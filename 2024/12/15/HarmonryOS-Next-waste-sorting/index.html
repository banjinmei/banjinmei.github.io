<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="LM">
    
    <title>
        
            HarmonryOS Next Waste Sorting |
        
        MLOG
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"banjinmei.github.io","root":"/","language":"en","path":"search1.xml"}
    KEEP.theme_config = {"base_info":{"primary_color":"#0066cc","title":"MLOG","author":"LM","avatar":"/images/avatar.svg","logo":"/images/logo.svg","favicon":"/images/logo.svg"},"menu":{"home":"/","archives":"/archives"},"first_screen":{"enable":false,"background_img":"/images/bg.svg","background_img_dark":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":false},"social_contact":{"enable":false,"links":{"github":null,"weixin":null,"qq":null,"weibo":null,"zhihu":null,"twitter":null,"x":null,"facebook":null,"email":null}},"scroll":{"progress_bar":false,"percent":false,"hide_header":true},"home":{"announcement":null,"category":false,"tag":false,"post_datetime":"updated"},"post":{"author_badge":{"enable":true,"level_badge":true,"custom_badge":["One","Two","Three"]},"word_count":{"wordcount":false,"min2read":false},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":false,"share":false,"reward":{"enable":false,"img_link":null,"text":null}},"code_block":{"tools":{"enable":false,"style":"default"},"highlight_theme":"default"},"toc":{"enable":false,"number":false,"expand_all":false,"init_open":true,"layout":"right"},"website_count":{"busuanzi_count":{"enable":false,"site_uv":false,"site_pv":false,"page_pv":false}},"local_search":{"enable":true,"preload":true},"comment":{"enable":false,"use":"valine","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.36"},"waline":{"server_url":null,"reaction":false,"version":"3.2.1"},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false},"artalk":{"server":null},"disqus":{"shortname":null}},"rss":{"enable":false},"lazyload":{"enable":false},"cdn":{"enable":false,"provider":"cdnjs"},"pjax":{"enable":false},"footer":{"since":2012,"word_count":false,"site_deploy":{"enable":false,"provider":"github","url":null},"record":{"enable":false,"list":[{"code":null,"link":null}]}},"inject":{"enable":false,"css":[null],"js":[null]},"root":"","source_data":{},"version":"4.1.3"}
    KEEP.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"}
    KEEP.language_code_block = {"copy":"Copy code","copied":"Copied","fold":"Fold code block","folded":"Folded"}
    KEEP.language_copy_copyright = {"copy":"Copy copyright info","copied":"Copied","title":"Original post title","author":"Original post author","link":"Original post link"}
  </script>
<meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/atom.xml" title="M Study Log" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    

    
</div>



<main class="page-container border-box">
    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               MLOG
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                
                                HOME
                            </a>
                        </li>
                    
                        
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                
                                ARCHIVES
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas search fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/"
                    >HOME</a>
                </li>
            
                
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives"
                    >ARCHIVES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">
                

                    
<div class="fade-in-down-animation">
    <div class="post-page-container border-box">
        <div class="post-content-container border-box">
            

            <div class="post-content-bottom border-box">
                
                    <div class="post-title">
                        HarmonryOS Next Waste Sorting
                    </div>
                

                
                    <div class="post-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/face.png">
                            </div>
                        
                        <div class="info-box">
                            <div class="author border-box">
                                <span class="name">mu</span>
                                
                                    <span class="author-badge">Lv6</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="post-meta-info-container border-box post">
    <div class="post-meta-info border-box">
        

        
            <span class="meta-info-item post-create-date">
                <i class="icon fa-solid fa-calendar-plus"></i>&nbsp;
                <span class="datetime">2024-12-15 15:33:54</span>
            </span>

            <span class="meta-info-item post-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="datetime" data-updated="Sun Dec 15 2024 16:58:35 GMT+0800">2024-12-15 16:58:35</span>
            </span>
        

        
            <span class="meta-info-item post-category border-box"><i class="icon fas fa-folder"></i>&nbsp;
                <ul class="post-category-ul">
                    
                            <li class="category-item"><a href="/categories/%E6%8A%80%E6%9C%AF/">技术</a></li>
                        
                    
                </ul>
            </span>
        

        
            <span class="post-tag meta-info-item border-box">
                <ul class="post-tag-ul">
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/HarmonryOS/">HarmonryOS</a></li>
                        
                    
                </ul>
            </span>
        

        
        
        
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="post-content keep-markdown-body ">
                    

                    <h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>DevEco Studio NEXT Beta1 Build Version: 5.0<br>API 13</p>
<h1 id="Waste-Sorting"><a href="#Waste-Sorting" class="headerlink" title="Waste Sorting"></a>Waste Sorting</h1><p>垃圾分类 </p>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//springCurve回弹</span></span><br><span class="line"><span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">    <span class="attr">duration</span>:<span class="number">800</span>,</span><br><span class="line">    <span class="attr">curve</span>: curves.<span class="title function_">springCurve</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">90</span>, <span class="number">20</span>),</span><br><span class="line">    <span class="comment">// 其他配置</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>初始偏移量、振幅、周期和阻尼系数，通过这些参数可以控制动画的弹性效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Fisher-Yates洗牌</span></span><br><span class="line"><span class="title function_">shuffleItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">garbageItems</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i] = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; curves &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入ArkUI工具包中的曲线模块</span></span><br><span class="line"><span class="comment">// 定义垃圾项目类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GarbageItem</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 垃圾名称</span></span><br><span class="line">  <span class="attr">type</span>: number; <span class="comment">// 垃圾类型</span></span><br><span class="line">  description?: string; <span class="comment">// 垃圾描述，可选</span></span><br><span class="line">  <span class="comment">// 构造函数初始化垃圾项目</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, type: number, description?: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name; <span class="comment">// 设置垃圾名称</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type; <span class="comment">// 设置垃圾类型</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">description</span> = description || <span class="string">&quot;&quot;</span>; <span class="comment">// 设置垃圾描述，默认为空字符串</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义垃圾类别类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GarbageCategory</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 类别名称</span></span><br><span class="line">  <span class="attr">type</span>: number; <span class="comment">// 类别类型</span></span><br><span class="line">  <span class="attr">color</span>: string; <span class="comment">// 类别颜色</span></span><br><span class="line">  <span class="attr">description</span>: string; <span class="comment">// 类别描述</span></span><br><span class="line">  <span class="comment">// 构造函数初始化垃圾类别</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, type: number, color: string, description: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name; <span class="comment">// 设置类别名称</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type; <span class="comment">// 设置类别类型</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color; <span class="comment">// 设置类别颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">description</span> = description; <span class="comment">// 设置类别描述</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用组件装饰器定义一个名为Index的应用入口</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="comment">// 定义状态变量</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentQuestionIndex</span>: number = <span class="number">0</span>; <span class="comment">// 当前题目索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">quizResults</span>: string[] = []; <span class="comment">// 测验结果数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">totalScore</span>: number = <span class="number">0</span>; <span class="comment">// 总得分</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">showAnimation</span>: boolean = <span class="literal">false</span>; <span class="comment">// 是否显示动画</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">scaleOptions</span>: <span class="title class_">ScaleOptions</span> = &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">1</span> &#125;; <span class="comment">// 缩放选项</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">itemXPosition</span>: number = <span class="number">0</span>; <span class="comment">// 物品X轴位置</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">itemOpacity</span>: number = <span class="number">1.0</span>; <span class="comment">// 物品透明度</span></span><br><span class="line">  <span class="comment">// 初始化垃圾类别数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">garbageCategories</span>: <span class="title class_">GarbageCategory</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;有害垃圾&quot;</span>, <span class="number">0</span>, <span class="string">&quot;#e2413f&quot;</span>, <span class="string">&quot;对人体健康或自然环境可能造成直接或潜在危害的生活垃圾&quot;</span>), <span class="comment">// 创建有害垃圾类别</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;可回收物&quot;</span>, <span class="number">1</span>, <span class="string">&quot;#1c6bb5&quot;</span>, <span class="string">&quot;适宜回收和资源利用的物品&quot;</span>), <span class="comment">// 创建可回收物类别</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;厨余垃圾&quot;</span>, <span class="number">2</span>, <span class="string">&quot;#4ca84e&quot;</span>, <span class="string">&quot;上海称湿垃圾，易腐烂的、含有机质的生活垃圾&quot;</span>), <span class="comment">// 创建厨余垃圾类别</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;其他垃圾&quot;</span>, <span class="number">3</span>, <span class="string">&quot;#5f5f5f&quot;</span>, <span class="string">&quot;上海称干垃圾，不能归类于以上三类的生活垃圾&quot;</span>), <span class="comment">// 创建其他垃圾类别</span></span><br><span class="line">  ];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">garbageItems</span>: <span class="title class_">GarbageItem</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;菜帮菜叶&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;剩菜剩饭&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;过期食品&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;瓜果皮壳&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;鱼骨鱼刺&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;鸡蛋及蛋壳&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;残枝落叶&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;茶叶渣&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;酒瓶&quot;</span>, <span class="number">1</span>,),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;玻璃杯&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;调味瓶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;图书&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;打印纸&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;信封&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;易拉罐&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;金属刀具&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;奶粉桶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;衣服裤子&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;毛绒玩具&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;鞋&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;饮料瓶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;塑料盆&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;食用油桶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;洗衣机&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;电烤箱&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;电视机&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;充电电池&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;废含汞荧光灯管&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;过期药品及其包装物&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;油漆桶&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;血压计&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;废水银温度计&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;杀虫喷雾罐&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;废X光片等感光胶片&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;食品袋&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;大棒骨&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;创可贴&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;污损塑料袋&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;烟屁&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;陶瓷碎片&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;餐巾纸&quot;</span>, <span class="number">3</span>, <span class="string">&quot;厕纸、卫生纸遇水即溶，不算可回收的“纸张”，类似的还有烟盒等。&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;卫生纸&quot;</span>, <span class="number">3</span>, <span class="string">&quot;厕纸、卫生纸遇水即溶，不算可回收的“纸张”，类似的还有烟盒等。&quot;</span>),</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在组件即将出现时重置测验</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetQuiz</span>(); <span class="comment">// 调用重置测验方法</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 重置测验状态</span></span><br><span class="line">  <span class="title function_">resetQuiz</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">quizResults</span> = []; <span class="comment">// 清空测验结果</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">totalScore</span> = <span class="number">0</span>; <span class="comment">// 清零总得分</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span> = <span class="number">0</span>; <span class="comment">// 重置当前题目索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shuffleItems</span>(); <span class="comment">// 打乱垃圾项目顺序</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 打乱垃圾项目顺序</span></span><br><span class="line">  <span class="title function_">shuffleItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">garbageItems</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>)); <span class="comment">// 随机索引</span></span><br><span class="line">      <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i]; <span class="comment">// 临时存储</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i] = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j]; <span class="comment">// 交换位置</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j] = temp; <span class="comment">// 交换位置</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 检查用户选择的答案</span></span><br><span class="line">  <span class="title function_">checkAnswer</span>(<span class="params">categoryType: number</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currentItem = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[<span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span>]; <span class="comment">// 获取当前垃圾项目</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">quizResults</span>.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;currentItem.name&#125;</span>（<span class="subst">$&#123;<span class="variable language_">this</span>.garbageCategories[categoryType].name&#125;</span>）【<span class="subst">$&#123;currentItem.type === categoryType ? <span class="string">&quot;✔&quot;</span> : <span class="variable language_">this</span>.garbageCategories[currentItem.type].name&#125;</span>】`</span>); <span class="comment">// 添加到测验结果中</span></span><br><span class="line">    <span class="keyword">if</span> (currentItem.<span class="property">type</span> === categoryType) &#123; <span class="comment">// 如果答案正确</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">totalScore</span> += <span class="number">10</span>; <span class="comment">// 加十分</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span>++; <span class="comment">// 进入下一个题目</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span> &gt;= <span class="number">10</span>) &#123; <span class="comment">// 如果完成了十个题目</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">displayResults</span>(); <span class="comment">// 显示结果</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">resetQuiz</span>(); <span class="comment">// 重置测验</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 显示测验结果</span></span><br><span class="line">  <span class="title function_">displayResults</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">sheets</span>: <span class="title class_">SheetInfo</span>[] = []; <span class="comment">// 初始化结果页面列表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">quizResults</span>.<span class="property">length</span>; i++) &#123; <span class="comment">// 循环添加每一个结果</span></span><br><span class="line">      sheets.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="variable language_">this</span>.<span class="property">quizResults</span>[i], <span class="comment">// 设置标题为测验结果</span></span><br><span class="line">        <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 不执行任何操作</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">showActionSheet</span>(&#123; <span class="comment">// 显示结果页</span></span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;成绩单&#x27;</span>, <span class="comment">// 标题</span></span><br><span class="line">      <span class="attr">message</span>: <span class="string">`总分数:<span class="subst">$&#123;<span class="variable language_">this</span>.totalScore&#125;</span>`</span>, <span class="comment">// 分数信息</span></span><br><span class="line">      <span class="attr">confirm</span>: &#123; <span class="comment">// 确认按钮</span></span><br><span class="line">        <span class="attr">defaultFocus</span>: <span class="literal">true</span>, <span class="comment">// 默认焦点</span></span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;我知道了&#x27;</span>, <span class="comment">// 按钮文本</span></span><br><span class="line">        <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 点击后的动作</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onWillDismiss</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 关闭前的动作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Center</span>, <span class="comment">// 对齐方式为中心</span></span><br><span class="line">      <span class="attr">sheets</span>: sheets <span class="comment">// 结果页面列表</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 构建用户界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 创建列布局</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`垃圾分类测验:<span class="subst">$&#123;<span class="variable language_">this</span>.currentQuestionIndex + <span class="number">1</span>&#125;</span>/10`</span>) <span class="comment">// 显示当前题目序号</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="string">&#x27;30lpx&#x27;</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">        .<span class="title function_">margin</span>(<span class="number">20</span>); <span class="comment">// 设置外边距</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建堆栈布局</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.garbageItems[<span class="variable language_">this</span>.currentQuestionIndex].name&#125;</span>`</span>) <span class="comment">// 显示当前垃圾项目名称</span></span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 居中对齐</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;130lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;130lpx&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;) <span class="comment">// 设置边框宽度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角半径</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="string">&#x27;20lpx&#x27;</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">2</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">scale</span>(<span class="variable language_">this</span>.<span class="property">scaleOptions</span>); <span class="comment">// 设置缩放比例</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">showAnimation</span>) &#123; <span class="comment">// 如果显示动画</span></span><br><span class="line">          <span class="title class_">Particle</span>(&#123; <span class="comment">// 创建粒子效果</span></span><br><span class="line">            <span class="attr">particles</span>: [ <span class="comment">// 初始化粒子数组</span></span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">emitter</span>: &#123; <span class="comment">// 粒子发射器配置</span></span><br><span class="line">                  <span class="attr">particle</span>: &#123; <span class="comment">// 粒子类型配置</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="title class_">ParticleType</span>.<span class="property">POINT</span>, <span class="comment">// 粒子类型为点</span></span><br><span class="line">                    <span class="attr">config</span>: &#123; <span class="comment">// 配置</span></span><br><span class="line">                      <span class="attr">radius</span>: <span class="number">5</span> <span class="comment">// 点的半径</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">count</span>: <span class="number">50</span>, <span class="comment">// 粒子数量</span></span><br><span class="line">                    <span class="attr">lifetime</span>: -<span class="number">1</span>, <span class="comment">// 生命周期</span></span><br><span class="line">                    <span class="attr">lifetimeRange</span>: -<span class="number">1</span> <span class="comment">// 生命周期范围</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="attr">emitRate</span>: <span class="number">100</span>, <span class="comment">// 发射速率</span></span><br><span class="line">                  <span class="attr">position</span>: [<span class="string">&#x27;25%&#x27;</span>, <span class="number">0</span>], <span class="comment">// 发射位置</span></span><br><span class="line">                  <span class="attr">size</span>: [<span class="string">&#x27;100lpx&#x27;</span>, <span class="string">&#x27;100lpx&#x27;</span>], <span class="comment">// 发射器大小</span></span><br><span class="line">                  <span class="attr">shape</span>: <span class="title class_">ParticleEmitterShape</span>.<span class="property">RECTANGLE</span> <span class="comment">// 发射器形状为矩形</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">color</span>: &#123; <span class="comment">// 粒子颜色配置</span></span><br><span class="line">                  <span class="attr">range</span>: [<span class="title class_">Color</span>.<span class="property">Orange</span>, <span class="title class_">Color</span>.<span class="property">Orange</span>], <span class="comment">// 颜色范围</span></span><br><span class="line">                  <span class="attr">updater</span>: &#123; <span class="comment">// 更新器配置</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="title class_">ParticleUpdater</span>.<span class="property">CURVE</span>, <span class="comment">// 变化方式为曲线变化</span></span><br><span class="line">                    <span class="attr">config</span>: [ <span class="comment">// 配置项</span></span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="attr">from</span>: <span class="title class_">Color</span>.<span class="property">Orange</span>, <span class="comment">// 起始颜色</span></span><br><span class="line">                        <span class="attr">to</span>: <span class="title class_">Color</span>.<span class="property">Orange</span>, <span class="comment">// 终止颜色</span></span><br><span class="line">                        <span class="attr">startMillis</span>: <span class="number">0</span>, <span class="comment">// 开始时间</span></span><br><span class="line">                        <span class="attr">endMillis</span>: -<span class="number">1</span>, <span class="comment">// 结束时间</span></span><br><span class="line">                        <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">FastOutLinearIn</span> <span class="comment">// 曲线类型</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ]</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">scale</span>: &#123; <span class="comment">// 粒子大小配置</span></span><br><span class="line">                  <span class="attr">range</span>: [<span class="number">0.8</span>, <span class="number">1.2</span>], <span class="comment">// 大小范围</span></span><br><span class="line">                  <span class="attr">updater</span>: &#123; <span class="comment">// 更新器配置</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="title class_">ParticleUpdater</span>.<span class="property">CURVE</span>, <span class="comment">// 变化方式为曲线变化</span></span><br><span class="line">                    <span class="attr">config</span>: [ <span class="comment">// 配置项</span></span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="attr">from</span>: <span class="number">1.0</span>, <span class="comment">// 起始大小</span></span><br><span class="line">                        <span class="attr">to</span>: <span class="number">1.0</span>, <span class="comment">// 终止大小</span></span><br><span class="line">                        <span class="attr">startMillis</span>: <span class="number">0</span>, <span class="comment">// 开始时间</span></span><br><span class="line">                        <span class="attr">endMillis</span>: -<span class="number">1</span>, <span class="comment">// 结束时间</span></span><br><span class="line">                        <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseIn</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ]</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 粒子加速度配置</span></span><br><span class="line">                <span class="attr">acceleration</span>: &#123;</span><br><span class="line">                  <span class="attr">speed</span>: &#123;</span><br><span class="line">                    <span class="attr">range</span>: [<span class="number">8000</span>, <span class="number">10000</span>], <span class="comment">// 向下减速，模拟重力</span></span><br><span class="line">                    <span class="attr">updater</span>: &#123;</span><br><span class="line">                      <span class="attr">type</span>: <span class="title class_">ParticleUpdater</span>.<span class="property">RANDOM</span>, <span class="comment">// 加速度线性变化</span></span><br><span class="line">                      <span class="attr">config</span>: [<span class="number">400</span>, <span class="number">500</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="attr">angle</span>: &#123;</span><br><span class="line">                    <span class="attr">range</span>: [<span class="number">90</span>, <span class="number">90</span>] <span class="comment">// 方向固定向下</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>).<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;150lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;300lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>)</span><br><span class="line">      .<span class="title function_">translate</span>(&#123;<span class="attr">x</span>:<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.itemXPosition&#125;</span>lpx`</span>,<span class="attr">y</span>:<span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">garbageCategories</span>, <span class="function">(<span class="params">category: GarbageCategory</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(category.<span class="property">name</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="string">&#x27;30lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">padding</span>(<span class="number">5</span>);</span><br><span class="line">            <span class="title class_">Divider</span>();</span><br><span class="line">            <span class="title class_">Text</span>(category.<span class="property">description</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="string">&#x27;28lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">padding</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(category.<span class="property">color</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;280lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&quot;24%&quot;</span>)</span><br><span class="line">          .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">1</span>, <span class="attr">right</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">scale</span>: <span class="number">0.8</span>, <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">MIDDLE</span> &#125;)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">showAnimation</span>)&#123;</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">showAnimation</span> = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">let</span> <span class="attr">itemX</span>:number = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">0</span>)&#123;</span><br><span class="line">              itemX = -<span class="number">270</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">1</span>)&#123;</span><br><span class="line">              itemX = -<span class="number">90</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">2</span>)&#123;</span><br><span class="line">              itemX = <span class="number">90</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">3</span>)&#123;</span><br><span class="line">              itemX = <span class="number">270</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">              <span class="attr">duration</span>:<span class="number">200</span>,</span><br><span class="line">              <span class="attr">onFinish</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                  <span class="attr">duration</span>:<span class="number">800</span>,</span><br><span class="line">                  <span class="attr">curve</span>: curves.<span class="title function_">springCurve</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">90</span>, <span class="number">20</span>),</span><br><span class="line">                  <span class="attr">onFinish</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                      <span class="attr">duration</span>:<span class="number">200</span>,</span><br><span class="line">                      <span class="attr">onFinish</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">itemXPosition</span> = <span class="number">0</span></span><br><span class="line">                        <span class="variable language_">this</span>.<span class="title function_">checkAnswer</span>(category.<span class="property">type</span>);</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">showAnimation</span> = <span class="literal">false</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">itemXPosition</span> = <span class="number">0</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">scaleOptions</span> = &#123; <span class="attr">x</span>: <span class="number">1.0</span>, <span class="attr">y</span>: <span class="number">1.0</span> &#125;;</span><br><span class="line">                    &#125;)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">scaleOptions</span> = &#123; <span class="attr">x</span>: <span class="number">1.3</span>, <span class="attr">y</span>: <span class="number">1.3</span> &#125;;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">itemXPosition</span> = itemX</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span> &#125;).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">resetQuiz</span>()</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="catch-cat"><a href="#catch-cat" class="headerlink" title="catch cat"></a>catch cat</h1><p>围住神经猫</p>
<h1 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h1><h2 id="1-广度优先搜索（BFS）："><a href="#1-广度优先搜索（BFS）：" class="headerlink" title="1. 广度优先搜索（BFS）："></a>1. 广度优先搜索（BFS）：</h2><p>广度优先搜索（Breadth-First Search，简称 BFS）是一种用于图和树结构的遍历或搜索算法。它从一个起始节点开始，首先访问该节点的所有邻接节点，然后再以同样的方式逐层访问这些邻接节点的邻接节点，直到访问完整个图或者找到目标节点为止。BFS的特点是按照从近到远的顺序访问节点，因此它非常适合用来寻找最短路径问题，尤其是在所有边的权重相等的情况下。</p>
<p>BFS的基本步骤如下：<br>初始化：选择一个起始节点，将其放入队列，并标记为已访问。<br>循环处理：<br>从队列中取出第一个节点。<br>检查该节点是否为目标节点；如果是，则结束搜索。<br>否则，将该节点的所有未访问过的邻接节点加入队列，并标记为已访问。<br>终止条件：当队列为空时，表示所有可到达的节点都已经被访问过，如果此时还没有找到目标节点，则说明目标节点不可达。</p>
<p>在 findNeighbors 方法中，通过遍历当前单元格的邻居来获取周围非墙壁且可以移动的单元格集合。这类似于广度优先搜索的思想，逐层遍历邻居单元格。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findNeighbors</span>(<span class="attr">cell</span>: <span class="title class_">Cell</span>): <span class="title class_">Cell</span>[] &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">neighbors</span>: <span class="title class_">Cell</span>[] = [];</span><br><span class="line">    <span class="comment">// 检查当前单元格的六个方向邻居，将非墙壁且可以移动的单元格加入集合</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> neighbors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="2-启发式搜索："><a href="#2-启发式搜索：" class="headerlink" title="2. 启发式搜索："></a>2. 启发式搜索：</h2><p>在 selectNextMove 方法中，根据一定的启发式函数选择下一个移动位置，以确保小猫朝着离边界最近的方向移动。这种启发式搜索可以帮助小猫更智能地选择下一步的移动位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">selectNextMove</span>(<span class="attr">emptyNeighbors</span>: <span class="title class_">Cell</span>[]): <span class="title class_">Cell</span> &#123;</span><br><span class="line">    <span class="comment">// 根据启发式函数选择最优的移动位置</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> closestToEdge || emptyNeighbors[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="3-曼哈顿距离计算："><a href="#3-曼哈顿距离计算：" class="headerlink" title="3. 曼哈顿距离计算："></a>3. 曼哈顿距离计算：</h2><p>曼哈顿距离（Manhattan Distance），也称为城市街区距离（City Block distance）或出租车几何，是衡量在标准坐标系中两个点之间沿轴向距离的总和。简单来说，它是从一个点到另一个点，在只允许水平或垂直移动的情况下，必须经过的最小距离。这个概念得名于美国纽约市曼哈顿区的街道布局，因为那里的街道大多呈网格状分布，车辆只能沿着这些街道行驶，而不能斜穿。</p>
<p>在 computeHeuristic 方法中，使用曼哈顿距离计算启发式函数的值，以评估当前单元格到边界的距离。曼哈顿距离是在网格上两点之间的距离，沿着网格的边缘移动。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">computeHeuristic</span>(<span class="attr">cell</span>: <span class="title class_">Cell</span>): number &#123;</span><br><span class="line">    <span class="comment">// 计算曼哈顿距离作为启发式函数的值</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> minDistanceX + minDistanceY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="wood-fish"><a href="#wood-fish" class="headerlink" title="wood fish"></a>wood fish</h1><p>电子木鱼</p>
<p>animateToImmediately </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 观察者模式装饰器</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: string = <span class="string">&#x27;功德+1&#x27;</span>; <span class="comment">// 默认显示的文字</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪属性变化</span></span><br><span class="line">  <span class="attr">opacity</span>: number = <span class="number">0</span>; <span class="comment">// 文字透明度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪属性变化</span></span><br><span class="line">  <span class="attr">y</span>: number = <span class="number">0</span>; <span class="comment">// 文字的垂直偏移量</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 主入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">list</span>: <span class="title class_">Cell</span>[] = []; <span class="comment">// 存储所有 Cell 对象的数组</span></span><br><span class="line">  <span class="attr">indexCount</span>: number = <span class="number">0</span>; <span class="comment">// 记录当前滚动的索引</span></span><br><span class="line">  <span class="attr">count</span>: number = <span class="number">10</span>; <span class="comment">// 列表中 Cell 对象的数量</span></span><br><span class="line">  <span class="attr">image</span>: string =</span><br><span class="line">    <span class="string">&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQsAAADICAYAAAD/XsT8AAAAAXNSR0IArs4c6QAAEApJREFUeF7tnV921LgSh+093Hfg6S7iPgALmDUAKyFZyQwrubASYCWelMfqcXfabVkuSVXS1+eEhESWpV+Vv1Mq/fE48EGBgwpM0/R2GIYPy2Vvlu/yO/msv8vPvyKrl3KhrHz/vVx3+d04jrF1Rd6SYkcUGI8UpmxfCixQkAf+/QKBNSRqiLGGifz8YwHML0CS3xzAIr/GLu6wgOHT0liJGkLk4KL9q6jke4DIOI7yMx8lBYCFkpAeq1kBwiMcYiWXCASAxKr1oBywUBDRUxUrQHxe5Rc8deFsW8NQ5i+JQIg+4uUEFvFauS25AsST207kaziRR6S2wCJSKI/Fpmn6+jKW7zWCSDVZgMc3oo5rCYFFqksZvY4oQtUwAg6GK4ukwELVt+pVtkAiRBL1GtLunQM4JOLocr0HsHDu3NM0yUzGn50mK2tYr9thCrCo4W4K91wiCYGEt/UQCr03U4WA43kcRxmqNP8BFs5MzHDDpMHmIco4js8mW6fUKGChJGTuakhc5lZYpf6m8xrAQsVH8layTIGyRiKvzJq1NxlpAAtNF1Gui+SlsqDlqxNofGllvQawKO9Au3dkyLErkacCzUQZwMKY2y3RxP+NNYvmnFdANrNJlOF2jQawOO8EKjUwy6Eio/VKBBQfvQIDWBhwL6IJA0Yo1wS3wxJgUc5J7t5pmiZZWCWbvfj0o4BLYACLSg7KCsxKwtu67ZOnhVzAooLzMOyoILrdW8rKzy92m/dvy4BFYSuxwKqw4D5u5wIYwKKQMzHsKCS039t8H8fxo+XmA4sC1mHYUUDkNm4hrzR4Z7UrwCKzZQBFZoHbq94sMIBFRmcjP5FR3LarNgkMYJHJ6Vg/kUnYfqo1BwxgkcH5pmmSvR2cYJVB286qNDVLAiwUvY8ZD0UxqSooYAYYwELJKRdQ/FSqjmpQYK2ACWAACwWnBBQKIlLFngLVl4YDiz0T7fwdUJwUkMuPKFAVGMDiiKluygKKE+JxaaoC1YABLBJNxmKrROG4TEOBKsAAFgmmAxQJonGJpgJVXm4ELA6aEFAcFIziuRQofnI4sDhgSnIUB8SiaAkFigIDWESaFFBECkWx0goUOwQYWESYlpWZESJRpKYCRYABLCJMzF6PCJEoUluB7BvPgMWOiQFF7WeA+x9QICswgMUDSwCKA25KUSsKZNtHAiw2TAworPg+7UhQIAswgMUdS3DCVYJ7cok1BdRXeQKLGxOz6Mqaz9OeEwqoAgNYrCwBKE64JZdaVEB10RawWEzMoiuLvk6bFBRQW4MBLP6FBedmKngmVZhUQGVKFVgMw8DMh0kHp1G6CpzOX3QPC2Y+dD2S2swqcDp/0TUsSGiadWwalkeBU+9T7RYWS0JT8hRv89iFWlHAnAKnchc9w4KEpjlfpkEFFHg3jqMMSQ5/uoQFeYrDfsIFjSgwjmPyM598oVftyFN4tRzt1lAAWESqyMKrSKEo1qoCpzaYdRVZsJ6i1WeAfkUqACxihCJPEaMSZRpXIDm5Kbp0EVmQp2j8EaB7MQqciip6ggXTpDHuRJmWFTgVVXQBi2ma/hyG4XPLXkDfUOCBAqeXeYe6mx6GMPzgIepcAbXt6c1HFtM0/WQ5d+ePS5/dF0hIjuJZs/vNRhZMk2q6CXU5UGAGxDAM31KXc+/1sUlYMPzYMzt/b0CBAIdBO4LY0qZVWDD8aOBpoAtXCggc5Ot7zujhkebNwYLZDx6xhhQI0cOPcRwFElU/TcGC4UdVX+Lm5xUwBYfb7rQGCxZfnXdYaiingGk4NAsL9n6U83DulKyAKzg0CQuGH8nOy4V5FXANh1ZhwfAjr9NTe5wCTcGhOVgw/IjzYkplUaAoHJbDm+SAafl6s/Qo/H+rg+G8zR9LATm0N2lmxXWCk+FHlgeASrcVKAKHBQrSik9LUz68rK+QL61PWK/xfGS1p3dYsPhKy32o51aB9SKorOscFjjkAsMjyx7aQ+IWFiy+4ulWVqAIHBYwSJQgwwjtiCFVkqiDcVzCguFHqk9w3UqBy96KXMunjYJhywl2geEVFgw/eO6PKpBt41WBHMPRvqaWf/jyZHewYPYj1Q+6uy5LMvJOtLA3G+FJ+IenarmCBe/98OR3Rduqnm9YTVO+X6YqBQqaMxJFBTpws82XJ3uDBYuvDli94aJq+YaGhhCa5v54by2GG1hM0ySH7srhu3z6UkAtargTLUikIBEDn2sF7kYXnmAxYdEuFFhHDafWN6zWLwgQOOH9mPu8ii5cwII1Fces7Kh0WEko30+BQfq8goOV9QuOTPGqqa+mUs3DgjUVnv1tPgYuAEE6IvsTZG9C2K9wunOLf0gS8ul0ZVSwVkDs9G79Cw+wIKlp34lfQSF1s1JsV5cpdBlakHOIFe14uauhiGlYkNQ8bt0CV6gOHY60dzXMIIo4Ilx62atFWtZhwUrNdENrXFkNDOvGAwkNUybVcTUUMQsLVmomGffMRSbAACTOmFD/2pd3klwYYRkWTJXq2z7UGBKM8gar07MQ2s1cIomvTHdqK5tU3yVvYRIWTJUmGfXRReaihnuNXWY2ZOEdSUt1F0iu8JK3MAcLpkqTjXo17bW897LYq+3OtJqZjTPqZb/2sprTIiyYKj1u/yw7LI83I/4KkpbxWlUueUlymoIFUUW0W7iDQ+gZkIi2saWCc97CGiyIKu67iFs4AAlLz3xyW2zBggVYV4YMcPg9jqPMWLj9EEm4Nd264XOS00xkMU0TC7D+2Uchx7O7BoR4GZBoAhKhE3ZgQVQxb4L6prnBqparskailvJZ7zvPiJiILDqOKh4ekJrV/MqVAwllQW1VN8+IVIdFp1FFa5GELKTq4XxKW49wudaYgUVPy7rlHZNfGhpuAIlyD2zVO8kekaqRRUebxR4esV7VCw7enCXZBwVrp/h/asOih6iiibwEkGjnqU/syX+rwaKDqKKJaAJIJD5a7V1WFRYtRxXuowkg0d7TfrJH/6sSWTS8Bd19NAEkTj5S7V5eDRYtRhWbr33z4D9AwoOVqrbxj+KRRaNRxe7r6qua+cHNgYRVy5hrVxVYtBZVyLoJd3s5gIS5h9F6g8rCosGo4u4LZC1bHUhYto7ptn0pOgx5mS5tKapwBYpl7wYrLk0/j6YbVw4WjUUVbqZGgYTpB9BT44rCopmoovYy+RgPAxIxKlHmgAJlYNFYVGE6oclW8QPuT9EjChSDRTNRxctLeUzmKoDEEb+nbIIC+WHRWFQhGpvKV3B8XYLbc0mKAnlhsTiynK3Z0scELIBESy7loi/ZYSFTdZ9dSBHfyKrLuoFEvKEoqapAPlg0GlWI+levoVc1x4PKgEQppbnPhgJZYdFiVBF0LJrk7ODsD55Q+wrkWe7dwWsIi+QtgIT9J6ijFmaDReuvIcw6FOGt4h09gn66qg+Ljo72V1+cBST8PDkdtlT38JuGk5r3fEMtumAnaIePnr8uq8Oi9eHHrYlPHXoDJPw9MR23WA8WHSfjDic7l6Ha12EY3nbsfHTdlwI6p3t3MPuxZ9aog3rJSezJyN8NK3D+JUOd5Sn2bCnQkCP2fiwF5f/y+fTyj7zflA8KeFVABRa95Sm8Gpt2o0CyAqffdTpNE6BIlp8LUcCNAufeot5xQtONhWkoCigpMM/6JR3YS0JTyQRUgwI+FEiDBQlNH9allSigqMC8WvlwZEGeQtEEVIUCPhSYd1kfggWg8GFZWokCygq8G8fxVzQsSGgqy091KOBEgfDqiyhYkNB0YlWaiQL6Clz2P+3CAlDoq0+NKOBIgctRDA9hscx8yMIrNjw5si5NRQFFBeZ8hdS3BwtWaCqqTlUo4E2B9as6N2FBQtObWWkvCqgrcHVey11YkKdQF50KUcCjAldHR76CBSs0PdqUNqNAFgUu+Yq7OQsWXmURnUpRwJsCr46MvIosOjqZ25vhaC8KlFbg1en1t7CYSreI+6EACphU4GoIcjUMmaap5dcNmrQGjUIBowrcPbV+jiyY/TBqMpqFAnUUuPsCrQALooo6RuGuKGBOgfVCrHXjAizIVZgzGQ1CgSoKbL6Wc2QGpIpBuCkKmFRgK6qYE5wkNk3ajEahQA0FHr6OU2DBZrEaZuGeKGBPgVfTpVc5i2mafrIF3Z7VaBEKFFZg9yXfElkAi8JW4XYoYE2BR7mK0FaBBTMh1ixHe1CgrAKbMyAMQ8oagruhgGUF5lcTxjSQBGeMSpRBgXYVmN8JEtM9gcXXl4JPMYUpgwIo0JQCu0nN22EIsGjK/nQGBaIUiB5+rBOccnK3zIjwQQEU6EeB6OHHBRbyAwuz+vEQeooCL+uqDg0/bmHxeRgG2XnKBwVQoG0Fvo/j+DGli2HXKUORFPW4BgV8KXA4T3GV4Az/YfepL6vTWhRIUOBwnmILFhJdyFDkQ0IjuAQFUMC2AqdAIV27PbCX4Yhtg9M6FEhRIGo5917F914yRLJzTzX+jgJ+FHh62ST2rNHcrdcXslBLQ13qQIG6CiRNkW41mRcj1zUmd0eBXAqoguJVzuK21ewbyWVH6kWBrAqog2IXFlJgeVGyHL0nyU8+KIACthVQSWbe6+LmMGRdeAHGp5ffsTvVtqPQur4VOD09+ki+KFiEClbQkBmTvUjj13Kd7JUPP/8ehuH98nu5njUdfTs3vddRQJ4viSiizqVIveUhWNyJNgIw5HsAgiwpDT/vtmsBkEBDIAJAdhWjAApcKSDPmkQU0c9cqn7JsEi94d51CzykmABEhj5EH3ui8fdeFciSyNwS0xwsbhsKPHp9Duj3jgLZEpluYbEBDxmuSNTBsIVnqjcFig07boU1H1nsecIq58GQZU8s/u5dAbWl2ylCuIfFRtKVqCPFG7jGqgJFZjv2Ot8ULDaGLCRK97yAv1tVQCAhSUyVjWBnO9k0LO5EHWGKVtaJ8EEBywpUHXLcE6YbWGxEHSHPwfSs5cemr7aZGHIAiw2nu1kYRtTR18NppbdmIREE6jay2PKQBRwyJSsrSiXiIOqw8ji12Q6BxPM4jn9Z7x6w2LEQUYd1F3bbPjeQILJI8LHValJyHQn6ccmsgGz2ktWX2fdyaOtNZHFCUTbBnRCvr0vnKdBhGL55hASRRQZnBR4ZRPVdpal1EmelJLI4q+CD64FHRnHtVt1EFMHUaWUHAx6VDZDv9gEQP3IfQJOvC/s1E1nsa5StxAoeb5imzSZzroq7AMRaPGCRy5US6yX6SBSuzGXNDjFi5AMWMSpVLLNaJBYWinGGRzl7dBc9PJIWWJRzPLU73ZwextmlasrO58jKFGfTuYdUuYBFqnIGr9uIQiQS2TuJ3WBvsjdJwBBOngcOEXIDiwiRvBe5iUSkOyEa6QEkAoUABuk7YEh0aGCRKFxLl23ARLoYYGI9MglACN/l/TTySoqs79FoyQdi+gIsYlSiTHiNZVDiNiKRqd/1O2TWit0DzRZ8bvdLhIdf6lu/qGr+GRiUdcy/AeOQohjN6eIJAAAAAElFTkSuQmCC&#x27;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化方法，在组件即将显示时被调用</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">count</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>()); <span class="comment">// 初始化 Cell 数组</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建 UI 的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 创建一个垂直布局容器</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆栈布局容器</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">list</span>, <span class="function">(<span class="params">item: Cell, _index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历 list 中的每一个 Cell</span></span><br><span class="line">          <span class="title class_">Text</span>(item.<span class="property">value</span>)<span class="comment">// 显示 Cell 中的文字</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置文字颜色为白色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">&#x27;50lpx&#x27;</span>)<span class="comment">// 设置文字大小</span></span><br><span class="line">            .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;item.y&#125;</span>lpx`</span> &#125;)<span class="comment">// 设置文字的垂直偏移量</span></span><br><span class="line">            .<span class="title function_">opacity</span>(item.<span class="property">opacity</span>) <span class="comment">// 设置文字的透明度</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>) <span class="comment">// 设置堆栈布局容器的宽度</span></span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;300lpx&#x27;</span>) <span class="comment">// 设置堆栈布局容器的高度</span></span><br><span class="line">      .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">BottomEnd</span>) <span class="comment">// 设置对齐方式为底部右端</span></span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Image</span>(<span class="variable language_">this</span>.<span class="property">image</span>)<span class="comment">// 显示图片</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>)<span class="comment">// 设置图片宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;300lpx&#x27;</span>)<span class="comment">// 设置图片高度</span></span><br><span class="line">        .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)<span class="comment">// 图片适应容器</span></span><br><span class="line">        .<span class="title function_">clickEffect</span>(&#123;</span><br><span class="line">          <span class="comment">// 点击效果配置</span></span><br><span class="line">          <span class="attr">scale</span>: <span class="number">0.5</span>, <span class="comment">// 缩放比例</span></span><br><span class="line">          <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span> <span class="comment">// 效果级别</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击图片时触发的回调</span></span><br><span class="line">          <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">indexCount</span> % <span class="variable language_">this</span>.<span class="property">count</span>; <span class="comment">// 计算当前滚动的索引</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">indexCount</span>++; <span class="comment">// 更新索引计数器</span></span><br><span class="line">          <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">            <span class="comment">// 立即开始动画</span></span><br><span class="line">            <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 动画持续时间为0毫秒</span></span><br><span class="line">            <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">              <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                <span class="comment">// 再次立即开始动画</span></span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span>, <span class="comment">// 动画持续时间为1000毫秒</span></span><br><span class="line">              &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">y</span> = -<span class="number">200</span> <span class="comment">// 设置 Cell 的垂直偏移量</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">opacity</span> = <span class="number">0</span> <span class="comment">// 设置 Cell 的透明度</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">y</span> = <span class="number">0</span> <span class="comment">// 设置 Cell 的垂直偏移量</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">opacity</span> = <span class="number">1</span> <span class="comment">// 设置 Cell 的透明度</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置容器高度为100%</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置容器宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 设置背景颜色为黑色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Sokoban"><a href="#Sokoban" class="headerlink" title="Sokoban"></a>Sokoban</h1><p>推箱子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span> <span class="comment">// 导入ArkUI工具包中的提示操作模块</span></span><br><span class="line">@<span class="title class_">ObservedV2</span> <span class="comment">// 观察者模式装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123; <span class="comment">// 定义游戏中的单元格类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪装饰器，标记属性以被跟踪</span></span><br><span class="line">  <span class="attr">type</span>: number = <span class="number">0</span>; <span class="comment">// 单元格类型，0：透明，1：墙，2：可移动区域</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">topLeft</span>: number = <span class="number">0</span>; <span class="comment">// 左上角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">topRight</span>: number = <span class="number">0</span>; <span class="comment">// 右上角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">bottomLeft</span>: number = <span class="number">0</span>; <span class="comment">// 左下角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">bottomRight</span>: number = <span class="number">0</span>; <span class="comment">// 右下角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">x</span>: number = <span class="number">0</span>; <span class="comment">// 单元格的X坐标偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">y</span>: number = <span class="number">0</span>; <span class="comment">// 单元格的Y坐标偏移量</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">cellType: number</span>) &#123; <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = cellType; <span class="comment">// 初始化单元格类型</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title class_">ObservedV2</span> <span class="comment">// 观察者模式装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPosition</span> &#123; <span class="comment">// 定义位置类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪装饰器，标记属性以被跟踪</span></span><br><span class="line">  <span class="attr">x</span>: number = <span class="number">0</span>; <span class="comment">// X坐标</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">y</span>: number = <span class="number">0</span>; <span class="comment">// Y坐标</span></span><br><span class="line">  <span class="title function_">setPosition</span>(<span class="params">x: number, y: number</span>) &#123; <span class="comment">// 设置位置的方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = x; <span class="comment">// 更新X坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y; <span class="comment">// 更新Y坐标</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title class_">Entry</span> <span class="comment">// 入口装饰器</span></span><br><span class="line">@<span class="title class_">Component</span> <span class="comment">// 组件装饰器</span></span><br><span class="line">struct <span class="title class_">Sokoban</span>  &#123; <span class="comment">// 定义游戏主结构</span></span><br><span class="line">  <span class="attr">cellWidth</span>: number = <span class="number">100</span>; <span class="comment">// 单元格宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">grid</span>: <span class="title class_">Cell</span>[][] = [ <span class="comment">// 游戏网格状态</span></span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">  ];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">victoryPositions</span>: <span class="title class_">MyPosition</span>[] = [<span class="keyword">new</span> <span class="title class_">MyPosition</span>(), <span class="keyword">new</span> <span class="title class_">MyPosition</span>()]; <span class="comment">// 胜利位置数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cratePositions</span>: <span class="title class_">MyPosition</span>[] = [<span class="keyword">new</span> <span class="title class_">MyPosition</span>(), <span class="keyword">new</span> <span class="title class_">MyPosition</span>()]; <span class="comment">// 箱子位置数组</span></span><br><span class="line">  <span class="attr">playerPosition</span>: <span class="title class_">MyPosition</span> = <span class="keyword">new</span> <span class="title class_">MyPosition</span>(); <span class="comment">// 玩家位置</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕Y坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕Y坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">startTime</span>: number = <span class="number">0</span>; <span class="comment">// 游戏开始时间</span></span><br><span class="line">  <span class="attr">isAnimationRunning</span>: boolean = <span class="literal">false</span> <span class="comment">// 动画是否正在运行</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123; <span class="comment">// 游戏加载前的准备工作</span></span><br><span class="line">    <span class="comment">// 初始化某些单元格的圆角大小...</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">0</span>][<span class="number">1</span>].<span class="property">topLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">0</span>][<span class="number">5</span>].<span class="property">topRight</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="property">topLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">4</span>][<span class="number">0</span>].<span class="property">bottomLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">5</span>][<span class="number">1</span>].<span class="property">bottomLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">5</span>][<span class="number">5</span>].<span class="property">bottomRight</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">1</span>][<span class="number">1</span>].<span class="property">bottomRight</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">4</span>][<span class="number">1</span>].<span class="property">topRight</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">2</span>][<span class="number">4</span>].<span class="property">topLeft</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">2</span>][<span class="number">4</span>].<span class="property">bottomLeft</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>(); <span class="comment">// 初始化游戏</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">initializeGame</span>(<span class="params"></span>) &#123; <span class="comment">// 初始化游戏状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 设置游戏开始时间为当前时间</span></span><br><span class="line">    <span class="comment">// 设置胜利位置和箱子位置...</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 设置游戏开始时间为当前时间</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">victoryPositions</span>[<span class="number">0</span>].<span class="title function_">setPosition</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">victoryPositions</span>[<span class="number">1</span>].<span class="title function_">setPosition</span>(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cratePositions</span>[<span class="number">0</span>].<span class="title function_">setPosition</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cratePositions</span>[<span class="number">1</span>].<span class="title function_">setPosition</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="title function_">setPosition</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isVictoryPositionVisible</span>(<span class="attr">x</span>: number, <span class="attr">y</span>: number): boolean &#123; <span class="comment">// 判断位置是否为胜利位置</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">victoryPositions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">position</span> =&gt;</span> position.<span class="property">x</span> === x &amp;&amp; position.<span class="property">y</span> === y); <span class="comment">// 返回是否有胜利位置与给定位置匹配</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isCratePositionVisible</span>(<span class="attr">x</span>: number, <span class="attr">y</span>: number): boolean &#123; <span class="comment">// 判断位置是否为箱子位置</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">cratePositions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">position</span> =&gt;</span> position.<span class="property">x</span> === x &amp;&amp; position.<span class="property">y</span> === y); <span class="comment">// 返回是否有箱子位置与给定位置匹配</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isPlayerPositionVisible</span>(<span class="attr">x</span>: number, <span class="attr">y</span>: number): boolean &#123; <span class="comment">// 判断位置是否为玩家位置</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span> === x &amp;&amp; <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span> === y; <span class="comment">// 返回玩家位置是否与给定位置相同</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">movePlayer</span>(<span class="params">direction: string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">directions</span>: object = <span class="title class_">Object</span>(&#123;</span><br><span class="line">      <span class="string">&#x27;right&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>: <span class="number">0</span>, <span class="attr">dy</span>:  <span class="number">1</span>&#125;),</span><br><span class="line">      <span class="string">&#x27;left&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>:<span class="number">0</span> , <span class="attr">dy</span>:-<span class="number">1</span> &#125;),</span><br><span class="line">      <span class="string">&#x27;down&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>: <span class="number">1</span>, <span class="attr">dy</span>: <span class="number">0</span> &#125;),</span><br><span class="line">      <span class="string">&#x27;up&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>: -<span class="number">1</span>, <span class="attr">dy</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">dx</span>: number = directions[direction][<span class="string">&#x27;dx&#x27;</span>]; <span class="comment">//&#123; dx, dy &#125;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">dy</span>: number = directions[direction][<span class="string">&#x27;dy&#x27;</span>]; <span class="comment">//&#123; dx, dy &#125;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">newX</span>: number = <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span> + dx;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">newY</span>: number = <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span> + dy;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> targetCell = <span class="variable language_">this</span>.<span class="property">grid</span>[newX][newY];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 检查新位置是否超出边界</span></span><br><span class="line">    <span class="keyword">if</span> (!targetCell) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 如果新位置是墙，则不能移动</span></span><br><span class="line">    <span class="keyword">if</span> (targetCell.<span class="property">type</span> === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> crateIndex = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCratePositionVisible</span>(newX, newY)) &#123;</span><br><span class="line">      <span class="keyword">const</span> crateBehindCell = <span class="variable language_">this</span>.<span class="property">grid</span>[newX + dx][newY + dy];</span><br><span class="line">      <span class="keyword">if</span> (!crateBehindCell || crateBehindCell.<span class="property">type</span> !== <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      crateIndex = <span class="variable language_">this</span>.<span class="property">cratePositions</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">crate</span> =&gt;</span> crate.<span class="property">x</span> === newX &amp;&amp; crate.<span class="property">y</span> === newY);</span><br><span class="line">      <span class="keyword">if</span> (crateIndex === -<span class="number">1</span> || <span class="variable language_">this</span>.<span class="title function_">isCratePositionVisible</span>(newX + dx, newY + dy)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">150</span>,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="attr">duration</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (crateIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">x</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">y</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span> += dx;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span> += dy;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">x</span> = <span class="number">0</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">y</span> = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="title function_">setPosition</span>(newX, newY);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 检查是否获胜</span></span><br><span class="line">          <span class="keyword">const</span> isAllCrateOnTarget = <span class="variable language_">this</span>.<span class="property">cratePositions</span>.<span class="title function_">every</span>(<span class="function"><span class="params">crate</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">victoryPositions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">victory</span> =&gt;</span> crate.<span class="property">x</span> === victory.<span class="property">x</span> &amp;&amp; crate.<span class="property">y</span> === victory.<span class="property">y</span>);</span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="keyword">if</span> (isAllCrateOnTarget) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;恭喜你，你赢了！&quot;</span>);</span><br><span class="line">            <span class="comment">// 可以在这里添加胜利处理逻辑</span></span><br><span class="line">            promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">              <span class="comment">// 显示对话框</span></span><br><span class="line">              <span class="attr">title</span>: <span class="string">&#x27;游戏胜利！&#x27;</span>, <span class="comment">// 对话框标题</span></span><br><span class="line">              <span class="attr">message</span>: <span class="string">&#x27;恭喜你，用时：&#x27;</span> + ((<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">startTime</span>) / <span class="number">1000</span>).<span class="title function_">toFixed</span>(<span class="number">3</span>) + <span class="string">&#x27;秒&#x27;</span>, <span class="comment">// 对话框消息</span></span><br><span class="line">              <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;] <span class="comment">// 对话框按钮</span></span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 对话框关闭后执行</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">x</span> = dy * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">y</span> = dx * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">      <span class="keyword">if</span> (crateIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">x</span> = dy * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">y</span> = dx * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`dx:<span class="subst">$&#123;dx&#125;</span>,dy:<span class="subst">$&#123;dy&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">//游戏区</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="comment">//非零区加瓷砖</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">grid</span>, <span class="function">(<span class="params">row: [], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">item: Cell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Stack</span>() &#123;</span><br><span class="line">                  <span class="title class_">Text</span>()</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(item.<span class="property">type</span> == <span class="number">0</span> ? <span class="title class_">Color</span>.<span class="property">Transparent</span> :</span><br><span class="line">                      ((rowIndex + colIndex) % <span class="number">2</span> == <span class="number">0</span> ? <span class="string">&quot;#cfb381&quot;</span> : <span class="string">&quot;#e1ca9f&quot;</span>))</span><br><span class="line">                    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">                      <span class="attr">topLeft</span>: item.<span class="property">topLeft</span> &gt; <span class="number">10</span> ? item.<span class="property">topLeft</span> : <span class="number">0</span>,</span><br><span class="line">                      <span class="attr">topRight</span>: item.<span class="property">topRight</span> &gt; <span class="number">10</span> ? item.<span class="property">topRight</span> : <span class="number">0</span>,</span><br><span class="line">                      <span class="attr">bottomLeft</span>: item.<span class="property">bottomLeft</span> &gt; <span class="number">10</span> ? item.<span class="property">bottomLeft</span> : <span class="number">0</span>,</span><br><span class="line">                      <span class="attr">bottomRight</span>: item.<span class="property">bottomRight</span> &gt; <span class="number">10</span> ? item.<span class="property">bottomRight</span> : <span class="number">0</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                  <span class="comment">//如果和是胜利坐标，显示叉号</span></span><br><span class="line">                  <span class="title class_">Stack</span>() &#123;</span><br><span class="line">                    <span class="title class_">Text</span>()</span><br><span class="line">                      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">8</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                    <span class="title class_">Text</span>()</span><br><span class="line">                      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">8</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                  &#125;.<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">45</span> &#125;)</span><br><span class="line">                  .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isVictoryPositionVisible</span>(rowIndex, colIndex) ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line"> </span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">grid</span>, <span class="function">(<span class="params">row: [], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">item: Cell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="comment">//是否显示箱子</span></span><br><span class="line">                <span class="title class_">Stack</span>() &#123;</span><br><span class="line">                  <span class="title class_">Text</span>()</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(item.<span class="property">type</span> == <span class="number">1</span> ? <span class="string">&quot;#412c0f&quot;</span> : <span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">                    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">                      <span class="attr">topLeft</span>: item.<span class="property">topLeft</span>,</span><br><span class="line">                      <span class="attr">topRight</span>: item.<span class="property">topRight</span>,</span><br><span class="line">                      <span class="attr">bottomLeft</span>: item.<span class="property">bottomLeft</span>,</span><br><span class="line">                      <span class="attr">bottomRight</span>: item.<span class="property">bottomRight</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                  <span class="title class_">Text</span>(<span class="string">&#x27;箱&#x27;</span>)</span><br><span class="line">                    .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                    .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                    .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#cb8321&quot;</span>)<span class="comment">//#995d12   #cb8321</span></span><br><span class="line">                    .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">                    .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isCratePositionVisible</span>(rowIndex, colIndex) ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">                  <span class="title class_">Text</span>(<span class="string">&#x27;我&#x27;</span>)</span><br><span class="line">                    .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                    .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                    .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#007dfe&quot;</span>)<span class="comment">//#995d12   #cb8321</span></span><br><span class="line">                    .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">                    .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isPlayerPositionVisible</span>(rowIndex, colIndex) ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="string">`<span class="subst">$&#123;item.x&#125;</span>lpx`</span>, <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;item.y&#125;</span>lpx`</span> &#125;)</span><br><span class="line"> </span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">MIDDLE</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#fdb300&quot;</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line">    .<span class="title function_">onTouch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Down</span> &amp;&amp; e.<span class="property">touches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 触摸开始，记录初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartX</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartY</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Up</span> &amp;&amp; e.<span class="property">changedTouches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 当手指抬起时，更新最后的位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenX</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenY</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">gesture</span>(</span><br><span class="line">      <span class="title class_">SwipeGesture</span>(&#123; <span class="attr">direction</span>: <span class="title class_">SwipeDirection</span>.<span class="property">All</span> &#125;)<span class="comment">// 支持方向中 all可以是上下左右</span></span><br><span class="line">        .<span class="title function_">onAction</span>(<span class="function">(<span class="params">_event: GestureEvent</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> swipeX = <span class="variable language_">this</span>.<span class="property">lastScreenX</span> - <span class="variable language_">this</span>.<span class="property">screenStartX</span>;</span><br><span class="line">          <span class="keyword">const</span> swipeY = <span class="variable language_">this</span>.<span class="property">lastScreenY</span> - <span class="variable language_">this</span>.<span class="property">screenStartY</span>;</span><br><span class="line">          <span class="comment">// 清除开始位置记录，准备下一次滑动判断</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartX</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartY</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeX) &gt; <span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeY)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">// 向右滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;right&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// 向左滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;left&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeY &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">// 向下滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;down&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// 向上滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;up&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Memory-Flip"><a href="#Memory-Flip" class="headerlink" title="Memory Flip"></a>Memory Flip</h1><p>记忆翻转</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span> <span class="comment">// 导入用于显示对话框的模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器来观察数据变化</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCell</span> &#123; <span class="comment">// 定义单元格类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: string; <span class="comment">// 单元格的值，即卡片上的图案</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isVisible</span>: boolean = <span class="literal">false</span>; <span class="comment">// 控制卡片是否可见</span></span><br><span class="line">  <span class="attr">isFrontVisible</span>: boolean = <span class="literal">false</span>; <span class="comment">// 控制卡片是否正面朝上</span></span><br><span class="line">  <span class="attr">isMatched</span>: boolean = <span class="literal">false</span>; <span class="comment">// 标记卡片是否已被匹配</span></span><br><span class="line">  <span class="attr">isAnimationRunning</span>: boolean = <span class="literal">false</span>; <span class="comment">// 动画是否正在运行</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span>; <span class="comment">// 卡片的旋转角度</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value: string</span>) &#123; <span class="comment">// 构造函数，初始化单元格</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value; <span class="comment">// 设置单元格的值</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 展示卡片正面的方法</span></span><br><span class="line">  <span class="title function_">revealFace</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isFrontVisible</span> = <span class="literal">true</span>; <span class="comment">// 设置卡片为正面朝上</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">true</span>; <span class="comment">// 设置卡片为可见</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">0</span>; <span class="comment">// 设置旋转角度为0</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为不可见</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重置卡片状态的方法</span></span><br><span class="line">  <span class="title function_">reset</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为不可见</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isFrontVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为背面朝上</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isMatched</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为未匹配</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 隐藏卡片正面的方法</span></span><br><span class="line">  <span class="title function_">hideFace</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isFrontVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为背面朝上</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为不可见</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">true</span>; <span class="comment">// 设置卡片为可见</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义组件入口</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">MemoryGame</span> &#123; <span class="comment">// 定义游戏组件</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">gameCells</span>: <span class="title class_">GameCell</span>[] = []; <span class="comment">// 存储游戏中的所有单元格</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">150</span>; <span class="comment">// 单元格的大小</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSpacing</span>: number = <span class="number">5</span>; <span class="comment">// 单元格之间的间距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">transitionDuration</span>: number = <span class="number">150</span>; <span class="comment">// 过渡动画的持续时间</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">firstSelectedIndex</span>: number | <span class="literal">null</span> = <span class="literal">null</span>; <span class="comment">// 记录第一次选择的卡片索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">secondSelectedIndex</span>: number | <span class="literal">null</span> = <span class="literal">null</span>; <span class="comment">// 记录第二次选择的卡片索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isGameOver</span>: boolean = <span class="literal">false</span>; <span class="comment">// 游戏是否结束</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">startTime</span>: number = <span class="number">0</span>; <span class="comment">// 游戏开始时间</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123; <span class="comment">// 组件即将显示时触发</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">cardValues</span>: string[] = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>]; <span class="comment">// 定义卡片的值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> cardValues) &#123; <span class="comment">// 遍历卡片值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">GameCell</span>(value)); <span class="comment">// 添加到游戏单元格数组中</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">GameCell</span>(value)); <span class="comment">// 每个值添加两次以形成对</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shuffleCards</span>(); <span class="comment">// 洗牌</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 洗牌方法</span></span><br><span class="line">  <span class="title function_">shuffleCards</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第一次选择索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第二次选择索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">false</span>; <span class="comment">// 游戏未结束</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 设置游戏开始时间为当前时间</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123; <span class="comment">// 重置所有单元格状态</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>[i].<span class="title function_">reset</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123; <span class="comment">// 洗牌算法</span></span><br><span class="line">      <span class="keyword">const</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>)); <span class="comment">// 随机索引</span></span><br><span class="line">      <span class="keyword">let</span> tempValue = <span class="variable language_">this</span>.<span class="property">gameCells</span>[i].<span class="property">value</span>; <span class="comment">// 临时保存值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>[i].<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">gameCells</span>[randomIndex].<span class="property">value</span>; <span class="comment">// 交换值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>[randomIndex].<span class="property">value</span> = tempValue; <span class="comment">// 交换值</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查卡片是否匹配的方法</span></span><br><span class="line">  <span class="title function_">checkForMatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> !== <span class="literal">null</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> !== <span class="literal">null</span>) &#123; <span class="comment">// 确保两个索引都不为空</span></span><br><span class="line">      <span class="keyword">const</span> firstCell = <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span>]; <span class="comment">// 获取第一个选中的单元格</span></span><br><span class="line">      <span class="keyword">const</span> secondCell = <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span>]; <span class="comment">// 获取第二个选中的单元格</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (firstCell.<span class="property">value</span> === secondCell.<span class="property">value</span>) &#123; <span class="comment">// 如果两个单元格的值相同</span></span><br><span class="line">        firstCell.<span class="property">isMatched</span> = <span class="literal">true</span>; <span class="comment">// 标记为已匹配</span></span><br><span class="line">        secondCell.<span class="property">isMatched</span> = <span class="literal">true</span>; <span class="comment">// 标记为已匹配</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第一次选择索引</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第二次选择索引</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="title function_">every</span>(<span class="function"><span class="params">cell</span> =&gt;</span> cell.<span class="property">isMatched</span>)) &#123; <span class="comment">// 如果所有单元格都已匹配</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>; <span class="comment">// 游戏结束</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;游戏结束&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">          promptAction.<span class="title function_">showDialog</span>(&#123; <span class="comment">// 显示对话框</span></span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;游戏胜利！&#x27;</span>, <span class="comment">// 对话框标题</span></span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;恭喜你，用时：&#x27;</span> + ((<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">startTime</span>) / <span class="number">1000</span>).<span class="title function_">toFixed</span>(<span class="number">3</span>) + <span class="string">&#x27;秒&#x27;</span>, <span class="comment">// 对话框消息</span></span><br><span class="line">            <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;] <span class="comment">// 对话框按钮</span></span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 对话框关闭后执行</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">shuffleCards</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果两个单元格的值不同</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 延迟一段时间后</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> !== <span class="literal">null</span>) &#123; <span class="comment">// 如果第一个索引不为空</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span>].<span class="title function_">hideFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 隐藏卡片</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第一次选择索引</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> !== <span class="literal">null</span>) &#123; <span class="comment">// 如果第二个索引不为空</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span>].<span class="title function_">hideFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 隐藏卡片</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第二次选择索引</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="number">400</span>); <span class="comment">// 延迟时间</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构建游戏界面的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建一个垂直布局</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123; <span class="comment">// 创建一个可换行的弹性布局</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">gameCells</span>, <span class="function">(<span class="params">gameCell: GameCell, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历游戏单元格</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;gameCell.isVisible ? gameCell.value : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>) <span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>) <span class="comment">// 设置边距</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 文本居中</span></span><br><span class="line">            .<span class="title function_">backgroundColor</span>(gameCell.<span class="property">isVisible</span> ? <span class="title class_">Color</span>.<span class="property">Orange</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="comment">// 设置旋转</span></span><br><span class="line">              <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">angle</span>: gameCell.<span class="property">rotationAngle</span>, <span class="comment">// 旋转角度</span></span><br><span class="line">              <span class="attr">centerX</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点X坐标</span></span><br><span class="line">              <span class="attr">centerY</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点Y坐标</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 单击事件处理</span></span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isGameOver</span>) &#123; <span class="comment">// 如果游戏已结束</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;游戏已结束&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (gameCell.<span class="property">isMatched</span>) &#123; <span class="comment">// 如果单元格已匹配</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;当前已标记&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> == <span class="literal">null</span>) &#123; <span class="comment">// 如果没有第一次选择</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = index; <span class="comment">// 设置第一次选择索引</span></span><br><span class="line">                <span class="keyword">if</span> (!gameCell.<span class="property">isFrontVisible</span>) &#123; <span class="comment">// 如果不是正面朝上</span></span><br><span class="line">                  gameCell.<span class="title function_">revealFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>); <span class="comment">// 展示正面</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> == index) &#123; <span class="comment">// 如果与第一次选择相同</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;和上一次点击的是一样的，不予处理&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> == <span class="literal">null</span>) &#123; <span class="comment">// 如果没有第二次选择</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = index; <span class="comment">// 设置第二次选择索引</span></span><br><span class="line">                <span class="keyword">if</span> (!gameCell.<span class="property">isFrontVisible</span>) &#123; <span class="comment">// 如果不是正面朝上</span></span><br><span class="line">                  gameCell.<span class="title function_">revealFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 展示正面</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">checkForMatch</span>(); <span class="comment">// 检查是否匹配</span></span><br><span class="line">                  &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">4</span>&#125;</span>lpx`</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>) <span class="comment">// 创建“重新开始”按钮</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 按钮点击事件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">shuffleCards</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置高度和宽度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3cup-ball"><a href="#3cup-ball" class="headerlink" title="3cup  ball"></a>3cup  ball</h1><p>三杯猜球</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用装饰器来追踪对象的变化</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cup</span> &#123;</span><br><span class="line">  <span class="comment">// 使用装饰器来追踪属性的变化</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">positionX</span>: number; <span class="comment">// 杯子的X轴位置</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">positionY</span>: number; <span class="comment">// 杯子的Y轴位置</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">containsBall</span>: boolean; <span class="comment">// 杯子内是否有球</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isRevealed</span>: boolean; <span class="comment">// 杯子是否打开</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数初始化杯子的状态</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">hasBall: boolean</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">positionX</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">positionY</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">containsBall</span> = hasBall;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRevealed</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 游戏入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">ThreeCupGame</span> &#123;</span><br><span class="line">  <span class="comment">// 游戏状态变量</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">gameCups</span>: <span class="title class_">Cup</span>[] = [<span class="comment">// 初始化三个杯子，其中一个有球</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cup</span>(<span class="literal">true</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cup</span>(<span class="literal">false</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cup</span>(<span class="literal">false</span>)</span><br><span class="line">  ];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cupWidth</span>: number = <span class="number">200</span>; <span class="comment">// 杯子宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cupSpacing</span>: number = <span class="number">10</span>; <span class="comment">// 杯子之间的间距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">animationDurationMs</span>: number = <span class="number">140</span>; <span class="comment">// 动画持续时间（毫秒）</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isGameAnimating</span>: boolean = <span class="literal">false</span>; <span class="comment">// 是否正在动画中</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">mixingCount</span>: number = <span class="number">5</span>; <span class="comment">// 每局游戏混合次数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentMixingCount</span>: number = <span class="number">0</span>; <span class="comment">// 当前正在进行的混合次数计数</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 开始游戏的方法</span></span><br><span class="line">  <span class="title function_">startGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentMixingCount</span>--; <span class="comment">// 减少混合次数</span></span><br><span class="line">    <span class="keyword">const</span> cupPairs = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">2</span>]]; <span class="comment">// 可能的杯子对组合</span></span><br><span class="line">    <span class="keyword">const</span> selectedPair = cupPairs[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * cupPairs.<span class="property">length</span>)]; <span class="comment">// 随机选择一对</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">moveCups</span>(selectedPair[<span class="number">0</span>], selectedPair[<span class="number">1</span>]); <span class="comment">// 开始移动选定的两个杯子</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 移动指定的两个杯子</span></span><br><span class="line">  <span class="title function_">moveCups</span>(<span class="params">cupIndex1: number, cupIndex2: number</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">direction</span>: number = <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.5</span> ? -<span class="number">1</span> : <span class="number">1</span>; <span class="comment">// 随机方向</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">distanceFactor</span>: number = <span class="title class_">Math</span>.<span class="title function_">abs</span>(cupIndex1 - cupIndex2); <span class="comment">// 距离因子</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">adjustedDistanceFactor</span>: number = distanceFactor === <span class="number">1</span> ? <span class="number">2</span> : <span class="number">1</span>; <span class="comment">// 根据距离调整因子</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionY</span> = -direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionX</span> = (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionY</span> = -direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> * <span class="number">2</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionX</span> = (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionY</span> = <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionY</span> = direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionX</span> = -(<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionY</span> = direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> * <span class="number">2</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">swapBalls</span>(cupIndex1, cupIndex2)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionX</span> = -(<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionY</span> = <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 重置杯子的位置</span></span><br><span class="line">  <span class="title function_">resetCupPosition</span>(<span class="params">cupIndex: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex].<span class="property">positionX</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex].<span class="property">positionY</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 交换两个杯子内的球</span></span><br><span class="line">  <span class="title function_">swapBalls</span>(<span class="params">cupIndex1: number, cupIndex2: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetCupPosition</span>(cupIndex1);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetCupPosition</span>(cupIndex2);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> temporaryBallStatus = <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">containsBall</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">containsBall</span> = <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">containsBall</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">containsBall</span> = temporaryBallStatus;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentMixingCount</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isGameAnimating</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">startGame</span>();</span><br><span class="line">      &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建游戏界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// 游戏标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;猜小球游戏&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 动画速度控制器</span></span><br><span class="line">      <span class="title class_">Counter</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`当前速度<span class="subst">$&#123;<span class="variable language_">this</span>.animationDurationMs&#125;</span>毫秒`</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="string">&#x27;26lpx&#x27;</span>);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>).<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> += <span class="number">10</span>;</span><br><span class="line">      &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> -= <span class="number">10</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> = <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> &lt; <span class="number">10</span> ? <span class="number">10</span> : <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 混合次数控制器</span></span><br><span class="line">      <span class="title class_">Counter</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`每局混合<span class="subst">$&#123;<span class="variable language_">this</span>.mixingCount&#125;</span>次`</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="string">&#x27;26lpx&#x27;</span>);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>).<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mixingCount</span> += <span class="number">1</span>;</span><br><span class="line">      &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mixingCount</span> -= <span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mixingCount</span> = <span class="variable language_">this</span>.<span class="property">mixingCount</span> &lt; <span class="number">1</span> ? <span class="number">1</span> : <span class="variable language_">this</span>.<span class="property">mixingCount</span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 杯子布局</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">gameCups</span>, <span class="function">(<span class="params">cup: Cup</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(cup.<span class="property">isRevealed</span> ? (cup.<span class="property">containsBall</span> ? <span class="string">&#x27;小球&#x27;</span> : <span class="string">&#x27;空&#x27;</span>) : <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupWidth&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupWidth&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupSpacing&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupWidth / <span class="number">4</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="string">`<span class="subst">$&#123;cup.positionX&#125;</span>lpx`</span>, <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;cup.positionY&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameAnimating</span>) &#123;</span><br><span class="line">                cup.<span class="property">isRevealed</span> = <span class="literal">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;720lpx&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 开始游戏按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;开始游戏&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameAnimating</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentMixingCount</span> = <span class="variable language_">this</span>.<span class="property">mixingCount</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isGameAnimating</span> = <span class="literal">true</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameCups</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cup</span> =&gt;</span> cup.<span class="property">isRevealed</span> = <span class="literal">false</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">startGame</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h1 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器标记Cell类，可能表示该类具有可观测性</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  <span class="comment">// 使用Trace装饰器标记value属性，可能表示该属性的变化会被追踪</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: number;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数初始化单元格的值为0</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用Entry和Component装饰器标记Game2048结构体，可能表示这是程序的入口点，并且该结构体定义了一个组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">  <span class="comment">// 定义Game2048结构体</span></span><br><span class="line">struct <span class="title class_">Game2048</span> &#123;</span><br><span class="line">  <span class="comment">// 使用State装饰器标记状态变量，可能表示这些变量是组件的状态</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">board</span>: <span class="title class_">Cell</span>[][] = []; <span class="comment">// 游戏盘面</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">score</span>: number = <span class="number">0</span>; <span class="comment">// 分数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">200</span>; <span class="comment">// 单元格大小</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellMargin</span>: number = <span class="number">5</span>; <span class="comment">// 单元格之间的边距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕Y坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕Y坐标</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 定义颜色数组</span></span><br><span class="line">  <span class="attr">colors</span>: string[] = [</span><br><span class="line">    <span class="string">&#x27;#CCCCCC&#x27;</span>, <span class="comment">// 0 - 灰色</span></span><br><span class="line">    <span class="string">&#x27;#FFC107&#x27;</span>, <span class="comment">// 2 - 黄色</span></span><br><span class="line">    <span class="string">&#x27;#FF9800&#x27;</span>, <span class="comment">// 4 - 橙色</span></span><br><span class="line">    <span class="string">&#x27;#FF5722&#x27;</span>, <span class="comment">// 8 - 深橙色</span></span><br><span class="line">    <span class="string">&#x27;#F44336&#x27;</span>, <span class="comment">// 16 - 红色</span></span><br><span class="line">    <span class="string">&#x27;#9C27B0&#x27;</span>, <span class="comment">// 32 - 紫色</span></span><br><span class="line">    <span class="string">&#x27;#3F51B5&#x27;</span>, <span class="comment">// 64 - 蓝紫色</span></span><br><span class="line">    <span class="string">&#x27;#00BCD4&#x27;</span>, <span class="comment">// 128 - 蓝色</span></span><br><span class="line">    <span class="string">&#x27;#009688&#x27;</span>, <span class="comment">// 256 - 深青色</span></span><br><span class="line">    <span class="string">&#x27;#4CAF50&#x27;</span>, <span class="comment">// 512 - 绿色</span></span><br><span class="line">    <span class="string">&#x27;#8BC34A&#x27;</span>, <span class="comment">// 1024 - 浅绿色</span></span><br><span class="line">    <span class="string">&#x27;#CDDC39&#x27;</span>, <span class="comment">// 2048 - 柠檬黄</span></span><br><span class="line">    <span class="string">&#x27;#FFEB3B&#x27;</span>, <span class="comment">// 4096 - 淡黄色</span></span><br><span class="line">    <span class="string">&#x27;#795548&#x27;</span>, <span class="comment">// 8192 - 棕色</span></span><br><span class="line">    <span class="string">&#x27;#607D8B&#x27;</span>, <span class="comment">// 16384 - 深灰色</span></span><br><span class="line">    <span class="string">&#x27;#9E9E9E&#x27;</span>, <span class="comment">// 32768 - 灰色</span></span><br><span class="line">    <span class="string">&#x27;#000000&#x27;</span> <span class="comment">// 以上 - 黑色</span></span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 游戏即将出现时执行的方法</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">score</span> = <span class="number">0</span>; <span class="comment">// 重置分数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initBoard</span>(); <span class="comment">// 重新初始化游戏板</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">addRandomTiles</span>(<span class="number">2</span>); <span class="comment">// 添加两个随机方块</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化游戏盘面</span></span><br><span class="line">  <span class="title function_">initBoard</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">cellArr</span>: <span class="title class_">Cell</span>[] = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">          cellArr.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>()); <span class="comment">// 创建新单元格</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>.<span class="title function_">push</span>(cellArr); <span class="comment">// 添加到盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">board</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">board</span>[i].<span class="property">length</span>; j++) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">board</span>[i][j].<span class="property">value</span> = <span class="number">0</span>; <span class="comment">// 清空单元格</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在盘面上添加指定数量的随机方块</span></span><br><span class="line">  <span class="title function_">addRandomTiles</span>(<span class="params">count: number</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">emptyCells</span>: object[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          emptyCells.<span class="title function_">push</span>(<span class="title class_">Object</span>(&#123; <span class="attr">row</span>: row, <span class="attr">col</span>: col &#125;)); <span class="comment">// 记录空单元格位置</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (emptyCells.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * emptyCells.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">let</span> obj = emptyCells[randomIndex];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[obj[<span class="string">&#x27;row&#x27;</span>]][obj[<span class="string">&#x27;col&#x27;</span>]].<span class="property">value</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.9</span> ? <span class="number">2</span> : <span class="number">4</span>; <span class="comment">// 随机生成2或4</span></span><br><span class="line">        emptyCells.<span class="title function_">splice</span>(randomIndex, <span class="number">1</span>); <span class="comment">// 移除已使用的空单元格位置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向左滑动</span></span><br><span class="line">  <span class="title function_">slideLeft</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempRow</span>: number[] = []; <span class="comment">// 临时存储行数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempRow.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">let</span> mergePos = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &lt; tempRow.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempRow[mergePos] === tempRow[mergePos + <span class="number">1</span>] &amp;&amp; !merged[mergePos]) &#123;</span><br><span class="line">          tempRow[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempRow[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempRow.<span class="title function_">splice</span>(mergePos + <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">while</span> (tempRow.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempRow.<span class="title function_">push</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> = tempRow[col]; <span class="comment">// 更新盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向右滑动</span></span><br><span class="line">  <span class="title function_">slideRight</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempRow</span>: number[] = []; <span class="comment">// 临时存储行数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">3</span>; col &gt;= <span class="number">0</span>; col--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempRow.<span class="title function_">unshift</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> mergePos = tempRow.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempRow[mergePos] === tempRow[mergePos - <span class="number">1</span>] &amp;&amp; !merged[mergePos - <span class="number">1</span>]) &#123;</span><br><span class="line">          tempRow[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempRow[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos - <span class="number">1</span>] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempRow.<span class="title function_">splice</span>(mergePos - <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos--;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">while</span> (tempRow.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempRow.<span class="title function_">unshift</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> = tempRow[col]; <span class="comment">// 更新盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向上滑动</span></span><br><span class="line">  <span class="title function_">slideUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempCol</span>: number[] = []; <span class="comment">// 临时存储列数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempCol.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">let</span> mergePos = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &lt; tempCol.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempCol[mergePos] === tempCol[mergePos + <span class="number">1</span>] &amp;&amp; !merged[mergePos]) &#123;</span><br><span class="line">          tempCol[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempCol[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempCol.<span class="title function_">splice</span>(mergePos + <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">while</span> (tempCol.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempCol.<span class="title function_">push</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> newRow = <span class="number">0</span>; newRow &lt; <span class="number">4</span>; newRow++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[newRow][col].<span class="property">value</span> = tempCol[newRow]; <span class="comment">// 更新盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向下滑动</span></span><br><span class="line">  <span class="title function_">slideDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempCol</span>: number[] = []; <span class="comment">// 临时存储列数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 从下往上遍历列</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">3</span>; row &gt;= <span class="number">0</span>; row--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempCol.<span class="title function_">unshift</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> mergePos = tempCol.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempCol[mergePos] === tempCol[mergePos - <span class="number">1</span>] &amp;&amp; !merged[mergePos - <span class="number">1</span>]) &#123;</span><br><span class="line">          tempCol[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempCol[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos - <span class="number">1</span>] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempCol.<span class="title function_">splice</span>(mergePos - <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos--;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 如果数组长度小于4，用0填充</span></span><br><span class="line">      <span class="keyword">while</span> (tempCol.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempCol.<span class="title function_">unshift</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 将处理后的数组元素放回到棋盘的对应列中</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[<span class="number">3</span> - row][col].<span class="property">value</span> = tempCol[<span class="number">3</span> - row]; <span class="comment">// 注意反转顺序</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建游戏界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 布局容器</span></span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// 显示得分</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`得分: <span class="subst">$&#123;<span class="variable language_">this</span>.score&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 底层背景布局</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span>, <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Row</span> &#125;) &#123;</span><br><span class="line">        <span class="comment">// 遍历每个单元格</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">board</span>.<span class="title function_">flat</span>(), <span class="function">(<span class="params">cell: Cell, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 显示单元格上的数字</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;cell.value || <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>px`</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>px`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>px`</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;cell.value &gt;= <span class="number">100</span> ? <span class="variable language_">this</span>.cellSize / <span class="number">3</span> : <span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>px`</span>) <span class="comment">// 根据数字大小调整字体大小</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">colors</span>[cell.<span class="property">value</span> == <span class="number">0</span>?<span class="number">0</span>:<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">log2</span>(cell.<span class="property">value</span>))]) <span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(cell.<span class="property">value</span> === <span class="number">0</span> ? <span class="string">&#x27;#000&#x27;</span> : <span class="string">&#x27;#fff&#x27;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 圆角</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellMargin * <span class="number">2</span>) * <span class="number">4</span>&#125;</span>px`</span>) <span class="comment">// 设置容器宽度</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 重新开始按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">aboutToAppear</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onTouch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Down</span> &amp;&amp; e.<span class="property">touches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 触摸开始，记录初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartX</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartY</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Up</span> &amp;&amp; e.<span class="property">changedTouches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 当手指抬起时，更新最后的位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenX</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenY</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">gesture</span>(</span><br><span class="line">      <span class="title class_">SwipeGesture</span>(&#123; <span class="attr">direction</span>: <span class="title class_">SwipeDirection</span>.<span class="property">All</span> &#125;) <span class="comment">// 支持方向中 all可以是上下左右</span></span><br><span class="line">        .<span class="title function_">onAction</span>(<span class="function">(<span class="params">_event: GestureEvent</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> swipeX = <span class="variable language_">this</span>.<span class="property">lastScreenX</span> - <span class="variable language_">this</span>.<span class="property">screenStartX</span>;</span><br><span class="line">          <span class="keyword">const</span> swipeY = <span class="variable language_">this</span>.<span class="property">lastScreenY</span> - <span class="variable language_">this</span>.<span class="property">screenStartY</span>;</span><br><span class="line">          <span class="comment">// 清除开始位置记录，准备下一次滑动判断</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartX</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartY</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeX) &gt; <span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeY)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideRight</span>(); <span class="comment">// 向右滑动</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideLeft</span>(); <span class="comment">// 向左滑动</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeY &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideDown</span>(); <span class="comment">// 向下滑动</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideUp</span>(); <span class="comment">// 向上滑动</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">addRandomTiles</span>(<span class="number">1</span>); <span class="comment">// 添加一个随机方块</span></span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="X✔"><a href="#X✔" class="headerlink" title="X✔"></a>X✔</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> winningLines = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>], <span class="comment">// Horizontal 1</span></span><br><span class="line">  [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>], <span class="comment">// Horizontal 2</span></span><br><span class="line">  [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="comment">// Horizontal 3</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>], <span class="comment">// Vertical 1</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>], <span class="comment">// Vertical 2</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="comment">// Vertical 3</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="comment">// Diagonal \</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>]<span class="comment">// Diagonal /</span></span><br><span class="line">];</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GridCell</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 当前格子的值</span></span><br><span class="line">  <span class="attr">rowIndex</span>: number = <span class="number">0</span>; <span class="comment">// 格子所在的行号</span></span><br><span class="line">  <span class="attr">colIndex</span>: number = <span class="number">0</span>; <span class="comment">// 格子所在的列号</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">rowIndex: number, colIndex: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rowIndex</span> = rowIndex;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colIndex</span> = colIndex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">TicTacToe</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">board</span>: <span class="title class_">GridCell</span>[][] = []; <span class="comment">// 游戏板</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentPlayer</span>: string = <span class="string">&#x27;X&#x27;</span>; <span class="comment">// 当前玩家</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isGameOver</span>: boolean = <span class="literal">false</span>; <span class="comment">// 游戏是否结束</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">winner</span>: string = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 获胜者</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">120</span>; <span class="comment">// 单元格大小</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellMargin</span>: number = <span class="number">5</span>; <span class="comment">// 单元格边距</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时初始化游戏</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">board</span> = [</span><br><span class="line">      [<span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">0</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">0</span>, <span class="number">2</span>)],</span><br><span class="line">      [<span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">1</span>, <span class="number">2</span>)],</span><br><span class="line">      [<span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">2</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">2</span>, <span class="number">2</span>)]</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initGame</span>(); <span class="comment">// 初始化游戏状态</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 重置游戏状态</span></span><br><span class="line">  <span class="title function_">initGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[i][j].<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 清空所有单元格</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentPlayer</span> = <span class="string">&#x27;X&#x27;</span>; <span class="comment">// 设置当前玩家为X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">false</span>; <span class="comment">// 游戏未结束</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">winner</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 无获胜者</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查是否有玩家获胜</span></span><br><span class="line">  <span class="title function_">checkForWinner</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> winningLines) &#123; <span class="comment">// 遍历所有胜利线路</span></span><br><span class="line">      <span class="keyword">const</span> mark = <span class="variable language_">this</span>.<span class="property">board</span>[line[<span class="number">0</span>]][line[<span class="number">1</span>]].<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">if</span> (mark &amp;&amp; <span class="comment">// 如果有标记</span></span><br><span class="line">        mark === <span class="variable language_">this</span>.<span class="property">board</span>[line[<span class="number">2</span>]][line[<span class="number">3</span>]].<span class="property">value</span> &amp;&amp; <span class="comment">// 并且等于同一行的下一个标记</span></span><br><span class="line">        mark === <span class="variable language_">this</span>.<span class="property">board</span>[line[<span class="number">4</span>]][line[<span class="number">5</span>]].<span class="property">value</span>) &#123; <span class="comment">// 再次等于同一行的下一个标记</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>; <span class="comment">// 游戏结束</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">winner</span> = mark; <span class="comment">// 设置获胜者</span></span><br><span class="line">        <span class="keyword">return</span> mark; <span class="comment">// 返回获胜者的标记</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> allCellsFilled = <span class="variable language_">this</span>.<span class="property">board</span>.<span class="title function_">flat</span>().<span class="title function_">every</span>(<span class="function"><span class="params">cell</span> =&gt;</span> cell.<span class="property">value</span> !== <span class="string">&#x27;&#x27;</span>); <span class="comment">// 检查所有单元格是否已填满</span></span><br><span class="line">    <span class="keyword">if</span> (allCellsFilled) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>; <span class="comment">// 游戏结束</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">winner</span> = <span class="string">&#x27;平局&#x27;</span>; <span class="comment">// 设置为平局</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;平局&#x27;</span>; <span class="comment">// 返回平局标识</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>; <span class="comment">// 无获胜者</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 玩家落子</span></span><br><span class="line">  <span class="title function_">placeMark</span>(<span class="params">rowIndex: number, colIndex: number</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameOver</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">board</span>[rowIndex][colIndex].<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">// 如果游戏未结束且单元格为空</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">board</span>[rowIndex][colIndex].<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">currentPlayer</span>; <span class="comment">// 放置标记</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">checkForWinner</span>(); <span class="comment">// 检查是否有获胜者</span></span><br><span class="line">      <span class="keyword">if</span> (result) &#123; <span class="comment">// 如果有获胜者</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;result&#125;</span> 获胜！`</span>);</span><br><span class="line">        <span class="keyword">let</span> message = <span class="string">`<span class="subst">$&#123;result&#125;</span> 获胜！`</span>; <span class="comment">// 设置提示信息</span></span><br><span class="line">        <span class="keyword">if</span> (result === <span class="string">&#x27;平局&#x27;</span>) &#123;</span><br><span class="line">          message = <span class="string">&#x27;平局！&#x27;</span>; <span class="comment">// 如果是平局</span></span><br><span class="line">        &#125;</span><br><span class="line">        promptAction.<span class="title function_">showDialog</span>(&#123; <span class="comment">// 显示对话框</span></span><br><span class="line">          <span class="attr">title</span>: <span class="string">`游戏结束`</span>, <span class="comment">// 标题</span></span><br><span class="line">          message, <span class="comment">// 提示信息</span></span><br><span class="line">          <span class="attr">buttons</span>: [ <span class="comment">// 按钮</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="comment">// 文本</span></span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> <span class="comment">// 颜色</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initGame</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果没有获胜者</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentPlayer</span> = <span class="variable language_">this</span>.<span class="property">currentPlayer</span> === <span class="string">&#x27;X&#x27;</span> ? <span class="string">&#x27;O&#x27;</span> : <span class="string">&#x27;X&#x27;</span>; <span class="comment">// 切换玩家</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPlayer</span> === <span class="string">&#x27;O&#x27;</span>) &#123; <span class="comment">// 如果是AI玩家</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">aiMove</span>(); <span class="comment">// AI落子</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// AI落子</span></span><br><span class="line">  <span class="title function_">aiMove</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> moveFound = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">bestMove</span>: <span class="literal">null</span> | number[] = <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 寻找最佳落子位置</span></span><br><span class="line">    bestMove = <span class="variable language_">this</span>.<span class="title function_">findWinningMove</span>(<span class="string">&#x27;O&#x27;</span>); <span class="comment">// 检查AI是否有胜利机会</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove a:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (bestMove) &#123;</span><br><span class="line">      moveFound = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      bestMove = <span class="variable language_">this</span>.<span class="title function_">findWinningMove</span>(<span class="string">&#x27;X&#x27;</span>); <span class="comment">// 检查玩家是否有胜利机会</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove b:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (bestMove) &#123;</span><br><span class="line">        moveFound = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bestMove = <span class="variable language_">this</span>.<span class="title function_">findRandomMove</span>(); <span class="comment">// 随机落子</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove c:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">if</span> (bestMove) &#123;</span><br><span class="line">          moveFound = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (moveFound &amp;&amp; bestMove) &#123; <span class="comment">// 如果找到了合适的落子位置</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">placeMark</span>(bestMove[<span class="number">0</span>], bestMove[<span class="number">1</span>]); <span class="comment">// 落子</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 寻找给定玩家是否有机会赢，并返回这样的移动位置</span></span><br><span class="line">  <span class="title function_">findWinningMove</span>(<span class="params">player: string</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> winningLines) &#123; <span class="comment">// 遍历所有胜利线路</span></span><br><span class="line">      <span class="keyword">let</span> missingIndex = -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">let</span> noEmptyCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; line.<span class="property">length</span>; i += <span class="number">2</span>) &#123; <span class="comment">// 检查每个单元格</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[line[i]][line[i + <span class="number">1</span>]].<span class="property">value</span> === player) &#123; <span class="comment">// 如果是该玩家的标记</span></span><br><span class="line">          noEmptyCount++; <span class="comment">// 计数</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[line[i]][line[i + <span class="number">1</span>]].<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">// 如果为空</span></span><br><span class="line">          missingIndex = i; <span class="comment">// 记录空格位置</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (noEmptyCount === <span class="number">2</span> &amp;&amp; missingIndex != -<span class="number">1</span>) &#123; <span class="comment">// 如果有两个标记且有一个空格</span></span><br><span class="line">        <span class="keyword">return</span> [line[missingIndex], line[missingIndex + <span class="number">1</span>]]; <span class="comment">// 返回空格位置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 未找到合适位置</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 寻找一个随机的合法落子位置</span></span><br><span class="line">  <span class="title function_">findRandomMove</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">emptyCells</span>: number[][] = []; <span class="comment">// 存储空格位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[i][j].<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">// 如果单元格为空</span></span><br><span class="line">          emptyCells.<span class="title function_">push</span>([i, j]); <span class="comment">// 添加到空格列表</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (emptyCells.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果有空格</span></span><br><span class="line">      <span class="keyword">return</span> emptyCells[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * emptyCells.<span class="property">length</span>)]; <span class="comment">// 随机选择一个空格</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 未找到空格</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建游戏界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建主列布局</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123; <span class="comment">// 创建主行布局</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">board</span>, <span class="function">(<span class="params">row: GridCell[], _index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历每一行</span></span><br><span class="line">          <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">cell: GridCell, _index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历每一个单元格</span></span><br><span class="line">            <span class="title class_">Text</span>(cell.<span class="property">value</span>) <span class="comment">// 显示单元格内的文本</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">              .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>lpx`</span>) <span class="comment">// 设置边距</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 居中文本</span></span><br><span class="line">              .<span class="title function_">backgroundColor</span>(cell.<span class="property">value</span> === <span class="string">&#x27;X&#x27;</span> ? <span class="title class_">Color</span>.<span class="property">Red</span> : <span class="comment">// 设置背景颜色</span></span><br><span class="line">                cell.<span class="property">value</span> === <span class="string">&#x27;O&#x27;</span> ? <span class="title class_">Color</span>.<span class="property">Blue</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">              .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">placeMark</span>(cell.<span class="property">rowIndex</span>, cell.<span class="property">colIndex</span>); <span class="comment">// 落子</span></span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellMargin * <span class="number">2</span>) * <span class="number">3</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>) <span class="comment">// 重新开始按钮</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;10%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initGame</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置高度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="mine"><a href="#mine" class="headerlink" title="mine"></a>mine</h1><p>扫雷 </p>
<p>实现步骤</p>
<p>步骤1：定义游戏状态</p>
<p>首先，我们需要定义游戏的状态变量，包括游戏面板数据、地雷数量、已揭示方块集合、标记为地雷的方块集合等。</p>
<p>步骤2：初始化游戏</p>
<p>在组件即将显示时初始化游戏，包括清空状态变量、生成游戏面板、放置地雷等。</p>
<p>步骤3：生成游戏面板与放置地雷</p>
<p>游戏面板由10x10的方块组成，随机放置10个地雷，并计算每个方块周围的地雷数量。</p>
<p>步骤4：处理用户交互</p>
<p>用户可以通过点击方块来揭示其内容，也可以通过长按来标记地雷。</p>
<p>步骤5：显示游戏结果</p>
<p>当玩家揭示到地雷时，游戏结束；当所有非雷方块都被揭示时，游戏胜利。</p>
<p>步骤6：定义Cell类</p>
<p>最后，定义一个Cell类来存储每个方块的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">MineSweeper</span> &#123;</span><br><span class="line">  <span class="comment">// 游戏面板数据</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">gameBoard</span>: <span class="title class_">Cell</span>[][] = [];</span><br><span class="line">  <span class="comment">// 地雷总数</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">mineCount</span>: number = <span class="number">10</span>;</span><br><span class="line">  <span class="comment">// 已经揭示的方块集合</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">revealedCells</span>: <span class="title class_">Set</span>&lt;string&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="comment">// 标记为地雷的方块集合</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">flaggedCells</span>: <span class="title class_">Set</span>&lt;string&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="comment">// 方块大小</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">cellSize</span>: number = <span class="number">60</span>;</span><br><span class="line">  <span class="comment">// 方块之间的边距</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">cellMargin</span>: number = <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// 游戏开始时间</span></span><br><span class="line">  private <span class="attr">startTime</span>: number = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="comment">// 游戏结束标志</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">isGameOver</span>: boolean = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在组件即将显示时初始化游戏</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化游戏</span></span><br><span class="line">  private <span class="title function_">initializeGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flaggedCells</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">generateBoard</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 生成游戏面板</span></span><br><span class="line">  private <span class="title function_">generateBoard</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameBoard</span> = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameBoard</span>.<span class="title function_">push</span>([]);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i].<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(i, j));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">placeMines</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calculateNumbers</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 随机放置地雷</span></span><br><span class="line">  private <span class="title function_">placeMines</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> placed = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (placed &lt; <span class="variable language_">this</span>.<span class="property">mineCount</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> x = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">let</span> y = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">gameBoard</span>[x][y].<span class="property">hasMine</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameBoard</span>[x][y].<span class="property">hasMine</span> = <span class="literal">true</span>;</span><br><span class="line">        placed++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算每个方块周围的地雷数量</span></span><br><span class="line">  private <span class="title function_">calculateNumbers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">hasMine</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">neighborMines</span> = <span class="variable language_">this</span>.<span class="title function_">countNeighborMines</span>(i, j);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">neighborMines</span>.<span class="title function_">toString</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">value</span> = <span class="string">&#x27;雷&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算给定坐标周围地雷的数量</span></span><br><span class="line">  private <span class="title function_">countNeighborMines</span>(<span class="attr">row</span>: number, <span class="attr">col</span>: number): number &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> dx = -<span class="number">1</span>; dx &lt;= <span class="number">1</span>; dx++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> dy = -<span class="number">1</span>; dy &lt;= <span class="number">1</span>; dy++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dx === <span class="number">0</span> &amp;&amp; dy === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> newRow = row + dx, newCol = col + dy;</span><br><span class="line">        <span class="keyword">if</span> (newRow &gt;= <span class="number">0</span> &amp;&amp; newRow &lt; <span class="number">10</span> &amp;&amp; newCol &gt;= <span class="number">0</span> &amp;&amp; newCol &lt; <span class="number">10</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">gameBoard</span>[newRow][newCol].<span class="property">hasMine</span>) &#123;</span><br><span class="line">          count++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 揭示方块</span></span><br><span class="line">  private <span class="title function_">revealCell</span>(<span class="params">row: number, col: number</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isGameOver</span> || <span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;row&#125;</span>,<span class="subst">$&#123;col&#125;</span>`</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">`<span class="subst">$&#123;row&#125;</span>,<span class="subst">$&#123;col&#125;</span>`</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">add</span>(key);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameBoard</span>[row][col].<span class="property">hasMine</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showGameOverDialog</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameBoard</span>[row][col].<span class="property">neighborMines</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> dx = -<span class="number">1</span>; dx &lt;= <span class="number">1</span>; dx++) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> dy = -<span class="number">1</span>; dy &lt;= <span class="number">1</span>; dy++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dx === <span class="number">0</span> &amp;&amp; dy === <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> newRow = row + dx, newCol = col + dy;</span><br><span class="line">            <span class="keyword">if</span> (newRow &gt;= <span class="number">0</span> &amp;&amp; newRow &lt; <span class="number">10</span> &amp;&amp; newCol &gt;= <span class="number">0</span> &amp;&amp; newCol &lt; <span class="number">10</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">revealCell</span>(newRow, newCol);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isVictory</span>()) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showVictoryDialog</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 显示游戏结束对话框</span></span><br><span class="line">  private <span class="title function_">showGameOverDialog</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>;</span><br><span class="line">    promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;游戏结束: 游戏失败！&#x27;</span>,</span><br><span class="line">      <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;]</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 显示胜利对话框</span></span><br><span class="line">  private <span class="title function_">showVictoryDialog</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>;</span><br><span class="line">    promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;恭喜你，游戏胜利！&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">`用时：<span class="subst">$&#123;((<span class="built_in">Date</span>.now() - <span class="variable language_">this</span>.startTime) / <span class="number">1000</span>).toFixed(<span class="number">3</span>)&#125;</span>秒`</span>,</span><br><span class="line">      <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;]</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断游戏是否胜利</span></span><br><span class="line">  private <span class="title function_">isVictory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> revealedNonMineCount = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">gameBoard</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i].<span class="property">length</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;i&#125;</span>,<span class="subst">$&#123;j&#125;</span>`</span>)) &#123;</span><br><span class="line">          revealedNonMineCount++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> revealedNonMineCount == <span class="number">90</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 决定是否显示方块值</span></span><br><span class="line">  private <span class="title function_">isShowValue</span>(<span class="attr">cell</span>: <span class="title class_">Cell</span>): string &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isGameOver</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> cell.<span class="property">value</span> === <span class="string">&#x27;0&#x27;</span> ? <span class="string">&#x27;&#x27;</span> : cell.<span class="property">value</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;cell.row&#125;</span>,<span class="subst">$&#123;cell.column&#125;</span>`</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> cell.<span class="property">value</span> === <span class="string">&#x27;0&#x27;</span> ? <span class="string">&#x27;&#x27;</span> : cell.<span class="property">value</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// 重置游戏按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>());</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建游戏面板容器</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">        <span class="comment">// 遍历每一行</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">gameBoard</span>, <span class="function">(<span class="params">row: Cell[], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 遍历每一列</span></span><br><span class="line">          <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">cell: Cell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Stack</span>() &#123;</span><br><span class="line">              <span class="comment">// 显示方块上的数字或雷</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="title function_">isShowValue</span>(cell))</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;rowIndex&#125;</span>,<span class="subst">$&#123;colIndex&#125;</span>`</span>) ?</span><br><span class="line">                  (<span class="variable language_">this</span>.<span class="title function_">isShowValue</span>(cell) === <span class="string">&#x27;雷&#x27;</span> ? <span class="title class_">Color</span>.<span class="property">Red</span> : <span class="title class_">Color</span>.<span class="property">White</span>) : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(!<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;rowIndex&#125;</span>,<span class="subst">$&#123;colIndex&#125;</span>`</span>) || <span class="variable language_">this</span>.<span class="title function_">isShowValue</span>(cell) === <span class="string">&#x27;雷&#x27;</span> ?</span><br><span class="line">                <span class="title class_">Color</span>.<span class="property">White</span> : <span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">                .<span class="title function_">parallelGesture</span>(<span class="title class_">GestureGroup</span>(<span class="title class_">GestureMode</span>.<span class="property">Exclusive</span>,</span><br><span class="line">                  <span class="title class_">TapGesture</span>(&#123; <span class="attr">count</span>: <span class="number">1</span>, <span class="attr">fingers</span>: <span class="number">1</span> &#125;)</span><br><span class="line">                    .<span class="title function_">onAction</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">revealCell</span>(rowIndex, colIndex)),</span><br><span class="line">                  <span class="title class_">LongPressGesture</span>(&#123; <span class="attr">repeat</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">                    .<span class="title function_">onAction</span>(<span class="function">() =&gt;</span> cell.<span class="property">isFlag</span> = <span class="literal">true</span>)</span><br><span class="line">                ));</span><br><span class="line"> </span><br><span class="line">              <span class="comment">// 显示标记旗帜</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;!<span class="variable language_">this</span>.revealedCells.has(<span class="string">`<span class="subst">$&#123;rowIndex&#125;</span>,<span class="subst">$&#123;colIndex&#125;</span>`</span>) ? <span class="string">&#x27;旗&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>)</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                .<span class="title function_">visibility</span>(cell.<span class="property">isFlag</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">isGameOver</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  cell.<span class="property">isFlag</span> = <span class="literal">false</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellMargin * <span class="number">2</span>) * <span class="number">10</span>&#125;</span>lpx`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 方块类</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  <span class="comment">// 方块所在的行</span></span><br><span class="line">  <span class="attr">row</span>: number;</span><br><span class="line">  <span class="comment">// 方块所在的列</span></span><br><span class="line">  <span class="attr">column</span>: number;</span><br><span class="line">  <span class="comment">// 是否有地雷</span></span><br><span class="line">  <span class="attr">hasMine</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 周围地雷数量</span></span><br><span class="line">  <span class="attr">neighborMines</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 是否被标记为地雷</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isFlag</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 方块值</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: string;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">row: number, column: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">row</span> = row;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">column</span> = column;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Schrulte-Grid"><a href="#Schrulte-Grid" class="headerlink" title="Schrulte Grid"></a>Schrulte Grid</h1><p>舒尔特方格（Schrulte Grid），也被称为舒尔特表或舒尔特图表，是一种用于训练注意力、视觉搜索速度和广度的简单而有效的工具。它通常由一个5x5的方格组成，每个小格子里随机填写了1到25的数字。训练者需要尽快地按照数字顺序找出这些数字，并用手指指出或说出它们的位置。</p>
<p>这种练习可以帮助提高眼睛的移动速度、扩大视野范围、增强大脑的反应速度和专注力，因此常被用来作为儿童和成人的注意力训练方法之一。此外，它也被一些专业领域（如飞行员、运动员等）用来提升快速信息处理能力和决策效率。</p>
<p>进行舒尔特方格训练时，建议：</p>
<p>保持正确的姿势，确保光线充足。<br>眼睛与纸面保持适当距离，一般为30-40厘米。<br>尽量不要用手指直接指着数字，以锻炼眼睛的移动能力。<br>随着熟练程度的提高，可以尝试更复杂或更大的方格，比如6x6或7x7。<br>定期练习，但也要注意休息，避免过度疲劳。<br>舒尔特方格不仅是一个简单的游戏，也是一个实用的认知训练工具，对于改善注意力集中度和个人效率有着积极的作用。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">numbers</span>: number[] = [];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentIndex</span>: number = <span class="number">0</span>; <span class="comment">//用于判断用户点击是否正确</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">timeStart</span>: number = <span class="number">0</span>;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">widthItem</span>: number = <span class="number">120</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">marginItem</span>: number = <span class="number">5</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化舒尔特方格</span></span><br><span class="line">  <span class="title function_">initGrid</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numbers</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">25</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">push</span>(i + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shuffleArray</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">numbers</span>)));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentIndex</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timeStart</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 随机打乱数组</span></span><br><span class="line">  <span class="title function_">shuffleArray</span>(<span class="params">array: number[]</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = array.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">25</span>);</span><br><span class="line">      <span class="keyword">let</span> temp = array[i]</span><br><span class="line">      array[i] = array[j]</span><br><span class="line">      array[j] = temp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numbers</span> = array</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断是否完成</span></span><br><span class="line">  <span class="title function_">isCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">currentIndex</span> === <span class="number">25</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">numbers</span>, <span class="function">(<span class="params">item: number, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.widthItem&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.widthItem&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.marginItem&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.widthItem/<span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">visibility</span>(item &lt;= <span class="variable language_">this</span>.<span class="property">currentIndex</span> ? <span class="title class_">Visibility</span>.<span class="property">Hidden</span> : <span class="title class_">Visibility</span>.<span class="property">Visible</span>)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">numbers</span>[index] === <span class="variable language_">this</span>.<span class="property">currentIndex</span> + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">currentIndex</span>++;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCompleted</span>()) &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;完成！&#x27;</span>);</span><br><span class="line">                  promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">`用时`</span>,</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;((<span class="built_in">Date</span>.now() - <span class="variable language_">this</span>.timeStart) / <span class="number">1000</span>).toFixed(<span class="number">3</span>)&#125;</span>秒`</span>,</span><br><span class="line">                    <span class="attr">buttons</span>: [</span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>,</span><br><span class="line">                        <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ],</span><br><span class="line">                  &#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">initGrid</span>();</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;错误的顺序！&#x27;</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.widthItem + <span class="variable language_">this</span>.marginItem * <span class="number">2</span>) * <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.widthItem + <span class="variable language_">this</span>.marginItem * <span class="number">2</span>) * <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 开始按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;开始&#x27;</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;50%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;10%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initGrid</span>();</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;游戏开始&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Piece"><a href="#Piece" class="headerlink" title="Piece"></a>Piece</h1><p>拼图 </p>
<p>算法： 随机 剪裁 交换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileIo <span class="keyword">as</span> fs &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.CoreFileKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; image &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ImageKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; photoAccessHelper &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.MediaLibraryKit&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义拼图组件接口</span></span><br><span class="line">interface <span class="title class_">PuzzlePiece</span> &#123;</span><br><span class="line">  <span class="comment">// 拼图块的像素地图</span></span><br><span class="line">  <span class="attr">pixelMap</span>: image.<span class="property">PixelMap</span>;</span><br><span class="line">  <span class="comment">// 原始图片中的索引位置</span></span><br><span class="line">  <span class="attr">originalIndex</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用装饰器定义页面组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Page30</span> &#123;</span><br><span class="line">  <span class="comment">// 状态变量：选中图片的URI</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedImageUrl</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 状态变量：原始图片的URI</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">originalImageUrl</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 状态变量：存储拼图块的数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">puzzlePieces</span>: <span class="title class_">Array</span>&lt;<span class="title class_">PuzzlePiece</span>&gt; = [];</span><br><span class="line">  <span class="comment">// 状态变量：记录当前选中的拼图块索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedPiece</span>: number = -<span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 弹出图片选择器方法</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">openPicker</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">let</span> <span class="title class_">PhotoSelectOptions</span> = <span class="keyword">new</span> photoAccessHelper.<span class="title class_">PhotoSelectOptions</span>();</span><br><span class="line">      <span class="title class_">PhotoSelectOptions</span>.<span class="property">MIMEType</span> = photoAccessHelper.<span class="property">PhotoViewMIMETypes</span>.<span class="property">IMAGE_TYPE</span>;</span><br><span class="line">      <span class="title class_">PhotoSelectOptions</span>.<span class="property">maxSelectNumber</span> = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">let</span> photoPicker = <span class="keyword">new</span> photoAccessHelper.<span class="title class_">PhotoViewPicker</span>();</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">uris</span>: photoAccessHelper.<span class="property">PhotoSelectResult</span> = <span class="keyword">await</span>  photoPicker.<span class="title function_">select</span>(<span class="title class_">PhotoSelectOptions</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (!uris || uris.<span class="property">photoUris</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 获取选中图片的第一张URI</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">uri</span>: string = uris.<span class="property">photoUris</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// 打开文件读取流</span></span><br><span class="line">      <span class="keyword">let</span> file = fs.<span class="title function_">openSync</span>(uri, fs.<span class="property">OpenMode</span>.<span class="property">READ_ONLY</span>);</span><br><span class="line">      <span class="comment">// 获取当前上下文</span></span><br><span class="line">      <span class="keyword">let</span> context = <span class="title function_">getContext</span>(<span class="variable language_">this</span>) <span class="keyword">as</span> common.<span class="property">UIAbilityContext</span>;</span><br><span class="line">      <span class="comment">// 新建一个保存裁剪后图片的路径</span></span><br><span class="line">      <span class="keyword">let</span> newUrl = context.<span class="property">filesDir</span> + <span class="string">&#x27;/test&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">      <span class="comment">// 复制图片到新的路径</span></span><br><span class="line">      fs.<span class="title function_">copyFileSync</span>(file.<span class="property">fd</span>, newUrl);</span><br><span class="line">      <span class="comment">// 关闭文件读取流</span></span><br><span class="line">      fs.<span class="title function_">closeSync</span>(file);</span><br><span class="line">      <span class="comment">// 更新状态变量：设置显示图片的URI</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedImageUrl</span> = newUrl;</span><br><span class="line">      <span class="comment">// 更新状态变量：保存原始图片的URI</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">originalImageUrl</span> = uri;</span><br><span class="line">      <span class="comment">// 图片更改时触发的方法</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">imgChange</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;openPicker&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 图片更改处理方法</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">imgChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 创建图片源对象</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">imageSource</span>: image.<span class="property">ImageSource</span> = image.<span class="title function_">createImageSource</span>(<span class="variable language_">this</span>.<span class="property">selectedImageUrl</span>);</span><br><span class="line">      <span class="comment">// 图片解码选项</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">decodingOptions</span>: image.<span class="property">DecodingOptions</span> = &#123;</span><br><span class="line">        <span class="attr">editable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">desiredPixelFormat</span>: <span class="number">3</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 创建像素地图</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">mPixelMap</span>: image.<span class="property">PixelMap</span> = <span class="keyword">await</span> imageSource.<span class="title function_">createPixelMap</span>(decodingOptions);</span><br><span class="line">      <span class="comment">// 获取图片信息</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">mImageInfo</span>: image.<span class="property">ImageInfo</span> = <span class="keyword">await</span> mPixelMap.<span class="title function_">getImageInfo</span>();</span><br><span class="line">      <span class="comment">// 计算每个拼图块的大小</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">pieceSize</span>: image.<span class="property">Size</span> = &#123;</span><br><span class="line">        <span class="attr">width</span>: mImageInfo.<span class="property">size</span>.<span class="property">width</span> / <span class="number">3</span>,</span><br><span class="line">        <span class="attr">height</span>: mImageInfo.<span class="property">size</span>.<span class="property">height</span> / <span class="number">3</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 清空已有拼图块数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="comment">// 遍历图片生成9个拼图块</span></span><br><span class="line">      <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">3</span>; row++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">3</span>; col++) &#123;</span><br><span class="line">          <span class="comment">// 创建基于原图的新图片源</span></span><br><span class="line">          <span class="keyword">const</span> imageSource = image.<span class="title function_">createImageSource</span>(<span class="variable language_">this</span>.<span class="property">selectedImageUrl</span>);</span><br><span class="line">          <span class="comment">// 创建新像素地图</span></span><br><span class="line">          <span class="keyword">let</span> mPixelMap = <span class="keyword">await</span> imageSource.<span class="title function_">createPixelMap</span>(decodingOptions);</span><br><span class="line">          <span class="comment">// 计算裁剪区域</span></span><br><span class="line">          <span class="keyword">const</span> <span class="attr">cutRegion</span>: image.<span class="property">Region</span> = &#123;</span><br><span class="line">            <span class="attr">x</span>: col * pieceSize.<span class="property">width</span>,</span><br><span class="line">            <span class="attr">y</span>: row * pieceSize.<span class="property">height</span>,</span><br><span class="line">            <span class="attr">size</span>: pieceSize,</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="comment">// 裁剪像素地图</span></span><br><span class="line">          <span class="keyword">await</span> mPixelMap.<span class="title function_">crop</span>(cutRegion);</span><br><span class="line">          <span class="comment">// 创建并添加拼图块至数组</span></span><br><span class="line">          <span class="keyword">const</span> <span class="attr">piece</span>: <span class="title class_">PuzzlePiece</span> = &#123;</span><br><span class="line">            <span class="attr">pixelMap</span>: mPixelMap,</span><br><span class="line">            <span class="attr">originalIndex</span>: count++,</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="title function_">push</span>(piece);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 打乱拼图块顺序</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">temp</span>: <span class="title class_">PuzzlePiece</span> = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i] = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[j];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[j] = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;imgChange&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 添加选择图片按钮，点击后调用打开图片选择器方法</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;选择图片→&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">openPicker</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 显示原始图片（如果已选择）</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">originalImageUrl</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;原始图片↓&#x27;</span>);</span><br><span class="line">        <span class="title class_">Image</span>(<span class="variable language_">this</span>.<span class="property">originalImageUrl</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;180lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;180lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果有拼图块，则显示游戏区</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;游戏图片↓&#x27;</span>);</span><br><span class="line">        <span class="comment">// 游戏区域采用网格布局</span></span><br><span class="line">        <span class="title class_">Grid</span>() &#123;</span><br><span class="line">          <span class="comment">// 遍历所有拼图块并创建网格项</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">puzzlePieces</span>, <span class="function">(<span class="params">item: PuzzlePiece, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">              <span class="comment">// 显示拼图块图像</span></span><br><span class="line">              <span class="title class_">Image</span>(item.<span class="property">pixelMap</span>)</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">&#x27;200lpx&#x27;</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">&#x27;200lpx&#x27;</span>)</span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">&#x27;5lpx&#x27;</span>)</span><br><span class="line">                  <span class="comment">// 根据是否选中调整缩放比例</span></span><br><span class="line">                .<span class="title function_">scale</span>(<span class="variable language_">this</span>.<span class="property">selectedPiece</span> == index ? &#123; <span class="attr">x</span>: <span class="number">0.5</span>, <span class="attr">y</span>: <span class="number">0.5</span> &#125; : &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">1</span> &#125;)</span><br><span class="line">                  <span class="comment">// 添加点击事件处理</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="comment">// 处理拼图交换逻辑</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedPiece</span> == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedPiece</span> = index;</span><br><span class="line">                  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedPiece</span> == index) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedPiece</span> = -<span class="number">1</span>;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> <span class="attr">temp</span>: <span class="title class_">PuzzlePiece</span> = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[<span class="variable language_">this</span>.<span class="property">selectedPiece</span>];</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[<span class="variable language_">this</span>.<span class="property">selectedPiece</span>] = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[index];</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[index] = temp;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedPiece</span> = -<span class="number">1</span>;</span><br><span class="line">                    <span class="comment">// 检查拼图是否完成</span></span><br><span class="line">                    <span class="keyword">let</span> <span class="attr">isSucc</span>: boolean = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;====item&#x27;</span>, <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i].<span class="property">originalIndex</span>, i);</span><br><span class="line">                      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i].<span class="property">originalIndex</span> !== i) &#123;</span><br><span class="line">                        isSucc = <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 如果拼图完成，弹出提示对话框</span></span><br><span class="line">                    <span class="keyword">if</span> (isSucc) &#123;</span><br><span class="line">                      promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">                        <span class="attr">message</span>: <span class="string">&#x27;拼图完成！&#x27;</span>,</span><br><span class="line">                      &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;) <span class="comment">// End of ForEach</span></span><br><span class="line">        &#125; <span class="comment">// End of Grid</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#fafafa&quot;</span>); <span class="comment">// 设置网格背景色</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">// End of Column</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置列宽度为100%</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="ruler"><a href="#ruler" class="headerlink" title="ruler"></a>ruler</h1><p>直尺</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable language_">window</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入窗口相关的API</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>; <span class="comment">// 导入设备信息相关的API</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义直尺线类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RulerLine</span> &#123;</span><br><span class="line">  <span class="attr">index</span>: number; <span class="comment">// 线的索引</span></span><br><span class="line">  <span class="attr">height</span>: number; <span class="comment">// 线的高度</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">index: number, height: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">index</span> = index; <span class="comment">// 初始化索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height; <span class="comment">// 初始化高度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 显示线的编号</span></span><br><span class="line">  <span class="title function_">showNumber</span>(): string &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">index</span> % <span class="number">10</span> === <span class="number">0</span> ? <span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="variable language_">this</span>.index / <span class="number">10</span>)&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>; <span class="comment">// 每10个线显示一个编号</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 扩展文本样式</span></span><br><span class="line">@<span class="title class_">Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fancy</span>(<span class="params"></span>) &#123;</span><br><span class="line">  .<span class="title function_">fontColor</span>(<span class="string">&quot;#019dfe&quot;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">20</span>); <span class="comment">// 设置字体大小</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义直尺组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">RulerComponent</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">maxRulerHeight</span>: number = <span class="number">0</span>; <span class="comment">// 最大直尺高度</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onCellWidthChanged&#x27;</span>) <span class="attr">cellWidthInPixels</span>: number = <span class="number">17.28</span>; <span class="comment">// 每毫米对应的像素</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">textWidth</span>: number = <span class="number">80</span>; <span class="comment">// 文本宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">rulerLines</span>: <span class="title class_">RulerLine</span>[] = []; <span class="comment">// 直尺线数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">leftOffsetX</span>: number = -<span class="number">300</span>; <span class="comment">// 左侧偏移</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentPositionX</span>: number = -<span class="number">300</span>; <span class="comment">// 当前X位置</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onContainerHeightChanged&#x27;</span>) <span class="attr">containerHeight</span>: number = <span class="number">53</span>; <span class="comment">// 容器高度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">originalContainerHeight</span>: number = <span class="number">53</span>; <span class="comment">// 原始容器高度</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onCellWidthChanged&#x27;</span>) <span class="attr">containerWidth</span>: number = <span class="number">0</span>; <span class="comment">// 容器宽度</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 处理单元格宽度变化</span></span><br><span class="line">  <span class="title function_">onCellWidthChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maxRulerHeight</span> = <span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">containerWidth</span>) / <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> / <span class="number">10</span>; <span class="comment">// 更新最大直尺高度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 处理容器高度变化</span></span><br><span class="line">  <span class="title function_">onContainerHeightChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>, <span class="number">53</span>); <span class="comment">// 确保容器高度不小于53</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 设置当前应用为横屏显示</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(<span class="title function_">getContext</span>()).<span class="title function_">then</span>(<span class="function">(<span class="params">windowClass</span>) =&gt;</span> &#123;</span><br><span class="line">      windowClass.<span class="title function_">setPreferredOrientation</span>(<span class="variable language_">window</span>.<span class="property">Orientation</span>.<span class="property">LANDSCAPE</span>); <span class="comment">// 设置为横屏</span></span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化直尺线</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">15</span> * <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">lineHeight</span>: number = (i % <span class="number">10</span> === <span class="number">0</span>) ? <span class="number">90</span> : (i % <span class="number">5</span> === <span class="number">0</span>) ? <span class="number">60</span> : <span class="number">45</span>; <span class="comment">// 根据索引设置线的高度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rulerLines</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">RulerLine</span>(i, lineHeight)); <span class="comment">// 将新线添加到数组中</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 创建一个列布局</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">        <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建另一个堆叠布局</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">rulerLines</span>, <span class="function">(<span class="params">line: RulerLine, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历直尺线数组</span></span><br><span class="line">            <span class="title class_">Line</span>()<span class="comment">// 创建一条线</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="number">1</span>)<span class="comment">// 设置线宽</span></span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;line.height&#125;</span>px`</span>)<span class="comment">// 设置线高</span></span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置线的背景颜色</span></span><br><span class="line">              .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidthInPixels * index&#125;</span>px`</span> &#125;); <span class="comment">// 设置线的左边距</span></span><br><span class="line">            <span class="title class_">Text</span>(line.<span class="title function_">showNumber</span>())<span class="comment">// 显示线的编号</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.textWidth&#125;</span>px`</span>)<span class="comment">// 设置文本宽度</span></span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.textWidth&#125;</span>px`</span>)<span class="comment">// 设置文本高度</span></span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 设置文本对齐方式</span></span><br><span class="line">              .<span class="title function_">margin</span>(&#123;</span><br><span class="line">                <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidthInPixels * index - <span class="variable language_">this</span>.textWidth / <span class="number">2</span>&#125;</span>px`</span>,</span><br><span class="line">                <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;line.height&#125;</span>px`</span></span><br><span class="line">              &#125;); <span class="comment">// 设置文本位置</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">TopStart</span>); <span class="comment">// 设置堆叠布局的宽高和对齐方式</span></span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">15</span> &#125;) &#123; <span class="comment">// 创建一个列布局，设置间距</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`当前设备：<span class="subst">$&#123;deviceInfo.marketName&#125;</span>`</span>).<span class="title function_">fancy</span>(); <span class="comment">// 显示当前设备名称</span></span><br><span class="line">          <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建一个计数器</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`选中区距离：<span class="subst">$&#123;<span class="variable language_">this</span>.maxRulerHeight.toFixed(<span class="number">2</span>)&#125;</span>厘米`</span>).<span class="title function_">fancy</span>(); <span class="comment">// 显示选中区距离</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">foregroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置计数器字体颜色</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">          .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="title function_">px2vp</span>(<span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>) + <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> / <span class="number">10</span>); <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="title function_">px2vp</span>(<span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>) - <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> / <span class="number">10</span>); <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建另一个计数器</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`每毫米间距：<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidthInPixels.toFixed(<span class="number">2</span>)&#125;</span>px`</span>).<span class="title function_">fancy</span>(); <span class="comment">// 显示每毫米间距</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">foregroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置计数器字体颜色</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">          .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> += <span class="number">0.01</span>; <span class="comment">// 增加每毫米间距</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0.01</span>, <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> - <span class="number">0.01</span>); <span class="comment">// 减少每毫米间距，确保不小于0.01</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">RelativeContainer</span>() &#123; <span class="comment">// 创建一个相对布局容器</span></span><br><span class="line">          <span class="title class_">Rect</span>()<span class="comment">// 创建一个矩形</span></span><br><span class="line">            .<span class="title function_">fill</span>(<span class="string">&quot;#80019dfe&quot;</span>)<span class="comment">// 设置填充颜色</span></span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置边框颜色</span></span><br><span class="line">            .<span class="title function_">borderWidth</span>(&#123; <span class="attr">left</span>: <span class="number">1</span>, <span class="attr">right</span>: <span class="number">1</span> &#125;)<span class="comment">// 设置边框宽度</span></span><br><span class="line">            .<span class="title function_">clip</span>(<span class="literal">true</span>)<span class="comment">// 启用裁剪</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>)<span class="comment">// 设置宽度为100%</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>)<span class="comment">// 设置高度为100%</span></span><br><span class="line">            .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params">oldArea: Area, newArea: Area</span>) =&gt;</span> &#123; <span class="comment">// 处理区域变化</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">containerWidth</span> = newArea.<span class="property">width</span> <span class="keyword">as</span> number; <span class="comment">// 更新容器宽度</span></span><br><span class="line">            &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">30</span>, <span class="attr">width</span>: <span class="number">30</span> &#125;)<span class="comment">// 创建一个圆形</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置填充颜色</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置边框颜色为透明</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">40</span>, <span class="attr">width</span>: <span class="number">40</span> &#125;)<span class="comment">// 创建另一个圆形</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置填充颜色为透明</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置边框颜色</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>) <span class="comment">// 设置碰撞检测行为</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">20</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">alignRules</span>(&#123;</span><br><span class="line">            <span class="comment">// 设置对齐规则</span></span><br><span class="line">            <span class="attr">center</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">VerticalAlign</span>.<span class="property">Center</span> &#125;, <span class="comment">// 垂直居中</span></span><br><span class="line">            <span class="attr">middle</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">HorizontalAlign</span>.<span class="property">Start</span> &#125; <span class="comment">// 左对齐</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">gesture</span>(<span class="title class_">PanGesture</span>(&#123;</span><br><span class="line">            <span class="comment">// 左侧拖动手势</span></span><br><span class="line">            <span class="attr">fingers</span>: <span class="number">1</span>, <span class="comment">// 单指拖动</span></span><br><span class="line">            <span class="attr">direction</span>: <span class="title class_">PanDirection</span>.<span class="property">Horizontal</span>, <span class="comment">// 水平拖动</span></span><br><span class="line">            <span class="attr">distance</span>: <span class="number">1</span> <span class="comment">// 最小拖动距离</span></span><br><span class="line">          &#125;).<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent</span>) =&gt;</span> &#123; <span class="comment">// 拖动更新时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentPositionX</span> + event.<span class="property">offsetX</span> / <span class="number">2</span>; <span class="comment">// 更新左侧偏移</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> - event.<span class="property">offsetX</span>; <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;).<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拖动结束时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPositionX</span> = <span class="variable language_">this</span>.<span class="property">leftOffsetX</span>; <span class="comment">// 更新位置</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> = <span class="variable language_">this</span>.<span class="property">containerHeight</span>; <span class="comment">// 更新原始高度</span></span><br><span class="line">          &#125;));</span><br><span class="line"> </span><br><span class="line">          <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建另一个堆叠布局</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">30</span>, <span class="attr">width</span>: <span class="number">30</span> &#125;)<span class="comment">// 创建一个圆形</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置填充颜色</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置边框颜色为透明</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">40</span>, <span class="attr">width</span>: <span class="number">40</span> &#125;)<span class="comment">// 创建另一个圆</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置填充颜色为透明</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置边框颜色</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>) <span class="comment">// 设置碰撞检测行为</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">20</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">alignRules</span>(&#123;</span><br><span class="line">            <span class="comment">// 设置对齐规则</span></span><br><span class="line">            <span class="attr">center</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">VerticalAlign</span>.<span class="property">Center</span> &#125;, <span class="comment">// 垂直居中</span></span><br><span class="line">            <span class="attr">middle</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">HorizontalAlign</span>.<span class="property">End</span> &#125; <span class="comment">// 右对齐</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">gesture</span>(<span class="title class_">PanGesture</span>(&#123;</span><br><span class="line">            <span class="comment">// 右侧拖动手势</span></span><br><span class="line">            <span class="attr">fingers</span>: <span class="number">1</span>, <span class="comment">// 单指拖动</span></span><br><span class="line">            <span class="attr">direction</span>: <span class="title class_">PanDirection</span>.<span class="property">Horizontal</span>, <span class="comment">// 水平拖动</span></span><br><span class="line">            <span class="attr">distance</span>: <span class="number">1</span> <span class="comment">// 最小拖动距离</span></span><br><span class="line">          &#125;).<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent</span>) =&gt;</span> &#123; <span class="comment">// 拖动更新时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentPositionX</span> + event.<span class="property">offsetX</span> / <span class="number">2</span>; <span class="comment">// 更新左侧偏移</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> + event.<span class="property">offsetX</span>; <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;).<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拖动结束时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPositionX</span> = <span class="variable language_">this</span>.<span class="property">leftOffsetX</span>; <span class="comment">// 更新位置</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> = <span class="variable language_">this</span>.<span class="property">containerHeight</span>; <span class="comment">// 更新原始高度</span></span><br><span class="line">          &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> &#125;) <span class="comment">// 使用左侧偏移</span></span><br><span class="line">        .<span class="title function_">gesture</span>(<span class="title class_">PanGesture</span>(&#123;</span><br><span class="line">          <span class="comment">// 左侧拖动手势</span></span><br><span class="line">          <span class="attr">fingers</span>: <span class="number">1</span>, <span class="comment">// 单指拖动</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">PanDirection</span>.<span class="property">Horizontal</span>, <span class="comment">// 水平拖动</span></span><br><span class="line">          <span class="attr">distance</span>: <span class="number">1</span> <span class="comment">// 最小拖动距离</span></span><br><span class="line">        &#125;).<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent</span>) =&gt;</span> &#123; <span class="comment">// 拖动更新时的处理</span></span><br><span class="line">          <span class="keyword">if</span> (event) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentPositionX</span> + event.<span class="property">offsetX</span>; <span class="comment">// 更新左侧偏移</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拖动结束时的处理</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentPositionX</span> = <span class="variable language_">this</span>.<span class="property">leftOffsetX</span>; <span class="comment">// 更新位置</span></span><br><span class="line">        &#125;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度和宽度</span></span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">30</span>, <span class="attr">right</span>: <span class="number">10</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#181b22&quot;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h1 id="randon-password"><a href="#randon-password" class="headerlink" title="randon password"></a>randon password</h1><p>随机密码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入剪贴板服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入弹窗提示服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用装饰器定义一个可观察的类，用于密码选项</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PasswordOption</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 选项名称</span></span><br><span class="line">  <span class="attr">characters</span>: string; <span class="comment">// 该选项对应的字符集</span></span><br><span class="line">  <span class="comment">// 定义是否选中，默认为true</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">selected</span>: boolean = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 定义是否启用，默认为true</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">enabled</span>: boolean = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数，初始化name和characters</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, characters: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">characters</span> = characters;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用装饰器定义一个入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">PasswordGeneratorPage</span> &#123;</span><br><span class="line">  <span class="comment">// 定义密码选项数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">options</span>: <span class="title class_">PasswordOption</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;大写字母&quot;</span>, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;小写字母&quot;</span>, <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;数字&quot;</span>, <span class="string">&quot;0123456789&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;特殊字符&quot;</span>, <span class="string">&quot;!@#$%^&amp;*()_+-=[]&#123;&#125;|;:,.&lt;&gt;?&quot;</span>),</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// 定义密码长度状态，默认值为10</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">passwordLength</span>: number = <span class="number">10</span>;</span><br><span class="line">  <span class="comment">// 基础间距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">baseSpacing</span>: number = <span class="number">30</span>;</span><br><span class="line">  <span class="comment">// 生成的密码</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">generatedPassword</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 是否启用复制按钮</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isCopyButtonEnabled</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 主题色</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">primaryColor</span>: string = <span class="string">&#x27;#71dec7&#x27;</span>;</span><br><span class="line">  <span class="comment">// 字体颜色</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">fontColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 生成密码的方法</span></span><br><span class="line">  <span class="title function_">generatePassword</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> characterSet = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 初始化字符集合</span></span><br><span class="line">    <span class="comment">// 遍历所有选项，如果选项被选中则加入字符集合</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> option <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">options</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (option.<span class="property">selected</span>) &#123;</span><br><span class="line">        characterSet += option.<span class="property">characters</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> password = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 初始化密码字符串</span></span><br><span class="line">    <span class="comment">// 根据密码长度生成随机密码</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">passwordLength</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * characterSet.<span class="property">length</span>);</span><br><span class="line">      password += characterSet[randomIndex];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">generatedPassword</span> = password; <span class="comment">// 更新生成的密码</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 复制到剪贴板的方法</span></span><br><span class="line">  <span class="title function_">copyToClipboard</span>(<span class="params">text: string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pasteboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text); <span class="comment">// 创建剪贴板数据</span></span><br><span class="line">    <span class="keyword">const</span> systemPasteboard = pasteboard.<span class="title function_">getSystemPasteboard</span>(); <span class="comment">// 获取系统剪贴板</span></span><br><span class="line">    systemPasteboard.<span class="title function_">setData</span>(pasteboardData); <span class="comment">// 将数据放入剪切板</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;已复制&#x27;</span> &#125;); <span class="comment">// 显示复制成功的提示</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查选项选择状态的方法</span></span><br><span class="line">  <span class="title function_">checkOptionsSelection</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> selectedCount = <span class="number">0</span>; <span class="comment">// 记录已选中的选项数量</span></span><br><span class="line">    <span class="keyword">let</span> lastSelectedIndex = <span class="number">0</span>; <span class="comment">// 记录最后一个选中的选项索引</span></span><br><span class="line">    <span class="comment">// 遍历所有选项</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">options</span>[i].<span class="property">enabled</span> = <span class="literal">true</span>; <span class="comment">// 默认启用所有选项</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>[i].<span class="property">selected</span>) &#123;</span><br><span class="line">        lastSelectedIndex = i; <span class="comment">// 更新最后一个选中的选项索引</span></span><br><span class="line">        selectedCount++; <span class="comment">// 增加选中计数</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果只有一个选项被选中，则禁用该选项防止其被取消选中</span></span><br><span class="line">    <span class="keyword">if</span> (selectedCount === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">options</span>[lastSelectedIndex].<span class="property">enabled</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建页面布局的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 标题栏</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&quot;随机密码生成&quot;</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)<span class="comment">// 设置宽度为100%</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">54</span>)<span class="comment">// 设置高度为54</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">18</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="number">600</span>)<span class="comment">// 设置字体粗细</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 设置文本居中对齐</span></span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>); <span class="comment">// 设置字体颜色</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 密码长度设置部分</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`密码长度：`</span>)<span class="comment">// 密码长度标签</span></span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>);</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.passwordLength&#125;</span>`</span>)<span class="comment">// 显示当前密码长度</span></span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>, <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 滑动条设置密码长度</span></span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;4&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>).<span class="title function_">width</span>(<span class="number">20</span>);</span><br><span class="line">          <span class="title class_">Slider</span>(&#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">passwordLength</span>, <span class="comment">// 当前值</span></span><br><span class="line">            <span class="attr">min</span>: <span class="number">4</span>, <span class="comment">// 最小值</span></span><br><span class="line">            <span class="attr">max</span>: <span class="number">32</span>, <span class="comment">// 最大值</span></span><br><span class="line">            <span class="attr">style</span>: <span class="title class_">SliderStyle</span>.<span class="property">InSet</span> <span class="comment">// 滑动条样式</span></span><br><span class="line">          &#125;)</span><br><span class="line">            .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)<span class="comment">// 布局权重</span></span><br><span class="line">            .<span class="title function_">blockColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 滑块颜色</span></span><br><span class="line">            .<span class="title function_">trackColor</span>(<span class="string">&#x27;#EBEBEB&#x27;</span>)<span class="comment">// 轨道颜色</span></span><br><span class="line">            .<span class="title function_">trackThickness</span>(<span class="number">30</span>)<span class="comment">// 轨道厚度</span></span><br><span class="line">            .<span class="title function_">blockSize</span>(&#123; <span class="attr">width</span>: <span class="number">55</span>, <span class="attr">height</span>: <span class="number">55</span> &#125;)<span class="comment">// 滑块大小</span></span><br><span class="line">            .<span class="title function_">selectedColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)<span class="comment">// 选中颜色</span></span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: number, mode: SliderChangeMode</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">passwordLength</span> = value; <span class="comment">// 更新密码长度</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;value:&#x27;</span> + value + <span class="string">&#x27;mode&#x27;</span> + mode.<span class="property">toString</span>); <span class="comment">// 打印日志</span></span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;32&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>).<span class="title function_">width</span>(<span class="number">20</span>);</span><br><span class="line">        &#125;.<span class="title function_">margin</span>(&#123;</span><br><span class="line">          <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">          <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">          <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 选项设置部分</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;选项&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>, <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>, <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 动态生成每个选项的UI元素</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">options</span>, <span class="function">(<span class="params">option: PasswordOption, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Row</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(option.<span class="property">name</span>)<span class="comment">// 选项名称</span></span><br><span class="line">              .<span class="title function_">fontWeight</span>(<span class="number">400</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">              .<span class="title function_">layoutWeight</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Switch</span>, <span class="attr">isOn</span>: option.<span class="property">selected</span> &#125;)<span class="comment">// 切换按钮</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">&#x27;50lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">enabled</span>(option.<span class="property">enabled</span>)<span class="comment">// 是否启用切换</span></span><br><span class="line">              .<span class="title function_">selectedColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">              .<span class="title function_">onChange</span>(<span class="function">(<span class="params">isOn: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">                option.<span class="property">selected</span> = isOn; <span class="comment">// 更新选项状态</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">checkOptionsSelection</span>(); <span class="comment">// 检查选项选择状态</span></span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">padding</span>(&#123;</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing / <span class="number">3</span>&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing / <span class="number">3</span>&#125;</span>lpx`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (option.<span class="property">enabled</span>) &#123;</span><br><span class="line">              option.<span class="property">selected</span> = !option.<span class="property">selected</span>; <span class="comment">// 切换选项状态</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 生成密码按钮</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;生成密码&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">54</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.baseSpacing * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)<span class="comment">// 点击效果</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">generatePassword</span>(); <span class="comment">// 生成密码</span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示生成的密码</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`密码结果：`</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.generatedPassword&#125;</span>`</span>)<span class="comment">// 显示生成的密码</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">5</span>, <span class="attr">right</span>: <span class="number">5</span> &#125;)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing / <span class="number">3</span>&#125;</span>lpx`</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 复制按钮</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">          .<span class="title function_">enabled</span>(<span class="variable language_">this</span>.<span class="property">generatedPassword</span> ? <span class="literal">true</span> : <span class="literal">false</span>)<span class="comment">// 只有生成了密码才启用复制按钮</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">54</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.baseSpacing * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">generatedPassword</span>); <span class="comment">// 复制密码</span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f2f3f5&quot;</span>); <span class="comment">// 页面背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="chinese"><a href="#chinese" class="headerlink" title="chinese"></a>chinese</h1><p>ohpm install @nutpi&#x2F;chinese_transverter</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入必要的转换库，提供简体与繁体之间的转换功能</span></span><br><span class="line"><span class="keyword">import</span> &#123; transverter, <span class="title class_">TransverterType</span>, <span class="title class_">TransverterLanguage</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@nutpi/chinese_transverter&quot;</span>;</span><br><span class="line"><span class="comment">// 导入剪贴板服务，用于将文本复制到系统剪贴板</span></span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入提示服务，用于向用户显示消息</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用@Entry装饰器标记此组件为应用的入口点</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">  <span class="comment">// 使用@Component装饰器定义一个名为SimplifiedTraditionalConverter的组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">SimplifiedTraditionalConverter</span> &#123;</span><br><span class="line">  <span class="comment">// 定义状态变量inputText，存储用户输入的原始文本，当其值变化时触发onInputTextChanged方法</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onInputTextChanged&#x27;</span>) <span class="attr">inputText</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量simplifiedResult，存储转换后的简体结果</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">simplifiedResult</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量traditionalResult，存储转换后的繁体结果</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">traditionalResult</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量isInputFocused，表示输入框是否获得了焦点</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isInputFocused</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 定义主题颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">themeColor</span>: string = <span class="string">&#x27;#439fff&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义文本颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">textColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义基础内边距大小</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">basePadding</span>: number = <span class="number">30</span>;</span><br><span class="line">  <span class="comment">// 定义最小文本区域高度</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">minTextAreaHeight</span>: number = <span class="number">50</span>;</span><br><span class="line">  <span class="comment">// 定义最大文本区域高度</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">maxTextAreaHeight</span>: number = <span class="number">300</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当inputText状态改变时触发的方法，用于更新转换结果</span></span><br><span class="line">  <span class="title function_">onInputTextChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 将inputText转换为简体，并更新simplifiedResult</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">simplifiedResult</span> = <span class="title function_">transverter</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">TransverterType</span>.<span class="property">SIMPLIFIED</span>,</span><br><span class="line">      <span class="attr">str</span>: <span class="variable language_">this</span>.<span class="property">inputText</span>,</span><br><span class="line">      <span class="attr">language</span>: <span class="title class_">TransverterLanguage</span>.<span class="property">ZH_CN</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 将inputText转换为繁体，并更新traditionalResult</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">traditionalResult</span> = <span class="title function_">transverter</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">TransverterType</span>.<span class="property">TRADITIONAL</span>,</span><br><span class="line">      <span class="attr">str</span>: <span class="variable language_">this</span>.<span class="property">inputText</span>,</span><br><span class="line">      <span class="attr">language</span>: <span class="title class_">TransverterLanguage</span>.<span class="property">ZH_CN</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 将给定的文本复制到剪贴板，并显示提示信息</span></span><br><span class="line">  private <span class="title function_">copyToClipboard</span>(<span class="attr">text</span>: string): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> clipboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text); <span class="comment">// 创建剪贴板数据</span></span><br><span class="line">    <span class="keyword">const</span> systemClipboard = pasteboard.<span class="title function_">getSystemPasteboard</span>(); <span class="comment">// 获取系统剪贴板</span></span><br><span class="line">    systemClipboard.<span class="title function_">setData</span>(clipboardData); <span class="comment">// 设置剪贴板数据</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;已复制到剪贴板&#x27;</span> &#125;); <span class="comment">// 显示复制成功的提示</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建组件的UI</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Scroll</span>() &#123; <span class="comment">// 创建可滚动的容器</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123; <span class="comment">// 在滚动容器中创建垂直布局</span></span><br><span class="line">        <span class="comment">// 创建标题文本</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&quot;简体繁体转换器&quot;</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">54</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建用户输入区域</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建多行文本输入框</span></span><br><span class="line">          <span class="title class_">TextArea</span>(&#123; <span class="attr">text</span>: $$this.<span class="property">inputText</span>, <span class="attr">placeholder</span>: <span class="string">&#x27;请输入简体/繁体字（支持混合输入）&#x27;</span> &#125;)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">placeholderColor</span>(<span class="variable language_">this</span>.<span class="property">isInputFocused</span> ? <span class="variable language_">this</span>.<span class="property">themeColor</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">isInputFocused</span> ? <span class="variable language_">this</span>.<span class="property">themeColor</span> : <span class="variable language_">this</span>.<span class="property">textColor</span>)</span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="variable language_">this</span>.<span class="property">isInputFocused</span> ? <span class="variable language_">this</span>.<span class="property">themeColor</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">            .<span class="title function_">caretColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">onBlur</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">isInputFocused</span> = <span class="literal">false</span>) <span class="comment">// 当输入框失去焦点时，更新isInputFocused状态</span></span><br><span class="line">            .<span class="title function_">onFocus</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">isInputFocused</span> = <span class="literal">true</span>) <span class="comment">// 当输入框获得焦点时，更新isInputFocused状态</span></span><br><span class="line">            .<span class="title function_">borderWidth</span>(<span class="number">1</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="variable language_">this</span>.<span class="property">minTextAreaHeight</span>, <span class="attr">maxHeight</span>: <span class="variable language_">this</span>.<span class="property">maxTextAreaHeight</span> &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建清空按钮</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;清空&#x27;</span>)</span><br><span class="line">            .<span class="title function_">borderWidth</span>(<span class="number">1</span>)</span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.basePadding * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 添加点击效果</span></span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">inputText</span> = <span class="string">&quot;&quot;</span>); <span class="comment">// 清空输入框</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建繁体结果展示与复制区域</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建繁体结果标题</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`繁体结果：`</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建繁体结果展示文本</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.traditionalResult&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="variable language_">this</span>.<span class="property">minTextAreaHeight</span>, <span class="attr">maxHeight</span>: <span class="variable language_">this</span>.<span class="property">maxTextAreaHeight</span> &#125;)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">copyOption</span>(<span class="title class_">CopyOptions</span>.<span class="property">InApp</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">3</span>&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建复制繁体结果按钮</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">            .<span class="title function_">enabled</span>(<span class="variable language_">this</span>.<span class="property">traditionalResult</span> ? <span class="literal">true</span> : <span class="literal">false</span>) <span class="comment">// 只有当有繁体结果时，按钮才可用</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.basePadding * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">traditionalResult</span>)); <span class="comment">// 复制繁体结果到剪贴板</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">        .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建简体结果展示与复制区域</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建简体结果标题</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`简体结果：`</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建简体结果展示文本</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.simplifiedResult&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="variable language_">this</span>.<span class="property">minTextAreaHeight</span>, <span class="attr">maxHeight</span>: <span class="variable language_">this</span>.<span class="property">maxTextAreaHeight</span> &#125;)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">copyOption</span>(<span class="title class_">CopyOptions</span>.<span class="property">InApp</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">3</span>&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建复制简体结果按钮</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">            .<span class="title function_">enabled</span>(<span class="variable language_">this</span>.<span class="property">simplifiedResult</span> ? <span class="literal">true</span> : <span class="literal">false</span>) <span class="comment">// 只有当有简体结果时，按钮才可用</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.basePadding * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">simplifiedResult</span>)); <span class="comment">// 复制简体结果到剪贴板</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">        .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f2f3f5&quot;</span>)</span><br><span class="line">    .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Up-Lower"><a href="#Up-Lower" class="headerlink" title="Up Lower"></a>Up Lower</h1><p>数字转中文大小写</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ohpm install @nutpi/chinese-finance-number</span><br><span class="line">ohpm install @nutpi/chinese-number-format</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入必要的模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 用于显示提示信息</span></span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>; <span class="comment">// 用于处理剪贴板操作</span></span><br><span class="line"><span class="keyword">import</span> &#123; toChineseNumber &#125; <span class="keyword">from</span> <span class="string">&#x27;@nutpi/chinese-finance-number&#x27;</span>; <span class="comment">// 将数字转换为中文大写金额</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  toChineseWithUnits, <span class="comment">// 将数字转换为带单位的中文</span></span><br><span class="line">  toUpperCase, <span class="comment">// 将中文小写转换为大写</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@nutpi/chinese-number-format&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span> <span class="comment">// 标记此组件为入口点</span></span><br><span class="line">@<span class="title class_">Component</span> <span class="comment">// 定义一个组件</span></span><br><span class="line">struct <span class="title class_">NumberToChineseConverter</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">exampleNumber</span>: number = <span class="number">88.8</span>; <span class="comment">// 示例数字</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">textColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>; <span class="comment">// 文本颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">lineColor</span>: string = <span class="string">&quot;#d5d5d5&quot;</span>; <span class="comment">// 分割线颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">basePadding</span>: number = <span class="number">30</span>; <span class="comment">// 基础内边距</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">chineseLowercase</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 转换后的小写中文</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">chineseUppercase</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 转换后的中文大写</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">chineseUppercaseAmount</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 转换后的中文大写金额</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;inputChanged&#x27;</span>) private <span class="attr">inputText</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 监听输入文本变化</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当输入文本改变时触发的方法</span></span><br><span class="line">  <span class="title function_">inputChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chineseLowercase</span> = <span class="title function_">toChineseWithUnits</span>(<span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">inputText</span>), <span class="string">&#x27;zh-CN&#x27;</span>); <span class="comment">// 转换为小写中文并带上单位</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chineseUppercase</span> = <span class="title function_">toUpperCase</span>(<span class="variable language_">this</span>.<span class="property">chineseLowercase</span>, <span class="string">&#x27;zh-CN&#x27;</span>); <span class="comment">// 将小写中文转换为大写</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chineseUppercaseAmount</span> = <span class="title function_">toChineseNumber</span>(<span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">inputText</span>)); <span class="comment">// 转换为大写金额</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 复制文本到剪贴板的方法</span></span><br><span class="line">  private <span class="title function_">copyToClipboard</span>(<span class="attr">text</span>: string): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pasteboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text); <span class="comment">// 创建剪贴板数据</span></span><br><span class="line">    <span class="keyword">const</span> systemPasteboard = pasteboard.<span class="title function_">getSystemPasteboard</span>(); <span class="comment">// 获取系统剪贴板</span></span><br><span class="line">    systemPasteboard.<span class="title function_">setData</span>(pasteboardData); <span class="comment">// 设置剪贴板数据</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;已复制&#x27;</span> &#125;); <span class="comment">// 显示复制成功的提示</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建用户界面的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 主列容器</span></span><br><span class="line">      <span class="comment">// 页面标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;数字转中文大小写&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 文本居中对齐</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">        .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">          <span class="attr">radius</span>: <span class="number">2</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">          <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">          <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">          <span class="attr">offsetY</span>: <span class="number">5</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Scroll</span>() &#123; <span class="comment">// 滚动视图</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123; <span class="comment">// 内部列容器</span></span><br><span class="line">          <span class="comment">// 工具介绍部分</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">&#x27;工具介绍&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontWeight</span>(<span class="number">600</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>); <span class="comment">// 设置介绍文字样式</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">&#x27;将数字转换为中文格式，适用于票据填写、合同文书、财务报表等多种场景。支持从最小单位“分”到最大单位“千兆”的数字转换。&#x27;</span>)</span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">JUSTIFY</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span> &#125;); <span class="comment">// 设置介绍详情文字样式</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>) <span class="comment">// 对齐方式</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">            <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">0</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 输入区</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123; <span class="comment">// 行容器</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;示例&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="string">&quot;#5871ce&quot;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f2f1fd&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">inputText</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.exampleNumber&#125;</span>`</span>; <span class="comment">// 设置输入框文本为示例数字</span></span><br><span class="line">                &#125;);</span><br><span class="line">              <span class="title class_">Blank</span>(); <span class="comment">// 占位符</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;清空&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="string">&quot;#e48742&quot;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#ffefe6&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">inputText</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 清空输入框</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">height</span>(<span class="number">45</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">            <span class="title class_">Divider</span>().<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span> &#125;); <span class="comment">// 分割线</span></span><br><span class="line">            <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: $$this.<span class="property">inputText</span>, <span class="attr">placeholder</span>: <span class="string">`请输入数字，例如：<span class="subst">$&#123;<span class="variable language_">this</span>.exampleNumber&#125;</span>`</span> &#125;) <span class="comment">// 输入框</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">              .<span class="title function_">caretColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 设置光标颜色</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">              .<span class="title function_">padding</span>(<span class="number">0</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">0</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">              .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">NUMBER_DECIMAL</span>); <span class="comment">// 设置输入类型为数字</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>) <span class="comment">// 对齐方式</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">            <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">0</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 结果区</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`小写：<span class="subst">$&#123;<span class="variable language_">this</span>.chineseLowercase&#125;</span>`</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 显示小写结果</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0052d9&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">chineseLowercase</span>); <span class="comment">// 复制小写结果到剪贴板</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="number">45</span> &#125;) <span class="comment">// 最小高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">            <span class="title class_">Divider</span>().<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span> &#125;); <span class="comment">// 分割线</span></span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`大写：<span class="subst">$&#123;<span class="variable language_">this</span>.chineseUppercase&#125;</span>`</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 显示大写结果</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0052d9&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">chineseUppercase</span>); <span class="comment">// 复制大写结果到剪贴板</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="number">45</span> &#125;) <span class="comment">// 最小高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">            <span class="title class_">Divider</span>().<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span> &#125;); <span class="comment">// 分割线</span></span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`大写金额：<span class="subst">$&#123;<span class="variable language_">this</span>.chineseUppercaseAmount&#125;</span>`</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 显示大写金额结果</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0052d9&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">chineseUppercaseAmount</span>); <span class="comment">// 复制大写金额结果到剪贴板</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="number">45</span> &#125;) <span class="comment">// 最小高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>) <span class="comment">// 对齐方式</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">            <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">0</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>).<span class="title function_">clip</span>(<span class="literal">false</span>); <span class="comment">// 关闭滚动条，不允许裁剪</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f4f8fb&quot;</span>); <span class="comment">// 设置页面背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<!--
erweima
https://blog.csdn.net/zhongcongxu01/article/details/144009716
--->
<h1 id="Tangram"><a href="#Tangram" class="headerlink" title="Tangram"></a>Tangram</h1><p>七巧板</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="title class_">ObservedV2</span> <span class="comment">// 监听数据变化的装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TangramBlock</span> &#123; <span class="comment">// 定义七巧板类</span></span><br><span class="line">  <span class="attr">width</span>: number; <span class="comment">// 宽度</span></span><br><span class="line">  <span class="attr">height</span>: number; <span class="comment">// 高度</span></span><br><span class="line">  <span class="attr">points</span>: <span class="title class_">Array</span>&lt;[number, number]&gt;; <span class="comment">// 点坐标数组</span></span><br><span class="line">  <span class="attr">color</span>: string; <span class="comment">// 颜色</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">initialOffsetX</span>: number; <span class="comment">// 初始X偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">initialOffsetY</span>: number; <span class="comment">// 初始Y偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">currentOffsetX</span>: number; <span class="comment">// 当前X偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">currentOffsetY</span>: number; <span class="comment">// 当前Y偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotationAngle</span>: number; <span class="comment">// 旋转角度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">flipAngle</span>: number = <span class="number">0</span>; <span class="comment">// 翻转角度，默认为0</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotateValue</span>: number; <span class="comment">// 旋转值</span></span><br><span class="line">  <span class="attr">defaultInitialOffsetX</span>: number; <span class="comment">// 默认初始X偏移量</span></span><br><span class="line">  <span class="attr">defaultInitialOffsetY</span>: number; <span class="comment">// 默认初始Y偏移量</span></span><br><span class="line">  <span class="attr">defaultRotationAngle</span>: number; <span class="comment">// 默认旋转角度</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">color: string, width: number, height: number, initialOffsetX: number, initialOffsetY: number,</span></span><br><span class="line"><span class="params">    rotationAngle: number, points: <span class="built_in">Array</span>&lt;[number, number]&gt;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetX</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetX</span> = initialOffsetX; <span class="comment">// 初始化X偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetY</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetY</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetY</span> = initialOffsetY; <span class="comment">// 初始化Y偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">rotateValue</span> = <span class="variable language_">this</span>.<span class="property">defaultRotationAngle</span> = rotationAngle; <span class="comment">// 初始化旋转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color; <span class="comment">// 设置颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width; <span class="comment">// 设置宽度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height; <span class="comment">// 设置高度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">points</span> = points; <span class="comment">// 设置点坐标数组</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">resetData</span>(<span class="params"></span>) &#123; <span class="comment">// 重置数据方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flipAngle</span> = <span class="number">0</span>; <span class="comment">// 重置翻转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetX</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetX</span>; <span class="comment">// 重置初始X偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetY</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetY</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetY</span>; <span class="comment">// 重置初始Y偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">rotateValue</span> = <span class="variable language_">this</span>.<span class="property">defaultRotationAngle</span>; <span class="comment">// 重置旋转角度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">baseUnitLength</span>: number = <span class="number">80</span>; <span class="comment">// 基本单位长度</span></span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span> <span class="comment">// 入口组件</span></span><br><span class="line">@<span class="title class_">Component</span> <span class="comment">// 定义组件</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">Index</span> &#123; <span class="comment">// 主组件</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedBlockIndex</span>: number = -<span class="number">1</span>; <span class="comment">// 当前选中位置</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">blocks</span>: <span class="title class_">TangramBlock</span>[] = [<span class="comment">// 七巧板数组</span></span><br><span class="line">  <span class="comment">// 小直角等腰三角形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#fed8e5&quot;</span>, baseUnitLength, baseUnitLength, -<span class="number">33.58</span>, -<span class="number">58.02</span>, <span class="number">135</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength]]),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#0a0bef&quot;</span>, baseUnitLength, baseUnitLength, <span class="number">78.76</span>, <span class="number">54.15</span>, <span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength]]),</span><br><span class="line">    <span class="comment">// 中直角等腰三角形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#ff0d0c&quot;</span>, baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>), baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>), -<span class="number">33.16</span>, -<span class="number">1.43</span>, -<span class="number">90</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>), <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>)]]),</span><br><span class="line">    <span class="comment">// 大直角等腰三角形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#ffa60a&quot;</span>, baseUnitLength * <span class="number">2</span>, baseUnitLength * <span class="number">2</span>, <span class="number">22.46</span>, -<span class="number">172</span>, -<span class="number">135</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength * <span class="number">2</span>, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength * <span class="number">2</span>]]),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#3da56a&quot;</span>, baseUnitLength * <span class="number">2</span>, baseUnitLength * <span class="number">2</span>, <span class="number">135.65</span>, -<span class="number">59.34</span>, -<span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength * <span class="number">2</span>, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength * <span class="number">2</span>]]),</span><br><span class="line">    <span class="comment">// 正方形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#ffff0b&quot;</span>, baseUnitLength, baseUnitLength, <span class="number">23.07</span>, -<span class="number">1.84</span>, -<span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [baseUnitLength, baseUnitLength], [<span class="number">0</span>, baseUnitLength]]),</span><br><span class="line">    <span class="comment">// 平行四边形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#5e0b9b&quot;</span>, baseUnitLength * <span class="number">2</span>, baseUnitLength, -<span class="number">61.53</span>, -<span class="number">85.97</span>, <span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [baseUnitLength * <span class="number">2</span>, baseUnitLength], [baseUnitLength, baseUnitLength]])</span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123; <span class="comment">// 构建方法</span></span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">30</span> &#125;) &#123; <span class="comment">// 创建垂直布局</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建堆叠布局</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">blocks</span>, <span class="function">(<span class="params">block: TangramBlock, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历七巧板数组</span></span><br><span class="line">          <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建堆叠布局</span></span><br><span class="line">            <span class="title class_">Polygon</span>(&#123; <span class="attr">width</span>: block.<span class="property">width</span>, <span class="attr">height</span>: block.<span class="property">height</span> &#125;)<span class="comment">// 绘制多边形</span></span><br><span class="line">              .<span class="title function_">points</span>(block.<span class="property">points</span>)<span class="comment">// 设置多边形顶点坐标</span></span><br><span class="line">              .<span class="title function_">fill</span>(block.<span class="property">color</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">              .<span class="title function_">draggable</span>(<span class="literal">false</span>)<span class="comment">// 长按不可拖动</span></span><br><span class="line">              .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: block.<span class="property">rotationAngle</span> &#125;) <span class="comment">// 旋转角度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">            <span class="comment">// 旋转</span></span><br><span class="line">            <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">angle</span>: block.<span class="property">flipAngle</span>,</span><br><span class="line">            <span class="attr">centerX</span>: block.<span class="property">width</span> / <span class="number">2</span>, <span class="comment">// 中心点X坐标</span></span><br><span class="line">            <span class="attr">centerY</span>: block.<span class="property">height</span> / <span class="number">2</span>, <span class="comment">// 中心点Y坐标</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">width</span>(block.<span class="property">width</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(block.<span class="property">height</span>) <span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">onTouch</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 触摸事件</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> = index; <span class="comment">// 设置选中索引</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">draggable</span>(<span class="literal">false</span>) <span class="comment">// 长按不可拖动</span></span><br><span class="line">          .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: block.<span class="property">initialOffsetX</span>, <span class="attr">y</span>: block.<span class="property">initialOffsetY</span>, <span class="attr">z</span>: <span class="number">0</span> &#125;) <span class="comment">// 平移</span></span><br><span class="line">          .<span class="title function_">gesture</span>( <span class="comment">// 手势操作</span></span><br><span class="line">            <span class="title class_">PanGesture</span>()<span class="comment">// 拖动手势</span></span><br><span class="line">              .<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent | <span class="literal">undefined</span></span>) =&gt;</span> &#123; <span class="comment">// 更新事件</span></span><br><span class="line">                <span class="keyword">if</span> (event) &#123;</span><br><span class="line">                  block.<span class="property">initialOffsetX</span> = block.<span class="property">currentOffsetX</span> + event.<span class="property">offsetX</span>; <span class="comment">// 更新X偏移量</span></span><br><span class="line">                  block.<span class="property">initialOffsetY</span> = block.<span class="property">currentOffsetY</span> + event.<span class="property">offsetY</span>; <span class="comment">// 更新Y偏移量</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .<span class="title function_">onActionEnd</span>(<span class="function">(<span class="params">event: GestureEvent | <span class="literal">undefined</span></span>) =&gt;</span> &#123; <span class="comment">// 结束事件</span></span><br><span class="line">                <span class="keyword">if</span> (event) &#123;</span><br><span class="line">                  block.<span class="property">currentOffsetX</span> = block.<span class="property">initialOffsetX</span>; <span class="comment">// 更新当前X偏移量</span></span><br><span class="line">                  block.<span class="property">currentOffsetY</span> = block.<span class="property">initialOffsetY</span>; <span class="comment">// 更新当前Y偏移量</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">          )</span><br><span class="line">          .<span class="title function_">zIndex</span>(<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> == index ? <span class="number">1</span> : <span class="number">0</span>) <span class="comment">// 设置层级</span></span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">2</span>) <span class="comment">// 边框宽度</span></span><br><span class="line">          .<span class="title function_">borderStyle</span>(<span class="title class_">BorderStyle</span>.<span class="property">Dashed</span>) <span class="comment">// 边框样式</span></span><br><span class="line">          .<span class="title function_">borderColor</span>(<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> == index ? <span class="string">&quot;#80a8a8a8&quot;</span> : <span class="title class_">Color</span>.<span class="property">Transparent</span>) <span class="comment">// 边框颜色</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;750lpx&#x27;</span>) <span class="comment">// 设置宽高</span></span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#e4f2f5&quot;</span>) <span class="comment">// 背景颜色</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 旋转角度计数器</span></span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建垂直布局，设置间距</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`旋转角度(间隔5)`</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 显示旋转角度文本，设置字体颜色</span></span><br><span class="line">        <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建计数器组件</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.selectedBlockIndex != -<span class="number">1</span> ? <span class="variable language_">this</span>.blocks[<span class="variable language_">this</span>.selectedBlockIndex].rotationAngle :</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="string">&#x27;-&#x27;</span>&#125;</span>`</span>)<span class="comment">// 显示当前选中七巧板的旋转角度或占位符</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">        .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> += <span class="number">5</span>; <span class="comment">// 增加旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> -= <span class="number">5</span>; <span class="comment">// 减少旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 旋转角度计数器</span></span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建垂直布局，设置间距</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`旋转角度(间隔45)`</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 显示旋转角度文本，设置字体颜色</span></span><br><span class="line">        <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建计数器组件</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.selectedBlockIndex != -<span class="number">1</span> ? <span class="variable language_">this</span>.blocks[<span class="variable language_">this</span>.selectedBlockIndex].rotationAngle :</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="string">&#x27;-&#x27;</span>&#125;</span>`</span>)<span class="comment">// 显示当前选中七巧板的旋转角度或占位符</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">        .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> += <span class="number">45</span>; <span class="comment">// 增加旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> -= <span class="number">45</span>; <span class="comment">// 减少旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 翻转按钮</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123; <span class="comment">// 创建水平布局</span></span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;向左翻转&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 左翻转按钮点击事件</span></span><br><span class="line">          <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">flipAngle</span> -= <span class="number">180</span>; <span class="comment">// 减少翻转角度</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;向右翻转&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 右翻转按钮点击事件</span></span><br><span class="line">          <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">flipAngle</span> += <span class="number">180</span>; <span class="comment">// 增加翻转角度</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceEvenly</span>) <span class="comment">// 设置宽度和内容对齐方式</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 重置和隐藏边框按钮</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123; <span class="comment">// 创建水平布局</span></span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;重置&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 重置按钮点击事件</span></span><br><span class="line">          <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">blocks</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[i].<span class="title function_">resetData</span>(); <span class="comment">// 重置七巧板数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> = -<span class="number">1</span>; <span class="comment">// 重置选中索引</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;隐藏边框&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 隐藏边框按钮点击事件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> = -<span class="number">1</span>; <span class="comment">// 重置选中索引</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceEvenly</span>) <span class="comment">// 设置宽度和内容对齐</span></span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Reversi"><a href="#Reversi" class="headerlink" title="Reversi"></a>Reversi</h1><p>翻转棋（Reversi）、奥赛罗棋（Othello）、苹果棋或正反棋（Anti reversi） 黑白棋</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入用于弹出对话框的工具</span></span><br><span class="line"> </span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChessCell</span> &#123; <span class="comment">// 定义棋盘上的单元格类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">frontVisibility</span>: number = <span class="number">0</span>; <span class="comment">// 单元格上的棋子状态：0表示无子, 1表示黑子，2表示白子</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span>; <span class="comment">// 单元格卡片的旋转角度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">opacity</span>: number = <span class="number">1</span>; <span class="comment">// 透明度</span></span><br><span class="line">  <span class="attr">isAnimationRunning</span>: boolean = <span class="literal">false</span>; <span class="comment">// 标记动画是否正在运行</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">flip</span>(<span class="params">time: number</span>) &#123; <span class="comment">// 翻转棋子的方法</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frontVisibility</span> === <span class="number">1</span>) &#123; <span class="comment">// 当前是黑子，要翻转成白子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showWhite</span>(time);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frontVisibility</span> === <span class="number">2</span>) &#123; <span class="comment">// 当前是白子，要翻转成黑子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showBlack</span>(time);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">showBlack</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123; <span class="comment">// 展示黑色棋子</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="keyword">if</span> (animationTime == <span class="number">0</span>) &#123; <span class="comment">// 如果不需要动画</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">0</span>; <span class="comment">// 设置旋转角度为0</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">1</span>; <span class="comment">// 黑子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">1</span>; <span class="comment">// 看到黑色</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">0</span>; <span class="comment">// 设置旋转角度为0</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">showWhite</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123; <span class="comment">// 展示白色棋子</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="keyword">if</span> (animationTime == <span class="number">0</span>) &#123; <span class="comment">// 如果不需要动画</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 白子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line"> </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 看到白色</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">showWhiteAi</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123; <span class="comment">// 展示白色棋子</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="keyword">if</span> (animationTime == <span class="number">0</span>) &#123; <span class="comment">// 如果不需要动画</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 白子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 白子</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime * <span class="number">3</span>, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseOut</span>,</span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">3</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line"> </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">opacity</span> = <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">opacity</span> = <span class="number">0.2</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TileHighlight</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isValidMove</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">OthelloGame</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">chessBoard</span>: <span class="title class_">ChessCell</span>[][] = [];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">70</span>;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSpacing</span>: number = <span class="number">5</span>;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">transitionDuration</span>: number = <span class="number">200</span>;</span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;currentPlayerIsBlackChanged&#x27;</span>) <span class="attr">currentPlayerIsBlack</span>: boolean = <span class="literal">true</span>; <span class="comment">// 先手，true表示黑棋</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">chessBoardSize</span>: number = <span class="number">8</span>; <span class="comment">// 假设棋盘大小为8×8</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">validMoveIndicators</span>: <span class="title class_">TileHighlight</span> [][] = []</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isTwoPlayerMode</span>: boolean = <span class="literal">false</span>; <span class="comment">//true:双击游戏，false:单人游戏</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isAIPlaying</span>:boolean = <span class="literal">false</span><span class="comment">//true:AI正在下棋</span></span><br><span class="line">  <span class="title function_">currentPlayerIsBlackChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> color = <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="number">1</span> : <span class="number">2</span>; <span class="comment">// 1是黑子，2表示白子</span></span><br><span class="line">      <span class="keyword">let</span> hasMoves = <span class="variable language_">this</span>.<span class="title function_">hasValidMoves</span>(color);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (!hasMoves) &#123;</span><br><span class="line">        <span class="keyword">let</span> opponentHasMoves = <span class="variable language_">this</span>.<span class="title function_">hasValidMoves</span>(!<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="number">1</span> : <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!opponentHasMoves) &#123;</span><br><span class="line">          <span class="keyword">const</span> winner = <span class="variable language_">this</span>.<span class="title function_">determineWinner</span>();</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(winner);</span><br><span class="line">          promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;游戏结束&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;winner&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;]</span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">initGame</span>();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = !<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span>; <span class="comment">// 切换下一玩家</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span>) &#123; <span class="comment">// 当前是白棋, 模拟AI下棋</span></span><br><span class="line">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span>) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">aiPlaceRandom</span>();</span><br><span class="line">            &#125;, <span class="variable language_">this</span>.<span class="property">transitionDuration</span> + <span class="number">20</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="variable language_">this</span>.<span class="property">transitionDuration</span> + <span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">aiPlaceRandom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">validMoves</span>: [number, number][] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[i].<span class="property">length</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[i][j].<span class="property">isValidMove</span>) &#123;</span><br><span class="line">          validMoves.<span class="title function_">push</span>([i, j]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (validMoves.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> randomMove = validMoves[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * validMoves.<span class="property">length</span>)];</span><br><span class="line">      <span class="keyword">let</span> chessCell = <span class="variable language_">this</span>.<span class="property">chessBoard</span>[randomMove[<span class="number">0</span>]][randomMove[<span class="number">1</span>]];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">placeChessPiece</span>(randomMove[<span class="number">0</span>], randomMove[<span class="number">1</span>], chessCell)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">placeChessPiece</span>(<span class="params">i: number, j: number, chessCell: ChessCell</span>) &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> reversibleTiles = <span class="variable language_">this</span>.<span class="title function_">findReversible</span>(i, j, <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="number">1</span> : <span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`reversibleTiles:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(reversibleTiles)&#125;</span>`</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (reversibleTiles.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = <span class="literal">false</span>;</span><br><span class="line">        chessCell.<span class="title function_">showBlack</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversibleTiles.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          reversibleTiles[i].<span class="title function_">flip</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span>) &#123; <span class="comment">//双人游戏，无动画</span></span><br><span class="line">          chessCell.<span class="title function_">showWhite</span>(<span class="number">0</span>);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversibleTiles.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            reversibleTiles[i].<span class="title function_">flip</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>);</span><br><span class="line">          &#125;</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//单人游戏，落子需要闪烁动画</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isAIPlaying</span> = <span class="literal">true</span><span class="comment">//AI 正在下棋</span></span><br><span class="line">          chessCell.<span class="title function_">showWhiteAi</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversibleTiles.<span class="property">length</span>; i++) &#123;</span><br><span class="line">              reversibleTiles[i].<span class="title function_">flip</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">currentPlayerIsBlackChanged</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAIPlaying</span> = <span class="literal">false</span><span class="comment">//AI下完了</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">hasValidMoves</span>(<span class="params">color: number</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> hasMoves = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">chessBoard</span>[row][col].<span class="property">frontVisibility</span> === <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">findReversible</span>(row, col, color).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[row][col].<span class="property">isValidMove</span> = <span class="literal">true</span>;</span><br><span class="line">          hasMoves = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[row][col].<span class="property">isValidMove</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hasMoves;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">chessBoard</span>.<span class="title function_">push</span>([]);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>.<span class="title function_">push</span>([])</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chessBoard</span>[i].<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">ChessCell</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[i].<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">TileHighlight</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initGame</span>()</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">initGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chessBoard</span>[i][j].<span class="property">frontVisibility</span> = <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始棋盘布局</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">3</span>][<span class="number">3</span>].<span class="property">frontVisibility</span> = <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">3</span>][<span class="number">4</span>].<span class="property">frontVisibility</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">4</span>][<span class="number">3</span>].<span class="property">frontVisibility</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">4</span>][<span class="number">4</span>].<span class="property">frontVisibility</span> = <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">currentPlayerIsBlackChanged</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">findReversible</span>(<span class="attr">row</span>: number, <span class="attr">col</span>: number, <span class="attr">color</span>: number): <span class="title class_">ChessCell</span>[] &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">reversibleTiles</span>: <span class="title class_">ChessCell</span>[] = [];</span><br><span class="line">    <span class="keyword">const</span> directions = [</span><br><span class="line">      [-<span class="number">1</span>, -<span class="number">1</span>], <span class="comment">// 左上</span></span><br><span class="line">      [-<span class="number">1</span>, <span class="number">0</span>], <span class="comment">// 正上</span></span><br><span class="line">      [-<span class="number">1</span>, <span class="number">1</span>], <span class="comment">// 右上</span></span><br><span class="line">      [<span class="number">0</span>, -<span class="number">1</span>], <span class="comment">// 左</span></span><br><span class="line">      [<span class="number">0</span>, <span class="number">1</span>], <span class="comment">// 右</span></span><br><span class="line">      [<span class="number">1</span>, -<span class="number">1</span>], <span class="comment">// 左下</span></span><br><span class="line">      [<span class="number">1</span>, <span class="number">0</span>], <span class="comment">// 正下</span></span><br><span class="line">      [<span class="number">1</span>, <span class="number">1</span>]<span class="comment">// 右下</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> direction <span class="keyword">of</span> directions) &#123;</span><br><span class="line">      <span class="keyword">let</span> foundOpposite = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">let</span> x = row;</span><br><span class="line">      <span class="keyword">let</span> y = col;</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        x += direction[<span class="number">0</span>];</span><br><span class="line">        y += direction[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt;= <span class="variable language_">this</span>.<span class="property">chessBoardSize</span> || y &gt;= <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> cell = <span class="variable language_">this</span>.<span class="property">chessBoard</span>[x][y];</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === color) &#123;</span><br><span class="line">          <span class="keyword">if</span> (foundOpposite) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">tempX</span>: number = x - direction[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">tempY</span>: number = y - direction[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">while</span> (tempX !== row || tempY !== col) &#123;</span><br><span class="line">              reversibleTiles.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">chessBoard</span>[tempX][tempY]);</span><br><span class="line">              tempX -= direction[<span class="number">0</span>];</span><br><span class="line">              tempY -= direction[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          foundOpposite = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> reversibleTiles;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">determineWinner</span>(): string &#123;</span><br><span class="line">    <span class="keyword">let</span> blackCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> whiteCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">chessBoard</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> cell <span class="keyword">of</span> row) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          blackCount++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === <span class="number">2</span>) &#123;</span><br><span class="line">          whiteCount++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (blackCount &gt; whiteCount) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;黑棋获胜！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (whiteCount &gt; blackCount) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;白棋获胜！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;平局！&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">hasValidMove</span>(<span class="attr">color</span>: number): boolean &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">chessBoard</span>[row][col].<span class="property">frontVisibility</span> === <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">findReversible</span>(row, col, color).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">``</span>)<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`黑棋行动`</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`白棋行动`</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">          <span class="title class_">Text</span>()<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">visibility</span>(!<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">8</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="comment">//棋盘背景</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>, <span class="function">(<span class="params">row: boolean[], _rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">item: TileHighlight, _colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item.isValidMove ? <span class="string">&#x27;+&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>)<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">2</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">8</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        <span class="comment">//棋子</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">chessBoard</span>, <span class="function">(<span class="params">row: ChessCell[], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">chessCell: ChessCell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">``</span>)<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>)<span class="comment">// 设置边距</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">                .<span class="title function_">opacity</span>(chessCell.<span class="property">opacity</span>)</span><br><span class="line">                .<span class="title function_">backgroundColor</span>(chessCell.<span class="property">frontVisibility</span> != <span class="number">0</span> ?</span><br><span class="line">                  (chessCell.<span class="property">frontVisibility</span> === <span class="number">1</span> ? <span class="title class_">Color</span>.<span class="property">Black</span> : <span class="title class_">Color</span>.<span class="property">White</span>) :</span><br><span class="line">                <span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">                  <span class="comment">// 设置旋转</span></span><br><span class="line">                  <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">                  <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">angle</span>: chessCell.<span class="property">rotationAngle</span>, <span class="comment">// 旋转角度</span></span><br><span class="line">                  <span class="attr">centerX</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点X坐标</span></span><br><span class="line">                  <span class="attr">centerY</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点Y坐标</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 单击事件处理</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAIPlaying</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`ai正在落子，玩家不可继续落子`</span>)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">if</span> (chessCell.<span class="property">frontVisibility</span> === <span class="number">0</span>) &#123; <span class="comment">// 没有棋子，需要落子</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">placeChessPiece</span>(rowIndex, colIndex, chessCell)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">8</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.isTwoPlayerMode? <span class="string">&#x27;双人游戏&#x27;</span> : <span class="string">&#x27;单人游戏&#x27;</span>&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">          .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">        <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Switch</span>, <span class="attr">isOn</span>: <span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span> &#125;)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">200</span>, <span class="attr">right</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">onChange</span>(<span class="function">(<span class="params">isOn: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span> = isOn</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 按钮点击事件</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initGame</span>()</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度和宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="nine-square"><a href="#nine-square" class="headerlink" title="nine-square"></a>nine-square</h1><p>九宫格抽奖</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个可观察的Prize类，用于表示奖品信息。</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prize</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">title</span>: string <span class="comment">// 奖品标题属性，使用@Trace进行追踪以便响应式更新UI</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">color</span>: string <span class="comment">// 奖品颜色属性</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">description</span>: string <span class="comment">// 奖品描述属性</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数，用来初始化新的奖品实例</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">title: string, color: string, description: string = <span class="string">&quot;&quot;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = title <span class="comment">// 设置奖品标题</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color <span class="comment">// 设置奖品颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">description</span> = description <span class="comment">// 设置奖品描述，默认为空字符串</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义MyPrizeUpdate结构组件，用于显示和编辑选中的奖品信息</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">MyPrizeUpdate</span> &#123;</span><br><span class="line">  @<span class="title class_">Consume</span> <span class="attr">selectedIndex</span>: number <span class="comment">// 当前选中的奖品索引</span></span><br><span class="line">  @<span class="title class_">Consume</span> private <span class="attr">selectionOrder</span>: number[] <span class="comment">// 保存抽奖顺序的数组</span></span><br><span class="line">  @<span class="title class_">Consume</span> private <span class="attr">prizeArray</span>: <span class="title class_">Prize</span>[] <span class="comment">// 保存所有奖品的数组</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建列布局容器，设置子元素之间的间距为20px</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123; <span class="comment">// 创建行布局容器</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;标题：&#x27;</span>) <span class="comment">// 显示“标题”文本</span></span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">title</span> &#125;)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>) <span class="comment">// 设置输入框宽度</span></span><br><span class="line">          .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 监听输入框内容变化</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">title</span> = value <span class="comment">// 更新奖品标题</span></span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;描述：&#x27;</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123;</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[<span class="variable language_">this</span>.selectionOrder[<span class="variable language_">this</span>.selectedIndex%<span class="variable language_">this</span>.selectionOrder.length]].description&#125;</span>`</span></span><br><span class="line">        &#125;).<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>).<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 同上，但针对奖品描述</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">description</span> = value</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;颜色：&#x27;</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123;</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[<span class="variable language_">this</span>.selectionOrder[<span class="variable language_">this</span>.selectedIndex%<span class="variable language_">this</span>.selectionOrder.length]].color&#125;</span>`</span></span><br><span class="line">        &#125;).<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>).<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 同上，但针对奖品颜色</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">color</span> = value</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Start</span>) <span class="comment">// 设置内容左对齐</span></span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">40</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色为白色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义抽奖页面入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">LotteryPage</span> &#123;</span><br><span class="line">  @<span class="title class_">Provide</span> private <span class="attr">selectedIndex</span>: number = <span class="number">0</span> <span class="comment">// 提供当前选中的索引，初始值为0</span></span><br><span class="line">  private <span class="attr">isAnimating</span>: boolean = <span class="literal">false</span> <span class="comment">// 标记是否正在进行动画，初始值为false</span></span><br><span class="line">  @<span class="title class_">Provide</span> private <span class="attr">selectionOrder</span>: number[] = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>] <span class="comment">// 定义抽奖顺序</span></span><br><span class="line">  private <span class="attr">cellWidth</span>: number = <span class="number">200</span> <span class="comment">// 单元格宽度</span></span><br><span class="line">  private <span class="attr">baseMargin</span>: number = <span class="number">10</span> <span class="comment">// 单元格边距</span></span><br><span class="line">  @<span class="title class_">Provide</span> private <span class="attr">prizeArray</span>: <span class="title class_">Prize</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;红包&quot;</span>, <span class="string">&quot;#ff9675&quot;</span>, <span class="string">&quot;10元&quot;</span>), <span class="comment">// 初始化奖品数组，创建各种奖品对象</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;话费&quot;</span>, <span class="string">&quot;#ff9f2e&quot;</span>, <span class="string">&quot;5元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;红包&quot;</span>, <span class="string">&quot;#8e7fff&quot;</span>, <span class="string">&quot;50元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;红包&quot;</span>, <span class="string">&quot;#48d1ea&quot;</span>, <span class="string">&quot;30元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;开始抽奖&quot;</span>, <span class="string">&quot;#fffdfd&quot;</span>), <span class="comment">// 抽奖按钮，没有具体奖品描述</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;谢谢参与&quot;</span>, <span class="string">&quot;#5f5f5f&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;谢谢参与&quot;</span>, <span class="string">&quot;#5f5f5f&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;超市红包&quot;</span>, <span class="string">&quot;#5f5f5f&quot;</span>, <span class="string">&quot;100元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;鲜花&quot;</span>, <span class="string">&quot;#75b0fe&quot;</span>),</span><br><span class="line">  ]</span><br><span class="line">  private <span class="attr">intervalID</span>: number = <span class="number">0</span> <span class="comment">// 定时器ID，用于控制抽奖速度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isSheetVisible</span>: boolean = <span class="literal">false</span> <span class="comment">// 控制底部弹出表单的可见性</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 开始抽奖逻辑</span></span><br><span class="line">  <span class="title function_">startLottery</span>(<span class="params">speed: number = <span class="number">500</span></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 设置延时执行</span></span><br><span class="line">      <span class="keyword">if</span> (speed &gt; <span class="number">50</span>) &#123; <span class="comment">// 如果速度大于50，则递归调用startLottery以逐渐加速</span></span><br><span class="line">        speed -= <span class="number">50</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">startLottery</span>(speed)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">runAtConstantSpeed</span>() <span class="comment">// 达到最高速度后进入匀速阶段</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedIndex</span>++ <span class="comment">// 每次调用时更新选中索引</span></span><br><span class="line">    &#125;, speed)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 以恒定速度运行抽奖</span></span><br><span class="line">  <span class="title function_">runAtConstantSpeed</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> speed = <span class="number">40</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>) <span class="comment">// 随机生成一个速度值</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalID</span>) <span class="comment">// 清除之前的定时器</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intervalID</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 设置新的定时器来更新选中索引</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedIndex</span> &gt;= speed) &#123; <span class="comment">// 如果选中索引达到速度值，停止并进入减速阶段</span></span><br><span class="line">        <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalID</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">slowDown</span>()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedIndex</span>++</span><br><span class="line">    &#125;, <span class="number">50</span>)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 减速逻辑</span></span><br><span class="line">  <span class="title function_">slowDown</span>(<span class="params">speed = <span class="number">50</span></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 设置延时执行</span></span><br><span class="line">      <span class="keyword">if</span> (speed &lt; <span class="number">500</span>) &#123; <span class="comment">// 如果速度小于500，则递归调用slowDown以逐渐减速</span></span><br><span class="line">        speed += <span class="number">50</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">slowDown</span>(speed)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedIndex</span> %= <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span> <span class="comment">// 确保索引在有效范围内</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>] <span class="comment">// 获取最终选中的奖品索引</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">false</span> <span class="comment">// 动画结束</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">showAlertDialog</span>(&#123; <span class="comment">// 显示结果对话框</span></span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;结果&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[index].title&#125;</span><span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[index].description&#125;</span>`</span>, <span class="comment">// 显示奖品信息</span></span><br><span class="line">          <span class="attr">confirm</span>: &#123;</span><br><span class="line">            <span class="attr">defaultFocus</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">value</span>: <span class="string">&#x27;我知道了&#x27;</span>, <span class="comment">// 确认按钮文本</span></span><br><span class="line">            <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123;&#125; <span class="comment">// 点击确认后的操作</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Center</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedIndex</span>++</span><br><span class="line">    &#125;, speed)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 使用Column布局容器</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123; <span class="comment">// 使用弹性布局，允许换行</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">prizeArray</span>, <span class="function">(<span class="params">item: Prize, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历奖品数组，创建每个奖品的UI</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123; <span class="comment">// 使用Column布局容器为每个奖品项</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item.title&#125;</span>`</span>) <span class="comment">// 显示奖品标题</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(index == <span class="number">4</span> ? <span class="title class_">Color</span>.<span class="property">White</span> : item.<span class="property">color</span>) <span class="comment">// 设置字体颜色，对于抽奖按钮特殊处理</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item.description&#125;</span>`</span>) <span class="comment">// 显示奖品描述</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(index == <span class="number">4</span> ? <span class="title class_">Color</span>.<span class="property">White</span> : item.<span class="property">color</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 添加点击效果</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 处理点击事件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimating</span>) &#123; <span class="comment">// 如果正在动画中，忽略点击</span></span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (index == <span class="number">4</span>) &#123; <span class="comment">// 如果点击的是抽奖按钮，开始抽奖</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">true</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">startLottery</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[i] == index) &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">selectedIndex</span> = i <span class="comment">// 更新选中索引到对应位置</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Center</span>) <span class="comment">// 设置水平居中对齐</span></span><br><span class="line">          .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>) <span class="comment">// 设置垂直居中对齐</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置单元格宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置单元格高度</span></span><br><span class="line">          .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseMargin&#125;</span>lpx`</span>) <span class="comment">// 设置单元格边距</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(index == <span class="number">4</span> ? <span class="string">&quot;#ff5444&quot;</span> : <span class="comment">// 抽奖按钮背景颜色特殊处理</span></span><br><span class="line">            (<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span> % <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>] == index ? <span class="title class_">Color</span>.<span class="property">Gray</span> : <span class="title class_">Color</span>.<span class="property">White</span>))</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 设置阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&quot;#f98732&quot;</span>,</span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">20</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth * <span class="number">3</span> + <span class="variable language_">this</span>.baseMargin * <span class="number">6</span>&#125;</span>lpx`</span>) <span class="comment">// 设置整体宽度</span></span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">30</span> &#125;) <span class="comment">// 设置顶部边距</span></span><br><span class="line">      <span class="title class_">MyPrizeUpdate</span>().<span class="title function_">margin</span>(&#123;<span class="attr">top</span>:<span class="number">20</span>&#125;) <span class="comment">// 插入MyPrizeUpdate组件，并设置其上边距</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度为100%</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#ffb350&quot;</span>) <span class="comment">// 设置页面背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>LotteryPage入口组件LotteryPage是整个抽奖应用的核心组件，负责组织页面布局和处理用户交互逻辑。它初始化了一系列必要的状态变量，比如保存所有奖品的数组prizeArray、定义抽奖顺序的selectionOrder以及控制动画状态的isAnimating等。此外，该组件实现了抽奖过程的关键方法——startLottery（开始抽奖）、runAtConstantSpeed（匀速运行）和slowDown（减速），它们共同协作以模拟真实的抽奖体验。当用户点击抽奖按钮时，这些方法按照预定的速度模式依次调用，直到最终确定一个奖品为止。最后，通过弹出对话框的方式向用户展示抽奖结果。</p>
<h1 id="blood"><a href="#blood" class="headerlink" title="blood"></a>blood</h1><p>血型计算</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入SegmentButton及其相关类型定义</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SegmentButton</span>, <span class="title class_">SegmentButtonItemTuple</span>, <span class="title class_">SegmentButtonOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用@Entry装饰器标记此组件为入口点</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">  <span class="comment">// 使用@Component装饰器标记此结构体为一个组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">  <span class="comment">// 定义一个名为BloodTypeCalculator的结构体，用于实现血型遗传计算功能</span></span><br><span class="line">struct <span class="title class_">BloodTypeCalculator</span> &#123;</span><br><span class="line">  <span class="comment">// 定义主题颜色，默认为橙色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">themeColor</span>: string | <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Orange</span>;</span><br><span class="line">  <span class="comment">// 定义文本颜色，默认为深灰色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">textColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义边框颜色，默认为浅灰色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">lineColor</span>: string = <span class="string">&quot;#d5d5d5&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义基础内边距大小，默认为30</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">basePadding</span>: number = <span class="number">30</span>;</span><br><span class="line">  <span class="comment">// 存储可能的血型结果</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">possibleBloodTypesText</span>: string = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 存储不可能的血型结果</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">impossibleBloodTypesText</span>: string = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义血型列表，包含A、B、AB、O四种血型</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">bloodTypeList</span>: object[] = [<span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;A&#x27;</span> &#125;), <span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;B&#x27;</span> &#125;), <span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;AB&#x27;</span> &#125;), <span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;O&#x27;</span> &#125;)];</span><br><span class="line">  <span class="comment">// 初始化单选胶囊按钮的配置项</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">singleSelectCapsuleOptions</span>: <span class="title class_">SegmentButtonOptions</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 监听父亲血型选择变化</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;capsuleSelectedIndexesChanged&#x27;</span>) <span class="attr">fatherBloodTypeIndex</span>: number[] = [<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// 监听母亲血型选择变化</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;capsuleSelectedIndexesChanged&#x27;</span>) <span class="attr">motherBloodTypeIndex</span>: number[] = [<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 根据血型获取其可能的基因组合</span></span><br><span class="line">  <span class="title function_">getGenes</span>(<span class="attr">bloodType</span>: string): string[] &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bloodType:<span class="subst">$&#123;bloodType&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">switch</span> (bloodType) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;O&#x27;</span>]; <span class="comment">// A型血可能的基因组合</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;O&#x27;</span>]; <span class="comment">// B型血可能的基因组合</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;AB&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]; <span class="comment">// AB型血可能的基因组合</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;O&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;O&#x27;</span>]; <span class="comment">// O型血可能的基因组合</span></span><br><span class="line">      <span class="attr">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid blood type&#x27;</span>); <span class="comment">// 非法血型抛出错误</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组合父母的基因以获得子代可能的基因组合</span></span><br><span class="line">  <span class="title function_">combineGenes</span>(<span class="attr">fatherGenes</span>: string[], <span class="attr">motherGenes</span>: string[]): string[] &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">possibleGenes</span>: string[] = []; <span class="comment">// 用于存储可能的基因组合</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fatherGene <span class="keyword">of</span> fatherGenes) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> motherGene <span class="keyword">of</span> motherGenes) &#123;</span><br><span class="line">        <span class="keyword">const</span> combinedGene = [fatherGene, motherGene].<span class="title function_">sort</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// 将父母的基因组合并排序后加入数组</span></span><br><span class="line">        <span class="keyword">if</span> (!possibleGenes.<span class="title function_">includes</span>(combinedGene)) &#123;</span><br><span class="line">          possibleGenes.<span class="title function_">push</span>(combinedGene); <span class="comment">// 如果组合尚未存在，则加入数组</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> possibleGenes; <span class="comment">// 返回所有可能的基因组合</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 根据基因组合确定血型</span></span><br><span class="line">  <span class="title function_">getBloodTypesFromGenes</span>(<span class="attr">genes</span>: string[]): string[] &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">bloodTypes</span>: string[] = []; <span class="comment">// 用于存储可能的血型</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> gene <span class="keyword">of</span> genes) &#123;</span><br><span class="line">      <span class="keyword">if</span> (gene === <span class="string">&#x27;AA&#x27;</span> || gene === <span class="string">&#x27;AO&#x27;</span> || gene === <span class="string">&#x27;OA&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;A&#x27;</span>); <span class="comment">// 基因组合为AA、AO或OA时，血型为A</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (gene === <span class="string">&#x27;BB&#x27;</span> || gene === <span class="string">&#x27;BO&#x27;</span> || gene === <span class="string">&#x27;OB&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;B&#x27;</span>); <span class="comment">// 基因组合为BB、BO或OB时，血型为B</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (gene === <span class="string">&#x27;AB&#x27;</span> || gene === <span class="string">&#x27;BA&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;AB&#x27;</span>); <span class="comment">// 基因组合为AB或BA时，血型为AB</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (gene === <span class="string">&#x27;OO&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;O&#x27;</span>); <span class="comment">// 基因组合为OO时，血型为O</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 去除重复的血型</span></span><br><span class="line">    <span class="keyword">return</span> bloodTypes.<span class="title function_">filter</span>(<span class="function">(<span class="params">value, index, self</span>) =&gt;</span> self.<span class="title function_">indexOf</span>(value) === index);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算孩子可能的血型及不可能的血型</span></span><br><span class="line">  <span class="title function_">calculatePossibleBloodTypes</span>(<span class="params">father: string, mother: string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fatherGenes = <span class="variable language_">this</span>.<span class="title function_">getGenes</span>(father); <span class="comment">// 获取父亲的基因组合</span></span><br><span class="line">    <span class="keyword">const</span> motherGenes = <span class="variable language_">this</span>.<span class="title function_">getGenes</span>(mother); <span class="comment">// 获取母亲的基因组合</span></span><br><span class="line">    <span class="keyword">const</span> possibleGenes = <span class="variable language_">this</span>.<span class="title function_">combineGenes</span>(fatherGenes, motherGenes); <span class="comment">// 组合父母的基因</span></span><br><span class="line">    <span class="keyword">const</span> possibleBloodTypes = <span class="variable language_">this</span>.<span class="title function_">getBloodTypesFromGenes</span>(possibleGenes); <span class="comment">// 从基因组合中获取可能的血型</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">allBloodTypes</span>: string[] = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;AB&#x27;</span>, <span class="string">&#x27;O&#x27;</span>]; <span class="comment">// 所有可能的血型列表</span></span><br><span class="line">    <span class="keyword">const</span> impossibleBloodTypes = allBloodTypes.<span class="title function_">filter</span>(<span class="function"><span class="params">bt</span> =&gt;</span> !possibleBloodTypes.<span class="title function_">includes</span>(bt)); <span class="comment">// 计算不可能的血型</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">possibleBloodTypesText</span> = <span class="string">`孩子可能血型：<span class="subst">$&#123;possibleBloodTypes.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>`</span>); <span class="comment">// 显示可能的血型</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">impossibleBloodTypesText</span> = <span class="string">`孩子不可能血型：<span class="subst">$&#123;impossibleBloodTypes.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>`</span>); <span class="comment">// 显示不可能的血型</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当胶囊按钮的选择发生变化时调用此函数</span></span><br><span class="line">  <span class="title function_">capsuleSelectedIndexesChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">father</span>: string = <span class="variable language_">this</span>.<span class="property">bloodTypeList</span>[<span class="variable language_">this</span>.<span class="property">fatherBloodTypeIndex</span>[<span class="number">0</span>]][<span class="string">&#x27;text&#x27;</span>]; <span class="comment">// 获取父亲选择的血型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">mother</span>: string = <span class="variable language_">this</span>.<span class="property">bloodTypeList</span>[<span class="variable language_">this</span>.<span class="property">motherBloodTypeIndex</span>[<span class="number">0</span>]][<span class="string">&#x27;text&#x27;</span>]; <span class="comment">// 获取母亲选择的血型</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calculatePossibleBloodTypes</span>(father, mother); <span class="comment">// 计算并更新血型信息</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在组件即将出现时调用此函数</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">singleSelectCapsuleOptions</span> = <span class="title class_">SegmentButtonOptions</span>.<span class="title function_">capsule</span>(&#123;</span><br><span class="line">      <span class="attr">buttons</span>: <span class="variable language_">this</span>.<span class="property">bloodTypeList</span> <span class="keyword">as</span> <span class="title class_">SegmentButtonItemTuple</span>, <span class="comment">// 设置胶囊按钮的选项</span></span><br><span class="line">      <span class="attr">multiply</span>: <span class="literal">false</span>, <span class="comment">// 单选模式</span></span><br><span class="line">      <span class="attr">fontColor</span>: <span class="title class_">Color</span>.<span class="property">White</span>, <span class="comment">// 字体颜色为白色</span></span><br><span class="line">      <span class="attr">selectedFontColor</span>: <span class="title class_">Color</span>.<span class="property">White</span>, <span class="comment">// 选中时字体颜色为白色</span></span><br><span class="line">      <span class="attr">selectedBackgroundColor</span>: <span class="variable language_">this</span>.<span class="property">themeColor</span>, <span class="comment">// 选中背景色为主题色</span></span><br><span class="line">      <span class="attr">backgroundColor</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 背景色为边框颜色</span></span><br><span class="line">      <span class="attr">backgroundBlurStyle</span>: <span class="title class_">BlurStyle</span>.<span class="property">BACKGROUND_THICK</span> <span class="comment">// 背景模糊效果</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">capsuleSelectedIndexesChanged</span>(); <span class="comment">// 初始化时调用选择变化处理函数</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建用户界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 页面标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;血型遗传计算&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 文本颜色</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 字体大小</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 宽度为100%</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>) <span class="comment">// 高度为50</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 文本居中对齐</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 背景色为白色</span></span><br><span class="line">        .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">          <span class="attr">radius</span>: <span class="number">2</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">          <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">          <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// 水平偏移量</span></span><br><span class="line">          <span class="attr">offsetY</span>: <span class="number">5</span> <span class="comment">// 垂直偏移量</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 工具介绍部分</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;工具介绍&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontWeight</span>(<span class="number">600</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;血型是以A、B、O三种遗传因子的组合而决定的，根据父母的血型，就可以判断出以后出生的孩子的血型。&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span> &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>,</span><br><span class="line">        <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 父亲血型选择部分</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;父亲血型&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">          <span class="title class_">SegmentButton</span>(&#123;</span><br><span class="line">            <span class="attr">options</span>: <span class="variable language_">this</span>.<span class="property">singleSelectCapsuleOptions</span>, <span class="comment">// 胶囊按钮的配置项</span></span><br><span class="line">            <span class="attr">selectedIndexes</span>: <span class="variable language_">this</span>.<span class="property">fatherBloodTypeIndex</span> <span class="comment">// 当前选中的索引</span></span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 母亲血型选择部分</span></span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;母亲血型&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">          <span class="title class_">SegmentButton</span>(&#123;</span><br><span class="line">            <span class="attr">options</span>: <span class="variable language_">this</span>.<span class="property">singleSelectCapsuleOptions</span>, <span class="comment">// 胶囊按钮的配置项</span></span><br><span class="line">            <span class="attr">selectedIndexes</span>: <span class="variable language_">this</span>.<span class="property">motherBloodTypeIndex</span> <span class="comment">// 当前选中的索引</span></span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>,</span><br><span class="line">        <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示计算结果</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">possibleBloodTypesText</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">impossibleBloodTypesText</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>,</span><br><span class="line">        <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f4f8fb&quot;</span>); <span class="comment">// 页面背景色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="compass"><a href="#compass" class="headerlink" title="compass"></a>compass</h1><p>指南针</p>
<p>传感器 角度计算</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sensor &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.SensorServiceKit&#x27;</span>; <span class="comment">// 导入传感器服务模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>; <span class="comment">// 导入业务错误处理模块</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义方向范围类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectionRange</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 方向名称</span></span><br><span class="line">  <span class="attr">min</span>: number = <span class="number">0</span>; <span class="comment">// 最小角度</span></span><br><span class="line">  <span class="attr">max</span>: number = <span class="number">0</span>; <span class="comment">// 最大角度</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义各个方向的范围</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">DIRECTION_RANGES</span>: <span class="title class_">DirectionRange</span>[] = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;北&#x27;</span>, <span class="attr">min</span>: <span class="number">337.5</span>, <span class="attr">max</span>: <span class="number">360</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;北&#x27;</span>, <span class="attr">min</span>: <span class="number">0</span>, <span class="attr">max</span>: <span class="number">22.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;东北&#x27;</span>, <span class="attr">min</span>: <span class="number">22.5</span>, <span class="attr">max</span>: <span class="number">67.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;东&#x27;</span>, <span class="attr">min</span>: <span class="number">67.5</span>, <span class="attr">max</span>: <span class="number">112.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;东南&#x27;</span>, <span class="attr">min</span>: <span class="number">112.5</span>, <span class="attr">max</span>: <span class="number">157.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;南&#x27;</span>, <span class="attr">min</span>: <span class="number">157.5</span>, <span class="attr">max</span>: <span class="number">202.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;西南&#x27;</span>, <span class="attr">min</span>: <span class="number">202.5</span>, <span class="attr">max</span>: <span class="number">247.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;西&#x27;</span>, <span class="attr">min</span>: <span class="number">247.5</span>, <span class="attr">max</span>: <span class="number">292.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;西北&#x27;</span>, <span class="attr">min</span>: <span class="number">292.5</span>, <span class="attr">max</span>: <span class="number">337.5</span> &#125;</span><br><span class="line">];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义指南针组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Compass</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">directionMessage</span>: string = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 当前方向的名称</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span>; <span class="comment">// 当前旋转角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentAngle</span>: number = <span class="number">0</span>; <span class="comment">// 当前传感器角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cumulativeRotation</span>: number = <span class="number">0</span>; <span class="comment">// 累计旋转角度</span></span><br><span class="line">  private <span class="attr">threshold</span>: number = <span class="number">1</span>; <span class="comment">// 设置阈值，用于过滤小的旋转变化</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时调用</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    sensor.<span class="title function_">getSensorList</span>(<span class="function">(<span class="params">error: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取传感器列表失败&#x27;</span>, error); <span class="comment">// 如果获取传感器列表失败，打印错误信息</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">startOrientationUpdates</span>(); <span class="comment">// 开始监听传感器数据</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 开始监听传感器的方位数据</span></span><br><span class="line">  private <span class="title function_">startOrientationUpdates</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    sensor.<span class="title function_">on</span>(sensor.<span class="property">SensorId</span>.<span class="property">ORIENTATION</span>, <span class="function">(<span class="params">orientationData</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> alpha = orientationData.<span class="property">alpha</span>; <span class="comment">// 获取当前的方位角</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">directionMessage</span> = <span class="variable language_">this</span>.<span class="title function_">calculateDirection</span>(alpha); <span class="comment">// 计算当前方向</span></span><br><span class="line">      <span class="keyword">const</span> angleDifference = <span class="variable language_">this</span>.<span class="title function_">calculateAngleDifference</span>(<span class="variable language_">this</span>.<span class="property">currentAngle</span>, alpha); <span class="comment">// 计算角度差</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(angleDifference) &gt; <span class="variable language_">this</span>.<span class="property">threshold</span>) &#123; <span class="comment">// 如果角度变化超过阈值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateRotationAngle</span>(angleDifference, alpha); <span class="comment">// 更新旋转角度</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, &#123; <span class="attr">interval</span>: <span class="number">10000000</span> &#125;); <span class="comment">// 设置传感器更新间隔，单位为纳秒，10000000表示1秒</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算两个角度之间的差异</span></span><br><span class="line">  private <span class="title function_">calculateAngleDifference</span>(<span class="attr">currentAngle</span>: number, <span class="attr">targetAngle</span>: number): number &#123;</span><br><span class="line">    <span class="keyword">let</span> diff = targetAngle - currentAngle; <span class="comment">// 计算角度差</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (diff &gt; <span class="number">180</span>) &#123;</span><br><span class="line">      diff -= <span class="number">360</span>; <span class="comment">// 顺时针旋转超过180度，调整为负值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; -<span class="number">180</span>) &#123;</span><br><span class="line">      diff += <span class="number">360</span>; <span class="comment">// 逆时针旋转超过180度，调整为正值</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> diff; <span class="comment">// 返回调整后的角度差</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 更新旋转角度</span></span><br><span class="line">  private <span class="title function_">updateRotationAngle</span>(<span class="attr">angleDifference</span>: number, <span class="attr">newAngle</span>: number): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cumulativeRotation</span> += angleDifference; <span class="comment">// 累加旋转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> += angleDifference; <span class="comment">// 更新当前旋转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentAngle</span> = newAngle; <span class="comment">// 更新当前传感器角度</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 动画更新</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">cumulativeRotation</span>; <span class="comment">// 将旋转角度设置为累计旋转角度</span></span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`累计旋转角度: <span class="subst">$&#123;<span class="variable language_">this</span>.cumulativeRotation&#125;</span>`</span>); <span class="comment">// 打印累计旋转角度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 根据角度计算方向</span></span><br><span class="line">  private <span class="title function_">calculateDirection</span>(<span class="attr">angle</span>: number): string &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> range <span class="keyword">of</span> <span class="variable constant_">DIRECTION_RANGES</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (angle &gt;= range.<span class="property">min</span> &amp;&amp; angle &lt; range.<span class="property">max</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> range.<span class="property">name</span>; <span class="comment">// 返回对应的方向名称</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;未知方向&#x27;</span>; <span class="comment">// 如果角度不在任何范围内，返回未知方向</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建用户界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建一个列布局，设置间距为20</span></span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建一个行布局，设置间距为5</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">directionMessage</span>) <span class="comment">// 显示当前方向</span></span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置布局权重</span></span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">End</span>) <span class="comment">// 文本对齐方式</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&#x27;#dedede&#x27;</span>) <span class="comment">// 文本颜色</span></span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">50</span>); <span class="comment">// 文本大小</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="variable language_">this</span>.currentAngle)&#125;</span>°`</span>) <span class="comment">// 显示当前角度</span></span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置布局权重</span></span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>) <span class="comment">// 文本对齐方式</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&#x27;#dedede&#x27;</span>) <span class="comment">// 文本颜色</span></span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">50</span>); <span class="comment">// 文本大小</span></span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;); <span class="comment">// 设置宽度和上边距</span></span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">        <span class="title class_">Stack</span>() &#123; <span class="comment">// 内部堆叠布局</span></span><br><span class="line">          <span class="title class_">Circle</span>() <span class="comment">// 创建一个圆形</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">250</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">250</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">fillOpacity</span>(<span class="number">0</span>) <span class="comment">// 设置填充透明度</span></span><br><span class="line">            .<span class="title function_">strokeWidth</span>(<span class="number">25</span>) <span class="comment">// 设置边框宽度</span></span><br><span class="line">            .<span class="title function_">stroke</span>(<span class="string">&#x27;#f95941&#x27;</span>) <span class="comment">// 设置边框颜色</span></span><br><span class="line">            .<span class="title function_">strokeDashArray</span>([<span class="number">1</span>, <span class="number">5</span>]) <span class="comment">// 设置边框虚线样式</span></span><br><span class="line">            .<span class="title function_">strokeLineJoin</span>(<span class="title class_">LineJoinStyle</span>.<span class="property">Round</span>); <span class="comment">// 设置边框连接方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;北&#x27;</span>) <span class="comment">// 创建一个文本，显示“北”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#ff4f3f&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">0</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;东&#x27;</span>) <span class="comment">// 创建一个文本，显示“东”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#fcfdfd&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">90</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;南&#x27;</span>) <span class="comment">// 创建一个文本，显示“南”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#fcfdfd&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">180</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;西&#x27;</span>) <span class="comment">// 创建一个文本，显示“西”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#fcfdfd&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">270</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;) <span class="comment">// 设置上边距</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: -<span class="variable language_">this</span>.<span class="property">rotationAngle</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">        .<span class="title function_">animation</span>(&#123;&#125;); <span class="comment">// 设置动画效果</span></span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Line</span>() <span class="comment">// 创建一个线条</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">5</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">40</span>) <span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#fdfffe&#x27;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="number">200</span> &#125;); <span class="comment">// 设置下边距</span></span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">300</span>); <span class="comment">// 设置高度</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#18181a&#x27;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="level"><a href="#level" class="headerlink" title="level"></a>level</h1><p>水平仪</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//module.json5</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;module&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;requestPermissions&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ohos.permission.ACCELEROMETER&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入传感器服务模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; sensor &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.SensorServiceKit&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入业务错误处理模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义单位长度，用于后续计算中的比例尺</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">UNIT_LENGTH</span> = <span class="number">4</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用 @Entry 和 @Component 装饰器定义一个名为 LevelMeter 的组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">LevelMeter</span> &#123;</span><br><span class="line">  <span class="comment">// 定义状态变量，用于存储当前角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">angle</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量，用于存储前后倾斜角度（pitch）</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">pitch</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量，用于存储左右倾斜角度（roll）</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">roll</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 定义角度变化阈值，用于判断是否需要更新角度</span></span><br><span class="line">  private <span class="attr">threshold</span>: number = <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时的生命周期方法</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取传感器列表</span></span><br><span class="line">    sensor.<span class="title function_">getSensorList</span>(<span class="function">(<span class="params">error: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="comment">// 如果获取传感器列表失败，输出错误信息</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取传感器列表失败&#x27;</span>, error);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 开始更新方向信息</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">startOrientationUpdates</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动方向更新的方法</span></span><br><span class="line">  private <span class="title function_">startOrientationUpdates</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 注册加速度传感器事件监听器</span></span><br><span class="line">    sensor.<span class="title function_">on</span>(sensor.<span class="property">SensorId</span>.<span class="property">ACCELEROMETER</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 计算新的前后倾斜角度（pitch）</span></span><br><span class="line">      <span class="keyword">const</span> newPitch = <span class="title class_">Math</span>.<span class="title function_">atan</span>(data.<span class="property">y</span> / <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(data.<span class="property">x</span> * data.<span class="property">x</span> + data.<span class="property">z</span> * data.<span class="property">z</span>)) * (<span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">      <span class="comment">// 计算新的左右倾斜角度（roll）</span></span><br><span class="line">      <span class="keyword">const</span> newRoll = <span class="title class_">Math</span>.<span class="title function_">atan</span>(data.<span class="property">x</span> / <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(data.<span class="property">y</span> * data.<span class="property">y</span> + data.<span class="property">z</span> * data.<span class="property">z</span>)) * (<span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 如果新的角度变化超过阈值，则更新状态</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(newPitch - <span class="variable language_">this</span>.<span class="property">pitch</span>) &gt; <span class="variable language_">this</span>.<span class="property">threshold</span> || <span class="title class_">Math</span>.<span class="title function_">abs</span>(newRoll - <span class="variable language_">this</span>.<span class="property">roll</span>) &gt; <span class="variable language_">this</span>.<span class="property">threshold</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pitch</span> = newPitch;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">roll</span> = newRoll;</span><br><span class="line">        <span class="comment">// 更新当前角度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">angle</span> = <span class="title class_">Math</span>.<span class="title function_">hypot</span>(newPitch, newRoll);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, &#123; <span class="attr">interval</span>: <span class="number">100000000</span> &#125;); <span class="comment">// 设置更新间隔为100毫秒</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算小球位置的方法</span></span><br><span class="line">  private <span class="title function_">calculateBallPosition</span>(): <span class="title class_">Position</span> &#123;</span><br><span class="line">    <span class="comment">// 根据当前角度计算半径</span></span><br><span class="line">    <span class="keyword">const</span> radius = (<span class="variable language_">this</span>.<span class="property">angle</span> &lt;= <span class="number">10</span> ? <span class="variable language_">this</span>.<span class="property">angle</span> * <span class="number">2.5</span> : (<span class="number">10</span> * <span class="number">2.5</span> + (<span class="variable language_">this</span>.<span class="property">angle</span> - <span class="number">10</span>))) * <span class="variable constant_">UNIT_LENGTH</span>;</span><br><span class="line">    <span class="comment">// 将角度转换为弧度</span></span><br><span class="line">    <span class="keyword">const</span> angleInRadians = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(<span class="variable language_">this</span>.<span class="property">pitch</span>, <span class="variable language_">this</span>.<span class="property">roll</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 计算小球在圆周上的X坐标</span></span><br><span class="line">    <span class="keyword">const</span> x = -radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>(angleInRadians);</span><br><span class="line">    <span class="comment">// 计算小球在圆周上的Y坐标</span></span><br><span class="line">    <span class="keyword">const</span> y = radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>(angleInRadians);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 返回小球的位置</span></span><br><span class="line">    <span class="keyword">return</span> &#123; x, y &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 使用Stack布局容器</span></span><br><span class="line">    <span class="title class_">Stack</span>() &#123;</span><br><span class="line">      <span class="comment">// 显示当前角度的文本</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建一个行布局，设置间距为5</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="variable language_">this</span>.angle)&#125;</span>°`</span>)<span class="comment">// 显示当前角度</span></span><br><span class="line">            .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)<span class="comment">// 设置布局权重</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#dedede&#x27;</span>)<span class="comment">// 文本颜色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">60</span>); <span class="comment">// 文本大小</span></span><br><span class="line">        &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置宽度和上边距</span></span><br><span class="line">      &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置高度和对齐方式</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 模拟水平仪背景的圆环</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="comment">// 外部大圆</span></span><br><span class="line">        <span class="title class_">Text</span>()</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;600lpx&#x27;</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;600lpx&#x27;</span>)<span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#171b1e&quot;</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">blur</span>(<span class="number">50</span>)<span class="comment">// 设置模糊效果</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="attr">radius</span>: <span class="number">300</span>, <span class="attr">type</span>: <span class="title class_">ShadowType</span>.<span class="property">COLOR</span>, <span class="attr">color</span>: <span class="string">&quot;#232426&quot;</span> &#125;); <span class="comment">// 设置阴影效果</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 中间圆</span></span><br><span class="line">        <span class="title class_">Text</span>()</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.angle &lt;= <span class="number">10</span> ? <span class="variable language_">this</span>.angle * <span class="number">2.5</span> : (<span class="number">10</span> * <span class="number">2.5</span> + (<span class="variable language_">this</span>.angle - <span class="number">10</span>))) * UNIT_LENGTH *</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.angle &lt;= <span class="number">10</span> ? <span class="variable language_">this</span>.angle * <span class="number">2.5</span> : (<span class="number">10</span> * <span class="number">2.5</span> + (<span class="variable language_">this</span>.angle - <span class="number">10</span>))) * UNIT_LENGTH *</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算高度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#2e3235&quot;</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">animation</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseOut</span> &#125;); <span class="comment">// 设置动画效果</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 刻度线</span></span><br><span class="line">        <span class="title class_">ForEach</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>], <span class="function">(<span class="params">item: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>()</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="number">15</span> + item) * UNIT_LENGTH * <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;(<span class="number">15</span> + item) * UNIT_LENGTH * <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算高度</span></span><br><span class="line">            .<span class="title function_">borderWidth</span>(<span class="number">1</span>)<span class="comment">// 设置边框宽度</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="string">&quot;#807d8184&quot;</span>); <span class="comment">// 设置边框颜色</span></span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 刻度数字</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">20</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&quot;#7d8184&quot;</span>)<span class="comment">// 设置字体颜色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">10</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 设置文本对齐方式</span></span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;(<span class="number">15</span> + item) * UNIT_LENGTH * <span class="number">2</span>&#125;</span>lpx`</span> &#125;); <span class="comment">// 设置左边距</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 小球</span></span><br><span class="line">        <span class="title class_">Text</span>()</span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">14</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">14</span>)<span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#ff5841&quot;</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>); <span class="comment">// 设置圆角</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 小球背景</span></span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">radialGradient</span>(&#123;</span><br><span class="line">            <span class="attr">center</span>: [<span class="number">20</span>, <span class="number">20</span>], <span class="comment">// 设置渐变中心点</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">60</span>, <span class="comment">// 设置渐变半径</span></span><br><span class="line">            <span class="attr">colors</span>: [</span><br><span class="line">              [<span class="string">&quot;#807a7a83&quot;</span>, <span class="number">0.0</span>], <span class="comment">// 渐变颜色1</span></span><br><span class="line">              [<span class="string">&quot;#8074747e&quot;</span>, <span class="number">0.7</span>], <span class="comment">// 渐变颜色2</span></span><br><span class="line">              [<span class="string">&quot;#80898992&quot;</span>, <span class="number">1.0</span>]<span class="comment">// 渐变颜色3</span></span><br><span class="line">            ]</span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度和高度</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">clip</span>(<span class="literal">true</span>) <span class="comment">// 设置裁剪</span></span><br><span class="line">        .<span class="title function_">radialGradient</span>(&#123;</span><br><span class="line">          <span class="attr">center</span>: [<span class="number">20</span>, <span class="number">20</span>], <span class="comment">// 设置渐变中心点</span></span><br><span class="line">          <span class="attr">radius</span>: <span class="number">60</span>, <span class="comment">// 设置渐变半径</span></span><br><span class="line">          <span class="attr">colors</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="variable language_">this</span>.<span class="property">angle</span>) === <span class="number">0</span> ?</span><br><span class="line">            [[<span class="string">&quot;#FF6B6B&quot;</span>, <span class="number">0.0</span>], [<span class="string">&quot;#D84315&quot;</span>, <span class="number">0.3</span>], [<span class="string">&quot;#C62828&quot;</span>, <span class="number">1.0</span>]] : <span class="comment">// 当角度为0时的渐变颜色</span></span><br><span class="line">            [[<span class="string">&quot;#bcbcc6&quot;</span>, <span class="number">0.0</span>], [<span class="string">&quot;#464650&quot;</span>, <span class="number">0.3</span>], [<span class="string">&quot;#474750&quot;</span>, <span class="number">1.0</span>]] <span class="comment">// 当角度不为0时的渐变颜色</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">50</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">translate</span>(&#123;</span><br><span class="line">          <span class="attr">x</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.calculateBallPosition().x&#125;</span>lpx`</span>, <span class="comment">// 设置X轴偏移</span></span><br><span class="line">          <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.calculateBallPosition().y&#125;</span>lpx`</span> <span class="comment">// 设置Y轴偏移</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">animation</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseOut</span> &#125;); <span class="comment">// 设置动画效果</span></span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;580lpx&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;580lpx&#x27;</span>).<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置外部大圆的宽度、高度和圆角</span></span><br><span class="line">    &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置Stack的高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置Stack的宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#18181a&quot;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="turntable"><a href="#turntable" class="headerlink" title="turntable"></a>turntable</h1><p>转盘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CounterComponent</span>, <span class="title class_">CounterType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入计数器组件和计数器类型</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义扇形组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Sector</span> &#123;</span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">radius</span>: number; <span class="comment">// 扇形的半径</span></span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">angle</span>: number; <span class="comment">// 扇形的角度</span></span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">color</span>: string; <span class="comment">// 扇形的颜色</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 创建扇形路径的函数</span></span><br><span class="line">  <span class="title function_">createSectorPath</span>(<span class="attr">radius</span>: number, <span class="attr">angle</span>: number): string &#123;</span><br><span class="line">    <span class="keyword">const</span> centerX = radius / <span class="number">2</span>; <span class="comment">// 计算扇形中心的X坐标</span></span><br><span class="line">    <span class="keyword">const</span> centerY = radius / <span class="number">2</span>; <span class="comment">// 计算扇形中心的Y坐标</span></span><br><span class="line">    <span class="keyword">const</span> startX = centerX; <span class="comment">// 扇形起始点的X坐标</span></span><br><span class="line">    <span class="keyword">const</span> startY = centerY - radius; <span class="comment">// 扇形起始点的Y坐标</span></span><br><span class="line">    <span class="keyword">const</span> halfAngle = angle / <span class="number">4</span>; <span class="comment">// 计算半个角度</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 计算扇形结束点1的坐标</span></span><br><span class="line">    <span class="keyword">const</span> endX1 = centerX + radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>((halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">const</span> endY1 = centerY - radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>((halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 计算扇形结束点2的坐标</span></span><br><span class="line">    <span class="keyword">const</span> endX2 = centerX + radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>((-halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">const</span> endY2 = centerY - radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>((-halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 判断是否为大弧</span></span><br><span class="line">    <span class="keyword">const</span> largeArcFlag = angle / <span class="number">2</span> &gt; <span class="number">180</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> sweepFlag = <span class="number">1</span>; <span class="comment">// 设置弧线方向为顺时针</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 生成SVG路径命令</span></span><br><span class="line">    <span class="keyword">const</span> pathCommands =</span><br><span class="line">      <span class="string">`M<span class="subst">$&#123;startX&#125;</span> <span class="subst">$&#123;startY&#125;</span> A<span class="subst">$&#123;radius&#125;</span> <span class="subst">$&#123;radius&#125;</span> 0 <span class="subst">$&#123;largeArcFlag&#125;</span> <span class="subst">$&#123;sweepFlag&#125;</span> <span class="subst">$&#123;endX1&#125;</span> <span class="subst">$&#123;endY1&#125;</span> L<span class="subst">$&#123;centerX&#125;</span> <span class="subst">$&#123;centerY&#125;</span> L<span class="subst">$&#123;endX2&#125;</span> <span class="subst">$&#123;endY2&#125;</span> A<span class="subst">$&#123;radius&#125;</span> <span class="subst">$&#123;radius&#125;</span> 0 <span class="subst">$&#123;largeArcFlag&#125;</span> <span class="subst">$&#123;<span class="number">1</span> -</span></span></span><br><span class="line"><span class="subst"><span class="string">        sweepFlag&#125;</span> <span class="subst">$&#123;startX&#125;</span> <span class="subst">$&#123;startY&#125;</span> Z`</span>;</span><br><span class="line">    <span class="keyword">return</span> pathCommands; <span class="comment">// 返回路径命令</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建扇形组件</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Stack</span>() &#123;</span><br><span class="line">      <span class="comment">// 创建第一个扇形路径</span></span><br><span class="line">      <span class="title class_">Path</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置宽度为半径</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置高度为半径</span></span><br><span class="line">        .<span class="title function_">commands</span>(<span class="variable language_">this</span>.<span class="title function_">createSectorPath</span>(<span class="variable language_">this</span>.<span class="property">radius</span>, <span class="variable language_">this</span>.<span class="property">angle</span>)) <span class="comment">// 设置路径命令</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>) <span class="comment">// 设置填充透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="variable language_">this</span>.<span class="property">color</span>) <span class="comment">// 设置填充颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">0</span>) <span class="comment">// 设置边框宽度为0</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="property">angle</span> / <span class="number">4</span> - <span class="number">90</span> &#125;); <span class="comment">// 旋转扇形</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建第二个扇形路径</span></span><br><span class="line">      <span class="title class_">Path</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置宽度为半径</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置高度为半径</span></span><br><span class="line">        .<span class="title function_">commands</span>(<span class="variable language_">this</span>.<span class="title function_">createSectorPath</span>(<span class="variable language_">this</span>.<span class="property">radius</span>, <span class="variable language_">this</span>.<span class="property">angle</span>)) <span class="comment">// 设置路径命令</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>) <span class="comment">// 设置填充透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="variable language_">this</span>.<span class="property">color</span>) <span class="comment">// 设置填充颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">0</span>) <span class="comment">// 设置边框宽度为0</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">180</span> - (<span class="variable language_">this</span>.<span class="property">angle</span> / <span class="number">4</span> - <span class="number">90</span>) &#125;); <span class="comment">// 旋转扇形</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义单元格类</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">angle</span>: number = <span class="number">0</span>; <span class="comment">// 扇形的角度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">title</span>: string; <span class="comment">// 当前格子的标题</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">color</span>: string; <span class="comment">// 背景颜色</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotate</span>: number = <span class="number">0</span>; <span class="comment">// 在转盘要旋转的角度</span></span><br><span class="line">  <span class="attr">angleStart</span>: number = <span class="number">0</span>; <span class="comment">// 轮盘所在区间的起始</span></span><br><span class="line">  <span class="attr">angleEnd</span>: number = <span class="number">0</span>; <span class="comment">// 轮盘所在区间的结束</span></span><br><span class="line">  <span class="attr">proportion</span>: number = <span class="number">0</span>; <span class="comment">// 所占比例</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">proportion: number, title: string, color: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">proportion</span> = proportion; <span class="comment">// 设置比例</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = title; <span class="comment">// 设置标题</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color; <span class="comment">// 设置颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义转盘组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Wheel</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cells</span>: <span class="title class_">Cell</span>[] = []; <span class="comment">// 存储单元格的数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">wheelWidth</span>: number = <span class="number">600</span>; <span class="comment">// 转盘的宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentAngle</span>: number = <span class="number">0</span>; <span class="comment">// 当前转盘的角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedName</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 选中的名称</span></span><br><span class="line">  <span class="attr">isAnimating</span>: boolean = <span class="literal">false</span>; <span class="comment">// 动画状态</span></span><br><span class="line">  <span class="attr">colorIndex</span>: number = <span class="number">0</span>; <span class="comment">// 颜色索引</span></span><br><span class="line">  <span class="attr">colorPalette</span>: string[] = [ <span class="comment">// 颜色调色板</span></span><br><span class="line">    <span class="string">&quot;#26c2ff&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#978efe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#c389fe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ff85bd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ff7051&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#fea800&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ffcf18&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#a9c92a&quot;</span></span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时调用</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化单元格</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>, <span class="string">&quot;跑步&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>, <span class="string">&quot;跳绳&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>, <span class="string">&quot;唱歌&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">4</span>, <span class="string">&quot;跳舞&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 计算角度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算每个单元格的角度</span></span><br><span class="line">  private <span class="title function_">calculateAngles</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 根据比例计算总比例</span></span><br><span class="line">    <span class="keyword">const</span> totalProportion = <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, cell</span>) =&gt;</span> sum + cell.<span class="property">proportion</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cell</span> =&gt;</span> &#123;</span><br><span class="line">      cell.<span class="property">angle</span> = (cell.<span class="property">proportion</span> * <span class="number">360</span>) / totalProportion; <span class="comment">// 计算每个单元格的角度</span></span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> cumulativeAngle = <span class="number">0</span>; <span class="comment">// 累计角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cell</span> =&gt;</span> &#123;</span><br><span class="line">      cell.<span class="property">angleStart</span> = cumulativeAngle; <span class="comment">// 设置起始角度</span></span><br><span class="line">      cumulativeAngle += cell.<span class="property">angle</span>; <span class="comment">// 更新累计角度</span></span><br><span class="line">      cell.<span class="property">angleEnd</span> = cumulativeAngle; <span class="comment">// 设置结束角度</span></span><br><span class="line">      cell.<span class="property">rotate</span> = cumulativeAngle - (cell.<span class="property">angle</span> / <span class="number">2</span>); <span class="comment">// 计算旋转角度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建转盘组件</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;转盘&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&quot;#0b0e15&quot;</span>); <span class="comment">// 显示转盘标题</span></span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="number">44</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置行的宽度和高度</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示当前状态</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">isAnimating</span> ? <span class="string">&#x27;旋转中&#x27;</span> : <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.selectedName&#125;</span>`</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&quot;#0b0e15&quot;</span>).<span class="title function_">height</span>(<span class="number">40</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="comment">// 遍历每个单元格并绘制扇形</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cells</span>, <span class="function">(<span class="params">cell: Cell</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Stack</span>() &#123;</span><br><span class="line">              <span class="title class_">Sector</span>(&#123; <span class="attr">radius</span>: <span class="title function_">lpx2px</span>(<span class="variable language_">this</span>.<span class="property">wheelWidth</span>) / <span class="number">2</span>, <span class="attr">angle</span>: cell.<span class="property">angle</span>, <span class="attr">color</span>: cell.<span class="property">color</span> &#125;); <span class="comment">// 创建扇形</span></span><br><span class="line">              <span class="title class_">Text</span>(cell.<span class="property">title</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>).<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.wheelWidth / <span class="number">1.4</span>&#125;</span>lpx`</span> &#125;); <span class="comment">// 显示单元格标题</span></span><br><span class="line">            &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: cell.<span class="property">rotate</span> &#125;); <span class="comment">// 设置宽度和高度，并旋转</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.wheelWidth&#125;</span>lpx`</span>) <span class="comment">// 设置转盘宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.wheelWidth&#125;</span>lpx`</span>) <span class="comment">// 设置转盘高度</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="property">currentAngle</span> &#125;); <span class="comment">// 旋转转盘</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建指针</span></span><br><span class="line">        <span class="title class_">Polygon</span>(&#123; <span class="attr">width</span>: <span class="number">20</span>, <span class="attr">height</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">points</span>([[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">10</span>, -<span class="number">20</span>], [<span class="number">20</span>, <span class="number">0</span>]]) <span class="comment">// 设置指针的点</span></span><br><span class="line">          .<span class="title function_">fill</span>(<span class="string">&quot;#d72b0b&quot;</span>) <span class="comment">// 设置指针颜色</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">20</span>) <span class="comment">// 设置指针高度</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">&#x27;140lpx&#x27;</span> &#125;); <span class="comment">// 设置指针底部边距</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建开始按钮</span></span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;开始&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&quot;#c53a2c&quot;</span>) <span class="comment">// 设置按钮字体颜色</span></span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">10</span>) <span class="comment">// 设置按钮边框宽度</span></span><br><span class="line">          .<span class="title function_">borderColor</span>(<span class="string">&quot;#dd2218&quot;</span>) <span class="comment">// 设置按钮边框颜色</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#fde427&quot;</span>) <span class="comment">// 设置按钮背景颜色</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;200lpx&#x27;</span>) <span class="comment">// 设置按钮宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;200lpx&#x27;</span>) <span class="comment">// 设置按钮高度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置按钮为圆形</span></span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击按钮时的回调函数</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimating</span>) &#123; <span class="comment">// 如果正在动画中，返回</span></span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">selectedName</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 清空选中的名称</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为正在动画</span></span><br><span class="line">            <span class="title function_">animateTo</span>(&#123; <span class="comment">// 开始动画</span></span><br><span class="line">              <span class="attr">duration</span>: <span class="number">5000</span>, <span class="comment">// 动画持续时间为5000毫秒</span></span><br><span class="line">              <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span>, <span class="comment">// 动画曲线为缓入缓出</span></span><br><span class="line">              <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">currentAngle</span> %= <span class="number">360</span>; <span class="comment">// 保持当前角度在0到360之间</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123; <span class="comment">// 遍历每个单元格</span></span><br><span class="line">                  <span class="comment">// 检查当前角度是否在单元格的角度范围内</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="number">360</span> - <span class="variable language_">this</span>.<span class="property">currentAngle</span> &gt;= cell.<span class="property">angleStart</span> &amp;&amp; <span class="number">360</span> - <span class="variable language_">this</span>.<span class="property">currentAngle</span> &lt;= cell.<span class="property">angleEnd</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedName</span> = cell.<span class="property">title</span>; <span class="comment">// 设置选中的名称为当前单元格的标题</span></span><br><span class="line">                    <span class="keyword">break</span>; <span class="comment">// 找到后退出循环</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为未动画</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画进行中的回调</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">currentAngle</span> += (<span class="number">360</span> * <span class="number">5</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">360</span>)); <span class="comment">// 更新当前角度，增加随机旋转</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建滚动区域</span></span><br><span class="line">      <span class="title class_">Scroll</span>() &#123;</span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 遍历每个单元格，创建输入框和计数器</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cells</span>, <span class="function">(<span class="params">item: Cell, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="comment">// 创建文本输入框，显示单元格标题</span></span><br><span class="line">              <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: item.<span class="property">title</span> &#125;)</span><br><span class="line">                .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置输入框占据剩余空间</span></span><br><span class="line">                .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 输入框内容变化时的回调</span></span><br><span class="line">                  item.<span class="property">title</span> = value; <span class="comment">// 更新单元格标题</span></span><br><span class="line">                &#125;);</span><br><span class="line">              <span class="comment">// 创建计数器组件</span></span><br><span class="line">              <span class="title class_">CounterComponent</span>(&#123;</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">type</span>: <span class="title class_">CounterType</span>.<span class="property">COMPACT</span>, <span class="comment">// 设置计数器类型为紧凑型</span></span><br><span class="line">                  <span class="attr">numberOptions</span>: &#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">`当前占比`</span>, <span class="comment">// 设置计数器标签</span></span><br><span class="line">                    <span class="attr">value</span>: item.<span class="property">proportion</span>, <span class="comment">// 设置计数器初始值</span></span><br><span class="line">                    <span class="attr">min</span>: <span class="number">1</span>, <span class="comment">// 设置最小值</span></span><br><span class="line">                    <span class="attr">max</span>: <span class="number">100</span>, <span class="comment">// 设置最大值</span></span><br><span class="line">                    <span class="attr">step</span>: <span class="number">1</span>, <span class="comment">// 设置步长</span></span><br><span class="line">                    <span class="attr">onChange</span>: <span class="function">(<span class="params">value: number</span>) =&gt;</span> &#123; <span class="comment">// 计数器值变化时的回调</span></span><br><span class="line">                      item.<span class="property">proportion</span> = value; <span class="comment">// 更新单元格的比例</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 重新计算角度</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="comment">// 创建删除按钮</span></span><br><span class="line">              <span class="title class_">Button</span>(<span class="string">&#x27;删除&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>); <span class="comment">// 从单元格数组中删除当前单元格</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 重新计算角度</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 设置行的宽度和内容对齐方式</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">40</span>, <span class="attr">right</span>: <span class="number">40</span> &#125;); <span class="comment">// 设置左右内边距</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;.<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 设置滚动区域占据剩余空间</span></span><br><span class="line">      &#125;.<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置滚动区域占据剩余空间</span></span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span> &#125;) <span class="comment">// 设置上下外边距</span></span><br><span class="line">      .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>); <span class="comment">// 设置对齐方式为顶部对齐</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建添加新内容按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;添加新内容&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 向单元格数组中添加新单元格</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>, <span class="string">&quot;新内容&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 重新计算角度</span></span><br><span class="line">      &#125;).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span> &#125;); <span class="comment">// 设置按钮的上下外边距</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置组件高度为100%</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置组件宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f5f8ff&quot;</span>); <span class="comment">// 设置组件背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Coin"><a href="#Coin" class="headerlink" title="Coin"></a>Coin</h1><p>投硬币</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义地鼠组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Hamster</span> &#123;</span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">cellWidth</span>: number <span class="comment">// 单元格宽度</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">      <span class="comment">// 身体</span></span><br><span class="line">      <span class="title class_">Text</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 宽度为单元格宽度的一半</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">3</span> * <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 高度为单元格高度的2/3</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#b49579&quot;</span>)<span class="comment">// 背景颜色</span></span><br><span class="line">        .<span class="title function_">borderRadius</span>(&#123; <span class="attr">topLeft</span>: <span class="string">&#x27;50%&#x27;</span>, <span class="attr">topRight</span>: <span class="string">&#x27;50%&#x27;</span> &#125;)<span class="comment">// 圆角</span></span><br><span class="line">        .<span class="title function_">borderColor</span>(<span class="string">&quot;#2a272d&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">borderWidth</span>(<span class="number">1</span>) <span class="comment">// 边框宽度</span></span><br><span class="line">      <span class="comment">// 嘴巴</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">4</span>&#125;</span>lpx`</span>)<span class="comment">// 嘴巴的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">5</span>&#125;</span>lpx`</span>)<span class="comment">// 嘴巴的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#e7bad7&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">stroke</span>(<span class="string">&quot;#563e3f&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)<span class="comment">// 边框宽度</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 上边距</span></span><br><span class="line">      <span class="comment">// 左眼睛</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">9</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼睛的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼睛的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#313028&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">stroke</span>(<span class="string">&quot;#2e2018&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)<span class="comment">// 边框宽度</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">3</span>&#125;</span>lpx`</span>, <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和右边距</span></span><br><span class="line">      <span class="comment">// 右眼睛</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">9</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼睛的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼睛的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#313028&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">stroke</span>(<span class="string">&quot;#2e2018&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)<span class="comment">// 边框宽度</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">3</span>&#125;</span>lpx`</span>, <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和左边距</span></span><br><span class="line">      <span class="comment">// 左眼瞳</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">20</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼瞳的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">15</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼瞳的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#fefbfa&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2.5</span>&#125;</span>lpx`</span>, <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和右边距</span></span><br><span class="line">      <span class="comment">// 右眼瞳</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">20</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼瞳的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">15</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼瞳的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#fefbfa&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2.5</span>&#125;</span>lpx`</span>, <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和左边距</span></span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>).<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置组件的宽度和高度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义页面组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">CoinTossPage</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellWidth</span>: number = <span class="number">50</span> <span class="comment">// 单元格宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">headsCount</span>: number = <span class="number">0</span> <span class="comment">// 正面朝上的次数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">tailsCount</span>: number = <span class="number">0</span> <span class="comment">// 反面朝上的次数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span> <span class="comment">// 旋转角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">verticalOffset</span>: number = <span class="number">0</span> <span class="comment">// 纵向位移</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isAnimRun</span>: boolean = <span class="literal">false</span> <span class="comment">// 动画是否正在执行</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 页面标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;抛硬币&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>)<span class="comment">// 高度设置为50</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)<span class="comment">// 宽度设置为100%</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中对齐</span></span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="string">&quot;#fefefe&quot;</span>)<span class="comment">// 字体颜色</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">20</span>); <span class="comment">// 字体大小</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示地鼠和计数</span></span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="title class_">Hamster</span>(&#123; <span class="attr">cellWidth</span>: <span class="variable language_">this</span>.<span class="property">cellWidth</span> &#125;) <span class="comment">// 创建地鼠组件</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">          <span class="comment">// 设置线性渐变背景</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">GradientDirection</span>.<span class="property">LeftBottom</span>,</span><br><span class="line">          <span class="attr">colors</span>: [[<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">0.0</span>], [<span class="string">&#x27;#fef888&#x27;</span>, <span class="number">0.5</span>], [<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">1.0</span>]]</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 显示反面朝上的次数</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.tailsCount&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&quot;#fefefe&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="comment">// 显示100</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&quot;100&quot;</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&quot;#9f7606&quot;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">          <span class="comment">// 设置线性渐变背景</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">GradientDirection</span>.<span class="property">LeftBottom</span>,</span><br><span class="line">          <span class="attr">colors</span>: [[<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">0.0</span>], [<span class="string">&#x27;#fef888&#x27;</span>, <span class="number">0.5</span>], [<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">1.0</span>]]</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 显示正面朝上的次数</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.headsCount&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&quot;#fefefe&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置宽度和内容居中对齐</span></span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建放大版地鼠组件</span></span><br><span class="line">          <span class="title class_">Hamster</span>(&#123; <span class="attr">cellWidth</span>: <span class="variable language_">this</span>.<span class="property">cellWidth</span> * <span class="number">3</span> &#125;)</span><br><span class="line">            .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isHeadsFaceUp</span>() ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>); <span class="comment">// 根据状态显示或隐藏</span></span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 显示100</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&quot;100&quot;</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&quot;#9f7606&quot;</span>)<span class="comment">// 字体颜色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span> * <span class="number">3</span>&#125;</span>lpx`</span>)<span class="comment">// 字体大小</span></span><br><span class="line">            .<span class="title function_">visibility</span>(!<span class="variable language_">this</span>.<span class="title function_">isHeadsFaceUp</span>() ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>)<span class="comment">// 根据状态显示或隐藏</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">              <span class="comment">// 旋转180度</span></span><br><span class="line">              <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">angle</span>: <span class="number">180</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth * <span class="number">3</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth * <span class="number">3</span>&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">          <span class="comment">// 设置线性渐变背景</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">GradientDirection</span>.<span class="property">LeftBottom</span>,</span><br><span class="line">          <span class="attr">colors</span>: [[<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">0.0</span>], [<span class="string">&#x27;#fef888&#x27;</span>, <span class="number">0.5</span>], [<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">1.0</span>]]</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">          <span class="comment">// 根据当前角度旋转</span></span><br><span class="line">          <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="property">rotationAngle</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">verticalOffset</span> &#125;) <span class="comment">// 设置纵向位移</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件处理</span></span><br><span class="line"> </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimRun</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isAnimRun</span> = <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line">          <span class="keyword">let</span> maxAnimationSteps = <span class="number">2</span> * (<span class="number">10</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>)); <span class="comment">// 计算最大动画次数</span></span><br><span class="line">          <span class="keyword">let</span> totalAnimationDuration = <span class="number">2000</span>; <span class="comment">// 动画总时长</span></span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 第一次动画，向上抛出</span></span><br><span class="line">          <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">            <span class="attr">duration</span>: totalAnimationDuration / <span class="number">2</span>, <span class="comment">// 动画时长为总时长的一半</span></span><br><span class="line">            <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">              <span class="comment">// 第二次动画，向下落</span></span><br><span class="line">              <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                <span class="attr">duration</span>: totalAnimationDuration / <span class="number">2</span>,</span><br><span class="line">                <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">rotationAngle</span> % <span class="number">360</span>; <span class="comment">// 确保角度在0到360之间</span></span><br><span class="line">                  <span class="comment">// 判断当前显示的面</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isHeadsFaceUp</span>()) &#123; <span class="comment">// 如果是地鼠面</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">tailsCount</span>++; <span class="comment">// 反面朝上的次数加1</span></span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果是反面</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">headsCount</span>++; <span class="comment">// 正面朝上的次数加1</span></span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">isAnimRun</span> = <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">verticalOffset</span> = <span class="number">0</span>; <span class="comment">// 重置纵向位移</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 设置纵向位移，模拟抛硬币的效果</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">verticalOffset</span> = -<span class="number">100</span> * (<span class="number">1</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span>)); <span class="comment">// 随机设置向上的位移</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 循环动画，增加旋转效果</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; maxAnimationSteps; i++) &#123;</span><br><span class="line">            <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">              <span class="attr">delay</span>: i * totalAnimationDuration / maxAnimationSteps, <span class="comment">// 设置每次动画的延迟</span></span><br><span class="line">              <span class="attr">duration</span>: <span class="number">100</span>, <span class="comment">// 每次动画的持续时间</span></span><br><span class="line">              <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 动画完成后的回调</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">rotationAngle</span> += <span class="number">90</span>; <span class="comment">// 每次增加90度旋转</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>).<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Bottom</span>).<span class="title function_">padding</span>(&#123; <span class="attr">bottom</span>: <span class="number">80</span> &#125;); <span class="comment">// 设置组件的宽度、权重、对齐方式和底部内边距</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置整个页面的高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置整个页面的宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0b0d0c&quot;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断当前是否显示地鼠面</span></span><br><span class="line">  <span class="title function_">isHeadsFaceUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> normalizedAngle = <span class="variable language_">this</span>.<span class="property">rotationAngle</span> % <span class="number">360</span>; <span class="comment">// 规范化角度</span></span><br><span class="line">    <span class="comment">// 判断角度范围，确定是否显示地鼠面</span></span><br><span class="line">    <span class="keyword">if</span> (normalizedAngle &gt;= <span class="number">0</span> &amp;&amp; normalizedAngle &lt; <span class="number">90</span> || normalizedAngle &gt;= <span class="number">270</span> &amp;&amp; normalizedAngle &lt;= <span class="number">360</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 显示地鼠面</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 显示反面</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<!--
分贝仪
https://blog.csdn.net/zhongcongxu01/article/details/143460361

https://blog.csdn.net/zhongcongxu01/article/details/142773929
-->

                </div>
                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/HarmonryOS/">HarmonryOS</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                    </div>
                </div>

                

                
                    <div class="post-nav border-box">
                        
                            <div class="prev-post">
                                <a class="prev"
                                   rel="prev"
                                   href="/2024/12/19/iRedMail-smtp/"
                                   title="iRedMail smtp"
                                >
                                    <span class="left arrow-icon flex-center">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">iRedMail smtp</span>
                                        <span class="post-nav-item">Prev posts</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="next-post">
                                <a class="next"
                                   rel="next"
                                   href="/2024/12/13/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8-%E5%9F%BA%E4%BA%8EArkTS%E5%8D%A1%E7%89%87%E5%BC%80%E5%8F%91-HarmonyOS%E6%9C%8D%E5%8A%A1%E5%8D%A1%E7%89%87/"
                                   title="鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片</span>
                                        <span class="post-nav-item">Next posts</span>
                                    </span>
                                    <span class="right arrow-icon flex-center">
                                        <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    






                
            </div>
        </div>

        
    </div>
</div>


                
            </div>
        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="wtime">
        <div class="wtime2">北京<span id="beijingTime"></span></div>
        <div class="wtime2" style="display: none;"> 东京<span id="tokyoTime"></span></div>
        <div class="wtime2">欧洲-巴黎<span id="parisTime"></span></div>
        <div class="wtime2">英国-伦敦 <span id="londonTime"></span></div>
        <div class="wtime2">美东-纽约 <span id="newYorkTime"></span></div>
        <div class="wtime2">美西-洛杉矶<span id="losAngelesTime"></span></div>
        <div  class="wtime2" style="display: none;">UTC<span id="utcTime"></span></div>
    </div>
    <div class="copyright-info info-item">
    
    
        Powered by&nbsp;Hexo <a target="_blank" href="https://hexo.io"></a>&nbsp;&&nbsp;Theme&nbsp; Keep 
        &copy;&nbsp;<span>2012</span>&nbsp;-&nbsp;2025
        
            &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">LM</a>
        
    </div>

    <div class="theme-info info-item">
    
    </div>

    

    

    
</footer>



<script type="text/javascript">

    // 定义各个时区相对UTC的偏移量（单位：小时），考虑夏令时情况设置不同偏移量范围
    const timeZoneOffsets = {
            'beijing': 8,  // 北京不实行夏令时，固定偏移8小时
            'tokyo': 9,  // 东京不实行夏令时，固定偏移9小时
            'paris': [1, 2],  // 巴黎实行夏令时，冬令时偏移1小时，夏令时偏移2小时（示例简化处理，实际更复杂）
            'london': [0, 1],  // 伦敦实行夏令时，冬令时偏移0小时，夏令时偏移1小时
            'newYork': [-5, -4],  // 纽约实行夏令时，冬令时偏移-5小时，夏令时偏移-4小时
            'losAngeles': [-8, -7]  // 洛杉矶实行夏令时，冬令时偏移-8小时，夏令时偏移-7小时
        };

        function padZero(num) {
            return num < 10? '0' + num : num;
        }

        function formatTime(date) {
            const year = date.getFullYear();
            const month = padZero(date.getMonth() + 1);
            const day = padZero(date.getDate());
            const hours = padZero(date.getHours());
            const minutes = padZero(date.getMinutes());
            const seconds = padZero(date.getSeconds());
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        function isDaylightSavingTime(date, zone) {
            const month = date.getMonth();
            const dstStart = new Date(date.getFullYear(), 3, 8, 2, 0, 0);  // 假设每年4月8日凌晨2点开始夏令时（简化示例，实际不同地区规则差异大）
            const dstEnd = new Date(date.getFullYear(), 10, 1, 2, 0, 0);  // 假设每年10月1日凌晨2点结束夏令时
            if (zone === 'paris' || zone === 'london' || zone === 'newYork' || zone === 'losAngeles') {
                return date >= dstStart && date < dstEnd;
            }
            return false;
        }

        function updateTime() {
            const now = new Date();
            const utcDate = new Date(now.getUTCFullYear(), now.getUTCMonth(), now.getUTCDate(), now.getUTCHours(),
                now.getUTCMinutes(), now.getUTCSeconds());
            const utcTime = formatTime(utcDate);
            document.getElementById('utcTime').innerHTML = utcTime;

            for (const zone in timeZoneOffsets) {
                const offsets = timeZoneOffsets[zone];
                let offset;
                if (Array.isArray(offsets)) {
                    offset = isDaylightSavingTime(utcDate, zone)? offsets[1] : offsets[0];
                } else {
                    offset = offsets;
                }
                const zoneDate = new Date(utcDate.getTime() + offset * 60 * 60 * 1000);
                document.getElementById(zone + 'Time').innerHTML = formatTime(zoneDate);
            }

            setTimeout(updateTime, 1000);
        }

        window.onload = function () {
            updateTime();
        };
    function notfound(imgElement) {  
            var src = imgElement.src;  
            var parts = src.split('/'); // 使用'/'分割URL  
            var filename = parts[parts.length - 1]; // 获取最后一部分（文件名）  
            //console.log(filename); // 输出: 20201124032511.png  
      
            imgElement.src = "https://47.115.223.75:8080/group1/v2/" + filename+"?timestamp=" + Date.now();
    
            imgElement.onerror = null; // 解绑onerror事件  
        }  
    //     function notfound() {
    
    //         var img2 = document.getElementById(this);  
    // var src = img2.src;  
    // var parts = src.split('/'); // 使用'/'分割URL  
    // var filename = parts[parts.length - 1]; // 获取最后一部分（文件名）  
    // console.log(filename); // 输出: image.jpg
    
    //         var img = event.srcElement;
    //         img.src = "https://img-home.csdnimg.cn/images/"+filename;
    //         img.onerror = null; //解绑onerror事件
    //     }
    </script>
        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        

        <!-- PC go comment -->
        

        <!-- PC full screen -->
        <li class="tools-item flex-center full-screen">
            <i class="fa-solid fa-expand"></i>
        </li>
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-toggle-theme-mode flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        

        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
</main>



<!-- common -->

<script src="/js/utils.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/toggle-theme.js"></script>

<script src="/js/code-block.js"></script>

<script src="/js/main.js"></script>

<script src="/js/libs/anime.min.js"></script>


<!-- local-search -->

    
<script src="/js/local-search.js"></script>



<!-- lazyload -->


<div class="">
    
        <!-- post-helper -->
        
<script src="/js/post/post-helper.js"></script>


        <!-- toc -->
        

        <!-- copyright-info -->
        

        <!-- share -->
        
    

    <!-- categories page -->
    

    <!-- links page -->
    

    <!-- photos page -->
    

    <!-- tools page -->
    
</div>

<!-- mermaid -->


<!-- pjax -->



</body>
</html>
